if (self.CavalryLogger) { CavalryLogger.start_js(["7FuJK"]); }

__d("FBRTCCallConstants",[],(function a(b,c,d,e,f,g){f.exports={FBRTCCallConnectionType:{MISSED_CALL:4,CONNECTED_CALL:5},FBRTCCallType:{VOICE_CALL:1,VIDEO_CALL:2,COLLAB_VIDEO_CALL:3,COLLAB_SCREEN_SHARE_CALL:4}}}),null);
__d("LinkshimCallsites",[],(function a(b,c,d,e,f,g){f.exports={INTERNAL_WIKI:1,MZERO_UPSELL:2,EVENTS_TICKET:3,UNIT_TEST:4,WEB_RESULT:5,OG_COMMENT_NOTIF:6,M_DATA_UPSELL:7,FBURL:8,M_URI:9,THIRD_PARTY_URL:10,UI_LINK:11,LANDING_CAMPAIGN:12,STREAM_CONTENT_TICKER:13,SOCIAL_WIFI_DEPRECATED:14,TIMELINE_APP_COLLECTION:15,SAVED_LATER_VIEW_ITEM:16,REQUESTS_CONTROLLER:17,LOGIN_BUTTON:18,COMMENT_PLUGIN_REDIRECT_ENTAPP:19,COMMENT_PLUGIN_REDIRECT_APPOWNED:20,M_DEEPLINK:21,M_DEEPLINK_INVALID:22,EVENT_BUY_TICKET:23,PAGE_TYPEAHEAD:24,EGO_ACTION:25,INTERN_SURVEY:26,RETIRED_ENDPOINT:27,OG_COMMENT_FEEDBACK_TARGET:28,LIKE_COMMON_RENDERER:29,NOTIFICATIONS_LINK:30,COUPON_OFFSITE_LINK:31,MZERO_MAILTO:32,MZERO:33,MERCURY_SHARE_ATTACHMENT:34,EXTERNAL_TOKEN_SURVEY:35,FBURL_INTERN:36,LANDING_PAGE_EXPERIMENT:37,OG_FEEDBACK_TARGET:38,GAMEDAY:39,ENTISH:40,JS_ENV:41,LINKSHIM_AUTOMATION:42,TASKS_APP:45,FEEDBACK_MODEL:46,JP_EMAIL_LINK:47,NOTIFICATION_REWRITE:48,OG_ACTION_PERMALINK:49,MALWARE_SCAN:50,EMAIL_LINK:51,EMAIL_ATTACHMENT:52,RENDER_EMAIL_LEGACY:53,TAGGED_WITH_STORY_EMAIL_NOTIF:54,MSG_INTRO_NOTIF:55,GROUP_COMMENT_NOTIF:56,EVENT_INVITE_LOCATION_EMAIL:57,EVENT_INVITE_MESSAGE_EMAIL:58,CLOSE_FRIEND_ACTIVITY:59,GROUP_DOC_CREATED_URL:60,GROUP_DOC_CREATED_NAME:61,MALL_POST_EMAIL_NOTIF:62,MALL_POST_SOCIAL_MSG:63,NOTIFICATION_REWRITE_RSS:64,WALL_POST_SOCIAL_MSG:65,TITAN_MSG_BODY_EMAIL:66,TITAN_MSG_BODY_SUBJECT:67,GROUP_POST_EMAIL:68,GROUP_POST_URL_EMAIL:69,GROUP_POST_PERMALINK_EMAIL:70,GROUP_POST_OPTOUT_EMAIL:71,GROUP_POST_TEXT_NOTIF:72,CLOSE_FRIEND_EMAIL_SHARE:73,PLACE_TAGGED_IN_CHECKIN:74,QUESTIONS_ANSWER_EMAIL:75,SUPPORT_TASK_COMMENT:76,INVITE_MESSAGE_EMAIL:77,GROUP_REQUEST_TO_JOIN_EMAIL:78,GROUP_POST_COMMENT_PERMALINK:79,GROUP_POST_COMMENT_OPTOUT:80,GROUP_POST_COMMENT_TEXT:81,EVENT_NAME_CHANGE_NOTIF:82,EVENT_NAME_CHANGE_OLD_NAME_NOTIF:83,EVENT_NAME_CHANGE_NEW_NAME_NOTIF:84,EVENT_CANCEL_NOTIFICATION:85,BASE_COMMENT_NOTIF:86,FBPAGE_FAN_INVITE_NAME:87,FBPAGE_FAN_INVITE_MSG:88,MESSAGING_HTML_EMAIL:89,ROLLOUT_TEXT_EMAIL:90,COMMENT_EMAIL_TEXT:91,SHARE_CONTENT_LEGACY_EMAIL:92,MZERO_UPSELL_NOTIF:93,INTERN_DEBUG:94,CALL_TO_ACTION:95,QUICK_PROMOTION_ACTION:96,COMPOSED_TEXT:97,GIF_SEARCH:98,OFFERS:99,MZERO_ATTACHMENTS:100,MZERO_UPLOADS:101,CCTA_LINK:102,M_CCTA_LINK:103,SAVED_ITEM_REDIRECT:104,ADS_PROMOTED_OBJECT:105,EMBEDS_MTOUCH_SELECT:106,IORG_BOOKMARK:107,PAYPAL_INIT:108,FUNDRAISER_NOTIF:109,COMMENTS_PLUGIN_NOTIF:110,INSTANT_SHOPPING_ACTION:111,LINK_MENU:112,TALENT_SEARCH:113,COMET:114,INTERVIEW_STATS:115,SCHEDULR:116,BULK_SCHEDULR:117,CIRCA_LINK:118,MZERO_CHANGE_DESTINATION:119,LINK_REACT:120,LYNX_EXTRA_REDIRECT:121,UI_LINK_EXPERIMENTAL:122,COORD_DASHBOARD:123,WHITEHAT:124,INSTAGRAM_PROFILE_URL:125,INSTAGRAM_DIRECT_MESSAGE:126,SNAPTU:127,RHC_CLICK_TRACKING:128,NOTIFICATIONS_TARGET:129,INSTANT_WORKFLOWS_PAYMENT_RECEIPT:130,INTEGRITY_CRAWLER:131,KILL_LINKSHIM_SECURE_REDIRECT:132,INSTAGRAM_STORY_URL:133,INSTAGRAM_LINKSHIM_URL:134,UNTRUSTED_LINK_JS:135,LYNX_EXPIRED_LINK:136,LYNX_USER_CONFIRMED_LINK:137,LYNX_INVALID_PARAMS:138,REMARKUP:139,PAYMENT_REDIRECT:140,PAGES_PLATFORM_APP_SETTING:141,PAGES_WEBSITE:142,RECRUITING_EMAIL:143,MN_PLATFORM_CTA_WEBVIEW_URL:144,WALYNX_INTERNAL:145,INSTANT_ARTICLE_APP_CTA:146,INSTANT_ARTICLE_CTA_POLICY_LINK:147,INSTANT_ARTICLE_CTA_TERMS_LINK:148,STONEHENGE_SUBSCRIBE:149,STONEHENGE_LOGIN:150,PRODUCT_RECOMMENDATION_LINK:151,ENT_PROFILE_WEBSITE:152,PROFILE_LEGACY_WEBSITE:153}}),null);
__d("XLinkshimLinkAsyncController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/linkshim/ajax/link/",{href:{type:"String",required:true},callsite:{type:"Enum",required:true,enumType:0}})}),null);
__d("LinkshimURI",["AsyncRequest","XLinkshimLinkAsyncController","isFacebookURI"],(function a(b,c,d,e,f,g){"use strict";var h={asyncGet:function i(j,k,l){if(c("isFacebookURI")(j)){l(j);return null}var m=c("XLinkshimLinkAsyncController").getURIBuilder().setString("href",j.toString()).setEnum("callsite",k).getURI(),n=new(c("AsyncRequest"))(m).setHandler(function(o){var p=o.getPayload();l(p.uri)});n.send();return n}};f.exports=h}),null);
__d("LinkshimLink.react",["Link.react","LinkshimURI","React","URI","areEqual"],(function a(b,c,d,e,f,g){"use strict";var h,i,j=c("React").PropTypes;h=babelHelpers.inherits(k,c("React").Component);i=h&&h.prototype;function k(){var l,m;for(var n=arguments.length,o=Array(n),p=0;p<n;p++)o[p]=arguments[p];return m=(l=i.constructor).call.apply(l,[this].concat(o)),this.state={shimURI:undefined},m}k.prototype.componentWillMount=function(){this.$LinkshimLink2(this.props)};k.prototype.componentWillUnmount=function(){this.$LinkshimLink3()};k.prototype.componentWillReceiveProps=function(l){if(!c("areEqual")(this.props,l))this.$LinkshimLink2(l)};k.prototype.$LinkshimLink3=function(){if(this.$LinkshimLink1)this.$LinkshimLink1.abandon()};k.prototype.$LinkshimLink2=function(l){this.$LinkshimLink3();this.$LinkshimLink1=c("LinkshimURI").asyncGet(l.uri,l.callsite,function(m){return this.setState({shimURI:m})}.bind(this))};k.prototype.render=function(){if(!this.state.shimURI)return this.props.loadingPlaceholder?this.props.loadingPlaceholder:null;var l=this.props,m=l.children,n=babelHelpers.objectWithoutProperties(l,["children"]);return c("React").createElement(c("Link.react"),babelHelpers["extends"]({href:this.state.shimURI},n),m)};k.propTypes={uri:j.instanceOf(c("URI")).isRequired,callsite:j.number.isRequired,loadingPlaceholder:j.element};f.exports=k}),null);
__d("XVideoCallAdminMessageController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/videocall/admin_msg/",{})}),null);
__d("FBRTCAdminMessage",["FBRTCConstants","FBRTCCallConstants","FBRTCLogger","FBRTCUtils","XVideoCallAdminMessageController","emptyFunction","performanceNow"],(function a(b,c,d,e,f,g){function h(i,j){"use strict";this.$FBRTCAdminMessage1=i;this.$FBRTCAdminMessage2=j;this.$FBRTCAdminMessage3=Date.now();this.$FBRTCAdminMessage4=null;this.$FBRTCAdminMessage5=null}h.prototype.onCallConnected=function(){"use strict";if(!this.$FBRTCAdminMessage4)this.$FBRTCAdminMessage4=c("performanceNow")()};h.prototype.onCallEnded=function(){"use strict";if(!this.$FBRTCAdminMessage5)this.$FBRTCAdminMessage5=c("performanceNow")()};h.prototype.submit=function(i,j){"use strict";if(!this.$FBRTCAdminMessage5)this.onCallEnded();var k=0,l=c("FBRTCCallConstants").FBRTCCallConnectionType.MISSED_CALL;if(this.$FBRTCAdminMessage4){k=Math.ceil(this.$FBRTCAdminMessage5-this.$FBRTCAdminMessage4);l=c("FBRTCCallConstants").FBRTCCallConnectionType.CONNECTED_CALL}var m=l===c("FBRTCCallConstants").FBRTCCallConnectionType.CONNECTED_CALL||j===c("FBRTCConstants").CallEndReason.IGNORE_CALL;this.$FBRTCAdminMessage6({peer_id:this.$FBRTCAdminMessage1,call_id:this.$FBRTCAdminMessage2,start_time:this.$FBRTCAdminMessage3,call_duration:k,message_type:l,call_category:i,call_acknowledged:m})};h.prototype.$FBRTCAdminMessage6=function(i){"use strict";var j=c("XVideoCallAdminMessageController").getURIBuilder().getURI();c("FBRTCUtils").sendServerRequest(j,c("emptyFunction"),this.$FBRTCAdminMessage7.bind(this,i.peer_id,i.call_id),false,null,i)};h.prototype.$FBRTCAdminMessage7=function(i,j,k){"use strict";var l;if(k)l="Fail to log admin message, error "+k.error;else l="Server timed out on logging admin message";c("FBRTCLogger").getInstance().logError(i,j,l)};f.exports=h}),null);
__d("CollabCallMessengerBrowserEventEnum",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({CALL_START_TRY:"call: try",CALL_PROCESS_STARTED:"call: start process",CALL_CONNECTED:"call: connected",CALL_ENDED:"call: ended",CONNECTION_INFO:"connection info",TURN_CREDENTIALS_RECEIVED:"TURN credentials received",HANGUP_CALL_ID_MISSMATCH:"hangup callID missmatch",CONNECTION_RECOVERY:"connection recovery",OFFER_ACCEPTED:"offer accepted",OFFER_IGNORED:"offer ignored",RENEGOTIATION:"offer renegotiation",LOCAL_STREAM_SET:"local stream: set",LOCAL_STREAM_READY:"local stream: ready",LOCAL_STREAM_STARTED:"local stream: started",LOCAL_STREAM_TRACKS_CHANGED:"local stream: tracks changed",LOCAL_SCREEN_STREAM_SET:"screen stream: set",SCREEN_SHARING_CANCELLED:"screen sharing: cancelled",SCREEN_SHARING_DIALOG_CANCEL:"screen sharing: dialog cancel",SCREEN_SHARING_DIALOG_SUCCESS:"screen sharing: dialog success",SCREEN_SHARING_EXT_DIALOG:"screen sharing: extension install dialog",SCREEN_SHARING_EXT_LINK:"screen sharing: user clicked on install link",SCREEN_SHARING_NOT_SUPPORTED:"screen sharing: not supported",SCREEN_SHARING_TOGGLED:"screen sharing: toggled",REMOTE_STREAM_SET:"remote stream: set",REMOTE_STREAM_STARTED:"remote stream: started",REMOTE_STREAM_TRACKS_CHANGED:"remote stream: tracks changed",REMOTE_STREAM_ADDED:"remote stream: added",REMOTE_STREAM_MUTE_TOGGLED:"remote steam: mute toggled",REMOTE_STREAM_REMOVED:"remote stream: removed",FAIL_BROWSER_NOT_SUPPORTED:"browser not supported",CALL_CONTROLLER_INIT:"call controller init",REQUEST_USER_MEDIA:"request user media",WSS_START_TRY:"wss: try",WSS_CONNECTED:"wss: connected",WSS_ENDED:"wss: ended",ICE_CONNECTION_STATE_CHANGE:"ICE connection state change",ICE_GATHERING_STATE_CHANGE:"ICE gathering state change",ICE_CANDIDATE_ERROR:"ICE candidate error",USER_SETTINGS_CHANGED:"user settings change",RTC_ERROR:"RTC error",MESSAGE_SENT:"message sent",MESSAGE_RECEIVED:"message received",SDP_UPDATE:"SDP update"})}),null);
__d("FBRTCPCConfig",["FBRTCConfig","FBRTCVersionDetection","RTCConfig"],(function a(b,c,d,e,f,g){var h="stun:stun.fbsbx.com:3478",i=function i(k,l,m){if(c("FBRTCVersionDetection").isChrome()&&c("FBRTCVersionDetection").webrtcVersion()>=34){var n={urls:k};if(l&&m){n.username=l;n.credential=m}return[n]}var o=[];for(var p=0;p<k.length;p++)if(l&&m)o.push({url:k[p],username:l,credential:m});else o.push({url:k[p]});return o},j={setTurnCredentials:function k(l){this.turnIP=l.ip;this.udpPort=l.udp_port;this.tcpPort=l.tcp_port;this.sslPort=l.ssl_tcp_port;this.turnUsername=l.username;this.turnPassword=l.password},getConfig:function k(){if(c("FBRTCConfig").isVCEndpointCall()&&c("RTCConfig").CollabDisableBrowserTurnDiscoveryGK)return{iceServers:[]};var l=i([h]).concat(i(this._turnUrls(),this.turnUsername,this.turnPassword));return{iceServers:l}},getConstraints:function k(){return{mandatory:{},optional:[{DtlsSrtpKeyAgreement:true},{googHighBitrate:true},{googVeryHighBitrate:true}]}},_turnUrls:function k(){if(c("FBRTCVersionDetection").isFirefox()&&c("FBRTCVersionDetection").webrtcVersion()<27)return["turn:"+this.turnIP+":"+this.udpPort];else return["turn:"+this.turnIP+":"+this.udpPort+"?transport=udp","turn:"+this.turnIP+":"+this.tcpPort+"?transport=tcp","turn:"+this.turnIP+":"+this.sslPort+"?transport=tcp"]}};f.exports=j}),null);
__d("FBRTCSdpUtils",["UserAgent"],(function a(b,c,d,e,f,g){var h="m=video 0",i="m=video 0 NULL/NULL 0",j=["audio","video"].map(function(x){return new RegExp("m="+x+"\\s+\\d+\\s+(\\w+\\/?)+(\\s+\\d+)+")}),k=j[0],l=j[1],m=function m(x){return x.match(/^a=rtpmap:(\d+)\s/)[1]},n=function n(x,y,z){var A=m(x[y]),B=x[z].split("RTP/SAVPF"),C=B[1].split(/\s+/),D=C.indexOf(A);C.splice(D,1);B[1]=C.join(" ");x[z]=B.join("RTP/SAVPF");x.splice(y,1)},o=function o(x,y,z){var A=m(x[y]);n(x,y,z);var B=new RegExp("^a=(rtcp-fb|fmtp):"+A+" ");x=x.filter(function(F){return!B.test(F)});var C=new RegExp("^a=fmtp:(\\d+)\\s+apt="+A+"($|;)"),D=x.reduce(function(D,F,G){var H=F.match(C);return H?[].concat(D,[H[1]]):D},[]).join("|"),E=new RegExp("^a=rtpmap:("+D+")\\s+rtx/|^a=fmtp:("+D+")\\s+apt=");return x.filter(function(F){return!E.test(F)})},p={RX_SDP_MEDIA_AUDIO:k,RX_SDP_MEDIA_VIDEO:l,replaceRTPSAVPFProfile:function x(y){var z="UDP/TLS/RTP/SAVPF",A="RTP/SAVPF";while(y.indexOf(z)>=0)y=y.replace(z,A);return y},addIceOptionToSdp:function x(y,z){"use strict";var A="a=ice-options:",B=y.indexOf(A);if(B>=0)return y.split("\r\n").map(function(I){return I.startsWith(A)?I+" "+z:I}).join("\r\n");var C=A+z,D=y.split("\r\n"),E=false,F=-1;for(var G=0;G<D.length;G++){var H=D[G].slice(0,2);if(H=="s="){E=true;continue}if(E&&H=="a="){F=G;break}}if(F>=0){D.splice(F,0,C);return D.join("\r\n")}return[y,C,"\r\n"].join("")},preferIsac:function x(y){var z=y.split("\r\n"),A=-1,B=-1,C=-1;for(var D=0;D<z.length;D++){var E=z[D];if(E.match(k))A=D;if(C===-1&&A>-1&&E.match(/^a=rtpmap:/))C=D;if(E.match(/^a=rtpmap:\d+\s+ISAC\/16000/))B=D}if(A===-1||B===-1||C===-1||z[A].indexOf("RTP/SAVPF")===-1)return z.join("\r\n");var F=z[B];n(z,B,A);z.splice(C,0,F);z[A]=z[A].replace("RTP/SAVPF","RTP/SAVPF "+m(F));return z.join("\r\n")},preferCodec:function x(y,z,A){var B,C=y.split("\r\n"),D=A?l:k,E=C.findIndex(function(F){return D.test(F)});if(E!==-1&&C[E].indexOf("RTP/SAVPF")!==-1)(function(){var F=new RegExp("^a=rtpmap:\\d+\\s+"+z),G=C.findIndex(function(K){return F.test(K)}),H=/^a=rtpmap:/,I=C.findIndex(function(K,L){return L>E&&H.test(K)});if(G!==-1&&I!==-1){var J=C[G];n(C,G,E);C.splice(I,0,J);C[E]=C[E].replace("RTP/SAVPF","RTP/SAVPF "+m(J))}})();return C.join("\r\n")},disableVideo:function x(y){var z=/m=video\s+\S+/;y=y.replace(z,h);if(c("UserAgent").isBrowser("Firefox <= 37"))y=this._makeDisabledVideoReceiveOnly(y);return y},_makeDisabledVideoReceiveOnly:function x(y){if(y.indexOf(h)>-1){var z=y.split(h);z[1]=z[1].replace(/send(recv|only)/,"recvonly");y=z.join(h)}return y},fixMobileIceSdp:function x(y){y=y.replace(/^a=/,"");y=y.split(/\s+username\s+.+password.+/)[0];var z=y.match(/\s+relay\s+|\s+srflx\s+/),A=y.match(/raddr.+rport.+/);if(z&&!A){z=z[0];var B=y.split(z),C=B[1].match(/^(\d+\.\d+\.\d+\.\d+)\s+(\d+)\s+/),D=void 0,E=void 0;if(C){D=C[1];E=C[2];B[1]=B[1].replace(C[0],"")}else{C=B[0].split(/\s+/);D=C[4];E=C[5]}y=""+B[0]+z+"raddr "+D+" rport "+E+" "+B[1]}return y},addAudioNack:function x(y){var z=[];y=y.split("\r\n").map(function(A){var B="";if(z.length>0&&(/^a=rtpmap:(\d+)/.test(A)||/^a=ssrc/.test(A)||/^m=/.test(A))){B+=this._getrtcpFeedbackLinesFromAudioFMTs(z)+"\r\n";z=[]}if(/^m=audio/.test(A))z=A.match(/^m=audio\s+[\d\/]+\s+[\w\/]+([\s+\d+]+)/)[1].trim().split(" ");return B+A}.bind(this)).join("\r\n");if(z.length>0)y+="\r\n"+this._getrtcpFeedbackLinesFromAudioFMTs(z);return y},addSetup:function x(y){if(y.indexOf("a=setup:")>=0)return y;var z=y.split("\r\n"),A=z.findIndex(function(C){return C.startsWith("s=")}),B=z.findIndex(function(C,D){return D>A&&C.startsWith("a=")});z.splice(B,0,"a=setup:actpass");return z.join("\r\n")},_getrtcpFeedbackLinesFromAudioFMTs:function x(y){return y.map(function(z){return"a=rtcp-fb:"+z+" nack"}).join("\r\n")},removeFEC:function x(y){var z=y.split("\r\n"),A=void 0,B=void 0;for(var C=0;C<z.length;C++){if(z[C].match(/^a=rtpmap:\d+\s+red\//))A=C;if(z[C].match(/^m=video/))B=C}if(A&&B)n(z,A,B);return z.join("\r\n")},removeH264:function x(y){var z=y.split("\r\n"),A=/^a=rtpmap:\d+\s+H264\//,B=z.findIndex(function(E){return A.test(E)}),C=/^m=video/,D=z.findIndex(function(E){return C.test(E)});return B!==-1&&D!==-1?o(z,B,D).join("\r\n"):y},removeVP9:function x(y){var z=y.split("\r\n"),A=/^a=rtpmap:\d+\s+VP9\//,B=z.findIndex(function(E){return A.test(E)}),C=/^m=video/,D=z.findIndex(function(E){return C.test(E)});return B!==-1&&D!==-1?o(z,B,D).join("\r\n"):y},isVideoSupported:function x(y){return y&&y.indexOf("m=video")!==-1&&(y.indexOf(h)===-1||y.indexOf(i)!==-1)},setDtlsRole:function x(y,z){if(!y.match(/setup:(active|passive|actpass)/))return y.replace(/(a=fingerprint:.+)/g,"$1\r\na=setup:"+z);else return y.replace(/setup:actpass/g,"setup:"+z)},setVideoBitrateConstraint:function x(y){var z=720;if(y.match(/^b=AS:/m))return y;y=y.replace(/^a=mid:video\r\n/m,"a=mid:video\r\nb=AS:"+z+"\r\n");return y},removeSdparta:function x(y){var z=y.split("\r\n"),A="audio",B=false,C=-1;for(var D=0;D<z.length;D++){var E=z[D];if(E.indexOf("m=audio")===0)A="audio";if(E.indexOf("m=video")===0){B=true;A="video"}if(E.indexOf("a=mid:sdparta_")===0)z[D]="a=mid:"+A;if(E.indexOf("a=group:BUNDLE sdparta_")===0)C=D}if(C>-1)if(B)z[C]="a=group:BUNDLE audio video";else z[C]="a=group:BUNDLE audio";return z.join("\r\n")},useDTLSOverCrypto:function x(y){if(!(c("UserAgent").isBrowser("Chrome >= 57")||c("UserAgent").isBrowser("Opera >= 44")))return y;if(!/^a=fingerprint:/m.test(y))return y;return y.split("\r\n").filter(function(z){return z.indexOf("a=crypto:")!==0}).join("\r\n")},validateOfferSdp:function x(y,z){var A;if(y.split(":")[0]==="LIVE"){var A=function(){var B=/^m=/,C=/^m=audio/,D=/^m=video/,E=/^a=ssrc:/,F=z.split("\r\n"),G=[];for(var H=F.length-1;H>=0;H--)if(B.test(F[H]))G.push(F.splice(H));var I=false,J=false;G.forEach(function(K){if(C.test(K[0])&&!I)I=K.some(function(L){return E.test(L)});else if(D.test(K[0])&&!J)J=K.some(function(L){return E.test(L)})});return{v:I&&J}}();if(typeof A==="object")return A.v}return true},addFBFeatures:s,getFBFeatures:t,addNullVideo:function x(y){if(y.indexOf("m=video")!==-1)return y;if(y.indexOf("m=audio")===-1)return y+"\r\n"+i;var z=y.split("\r\n"),A=-1;for(var B=0;B<z.length;B++){var C=z[B];if(A>-1){if(!/^[abcik]=/.test(C))break;A=B}else if(C.indexOf("m=audio")===0)A=B}z.splice(A+1,0,i);return z.join("\r\n")},hasNullVideo:function x(y){return y.indexOf(i)!==-1}},q="a=x-fb-feature:",r="\r\n";function s(x){for(var y=arguments.length,z=Array(y>1?y-1:0),A=1;A<y;A++)z[A-1]=arguments[A];if(z.length<1)return x;var B=u(x),C=B[0],D=B[1],E=C.split(r),F=v(E),G=E.filter(function(I){return!I.startsWith(q)}),H=1+G.map(function(I){return I?I.substr(0,2):""}).lastIndexOf("a=")||G.length;return[].concat(G.slice(0),w([].concat(F,z)).map(function(I){return""+q+I}),G.slice(H),[D?[D.trim(),""].join(r):""]).join(r)}function t(x){var y=u(x),z=y[0];return v(z.split(r))}function u(x){if(!x)return["",""];var y=x.trim().split(r),z=0;while(z<y.length){if(y[z].startsWith("m="))break;z++}if(z===y.length)return[x.trim(),""];return[y.slice(0,z),y.slice(z)].map(function(A){return A.join(r).trim()})}function v(x){return w(x.filter(function(y){return y.startsWith(q)}).map(function(y){return y.substr(q.length)}))}function w(x){var y=Object.create(null);for(var z=x,A=Array.isArray(z),B=0,z=A?z:z[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var C;if(A){if(B>=z.length)break;C=z[B++]}else{B=z.next();if(B.done)break;C=B.value}var D=C;if(D)y[D]=true}return Object.keys(y).sort()}f.exports=p}),null);
__d("FBRTCStatsHelpers",["FBRTCLogger"],(function a(b,c,d,e,f,g){var h=function h(j){if(j==="host"||j==="local")return"local";if(j==="serverreflexive")return"srflx";if(j==="peerreflexive")return"prflx";if(j==="relayed"||j==="relay")return"relay";return"unknown"},i={connectionType:function j(k,l,m,n){return["l:",h(k),"-",l,";","r:",h(m),"-",n].join("")},logReport:function j(k){var l=c("FBRTCLogger").getInstance(),m=["connectionType","audioCodec","videoCodec","audioRtt","videoRtt","audioPacketsLost","videoPacketsLost","audioBytesSent","videoBytesSent","audioPacketsSent","videoPacketsSent"];for(var n=0;n<m.length;n++){var o=k[m[n]].call(k);l.logToConsole(m[n]+" => "+o)}}};f.exports=i}),null);
__d("FBRTCChromeStatsReport",["FBRTCStatsHelpers"],(function a(b,c,d,e,f,g){var h=function h(j,k){return parseInt(j.stat(k),10)};function i(){"use strict";this.$FBRTCChromeStatsReport1=[];this.$FBRTCChromeStatsReport2=null;this.$FBRTCChromeStatsReport3=null;this.$FBRTCChromeStatsReport4=null;this.$FBRTCChromeStatsReport5=null;this.$FBRTCChromeStatsReport6=null}i.prototype.parseReport=function(j){"use strict";j.result().forEach(function(k){if(k.type==="googCandidatePair"&&k.stat("googActiveConnection")==="true")this.$FBRTCChromeStatsReport1.push(k);if(this.$FBRTCChromeStatsReport7(k))this.$FBRTCChromeStatsReport2=k;if(this.$FBRTCChromeStatsReport8(k))this.$FBRTCChromeStatsReport3=k;if(this.$FBRTCChromeStatsReport9(k))this.$FBRTCChromeStatsReport4=k;if(this.$FBRTCChromeStatsReport10(k))this.$FBRTCChromeStatsReport5=k;if(k.type==="VideoBwe")this.$FBRTCChromeStatsReport6=k}.bind(this))};i.prototype.isConnected=function(){"use strict";return true};i.prototype.audioRtt=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,"googRtt")};i.prototype.videoRtt=function(){"use strict";if(!this.$FBRTCChromeStatsReport3)return 0;return h(this.$FBRTCChromeStatsReport3,"googRtt")};i.prototype.audioCodec=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return"unknown";return this.$FBRTCChromeStatsReport2.stat("googCodecName")};i.prototype.videoCodec=function(){"use strict";if(!this.$FBRTCChromeStatsReport3)return"unknown";return this.$FBRTCChromeStatsReport3.stat("googCodecName")};i.prototype.audioPacketsLost=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,"packetsLost")};i.prototype.setVideoPacketsLost=function(j){"use strict";this.$FBRTCChromeStatsReport11=j};i.prototype.videoPacketsLost=function(){"use strict";if(!this.$FBRTCChromeStatsReport3)return 0;if(this.$FBRTCChromeStatsReport11)return this.$FBRTCChromeStatsReport11;return h(this.$FBRTCChromeStatsReport3,"packetsLost")};i.prototype.audioBytesSent=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,"bytesSent")};i.prototype.videoBytesSent=function(){"use strict";if(!this.$FBRTCChromeStatsReport3)return 0;return h(this.$FBRTCChromeStatsReport3,"bytesSent")};i.prototype.audioPacketsSent=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,"packetsSent")};i.prototype.videoPacketsSent=function(){"use strict";if(!this.$FBRTCChromeStatsReport3)return 0;return h(this.$FBRTCChromeStatsReport3,"packetsSent")};i.prototype.videoFrameRateSent=function(){"use strict";if(!this.$FBRTCChromeStatsReport3)return 0;return h(this.$FBRTCChromeStatsReport3,"googFrameRateSent")};i.prototype.videoFrameRateCaptured=function(){"use strict";if(!this.$FBRTCChromeStatsReport3)return 0;return h(this.$FBRTCChromeStatsReport3,"googFrameRateInput")};i.prototype.connectionType=function(){"use strict";var j="unknown",k="unknown",l="unknown";for(var m=0;m<this.$FBRTCChromeStatsReport1.length;m++){var n=this.$FBRTCChromeStatsReport1[m];k=n.stat("googLocalCandidateType");l=n.stat("googRemoteCandidateType");j=n.stat("googTransportType")}return c("FBRTCStatsHelpers").connectionType(k,j,l,j)};i.prototype.$FBRTCChromeStatsReport7=function(j){"use strict";return j.type==="ssrc"&&j.names().indexOf("audioInputLevel")>-1};i.prototype.$FBRTCChromeStatsReport8=function(j){"use strict";return j.type==="ssrc"&&j.names().indexOf("googFrameHeightInput")>-1};i.prototype.$FBRTCChromeStatsReport9=function(j){"use strict";return j.type==="ssrc"&&j.names().indexOf("audioOutputLevel")>-1};i.prototype.$FBRTCChromeStatsReport10=function(j){"use strict";return j.type==="ssrc"&&j.names().indexOf("googFrameHeightReceived")>-1};f.exports=i}),null);
__d("FBRTCMozStatsReport",["Map","FBRTCLogger","FBRTCStatsHelpers"],(function a(b,c,d,e,f,g){function h(){"use strict";this.$FBRTCMozStatsReport1=null;this.$FBRTCMozStatsReport2=null;this.$FBRTCMozStatsReport3=null;this.$FBRTCMozStatsReport4=null;this.candidates=new(c("Map"))();this.candidatePairs=new(c("Map"))();this.$FBRTCMozStatsReport5=c("FBRTCLogger").getInstance()}h.prototype.parseReport=function(i){"use strict";i.forEach(function(j){switch(j.type){case"inboundrtp":if(!j.remoteId)break;var k={inbound:j,outbound:i[j.remoteId]};if(j.isRemote)if(Object.prototype.hasOwnProperty.call(k.outbound,"framerateMean"))this.$FBRTCMozStatsReport2=k;else this.$FBRTCMozStatsReport1=k;else if(Object.prototype.hasOwnProperty.call(k.outbound,"framerateMean"))this.$FBRTCMozStatsReport4=k;else this.$FBRTCMozStatsReport3=k;break;case"outboundrtp":break;case"candidatepair":if(j.state==="succeeded")this.candidatePairs.set(j.id,j);break;case"localcandidate":this.candidates.set(j.id,j);break;case"remotecandidate":this.candidates.set(j.id,j);break;default:this.$FBRTCMozStatsReport5.logToConsole("unrecognized webrtc stats type "+j.type);break}}.bind(this))};h.prototype.isConnected=function(){"use strict";return!!this.$FBRTCMozStatsReport1};h.prototype.audioRtt=function(){"use strict";if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.inbound.mozRtt};h.prototype.videoRtt=function(){"use strict";if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.inbound.mozRtt};h.prototype.audioCodec=function(){"use strict";return"opus"};h.prototype.videoCodec=function(){"use strict";return"VP8"};h.prototype.audioPacketsLost=function(){"use strict";if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.inbound.packetsLost};h.prototype.setVideoPacketsLost=function(i){"use strict"};h.prototype.videoPacketsLost=function(){"use strict";if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.inbound.packetsLost};h.prototype.audioBytesSent=function(){"use strict";if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.outbound.bytesSent};h.prototype.videoBytesSent=function(){"use strict";if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.outbound.bytesSent};h.prototype.audioPacketsSent=function(){"use strict";if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.outbound.packetsSent};h.prototype.videoPacketsSent=function(){"use strict";if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.outbound.packetsSent};h.prototype.videoFrameRateSent=function(){"use strict";if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.outbound.framerateMean};h.prototype.videoFrameRateCaptured=function(){"use strict";if(!this.$FBRTCMozStatsReport2)return 0;return 30};h.prototype.connectionType=function(){"use strict";var i="unknown",j="unknown",k="unknown",l="unknown";this.candidatePairs.forEach(function(m){var n=this.candidates.get(m.localCandidateId),o=this.candidates.get(m.remoteCandidateId);i=n.transport;k=o.transport;j=n.candidateType;l=o.candidateType}.bind(this));return c("FBRTCStatsHelpers").connectionType(j,i,l,k)};f.exports=h}),null);
__d("FBRTCStatsReportFactory",["FBRTCMozStatsReport","FBRTCChromeStatsReport","FBRTCLogger","FBRTCVersionDetection"],(function a(b,c,d,e,f,g){var h=function h(k,l){k.getStats(null,function(m){var n=new(c("FBRTCMozStatsReport"))();n.parseReport(m);l(n)},function(){c("FBRTCLogger").getInstance().logToConsole("Firefox stats collection failed")})},i=function i(k,l){k.getStats(function(m){var n=new(c("FBRTCChromeStatsReport"))();n.parseReport(m);l(n)})},j={getStats:function k(l,m){if(c("FBRTCVersionDetection").isFirefox())h(l,m);if(c("FBRTCVersionDetection").isChrome())i(l,m)}};f.exports=j}),null);
__d("FBRTCCallConnection",["invariant","Promise","Base64","FBRTCConfig","FBRTCLogger","FBRTCPCConfig","FBRTCConstants","FBRTCSdpUtils","FBRTCStatsReportFactory","Queue","RTCConfig","UserAgent","mixInEventEmitter"],(function a(b,c,d,e,f,g,h){var i=3e5,j=12e3,k=1e4,l="data",m=1e3,n=100;function o(){"use strict";this.$FBRTCCallConnection1=c("FBRTCLogger").getInstance();this.$FBRTCCallConnection2();this.$FBRTCCallConnection3=null;this.$FBRTCCallConnection4=null;this.$FBRTCCallConnection5=new(c("Queue"))({interval:1,processor:this.$FBRTCCallConnection6.bind(this)});this.$FBRTCCallConnection7=null;this.$FBRTCCallConnection8=null;this.$FBRTCCallConnection9=false;this.$FBRTCCallConnection10=0;this.$FBRTCCallConnection11=[];this.$FBRTCCallConnection12=false;this.$FBRTCCallConnection13="passive";this.$FBRTCCallConnection14=true;this.$FBRTCCallConnection15=0;this.$FBRTCCallConnection16={};this.$FBRTCCallConnection17=null}o.prototype.init=function(p){"use strict";this.$FBRTCCallConnection1.logToConsole("Creating a new peer connection with: "+JSON.stringify(c("FBRTCPCConfig").getConfig())+", "+JSON.stringify(c("FBRTCPCConfig").getConstraints()));this.$FBRTCCallConnection18=p};o.prototype.setStream=function(p){"use strict";this.$FBRTCCallConnection18=p};o.prototype.addScreenStream=function(p){"use strict";if(p&&p.getStream()){this.$FBRTCCallConnection1.logToConsole("Screen stream added");this.$FBRTCCallConnection19=p}else this.$FBRTCCallConnection1.logToConsole("Trying to add invalid stream")};o.prototype.removeScreenStream=function(p){"use strict";if(p&&p.getStream()){this.$FBRTCCallConnection1.logToConsole("Screen stream removed");try{this.$FBRTCCallConnection3.removeStream(p.getStream())}catch(q){this.$FBRTCCallConnection1.logToConsole("Missing connection to remove stream from")}}else this.$FBRTCCallConnection1.logToConsole("Trying to remove an invalid stream");this.$FBRTCCallConnection19=null};o.prototype.setPeerSupportsVideo=function(p){"use strict";this.$FBRTCCallConnection14=p};o.prototype.$FBRTCCallConnection20=function(){"use strict";var p={};if(this.$FBRTCCallConnection18&&this.$FBRTCCallConnection18.hasStream()){var q=this.$FBRTCCallConnection18.hasVideoTracks()?c("FBRTCConstants").StreamType.AUDIO_VIDEO:c("FBRTCConstants").StreamType.AUDIO_ONLY;p[this.$FBRTCCallConnection18.getStreamId()]={type:q}}if(this.$FBRTCCallConnection19&&this.$FBRTCCallConnection19.hasStream())p[this.$FBRTCCallConnection19.getStreamId()]={type:c("FBRTCConstants").StreamType.SCREEN_CONTENT};return{streams:p}};o.prototype.$FBRTCCallConnection21=function(p){"use strict";this.$FBRTCCallConnection1.logToConsole("Setting new remote attributes: "+JSON.stringify(p));this.$FBRTCCallConnection17=p};o.prototype.getRemoteAttributesForStream=function(p){"use strict";var q=p&&this.$FBRTCCallConnection17&&this.$FBRTCCallConnection17.streams;return q&&q[p.id]};o.prototype.isScreenStream=function(p){"use strict";var q=this.getRemoteAttributesForStream(p);if(q){this.$FBRTCCallConnection1.logToConsole("Stream "+p.id+" type attribute is: "+q.type);return q.type===c("FBRTCConstants").StreamType.SCREEN_CONTENT}else{this.$FBRTCCallConnection1.logToConsole("No attributes found for stream "+p.id);return false}};o.prototype.getRemoteStreamsCount=function(){"use strict";return this.$FBRTCCallConnection3.getRemoteStreams().length};o.prototype.$FBRTCCallConnection22=function(p,q){"use strict";this.$FBRTCCallConnection23(null);p.onaddstream=null;p.onremovestream=null;p.onicecandidate=null;p.oniceconnectionstatechange=null;this.$FBRTCCallConnection11=[];var r=q?5e3:1;setTimeout(function(){if(p.iceConnectionState!=="closed")p.close()},r)};o.prototype.$FBRTCCallConnection24=function(){"use strict";if(this.$FBRTCCallConnection3)this.$FBRTCCallConnection22(this.$FBRTCCallConnection3,true);var p=new this.nativePeerConnection(c("FBRTCPCConfig").getConfig(),c("FBRTCPCConfig").getConstraints());this.$FBRTCCallConnection13="passive";p.onaddstream=this.$FBRTCCallConnection25.bind(this);p.onremovestream=this.$FBRTCCallConnection26.bind(this);p.onicecandidate=this.$FBRTCCallConnection27.bind(this);p.oniceconnectionstatechange=this.$FBRTCCallConnection28.bind(this);p.addStream(this.$FBRTCCallConnection29());return p};o.prototype.$FBRTCCallConnection23=function(p){"use strict";this.$FBRTCCallConnection5.stop(true);if(this.isDataChannelOpen())this.$FBRTCCallConnection4.close();this.$FBRTCCallConnection4=p;if(!p)return;this.$FBRTCCallConnection4.onopen=this.$FBRTCCallConnection30.bind(this);this.$FBRTCCallConnection4.onclose=this.$FBRTCCallConnection31.bind(this);this.$FBRTCCallConnection4.onerror=this.$FBRTCCallConnection32.bind(this);this.$FBRTCCallConnection4.onmessage=this.$FBRTCCallConnection33.bind(this)};o.prototype.$FBRTCCallConnection30=function(event){"use strict";this.$FBRTCCallConnection5.start();this.emit("data_opened",event)};o.prototype.$FBRTCCallConnection31=function(event){"use strict";this.$FBRTCCallConnection23(null);this.emit("data_closed",event)};o.prototype.$FBRTCCallConnection32=function(event){"use strict";this.$FBRTCCallConnection23(null);this.emit("data_error",event)};o.prototype.$FBRTCCallConnection33=function(event){"use strict";var p=JSON.parse(event.data);if(p.batchID===undefined){this.emit("data_message",p.data);return}if(this.$FBRTCCallConnection16[p.batchID]===undefined)this.$FBRTCCallConnection16[p.batchID]=[];var q=this.$FBRTCCallConnection16[p.batchID];q.push(p.data);if(!p.isLast)return;var r=c("Base64").decodeObject(q.join(""));delete this.$FBRTCCallConnection16[p.batchID];this.emit("data_message",r.data)};o.prototype.isDataChannelOpen=function(){"use strict";return!!this.$FBRTCCallConnection4&&this.$FBRTCCallConnection4.readyState==="open"};o.prototype.sendData=function(p){"use strict";this.$FBRTCCallConnection5.enqueue({data:p})};o.prototype.$FBRTCCallConnection6=function(p){"use strict";if(!this.isDataChannelOpen()){h(0);return}if(p.batchID!==undefined){this.$FBRTCCallConnection34(p);return}var q=JSON.stringify(p);try{this.$FBRTCCallConnection4.send(q);return}catch(r){}if(q.length<m){setTimeout(function(){this.$FBRTCCallConnection5.enqueue(p)}.bind(this),n);return}var s={batchID:this.$FBRTCCallConnection15.toString(),dataStr:c("Base64").encode(q)};this.$FBRTCCallConnection15++;this.$FBRTCCallConnection34(s)};o.prototype.$FBRTCCallConnection34=function(p){"use strict";while(this.isDataChannelOpen()&&p.dataStr.length>0){var q={batchID:p.batchID,data:p.dataStr.slice(0,m)},r=p.dataStr.slice(m);if(r.length<=0)q.isLast=true;try{this.$FBRTCCallConnection4.send(JSON.stringify(q))}catch(s){setTimeout(function(){this.$FBRTCCallConnection5.enqueue(p)}.bind(this),n);return}p.dataStr=r}};o.prototype.createOffer=function(){"use strict";this.$FBRTCCallConnection3=this.$FBRTCCallConnection24();if(c("FBRTCConfig").shouldCreateDataChannel())this.$FBRTCCallConnection23(this.$FBRTCCallConnection3.createDataChannel(l));this.$FBRTCCallConnection35("offer");this.$FBRTCCallConnection13="active"};o.prototype.createSdpUpdate=function(p){"use strict";if(p){var q=this.$FBRTCCallConnection3.getLocalStreams();for(var r=0;r<q.length;r++)this.$FBRTCCallConnection3.removeStream(q[r]);this.$FBRTCCallConnection3.addStream(this.$FBRTCCallConnection18.getStream());if(this.$FBRTCCallConnection19)this.$FBRTCCallConnection3.addStream(this.$FBRTCCallConnection19.getStream())}else this.$FBRTCCallConnection29();this.$FBRTCCallConnection35("sdp_update")};o.prototype.$FBRTCCallConnection29=function(){"use strict";var p=this.$FBRTCCallConnection18.getStream();if(!this.$FBRTCCallConnection19){if(this.$FBRTCCallConnection36){this.$FBRTCCallConnection37(this.$FBRTCCallConnection36);this.$FBRTCCallConnection36=null}}else{this.$FBRTCCallConnection36=p.getVideoTracks()[0];var q=this.$FBRTCCallConnection19.getStream().getVideoTracks(),r=q[0];this.$FBRTCCallConnection37(r)}return p};o.prototype.$FBRTCCallConnection37=function(p){"use strict";var q=this.$FBRTCCallConnection18.getStream(),r=q.getVideoTracks(),s=r.length;while(s--)q.removeTrack(r[s]);q.addTrack(p)};o.prototype.$FBRTCCallConnection35=function(p){"use strict";this.$FBRTCCallConnection12=true;this.$FBRTCCallConnection3.createOffer(this.$FBRTCCallConnection38.bind(this,p),this.$FBRTCCallConnection39.bind(this,"CreateOfferFailed"),this.$FBRTCCallConnection40())};o.prototype.$FBRTCCallConnection40=function(){"use strict";if(c("UserAgent").isBrowser("Chrome <= 37")||c("UserAgent").isBrowser("Opera <= 25"))return{mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:this.$FBRTCCallConnection14}};return{offerToReceiveAudio:true,offerToReceiveVideo:this.$FBRTCCallConnection14}};o.prototype.end=function(){"use strict";this.$FBRTCCallConnection1.logToConsole("Ending connection...");if(this.$FBRTCCallConnection3){this.emit("isEnding");this.$FBRTCCallConnection22(this.$FBRTCCallConnection3,false);this.$FBRTCCallConnection3=null}};o.prototype.onReceivedOfferSDP=function(p,q){"use strict";this.$FBRTCCallConnection3=this.$FBRTCCallConnection24();if(c("FBRTCConfig").shouldCreateDataChannel())this.$FBRTCCallConnection3.ondatachannel=function(event){this.$FBRTCCallConnection23(event.channel)}.bind(this);var r=new this.nativeSessionDescription({type:"offer",sdp:p});this.$FBRTCCallConnection21(q);r.sdp=c("FBRTCSdpUtils").addSetup(r.sdp);this.$FBRTCCallConnection3.setRemoteDescription(r,this.$FBRTCCallConnection41.bind(this,r),this.$FBRTCCallConnection39.bind(this,"SetRemoteOfferFailed"))};o.prototype.onReceivedAnswerSDP=function(p,q){"use strict";var r=new this.nativeSessionDescription({type:"answer",sdp:p});this.$FBRTCCallConnection21(q);this.$FBRTCCallConnection3.setRemoteDescription(r,this.$FBRTCCallConnection41.bind(this,r),this.$FBRTCCallConnection39.bind(this,"SetRemoteAnswerFailed"))};o.prototype.onReceivedSdpUpdate=function(p,q){"use strict";if(this.$FBRTCCallConnection12)setTimeout(function(){this.onReceivedSdpUpdate(p,q)}.bind(this),200);switch(this.$FBRTCCallConnection3.signalingState){case"stable":this.$FBRTCCallConnection42(p,"offer",q);break;case"have-local-offer":p=c("FBRTCSdpUtils").setDtlsRole(p,this.$FBRTCCallConnection13);this.$FBRTCCallConnection42(p,"answer",q);break;case"have-remote-offer":setTimeout(function(){this.onReceivedSdpUpdate(p,q)}.bind(this),1e3);break;case"have-local-pranswer":case"have-remote-pranswer":break;case"closed":break}};o.prototype.$FBRTCCallConnection42=function(p,q,r){"use strict";var s=new this.nativeSessionDescription({type:q,sdp:p});this.$FBRTCCallConnection12=true;this.$FBRTCCallConnection21(r);this.$FBRTCCallConnection3.setRemoteDescription(s,function(){this.$FBRTCCallConnection1.logToConsole("sdp update "+s.type+" set");if(this.$FBRTCCallConnection3&&s.type==="offer")this.$FBRTCCallConnection3.createAnswer(this.$FBRTCCallConnection38.bind(this,"sdp_update"),this.$FBRTCCallConnection39.bind(this,"CreateSdpUpdateFailed"));else this.$FBRTCCallConnection12=false}.bind(this),this.$FBRTCCallConnection39.bind(this,"SetRemoteSdpUpdateFailed"))};o.prototype.onReceivedRemoteIceCandidate=function(p){"use strict";p.sdp=c("FBRTCSdpUtils").fixMobileIceSdp(p.sdp);var q=new this.nativeIceCandidate({sdpMLineIndex:p.label,candidate:p.sdp,sdpMid:p.sdp_mid});this.$FBRTCCallConnection3.addIceCandidate(q)};o.prototype.getStats=function(p){"use strict";c("FBRTCStatsReportFactory").getStats(this.$FBRTCCallConnection3,p)};o.prototype.getStatsNative=function(p){"use strict";if(c("UserAgent").isBrowser("Firefox"))return new(c("Promise"))(function(q){return q(this.$FBRTCCallConnection3.getStats(p))}.bind(this));if(c("UserAgent").isBrowser("Chrome"))return new(c("Promise"))(function(q,r){this.$FBRTCCallConnection3.getStats(function(s){var t={};s.result().forEach(function(u){var v={id:u.id,type:u.type};u.names().forEach(function(w){return v[w]=u.stat(w)});t[v.id]=v});q(t)},p,r)}.bind(this));return c("Promise").reject(new Error("browser not supported"))};o.prototype.getCreatedIceCandidates=function(){"use strict";return this.$FBRTCCallConnection11};o.prototype.$FBRTCCallConnection38=function(p,q){"use strict";this.$FBRTCCallConnection1.logToConsole("Created "+p+" sdp");if(!this.$FBRTCCallConnection3){this.$FBRTCCallConnection1.logToConsole("_onSDPCreated: pc has been deallocated");return}if(!this.$FBRTCCallConnection14&&p==="sdp_update")q.sdp=c("FBRTCSdpUtils").disableVideo(q.sdp);q.sdp=c("FBRTCSdpUtils").addIceOptionToSdp(q.sdp,"fb-force-5245");q.sdp=c("FBRTCSdpUtils").replaceRTPSAVPFProfile(q.sdp);q.sdp=c("FBRTCSdpUtils").preferIsac(q.sdp);q.sdp=c("FBRTCSdpUtils").removeSdparta(q.sdp);if(c("FBRTCConfig").isVCEndpointCall()&&c("RTCConfig").DeclareAudioNackCapabilityInSDPOffer&&c("UserAgent").isBrowser("Chrome >= 29"))q.sdp=c("FBRTCSdpUtils").addAudioNack(q.sdp);this.$FBRTCCallConnection3.setLocalDescription(q,function(){this.$FBRTCCallConnection12=false;this.$FBRTCCallConnection1.logToConsole("Local "+p+" set");this.emit("sdpCreated",{type:p,sdp:q.sdp,attributes:this.$FBRTCCallConnection20()})}.bind(this),this.$FBRTCCallConnection39.bind(this,"SetLocalDescriptionFailed:"+p))};o.prototype.$FBRTCCallConnection41=function(p){"use strict";this.$FBRTCCallConnection1.logToConsole("Remote "+p.type+" set");if(!this.$FBRTCCallConnection3){this.$FBRTCCallConnection1.logToConsole("_onRemoteDescriptionSet: pc has been deallocated");return}if(p.type==="offer")this.$FBRTCCallConnection3.createAnswer(this.$FBRTCCallConnection38.bind(this,"answer"),this.$FBRTCCallConnection39.bind(this,"CreateAnswerFailed"));this.emit("remoteDescriptionSet")};o.prototype.$FBRTCCallConnection25=function(event){"use strict";this.$FBRTCCallConnection1.logToConsole("Remote stream added");this.emit("remoteStreamAdded",{stream:event.stream})};o.prototype.$FBRTCCallConnection26=function(event){"use strict";this.$FBRTCCallConnection1.logToConsole("Remote stream removed");this.emit("remoteStreamRemoved",{stream:event.stream})};o.prototype.$FBRTCCallConnection27=function(event){"use strict";if(event.candidate){this.$FBRTCCallConnection11.push(event.candidate);this.emit("localIceCandidateCreated",event.candidate)}};o.prototype.$FBRTCCallConnection28=function(event){"use strict";var p=event.target.iceConnectionState;this.$FBRTCCallConnection1.logToConsole("Ice candidate state changed from "+this.$FBRTCCallConnection7+" to "+p);if(p===this.$FBRTCCallConnection7)return;this.$FBRTCCallConnection43();if(this.$FBRTCCallConnection44(p)){if(!this.$FBRTCCallConnection9){this.emit("connected");this.$FBRTCCallConnection9=true}}else if(p==="disconnected")this.$FBRTCCallConnection45();else if(p==="failed")this.$FBRTCCallConnection46();this.$FBRTCCallConnection7=p};o.prototype.$FBRTCCallConnection44=function(p){"use strict";return p==="completed"||p==="connected"};o.prototype.$FBRTCCallConnection45=function(){"use strict";if(this.$FBRTCCallConnection44(this.$FBRTCCallConnection7)){var p=Date.now();if(this.$FBRTCCallConnection47-p>=i)this.$FBRTCCallConnection10=0;this.$FBRTCCallConnection10=this.$FBRTCCallConnection10+1;this.$FBRTCCallConnection47=p;if(this.$FBRTCCallConnection10>=2)this.emit("connectionUnstable")}var q=this;this.$FBRTCCallConnection8=setTimeout(function(){q.emit("disconnected")},j)};o.prototype.$FBRTCCallConnection46=function(){"use strict";var p=this;this.$FBRTCCallConnection8=setTimeout(function(){var q={details:"Ice candidate state failed",endCallSubreason:"IceFailed"};p.emit("connectionError",q)},k)};o.prototype.$FBRTCCallConnection43=function(){"use strict";if(this.$FBRTCCallConnection8)clearTimeout(this.$FBRTCCallConnection8);this.$FBRTCCallConnection8=null};o.prototype.$FBRTCCallConnection39=function(p,q){"use strict";var r={details:q,endCallSubreason:p};this.emit("connectionError",r)};o.prototype.$FBRTCCallConnection2=function(){"use strict";if(window.webkitRTCPeerConnection){this.$FBRTCCallConnection1.logToConsole("Using Chrome WebRTC APIs...");this.nativePeerConnection=window.webkitRTCPeerConnection;this.nativeIceCandidate=window.RTCIceCandidate;this.nativeSessionDescription=window.RTCSessionDescription}else{this.$FBRTCCallConnection1.logToConsole("Using Firefox WebRTC APIs...");this.nativePeerConnection=window.mozRTCPeerConnection;this.nativeIceCandidate=window.mozRTCIceCandidate;this.nativeSessionDescription=window.mozRTCSessionDescription}};c("mixInEventEmitter")(o,{remoteStreamAdded:true,remoteStreamRemoved:true,sdpCreated:true,localIceCandidateCreated:true,remoteDescriptionSet:true,connected:true,disconnected:true,connectionUnstable:true,connectionError:true,isEnding:true,data_opened:true,data_closed:true,data_error:true,data_message:true});f.exports=o}),null);
__d("FBRTCRttAggregator",[],(function a(b,c,d,e,f,g){function h(){"use strict";this.$FBRTCRttAggregator1=[{count:0,ave:0},{count:0,ave:0},{count:0,ave:0},{count:0,ave:0}]}h.prototype.addRtt=function(i){"use strict";var j=this.$FBRTCRttAggregator1[this.$FBRTCRttAggregator2(i)];j.ave=this.$FBRTCRttAggregator3(j.ave,j.count,i);j.count+=1};h.prototype.toString=function(){"use strict";return[this.$FBRTCRttAggregator4("50",this.$FBRTCRttAggregator1[0]),this.$FBRTCRttAggregator4("100",this.$FBRTCRttAggregator1[1]),this.$FBRTCRttAggregator4("200",this.$FBRTCRttAggregator1[2]),this.$FBRTCRttAggregator4("0",this.$FBRTCRttAggregator1[3])].join("|")};h.prototype.$FBRTCRttAggregator4=function(i,j){"use strict";return i+"="+j.count+","+Math.round(j.ave)};h.prototype.$FBRTCRttAggregator2=function(i){"use strict";if(i<50)return 0;if(i<100)return 1;if(i<200)return 2;return 3};h.prototype.$FBRTCRttAggregator3=function(i,j,k){"use strict";return(i*j+k)/(j+1)};f.exports=h}),null);
__d("FBRTCStatsInterpreter",["FBRTCLogger"],(function a(b,c,d,e,f,g){var h={rtt_weight:2,frr_weight:800,plr_weight:500,score_threshold:1e3,bad_score_count:3};function i(j){"use strict";this.$FBRTCStatsInterpreter1=babelHelpers["extends"]({},h,j);this.$FBRTCStatsInterpreter2=c("FBRTCLogger").getInstance();this.$FBRTCStatsInterpreter3=0}i.prototype.interpretStats=function(j,k){"use strict";var l=j.videoRtt(),m=this.$FBRTCStatsInterpreter4(j),n=this.$FBRTCStatsInterpreter5(j,k),o=this.$FBRTCStatsInterpreter6(l,m,n);if(o>=this.$FBRTCStatsInterpreter1.score_threshold&&!this.isNetworkPoor())this.$FBRTCStatsInterpreter3+=1;if(o<this.$FBRTCStatsInterpreter1.score_threshold&&this.$FBRTCStatsInterpreter3>0)this.$FBRTCStatsInterpreter3-=1};i.prototype.isNetworkPoor=function(){"use strict";return this.$FBRTCStatsInterpreter3>=this.$FBRTCStatsInterpreter1.bad_score_count};i.prototype.$FBRTCStatsInterpreter6=function(j,k,l){"use strict";return j*this.$FBRTCStatsInterpreter1.rtt_weight+k*this.$FBRTCStatsInterpreter1.frr_weight+l*this.$FBRTCStatsInterpreter1.plr_weight};i.prototype.$FBRTCStatsInterpreter5=function(j,k){"use strict";var l,m;if(k){l=j.videoPacketsLost()-k.videoPacketsLost();m=j.videoPacketsSent()-k.videoPacketsSent()}else{l=j.videoPacketsLost();m=j.videoPacketsSent()}if(l<0||m===0)return 0;return l/m};i.prototype.$FBRTCStatsInterpreter4=function(j){"use strict";if(j.videoFrameRateCaptured()===0)return 0;return 1-j.videoFrameRateSent()/j.videoFrameRateCaptured()};f.exports=i}),null);
__d("RingBuffer",[],(function a(b,c,d,e,f,g){function h(i){"use strict";this.$RingBuffer1=i;this.$RingBuffer2=-1;this.$RingBuffer3=[]}h.prototype.add=function(i){"use strict";this.$RingBuffer2=(this.$RingBuffer2+1)%this.$RingBuffer1;this.$RingBuffer3[this.$RingBuffer2]=i};h.prototype.size=function(){"use strict";return this.$RingBuffer3.length};h.prototype.head=function(){"use strict";if(this.$RingBuffer2===-1)return null;return this.$RingBuffer3[this.$RingBuffer2]};h.prototype.tail=function(){"use strict";if(this.$RingBuffer2===-1)return null;return this.$RingBuffer3[this.$RingBuffer4()]};h.prototype.forEach=function(i){"use strict";for(var j=0;j<this.$RingBuffer3.length;j++){var k=(this.$RingBuffer2+1+j)%this.$RingBuffer3.length;i(this.$RingBuffer3[k])}};h.prototype.$RingBuffer4=function(){"use strict";return(this.$RingBuffer2+1)%this.$RingBuffer3.length};f.exports=h}),null);
__d("FBRTCCallConnectionMonitor",["RingBuffer","FBRTCRttAggregator","FBRTCStatsInterpreter","FBRTCConfig","mixInEventEmitter"],(function a(b,c,d,e,f,g){var h=3e3,i=1,j=0,k=3;function l(m,n){"use strict";this.$FBRTCCallConnectionMonitor1=new(c("FBRTCStatsInterpreter"))(c("FBRTCConfig").statsInterpreterConfig());this.$FBRTCCallConnectionMonitor2=new(c("FBRTCRttAggregator"))();this.$FBRTCCallConnectionMonitor3=new(c("FBRTCRttAggregator"))();this.$FBRTCCallConnectionMonitor4=m;this.$FBRTCCallConnectionMonitor5=n;this.$FBRTCCallConnectionMonitor6=null;this.$FBRTCCallConnectionMonitor7=[];this.$FBRTCCallConnectionMonitor8=new(c("RingBuffer"))(i);this.$FBRTCCallConnectionMonitor9=0;this.$FBRTCCallConnectionMonitor4.addListener("connected",this.$FBRTCCallConnectionMonitor10,this);this.$FBRTCCallConnectionMonitor4.addListener("isEnding",this.$FBRTCCallConnectionMonitor11,this)}l.prototype.$FBRTCCallConnectionMonitor10=function(){"use strict";var m=this.$FBRTCCallConnectionMonitor12.bind(this);this.$FBRTCCallConnectionMonitor6=setInterval(m,h);this.$FBRTCCallConnectionMonitor12()};l.prototype.$FBRTCCallConnectionMonitor11=function(){"use strict";if(this.$FBRTCCallConnectionMonitor6!==null){this.$FBRTCCallConnectionMonitor12();clearInterval(this.$FBRTCCallConnectionMonitor6);this.$FBRTCCallConnectionMonitor6=null}};l.prototype.$FBRTCCallConnectionMonitor12=function(){"use strict";this.$FBRTCCallConnectionMonitor4.getStats(function(m){var n;if(this.$FBRTCCallConnectionMonitor8.size()>0){n=this.$FBRTCCallConnectionMonitor8.head();this.$FBRTCCallConnectionMonitor13(m,n)}if(this.$FBRTCCallConnectionMonitor7.length<j)this.$FBRTCCallConnectionMonitor7.push(m);if(n&&n.isConnected()&&!m.isConnected())this.$FBRTCCallConnectionMonitor9+=1;this.$FBRTCCallConnectionMonitor9>=k;if(m.isConnected()){this.$FBRTCCallConnectionMonitor9=0;this.$FBRTCCallConnectionMonitor8.add(m);this.$FBRTCCallConnectionMonitor2.addRtt(m.audioRtt());this.$FBRTCCallConnectionMonitor3.addRtt(m.videoRtt());this.$FBRTCCallConnectionMonitor5.setPcStats(this.$FBRTCCallConnectionMonitor14());this.$FBRTCCallConnectionMonitor15(m,n)}}.bind(this))};l.prototype.$FBRTCCallConnectionMonitor14=function(){"use strict";var m=this.$FBRTCCallConnectionMonitor8.head();return{end:{conn_type:m.connectionType()},sender:{bytes:m.audioBytesSent(),codec:{0:m.audioCodec()},plost:m.audioPacketsLost(),psent:m.audioPacketsSent(),rtt:this.$FBRTCCallConnectionMonitor2.toString()},video:{sender:{bytes:m.videoBytesSent(),codec:{0:m.videoCodec()},plost:m.videoPacketsLost(),psent:m.videoPacketsSent(),rtt:this.$FBRTCCallConnectionMonitor3.toString()}}}};l.prototype.$FBRTCCallConnectionMonitor13=function(m,n){"use strict";if(n.videoPacketsLost()>m.videoPacketsLost())m.setVideoPacketsLost(n.videoPacketsLost())};l.prototype.$FBRTCCallConnectionMonitor15=function(m,n){"use strict";this.$FBRTCCallConnectionMonitor1.interpretStats(m,n);if(this.$FBRTCCallConnectionMonitor1.isNetworkPoor())this.emit("connectionPoor")};c("mixInEventEmitter")(l,{connectionPoor:true});f.exports=l}),null);
__d("FBRTCFullScreenController",["FBRTCCallControlActions","FBRTCStore"],(function a(b,c,d,e,f,g){var h,i,j,k,l=document.documentElement;if(l.requestFullscreen){j=l.requestFullscreen.bind(l);k="fullscreenchange"}else if(l.msRequestFullscreen){j=l.msRequestFullscreen.bind(l);k="msfullscreenchange"}else if(l.mozRequestFullScreen){j=l.mozRequestFullScreen.bind(l);k="mozfullscreenchange"}else if(l.webkitRequestFullscreen){j=l.webkitRequestFullscreen.bind(l,Element.ALLOW_KEYBOARD_INPUT);k="webkitfullscreenchange"}var m;if(document.exitFullscreen)m=document.exitFullscreen.bind(document);else if(document.msExitFullscreen)m=document.msExitFullscreen.bind(document);else if(document.mozCancelFullScreen)m=document.mozCancelFullScreen.bind(document);else if(document.webkitExitFullscreen)m=document.webkitExitFullscreen.bind(document);h=babelHelpers.inherits(n,c("FBRTCStore"));i=h&&h.prototype;function n(){"use strict";i.constructor.call(this);this.$FBRTCFullScreenController1=this.$FBRTCFullScreenController2.bind(this);document.addEventListener(k,this.$FBRTCFullScreenController1)}n.prototype.destroy=function(){"use strict";document.removeEventListener(k,this.$FBRTCFullScreenController1);i.destroy.call(this)};n.prototype.$FBRTCFullScreenController2=function(){"use strict";this.__emitChange()};n.prototype.supportsFullScreen=function(){"use strict";return j&&m};n.prototype.isFullScreen=function(){"use strict";return!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)};n.prototype.$FBRTCFullScreenController3=function(){"use strict";if(this.isFullScreen())m();else j()};n.prototype.__onDispatch=function(o){"use strict";switch(o.type){case c("FBRTCCallControlActions").Types.TOGGLE_FULL_SCREEN:this.$FBRTCFullScreenController3();break}};f.exports=new n()}),null);
__d("XVideoCallUserInfoController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/videocall/userinfo/",{user_id:{type:"Int",required:true}})}),null);
__d("FBRTCPeerInfo",["ix","XVideoCallUserInfoController","FBRTCUtils"],(function a(b,c,d,e,f,g,h){function i(j){"use strict";this.peerID=j;this.peerPicUrl=null;this.selfPicUrl=h("28192");this.backgroundUrl=null;this.peerName="";this.peerShortName=null}i.prototype.fetch=function(j,k){"use strict";var l=c("XVideoCallUserInfoController").getURIBuilder().setInt("user_id",this.peerID).getURI(),m=this;c("FBRTCUtils").sendServerRequest(l,function(n){m.peerPicUrl=n.payload.profile_pic_url;m.backgroundUrl=n.payload.cover_pic_url;m.peerName=n.payload.name;m.peerShortName=n.payload.peer_short_name;if(n.payload.self_profile_pic_url)m.selfPicUrl=n.payload.self_profile_pic_url;if(j)j()},k)};f.exports=i}),null);
__d("FBRTCScreenSharingConstants",[],(function a(b,c,d,e,f,g){"use strict";var h={DIRECT_SENDER:"DIRECT_SENDER",DIRECT_RECIPIENT:"DIRECT_RECIPIENT",FROM_VIDEO_CALL:"FROM_VIDEO_CALL"};f.exports=h}),null);
__d("FBRTCScreenSharingActions",["FBRTCDispatcher","keyMirror"],(function a(b,c,d,e,f,g){"use strict";var h=c("keyMirror")({END_SESSION:null}),i=c("keyMirror")({CONNECTED:null,SDP_CREATED:null,REMOTE_DESCRIPTION_SET:null,LOCAL_ICE_CANDIDATE_CREATED:null,REMOTE_STREAM_ADDED:null,OFFER_ACK:null}),j={ConnectionEventTypes:i,ControlEventTypes:h,endSession:function k(){c("FBRTCDispatcher").dispatch({type:h.END_SESSION})},sdpCreated:function k(l){c("FBRTCDispatcher").dispatch({type:i.SDP_CREATED,description:l})},remoteDescriptionSet:function k(){c("FBRTCDispatcher").dispatch({type:i.REMOTE_DESCRIPTION_SET})},localIceCandidateCreated:function k(l){c("FBRTCDispatcher").dispatch({type:i.LOCAL_ICE_CANDIDATE_CREATED,candidate:l})},remoteStreamAdded:function k(l){c("FBRTCDispatcher").dispatch({type:i.REMOTE_STREAM_ADDED,stream:l})},offerAckReceived:function k(){c("FBRTCDispatcher").dispatch({type:i.OFFER_ACK})},connected:function k(){c("FBRTCDispatcher").dispatch({type:i.CONNECTED})}};f.exports=j}),null);
__d("XScreenSharingController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/videocall/screen_sharing/",{peer_id:{type:"FBID",required:true}})}),null);
__d("FBRTCScreenSharingUI",["FBRTCCallControlActions","FBRTCDispatcher","FBRTCScreenSharingActions","FBRTCScreenSharingConstants","XScreenSharingController"],(function a(b,c,d,e,f,g){var h=void 0,i={open:function j(k,l,m){window.getRemoteMediaStream=function(){return l};window.getUIType=function(){return k};window.closeScreenSharingWindow=this._onUnload.bind(this,k);var n=k===c("FBRTCScreenSharingConstants").DIRECT_SENDER;h=window.open(this._getUnsignedUri(m),"Screen Sharing",this._getWindowFeatures(n));if(window.focus&&this.isOpen())h.focus()},close:function j(){if(h){var k=null;if(h.opener&&!h.opener.closed)k=h.opener;h.close();h=null;if(k)k.postMessage({recipient:"SC_CONTENT_SCRIPT",type:"SC_RESET_PORT",text:"reset comm port"},"*")}},isOpen:function j(){return!!(h&&!h.closed)},_onUnload:function j(k){if(this._isDirect(k))c("FBRTCScreenSharingActions").endSession();else{i.close();c("FBRTCDispatcher").dispatch({type:c("FBRTCCallControlActions").Types.CLOSE_STANDALONE_SCREEN})}},_isDirect:function j(k){return k===c("FBRTCScreenSharingConstants").DIRECT_RECIPIENT||k===c("FBRTCScreenSharingConstants").DIRECT_SENDER},_getWindowFeatures:function j(k){var l=screen.availLeft,m=screen.availTop,n=Math.min(k?448:960,screen.width-l),o=Math.min(k?252:540,screen.height-m),p={height:"height="+o.toString(),width:"width="+n.toString(),top:"top="+m.toString(),left:"left="+l.toString()};return["menubar=no","location=no","scrollbars=no","status=no","personalbar=no",p.height,p.width,p.top,p.left].join(",")},_getUnsignedUri:function j(k){return c("XScreenSharingController").getURIBuilder().setFBID("peer_id",k).getURI()}};f.exports=i}),null);
__d("FBRTCStreamWrapper",["mixInEventEmitter","FBRTCUtils"],(function a(b,c,d,e,f,g){var h=100,i=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,j;function k(){"use strict";this.$FBRTCStreamWrapper1=true;this.$FBRTCStreamWrapper2=true;this.$FBRTCStreamWrapper3=null;this.$FBRTCStreamWrapper4=null;this.aspectRatio=k.aspectRatios.other;this.videoWidth=0;this.videoHeight=0}k.prototype.setStream=function(l){var m=arguments.length<=1||arguments[1]===undefined?true:arguments[1];"use strict";var n=this.hasStream();this.stop();this.$FBRTCStreamWrapper3=l;this.$FBRTCStreamWrapper5();this.$FBRTCStreamWrapper6();if(m){this.$FBRTCStreamWrapper3.onaddtrack=this.$FBRTCStreamWrapper7.bind(this);this.$FBRTCStreamWrapper3.onremovetrack=this.$FBRTCStreamWrapper7.bind(this);this.$FBRTCStreamWrapper3.onended=this.$FBRTCStreamWrapper8.bind(this);if(n)this.emit("tracksChanged")}};k.prototype.getStreamId=function(){"use strict";return this.$FBRTCStreamWrapper3&&this.$FBRTCStreamWrapper3.id};k.prototype.getStream=function(){"use strict";return this.$FBRTCStreamWrapper3};k.prototype.hasStream=function(){"use strict";return!!this.$FBRTCStreamWrapper3};k.prototype.stop=function(){"use strict";if(this.$FBRTCStreamWrapper3){k.stopStream(this.$FBRTCStreamWrapper3);this.$FBRTCStreamWrapper3=null}};k.prototype.hasVideoTracks=function(){"use strict";if(this.$FBRTCStreamWrapper3&&this.$FBRTCStreamWrapper3.getVideoTracks)return this.$FBRTCStreamWrapper3.getVideoTracks().length>0;return true};k.prototype.hasVideo=function(){"use strict";return this.$FBRTCStreamWrapper2&&this.hasVideoTracks()};k.prototype.hasAudioTracks=function(){"use strict";if(this.$FBRTCStreamWrapper3&&this.$FBRTCStreamWrapper3.getAudioTracks)return this.$FBRTCStreamWrapper3.getAudioTracks().length>0;return true};k.prototype.hasAudio=function(){"use strict";return this.$FBRTCStreamWrapper1&&this.hasAudioTracks()};k.prototype.attachToVideoTag=function(l){"use strict";if(this.$FBRTCStreamWrapper3){this.$FBRTCStreamWrapper4=l;c("FBRTCUtils").attachMediaStream(l,this.$FBRTCStreamWrapper3);this.$FBRTCStreamWrapper9(l)}};k.prototype.getAudioAnalyser=function(){"use strict";if(this.$FBRTCStreamWrapper3){var l=this.$FBRTCStreamWrapper10(),m=l.createMediaStreamSource(this.$FBRTCStreamWrapper3),n=l.createAnalyser();n.fftSize=2048;m.connect(n);return n}};k.prototype.$FBRTCStreamWrapper10=function(){"use strict";if(!j)j=new i();return j};k.prototype.toggleMuteAudio=function(){"use strict";if(!this.hasAudioTracks())return;this.$FBRTCStreamWrapper1=!this.$FBRTCStreamWrapper1;this.$FBRTCStreamWrapper5()};k.prototype.$FBRTCStreamWrapper5=function(){"use strict";if(this.$FBRTCStreamWrapper3){var l=this.$FBRTCStreamWrapper3.getAudioTracks();for(var m=0;m<l.length;m++)l[m].enabled=this.$FBRTCStreamWrapper1}};k.prototype.toggleMuteVideo=function(){"use strict";this.$FBRTCStreamWrapper2=!this.$FBRTCStreamWrapper2;if(this.$FBRTCStreamWrapper2)this.$FBRTCStreamWrapper6();else setTimeout(this.$FBRTCStreamWrapper6.bind(this),500);this.$FBRTCStreamWrapper7()};k.prototype.$FBRTCStreamWrapper6=function(){"use strict";if(this.$FBRTCStreamWrapper3){var l=this.$FBRTCStreamWrapper3.getVideoTracks();for(var m=0;m<l.length;m++)l[m].enabled=this.$FBRTCStreamWrapper2}};k.prototype.setVideoEnabled=function(l){"use strict";this.$FBRTCStreamWrapper2=l;this.$FBRTCStreamWrapper6();this.$FBRTCStreamWrapper7()};k.prototype.$FBRTCStreamWrapper9=function(l){"use strict";if(!this.hasVideo()||l.currentTime>0)this.$FBRTCStreamWrapper11(l);else setTimeout(this.$FBRTCStreamWrapper9.bind(this,l),h)};k.prototype.$FBRTCStreamWrapper12=function(l){"use strict";this.videoWidth=l.videoWidth;this.videoHeight=l.videoHeight;var m=l.videoWidth/l.videoHeight;if(c("FBRTCUtils").aboutEqual(m,16/9))return k.aspectRatios["16:9"];if(c("FBRTCUtils").aboutEqual(m,4/3))return k.aspectRatios["4:3"];return k.aspectRatios.other};k.prototype.$FBRTCStreamWrapper11=function(l){"use strict";if(this.hasVideo())this.aspectRatio=this.$FBRTCStreamWrapper12(l);else this.aspectRatio=k.aspectRatios.other;this.emit("streamStarted")};k.prototype.$FBRTCStreamWrapper8=function(){"use strict";this.emit("streamEnded")};k.prototype.$FBRTCStreamWrapper7=function(event){"use strict";if(this.$FBRTCStreamWrapper13(event))this.attachToVideoTag(this.$FBRTCStreamWrapper4);this.emit("tracksChanged")};k.prototype.$FBRTCStreamWrapper13=function(l){"use strict";return this.$FBRTCStreamWrapper4&&l&&l.type==="addtrack"&&l.track.kind==="video"};k.aspectRatios={"16:9":1,"4:3":2,other:3};c("mixInEventEmitter")(k,{streamStarted:true,streamEnded:true,tracksChanged:true});k.stopStream=function(l){if("active"in l){if(l.active)l.getTracks().forEach(function(m){m.stop()})}else if("stop"in l)l.stop()};f.exports=k}),null);
__d("FBRTCVideoDurationTracker",["performanceNow"],(function a(b,c,d,e,f,g){"use strict";var h=0;function i(j){this.$FBRTCVideoDurationTracker2=j;this.$FBRTCVideoDurationTracker1=0;this.$FBRTCVideoDurationTracker4=h}i.prototype.startTracking=function(){if(this.$FBRTCVideoDurationTracker2.hasVideo())this.$FBRTCVideoDurationTracker4=this.$FBRTCVideoDurationTracker5();this.$FBRTCVideoDurationTracker3=this.$FBRTCVideoDurationTracker2.addListener("tracksChanged",function(){if(this.$FBRTCVideoDurationTracker2.hasVideo()&&!this.$FBRTCVideoDurationTracker4)this.$FBRTCVideoDurationTracker4=this.$FBRTCVideoDurationTracker5();else if(!this.$FBRTCVideoDurationTracker2.hasVideo()){this.$FBRTCVideoDurationTracker1=this.getDuration();this.$FBRTCVideoDurationTracker4=h}}.bind(this))};i.prototype.stopTracking=function(){this.$FBRTCVideoDurationTracker1=this.getDuration();this.$FBRTCVideoDurationTracker4=h;if(this.$FBRTCVideoDurationTracker3){this.$FBRTCVideoDurationTracker3.remove();this.$FBRTCVideoDurationTracker3=null}};i.prototype.getDuration=function(){if(this.$FBRTCVideoDurationTracker4!==h){var j=this.$FBRTCVideoDurationTracker5()-this.$FBRTCVideoDurationTracker4;return this.$FBRTCVideoDurationTracker1+j}return this.$FBRTCVideoDurationTracker1};i.prototype.$FBRTCVideoDurationTracker5=function(){return c("performanceNow")()};f.exports=i}),null);
__d("FBRTCCallModel",["Bootloader","CollabCallMessengerBrowserEventEnum","FBRTCAdminMessage","FBRTCCallConstants","FBRTCCallControlActions","FBRTCConfig","FBRTCFullScreenController","FBRTCLogger","FBRTCPCConfig","FBRTCPeerInfo","FBRTCScreenSharingConstants","FBRTCScreenSharingUI","FBRTCStore","FBRTCStreamWrapper","FBRTCStruct","FBRTCVideoDurationTracker","RTCConfig"],(function a(b,c,d,e,f,g){var h,i;h=babelHelpers.inherits(j,c("FBRTCStore"));i=h&&h.prototype;function j(k){"use strict";i.constructor.call(this);this.$FBRTCCallModel1=c("FBRTCLogger").getInstance();this.isCaller=k.isCaller;this.peerID=k.peerID;this.$FBRTCCallModel2=k.isAudioOnly;this.$FBRTCCallModel3=new(c("FBRTCPeerInfo"))(k.peerID);this.$FBRTCCallModel4=false;this.resetCallInfo(k.callID);this.$FBRTCCallModel5();this.$FBRTCCallModel6(true)}j.prototype.resetForReconnect=function(k){"use strict";this.isCaller=false;this.resetCallInfo(k);this.$FBRTCCallModel6(false)};j.prototype.fetchPeerInfo=function(){"use strict";var k=this,l=function l(){k.__emitChange()},m=function m(){k.$FBRTCCallModel1.logError(k.peerID,k.callID,"Failed to get remote photos")};this.$FBRTCCallModel3.fetch(l,m)};j.prototype.setSignalingExperiments=function(k){"use strict";if(k||k===[])this.$FBRTCCallModel7=k};j.prototype.supportsSdpUpdate=function(){"use strict";var k="sdp_update";return this.$FBRTCCallModel7.indexOf(k)!==-1&&c("FBRTCConfig").supportedSignalingExperiments().indexOf(k)!==-1};j.prototype.supportsMultipleStreamsPlanB=function(){"use strict";var k="multiple_streams_plan_b";return this.$FBRTCCallModel7.indexOf(k)!==-1&&c("FBRTCConfig").supportedSignalingExperiments().indexOf(k)!==-1};j.prototype.canPeerReceiveScreenSharing=function(){"use strict";return this.$FBRTCCallModel7.indexOf("screen_sharing")!==-1||c("FBRTCConfig").isVCEndpointCall()};j.prototype.onSDPMessageFromPeer=function(k){"use strict";this.isRemoteVideoSupported=k.isRemoteVideoSupported();this.isPeerOnMobile=k.isFromMobile();if(!this.isRemoteVideoSupported)this.localStream.setVideoEnabled(false)};j.prototype.$FBRTCCallModel5=function(){"use strict";this.remoteStream=new(c("FBRTCStreamWrapper"))();this.localStream=new(c("FBRTCStreamWrapper"))();this.localStream.addListener("tracksChanged",function(){if(!this.$FBRTCCallModel8&&this.localStream.hasVideo())this.$FBRTCCallModel9=true;this.$FBRTCCallModel10(c("CollabCallMessengerBrowserEventEnum").LOCAL_STREAM_TRACKS_CHANGED,this.localStream.getStream());this.__emitChange()}.bind(this));this.$FBRTCCallModel11=new(c("FBRTCVideoDurationTracker"))(this.remoteStream);this.$FBRTCCallModel12=new(c("FBRTCVideoDurationTracker"))(this.localStream)};j.prototype.resetCallInfo=function(k){"use strict";this.callID=k;this.$FBRTCCallModel13=new(c("FBRTCAdminMessage"))(this.peerID,k);this.startTime=new Date();this.endCallReason=null;this.endCallSubreason=null;this.isRemoteEnded=null;this.wasConnected=false;this.receivedNack=false;this.isRemoteVideoSupported=true;this.isPeerOnMobile=false;this.$FBRTCCallModel14=null;this.$FBRTCCallModel8=true;this.$FBRTCCallModel9=false;this.$FBRTCCallModel7=[];this.$FBRTCCallModel15=null};j.prototype.$FBRTCCallModel6=function(k){"use strict";this.selfViewOpen=true;this.uiState=j.UIState.INIT;this.__emitChange()};j.prototype.getLocalVideoDuration=function(){"use strict";return this.$FBRTCCallModel12.getDuration()};j.prototype.getRemoteVideoDuration=function(){"use strict";return this.$FBRTCCallModel11.getDuration()};j.prototype.setLocalStream=function(k){"use strict";this.localStream.setStream(k);this.$FBRTCCallModel10(c("CollabCallMessengerBrowserEventEnum").LOCAL_STREAM_SET,k)};j.prototype.setLocalScreenStream=function(k){"use strict";this.$FBRTCCallModel4=k!==null;this.selfViewOpen=true;this.$FBRTCCallModel14=k;this.__emitChange()};j.prototype.getLocalScreenStream=function(){"use strict";return this.$FBRTCCallModel14};j.prototype.setRemoteStream=function(k){"use strict";this.remoteStream.setStream(k);this.remoteStream.once("streamStarted",function(){this.setStateFrom(j.UIState.CALL_CONNECTING,j.UIState.CALL_CONNECTED);this.$FBRTCCallModel10(c("CollabCallMessengerBrowserEventEnum").REMOTE_STREAM_STARTED,this.remoteStream.getStream())}.bind(this));this.remoteStream.addListener("tracksChanged",function(){this.$FBRTCCallModel10(c("CollabCallMessengerBrowserEventEnum").REMOTE_STREAM_TRACKS_CHANGED,this.remoteStream.getStream());this.__emitChange()}.bind(this));this.$FBRTCCallModel10(c("CollabCallMessengerBrowserEventEnum").REMOTE_STREAM_SET,k);this.__emitChange()};j.prototype.setRemoteScreenStream=function(k){"use strict";this.$FBRTCCallModel15=k;this.__emitChange()};j.prototype.getRemoteScreenStream=function(){"use strict";return this.$FBRTCCallModel15};j.prototype.canStartCall=function(k){"use strict";return this.localStream.hasStream()&&(c("FBRTCPCConfig").turnIP||c("FBRTCConfig").isVCEndpointCall()&&c("RTCConfig").CollabDisableBrowserTurnDiscoveryGK)};j.prototype.isAwaitingUserStart=function(){"use strict";return this.uiState===j.UIState.AWAITING_USER_START};j.prototype.canBeStartedByParentWindow=function(){"use strict";return this.uiState===j.UIState.INIT};j.prototype.isInProgress=function(){"use strict";return this.uiState>=j.UIState.CONTACTING&&this.uiState<j.UIState.CALL_ENDED};j.prototype.isUserMediaPending=function(){"use strict";return this.uiState===j.UIState.PENDING_LOCAL_MEDIA};j.prototype.isUserMediaDenied=function(){"use strict";return this.uiState===j.UIState.USER_MEDIA_DENIED};j.prototype.isConnected=function(){"use strict";return this.uiState===j.UIState.CALL_CONNECTED};j.prototype.isRemoteVideoActive=function(){"use strict";return this.uiState===j.UIState.CALL_CONNECTED&&this.remoteStream.hasVideo()};j.prototype.isEnded=function(){"use strict";return this.uiState>=j.UIState.CALL_ENDED};j.prototype.isAwaitingAnswer=function(){"use strict";return this.uiState==j.UIState.CONTACTING||this.uiState==j.UIState.RINGING};j.prototype.isFullScreen=function(){"use strict";return c("FBRTCFullScreenController").isFullScreen()};j.prototype.isScreenSharingEnabled=function(){"use strict";return this.$FBRTCCallModel4};j.prototype.peerPicUrl=function(){"use strict";return this.$FBRTCCallModel3.peerPicUrl};j.prototype.selfPicUrl=function(){"use strict";return this.$FBRTCCallModel3.selfPicUrl};j.prototype.backgroundUrl=function(){"use strict";return this.$FBRTCCallModel3.backgroundUrl};j.prototype.peerName=function(){"use strict";return this.$FBRTCCallModel3.peerName};j.prototype.peerShortName=function(){"use strict";if(this.$FBRTCCallModel3.peerShortName)return this.$FBRTCCallModel3.peerShortName;return this.$FBRTCCallModel3.peerName};j.prototype.autoDisableVideo=function(){"use strict";if(this.$FBRTCCallModel8){this.$FBRTCCallModel8=false;this.$FBRTCCallModel1.logCallAction(this.peerID,this.callID,c("FBRTCLogger").CallAction.AUTO_DISABLE_VIDEO);this.localStream.setVideoEnabled(false)}};j.prototype.videoIsAutoDisabled=function(){"use strict";return!this.$FBRTCCallModel8&&!this.$FBRTCCallModel9&&!this.localStream.hasVideo()};j.prototype.$FBRTCCallModel16=function(){"use strict";this.localStream.toggleMuteAudio();this.$FBRTCCallModel1.logCallAction(this.peerID,this.callID,c("FBRTCLogger").CallAction.SET_MUTE,!this.localStream.hasAudio()?"true":"false");this.__emitChange()};j.prototype.$FBRTCCallModel17=function(k){"use strict";this.localStream.toggleMuteVideo();this.$FBRTCCallModel1.logCallAction(this.peerID,this.callID,c("FBRTCLogger").CallAction.SET_VIDEO_ON,this.localStream.hasVideo());this.__emitChange()};j.prototype.toggleSelfView=function(){"use strict";this.selfViewOpen=!this.selfViewOpen;this.$FBRTCCallModel1.logCallAction(this.peerID,this.callID,c("FBRTCLogger").CallAction.SET_SELF_VIEW_ON,!this.selfViewOpen?"true":"false");this.__emitChange()};j.prototype.setState=function(k){"use strict";if(k===this.uiState)return;var l=this.uiState;this.uiState=k;switch(k){case j.UIState.CALL_CONNECTED:this.wasConnected=true;this.$FBRTCCallModel13.onCallConnected();this.$FBRTCCallModel11.startTracking();this.$FBRTCCallModel12.startTracking();break;case j.UIState.CALL_ENDED:this.$FBRTCCallModel13.onCallEnded();this.$FBRTCCallModel11.stopTracking();this.$FBRTCCallModel12.stopTracking();if(this.isCaller&&l>j.UIState.MORE_INIT)this.$FBRTCCallModel13.submit(this.$FBRTCCallModel18(),this.endCallReason);break}this.$FBRTCCallModel1.logInfo(this.peerID,this.callID,'UI: state change - "'+j.UIState.strNames[l]+'" to "'+j.UIState.strNames[k]+'"');this.__emitChange()};j.prototype.$FBRTCCallModel18=function(){"use strict";return!this.$FBRTCCallModel2||this.getLocalVideoDuration()>0&&this.getRemoteVideoDuration()>0?c("FBRTCCallConstants").FBRTCCallType.VIDEO_CALL:c("FBRTCCallConstants").FBRTCCallType.VOICE_CALL};j.prototype.setStateFrom=function(k,l){"use strict";if(this.uiState===k)this.setState(l);else this.$FBRTCCallModel1.logInfo(this.peerID,this.callID,'UI: Not at "'+j.UIState.strNames[k]+'", not moving to "'+j.UIState.strNames[l]+'"')};j.prototype.$FBRTCCallModel10=function(event,k){"use strict";if(!c("FBRTCConfig").isVCEndpointCall())return;c("Bootloader").loadModules(["CollabMessengerLogger"],function(l){return l.log(event,{peerID:this.peerID,callID:this.callID,eventDetails:k})}.bind(this),"FBRTCCallModel")};j.prototype.__onDispatch=function(k){"use strict";switch(k.type){case c("FBRTCCallControlActions").Types.TOGGLE_MUTE_AUDIO:this.$FBRTCCallModel16();break;case c("FBRTCCallControlActions").Types.TOGGLE_MUTE_VIDEO:this.$FBRTCCallModel17();break;case c("FBRTCCallControlActions").Types.CLOSE_STANDALONE_SCREEN:this.__emitChange();break;case c("FBRTCCallControlActions").Types.TOGGLE_SELF_VIEW:this.toggleSelfView();break;case c("FBRTCCallControlActions").Types.OPEN_SCREEN_IN_NEW:c("FBRTCScreenSharingUI").open(c("FBRTCScreenSharingConstants").FROM_VIDEO_CALL,this.$FBRTCCallModel15,this.peerID);this.__emitChange();break}};j.UIState=new(c("FBRTCStruct"))(["INIT","AWAITING_USER_START","PENDING_LOCAL_MEDIA","USER_MEDIA_DENIED","MORE_INIT","CONTACTING","RINGING","CALL_CONNECTING","CALL_CONNECTED","CALL_ENDED","COLLECT_RATING"]);f.exports=j}),null);
__d("FBRTCDialog.react",["MessengerDialog.react","XUIDialog.react","FBRTCConfig"],(function a(b,c,d,e,f,g){f.exports=c("FBRTCConfig").isMessengerDotCom()?c("MessengerDialog.react"):c("XUIDialog.react")}),null);
__d("FBRTCDialogBody.react",["MessengerDialogBody.react","XUIDialogBody.react","FBRTCConfig"],(function a(b,c,d,e,f,g){f.exports=c("FBRTCConfig").isMessengerDotCom()?c("MessengerDialogBody.react"):c("XUIDialogBody.react")}),null);
__d("FBRTCDialogFooter.react",["MessengerDialogFooter.react","XUIDialogFooter.react","FBRTCConfig"],(function a(b,c,d,e,f,g){f.exports=c("FBRTCConfig").isMessengerDotCom()?c("MessengerDialogFooter.react"):c("XUIDialogFooter.react")}),null);
__d("FBRTCDialogTitle.react",["FBRTCConfig","MessengerDialogTitle.react","MessengerDialogHeader.react","React","XUIDialogTitle.react"],(function a(b,c,d,e,f,g){"use strict";var h,i,j=c("React").PropTypes;h=babelHelpers.inherits(k,c("React").PureComponent);i=h&&h.prototype;k.prototype.render=function(){var l=this.props,m=l.className,n=l.showCloseButton,o=babelHelpers.objectWithoutProperties(l,["className","showCloseButton"]);if(c("FBRTCConfig").isMessengerDotCom())return c("React").createElement(c("MessengerDialogHeader.react"),null,c("React").createElement(c("MessengerDialogTitle.react"),babelHelpers["extends"]({className:m,showCloseButton:n},o),this.props.children));return c("React").createElement(c("XUIDialogTitle.react"),babelHelpers["extends"]({className:m,showCloseButton:n},o),this.props.children)};function k(){h.apply(this,arguments)}k.propTypes={className:j.string,showCloseButton:j.bool.isRequired};f.exports=k}),null);
__d("FBRTCMediaAccessErrorDialog.react",["fbt","FBRTCConfig","FBRTCDialog.react","FBRTCDialogBody.react","FBRTCDialogFooter.react","FBRTCDialogTitle.react","Link.react","React"],(function a(b,c,d,e,f,g,h){"use strict";var i,j,k=440;i=babelHelpers.inherits(l,c("React").Component);j=i&&i.prototype;l.prototype.render=function(){return c("React").createElement(c("FBRTCDialog.react"),{shown:true,width:k,layerHideOnBlur:false},c("React").createElement(c("FBRTCDialogTitle.react"),{showCloseButton:false},c("React").createElement("span",null,h._("Can't Make Call"))),c("React").createElement(c("FBRTCDialogBody.react"),null,this.$FBRTCMediaAccessErrorDialog1()),c("React").createElement(c("FBRTCDialogFooter.react"),{leftContent:this.$FBRTCMediaAccessErrorDialog2()}))};l.prototype.$FBRTCMediaAccessErrorDialog1=function(){return c("React").createElement("p",null,h._("Connect a camera and a microphone to make a call. If they're already connected, try restarting your browser and closing any other applications that use a camera or microphone."))};l.prototype.$FBRTCMediaAccessErrorDialog2=function(){return c("React").createElement("span",null,h._("Still need help? See our {troubleShootingGuideLink}",[h.param("troubleShootingGuideLink",c("React").createElement(c("Link.react"),{href:c("FBRTCConfig").userMediaErrorUrl(),target:"_blank"},h._("Troubleshooting Guide")))]))};function l(){i.apply(this,arguments)}f.exports=l}),null);
__d("FBRTCPeerBrowserUnsupportedDialog.react",["fbt","FBRTCConfig","Link.react","React","XUIDialog.react","XUIDialogBody.react","XUIDialogFooter.react","XUIDialogTitle.react"],(function a(b,c,d,e,f,g,h){"use strict";var i,j,k=440;i=babelHelpers.inherits(l,c("React").Component);j=i&&i.prototype;l.prototype.render=function(){return c("React").createElement(c("XUIDialog.react"),{shown:true,width:k},c("React").createElement(c("XUIDialogTitle.react"),{showCloseButton:false},c("React").createElement("span",null,h._("Can't Connect Call"))),c("React").createElement(c("XUIDialogBody.react"),null,this.$FBRTCPeerBrowserUnsupportedDialog1()),c("React").createElement(c("XUIDialogFooter.react"),{leftContent:this.$FBRTCPeerBrowserUnsupportedDialog2()}))};l.prototype.$FBRTCPeerBrowserUnsupportedDialog1=function(){var m=this.props.peerName;return c("React").createElement("p",null,h._("{name} isn't using a browser that supports video calling yet.",[h.param("name",m)]))};l.prototype.$FBRTCPeerBrowserUnsupportedDialog2=function(){return c("React").createElement("span",null,h._("Still need help? See our {troubleShootingGuideLink}",[h.param("troubleShootingGuideLink",c("React").createElement(c("Link.react"),{href:c("FBRTCConfig").unsupportedBrowserUrl(),target:"_blank"},h._("Troubleshooting Guide")))]))};function l(){i.apply(this,arguments)}f.exports=l}),null);
__d("ScreenSharingWebDriverIDs",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({SHARE_SCREEN_BUTTON:"shareScreenButton",INSTALL_EXT_DIALOG:"install_extension_dialog"})}),null);
__d("FBRTCScreenSharingInstallExtensionDialog.react",["fbt","React","FBRTCCallControlActions","FBRTCLogger","FBRTCScreenSharingLogger","LinkshimCallsites","ScreenSharingWebDriverIDs","URI","FBRTCDialogFooter.react","LinkshimLink.react","XUIDialog.react","XUIDialogBody.react","XUIDialogButton.react","XUIDialogCancelButton.react","XUIDialogTitle.react"],(function a(b,c,d,e,f,g,h){"use strict";var i,j,k=c("React").PropTypes,l="https://chrome.google.com/webstore/detail/degmgkchmbgaognjjlhggmhbcpicdifm";i=babelHelpers.inherits(m,c("React").Component);j=i&&i.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=j.constructor).call.apply(n,[this].concat(q)),this.$FBRTCScreenSharingInstallExtensionDialog3=function(){c("FBRTCScreenSharingLogger").getInstance().logAction(this.props.peerID,this.props.sessionID,c("FBRTCScreenSharingLogger").Action.SCREEN_SHARING_EXT_LINK,false)}.bind(this),o}m.prototype.componentDidMount=function(){c("FBRTCScreenSharingLogger").getInstance().logAction(this.props.peerID,this.props.sessionID,c("FBRTCScreenSharingLogger").Action.SCREEN_SHARING_EXT_DIALOG,false)};m.prototype.render=function(){return c("React").createElement(c("XUIDialog.react"),{shown:true,width:440,layerHideOnBlur:false},c("React").createElement(c("XUIDialogTitle.react"),{showCloseButton:true},c("React").createElement("span",null,h._("Please install screen sharing extension"))),c("React").createElement(c("XUIDialogBody.react"),{"data-testid":c("ScreenSharingWebDriverIDs").INSTALL_EXT_DIALOG},this.$FBRTCScreenSharingInstallExtensionDialog1()),c("React").createElement(c("FBRTCDialogFooter.react"),null,c("React").createElement(c("XUIDialogCancelButton.react"),null),c("React").createElement(c("XUIDialogButton.react"),{label:h._("Call Again"),use:"confirm",onClick:this.$FBRTCScreenSharingInstallExtensionDialog2})))};m.prototype.$FBRTCScreenSharingInstallExtensionDialog1=function(){return c("React").createElement("div",null,c("React").createElement("p",null,h._("To share your screen, you'll need to install an extension. Then you can return here to start your call again.")),c("React").createElement(c("LinkshimLink.react"),{uri:new(c("URI"))(l),callsite:c("LinkshimCallsites").THIRD_PARTY_URL,target:"_blank",onClick:this.$FBRTCScreenSharingInstallExtensionDialog3},h._("Install screen sharing extension")))};m.prototype.$FBRTCScreenSharingInstallExtensionDialog2=function(){c("FBRTCCallControlActions").resetCall(c("FBRTCLogger").Trigger.RESET_CALL)};m.propTypes={peerID:k.any.isRequired,sessionID:k.number.isRequired};f.exports=m}),null);
__d("FBRTCScreenStreamWrapper",["FBRTCStreamWrapper"],(function a(b,c,d,e,f,g){"use strict";var h,i;h=babelHelpers.inherits(j,c("FBRTCStreamWrapper"));i=h&&h.prototype;j.prototype.toggleMuteAudio=function(){return};j.prototype.toggleMuteVideo=function(){return};function j(){h.apply(this,arguments)}f.exports=j}),null);
__d("FBRTCScreenSharingModel",["Event","FBRTCScreenSharingLogger","FBRTCScreenStreamWrapper","FBRTCStore"],(function a(b,c,d,e,f,g){"use strict";var h,i;h=babelHelpers.inherits(j,c("FBRTCStore"));i=h&&h.prototype;function j(k,l){i.constructor.call(this);this.$FBRTCScreenSharingModel3=null;this.$FBRTCScreenSharingModel4=new(c("FBRTCScreenStreamWrapper"))();this.$FBRTCScreenSharingModel5=c("FBRTCScreenSharingLogger").getInstance();this.$FBRTCScreenSharingModel1=k;this.$FBRTCScreenSharingModel2=l}j.prototype.isEnabled=function(){return!!this.$FBRTCScreenSharingModel3};j.prototype.setStream=function(k){var l=arguments.length<=1||arguments[1]===undefined?false:arguments[1],m=arguments.length<=2||arguments[2]===undefined?false:arguments[2];if(k&&(!l||m))c("Event").listen(k.getVideoTracks()[0],"ended",this.__emitChange.bind(this));if(this.$FBRTCScreenSharingModel4===null)this.$FBRTCScreenSharingModel4=new(c("FBRTCScreenStreamWrapper"))();this.$FBRTCScreenSharingModel4.setStream(k,!l)};j.prototype.getStream=function(){return this.$FBRTCScreenSharingModel4};j.prototype.getPeerID=function(){return this.$FBRTCScreenSharingModel1};j.prototype.getSessionID=function(){return this.$FBRTCScreenSharingModel2};j.prototype.onStart=function(k){if(!k){this.$FBRTCScreenSharingModel5.logToConsole(null,null,"Invalid stream id");return}this.$FBRTCScreenSharingModel5.logToConsole(null,null,"Enabling screen sharing");this.$FBRTCScreenSharingModel3=k};j.prototype.onStop=function(){this.$FBRTCScreenSharingModel3=null;if(this.$FBRTCScreenSharingModel4)this.$FBRTCScreenSharingModel4.stop()};j.prototype.__onDispatch=function(k){};f.exports=j}),null);
__d("FBRTCScreenSharingUnsupportedBrowserDialog.react",["cx","fbt","ix","React","Image.react","Link.react","Layout.react","XUIDialog.react","XUIDialogBody.react","XUIDialogTitle.react","XUIText.react","FBRTCVersionDetection"],(function a(b,c,d,e,f,g,h,i,j){"use strict";var k,l,m=c("Layout.react").Column;k=babelHelpers.inherits(n,c("React").Component);l=k&&k.prototype;function n(){var o,p;for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return p=(o=l.constructor).call.apply(o,[this].concat(r)),this.$FBRTCScreenSharingUnsupportedBrowserDialog1=function(){var t=null;if(c("FBRTCVersionDetection").isChrome())t=i._("Update browser to share your screen");else t=i._("Switch browsers to share your screen");return c("React").createElement("span",null,t)},this.$FBRTCScreenSharingUnsupportedBrowserDialog2=function(){var t=null;if(c("FBRTCVersionDetection").isChrome())t=this.$FBRTCScreenSharingUnsupportedBrowserDialog4();else t=this.$FBRTCScreenSharingUnsupportedBrowserDialog5();return c("React").createElement("p",null,t)}.bind(this),this.$FBRTCScreenSharingUnsupportedBrowserDialog4=function(){return i._("Screen sharing doesn't work in the older version of Google Chrome that you're using. To share your screen, please update Google Chrome.")},this.$FBRTCScreenSharingUnsupportedBrowserDialog5=function(){if(c("FBRTCVersionDetection").isFirefox())return i._("Screen sharing doesn't work in Mozilla Firefox yet. To share your screen, please open Facebook in Google Chrome.");else return i._("Screen sharing doesn't work in your browser yet. To share your screen, please open Facebook in Google Chrome.")},this.$FBRTCScreenSharingUnsupportedBrowserDialog3=function(){return c("React").createElement(c("Layout.react"),null,c("React").createElement(m,{style:{width:"100%",textAlign:"center"}},c("React").createElement(c("Link.react"),{href:"https://www.google.com/chrome/index.html",target:"_blank"},c("React").createElement(c("Image.react"),{className:"_4_if",src:j("28180"),alt:"Chrome",width:"64"}),c("React").createElement(c("XUIText.react"),{display:"block"},"Google Chrome"))))},p}n.prototype.render=function(){return c("React").createElement(c("XUIDialog.react"),{shown:true,width:440,layerHideOnBlur:false},c("React").createElement(c("XUIDialogTitle.react"),{showCloseButton:true},this.$FBRTCScreenSharingUnsupportedBrowserDialog1()),c("React").createElement(c("XUIDialogBody.react"),null,this.$FBRTCScreenSharingUnsupportedBrowserDialog2(),this.$FBRTCScreenSharingUnsupportedBrowserDialog3()))};f.exports=n}),null);
__d("FBRTCAudioSpectrumAnalyser.react",["React","ReactDOM","cancelAnimationFrame","requestAnimationFrame"],(function a(b,c,d,e,f,g){"use strict";var h,i,j=7,k=3,l=9,m="#3B5998",n="#CCCCCC",o=80,p=106;h=babelHelpers.inherits(q,c("React").Component);i=h&&h.prototype;function q(){var t,u;for(var v=arguments.length,w=Array(v),x=0;x<v;x++)w[x]=arguments[x];return u=(t=i.constructor).call.apply(t,[this].concat(w)),this.$FBRTCAudioSpectrumAnalyser1=false,this.$FBRTCAudioSpectrumAnalyser2=null,u}q.prototype.componentDidMount=function(){this.$FBRTCAudioSpectrumAnalyser3()};q.prototype.componentWillUnmount=function(){this.$FBRTCAudioSpectrumAnalyser4()};q.prototype.shouldComponentUpdate=function(t){return this.$FBRTCAudioSpectrumAnalyser5(t.stream)};q.prototype.componentDidUpdate=function(){this.$FBRTCAudioSpectrumAnalyser4();this.$FBRTCAudioSpectrumAnalyser3()};q.prototype.$FBRTCAudioSpectrumAnalyser5=function(t){var u=t?t.getStream():null,v=this.props.stream?this.props.stream.getStream():null;return v!==u};q.prototype.$FBRTCAudioSpectrumAnalyser4=function(){this.$FBRTCAudioSpectrumAnalyser1=false;c("cancelAnimationFrame")(this.$FBRTCAudioSpectrumAnalyser2)};q.prototype.$FBRTCAudioSpectrumAnalyser3=function(){var t=this.props.stream.getAudioAnalyser();if(!this.$FBRTCAudioSpectrumAnalyser1&&t){this.$FBRTCAudioSpectrumAnalyser1=true;var u=c("ReactDOM").findDOMNode(this),v=u.getContext("2d");this.$FBRTCAudioSpectrumAnalyser6(t,u,v)}};q.prototype.render=function(){return c("React").createElement("canvas",{width:p,height:o})};q.prototype.$FBRTCAudioSpectrumAnalyser6=function(t,u,v){this.$FBRTCAudioSpectrumAnalyser2=c("requestAnimationFrame")(function(){if(!this.$FBRTCAudioSpectrumAnalyser1)return;s(t,u,v);this.$FBRTCAudioSpectrumAnalyser6(t,u,v)}.bind(this))};var r=function r(t,u,v,w){var x=w?n:m;u+=k;v-=k;t.beginPath();t.arc(u,v,k,0,2*Math.PI,false);t.fillStyle=x;t.strokeStyle=x;t.fill()},s=function s(t,u,v){var w=void 0,x=void 0,y=u.width/l,z=Math.floor(u.height/j),A=new Uint8Array(2048);t.getByteFrequencyData(A);v.clearRect(0,0,u.width,u.height);var B=Math.floor(A.length/(l*3));for(var C=0;C<l;C+=1){w=0;for(var D=0;D<B;D+=1)w+=A[C*B+D];x=w*j/(B*256);if(x<1)x=.6;var E=0;for(E;E<Math.floor(x);E++)r(v,C*y,u.height-E*z,false);if(x-Math.floor(x)>=.5)r(v,C*y,u.height-E*z,true)}};f.exports=q}),null);
__d("FBRTCAudioConstraints",["FBRTCConstants","FBRTCVersionDetection"],(function a(b,c,d,e,f,g){"use strict";function h(i){var j=arguments.length<=1||arguments[1]===undefined?null:arguments[1];this.streamType=i;this.audioSource=j}h.prototype.getConstraints=function(){if(this.streamType===c("FBRTCConstants").StreamType.SCREEN_CONTENT&&c("FBRTCVersionDetection").isChrome())return false;if(!this.audioSource)return true;return{optional:[{sourceId:this.audioSource}]}};f.exports=h}),null);
__d("FBRTCVideoConstraints",["UserAgent","FBRTCConstants","RTCConfig"],(function a(b,c,d,e,f,g){"use strict";var h=1080,i=720,j=180,k=480,l=1920,m=1280,n=320,o=854,p=5,q=15,r=30;function s(t,u){var v=arguments.length<=2||arguments[2]===undefined?null:arguments[2];this.streamType=t;this.videoQuality=u;this.videoSource=v}s.prototype.getConstraints=function(){if(this.streamType===c("FBRTCConstants").StreamType.AUDIO_ONLY)return false;if(this.streamType===c("FBRTCConstants").StreamType.SCREEN_CONTENT){if(this.videoSource){if(c("FBRTCConstants").VideoQuality.CUSTOM_VIDEO_STREAM_SIZE)return{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:this.videoSource},optional:[{minHeight:k},{maxHeight:h},{minFrameRate:p},{maxFrameRate:r}]};var t={width:l,height:h,frameRate:r},u=this.$FBRTCVideoConstraints1(t),v=u.width,w=u.height,x=u.frameRate;return{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:this.videoSource,minHeight:w,maxHeight:w,minWidth:v,maxWidth:v,minFrameRate:p,maxFrameRate:x}}}return false}var y=this.$FBRTCVideoConstraints1(c("RTCConfig").CollaborationCallQuality.videoToRoom),z=y.width,A=y.height,B=y.frameRate;if(this.shouldUseNewMozAPI())return{height:{min:j,max:i,ideal:A},width:{min:320,max:1280,ideal:A*16/9},frameRate:{min:10,max:30,ideal:B}};var C={mandatory:{},optional:[{minHeight:A},{maxHeight:A},{minFrameRate:B},{maxFrameRate:B},{googLeakyBucket:true}]};if(this.videoSource)C.optional=C.optional.concat({sourceId:this.videoSource});if(this.videoQuality===c("FBRTCConstants").VideoQuality.CUSTOM_VIDEO)C.optional=C.optional.concat({minWidth:z},{maxWidth:z});return C};s.prototype.$FBRTCVideoConstraints1=function(t){var u=arguments.length<=1||arguments[1]===undefined?{width:o,height:k,frameRate:r}:arguments[1];switch(this.videoQuality){case c("FBRTCConstants").VideoQuality.HD_VIDEO:return{width:m,height:i,frameRate:r};case c("FBRTCConstants").VideoQuality.LQ_VIDEO:return{width:n,height:j,frameRate:q};case c("FBRTCConstants").VideoQuality.SD_VIDEO:return{width:o,height:k,frameRate:r};case c("FBRTCConstants").VideoQuality.CUSTOM_VIDEO:return t;default:return u}};s.prototype.shouldUseNewMozAPI=function(){return!!navigator.mediaDevices&&c("UserAgent").isBrowser("Firefox >= 38")};f.exports=s}),null);
__d("RTCMediaDevices",["invariant","Promise","RTCOnDeviceChangePoller"],(function a(b,c,d,e,f,g,h){"use strict";var i=navigator.mediaDevices&&typeof navigator.mediaDevices.enumerateDevices==="function",j=window.MediaStreamTrack&&window.MediaStreamTrack.getSources==="function",k=1e3,l=void 0,m={addEventListener:function o(p,q){if(p==="devicechange"&&c("RTCOnDeviceChangePoller").isNeeded()){if(!l)l=new(c("RTCOnDeviceChangePoller"))(k);l.add(q);return}var r=navigator,s=r.mediaDevices;if(s&&"addEventListener"in s)s.addEventListener(p,q)},removeEventListener:function o(p,q){if(p==="devicechange"&&c("RTCOnDeviceChangePoller").isNeeded()){if(l)l.remove(q);return}var r=navigator,s=r.mediaDevices;if(s&&"removeEventListener"in s)s.removeEventListener(p,q)},isSupported:function o(p){switch(p){case"enumerateDevices":return i||j;default:return Boolean(navigator.mediaDevices)}},enumerateDevices:function o(){if(i){navigator.mediaDevices||h(0);return c("Promise").resolve(navigator.mediaDevices.enumerateDevices())}else if(j)return new(c("Promise"))(function(p){return window.MediaStreamTrack.getSources(p)}).then(n);return c("Promise").reject(new Error("enumerateDevices() not supported"))},filterDevicesOfKind:function o(p,q){return p.filter(function(r){return r.kind===q})}};function n(o){return o.map(function(p){var q=p.id,r=p.kind,s=p.label;return{deviceId:q,groupId:"",kind:r==="video"?"videoinput":"audioinput",label:s}})}f.exports=m}),null);
__d("RTCOnDeviceChangePoller",["Promise","RTCMediaDevices"],(function a(b,c,d,e,f,g){h.isNeeded=function(){"use strict";var i=navigator,j=i.mediaDevices;if(!c("RTCMediaDevices").isSupported("enumerateDevices")||j&&"ondevicechange"in j)return false;return true};function h(i){"use strict";this.$RTCOnDeviceChangePoller1=[];this.$RTCOnDeviceChangePoller2="";this.$RTCOnDeviceChangePoller3=0;this.$RTCOnDeviceChangePoller4=0;this.$RTCOnDeviceChangePoller7=function(){c("RTCMediaDevices").enumerateDevices().then(function(j){var k=j.map(function(r){return r.deviceId+":"+r.label+":"+r.groupId}).sort().join("~");if(k===this.$RTCOnDeviceChangePoller2)return;this.$RTCOnDeviceChangePoller2=k;for(var l=this.$RTCOnDeviceChangePoller1,m=Array.isArray(l),n=0,l=m?l:l[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var o;if(m){if(n>=l.length)break;o=l[n++]}else{n=l.next();if(n.done)break;o=n.value}var p=o;try{p()}catch(q){}}}.bind(this))["catch"](function(j){return c("Promise").resolve()}).then(function(){this.$RTCOnDeviceChangePoller4=setTimeout(this.$RTCOnDeviceChangePoller7,this.$RTCOnDeviceChangePoller3)}.bind(this))["catch"](function(j){})}.bind(this);this.$RTCOnDeviceChangePoller3=i}h.prototype.add=function(i){"use strict";this.$RTCOnDeviceChangePoller1.push(i);this.$RTCOnDeviceChangePoller5()};h.prototype.remove=function(i){"use strict";this.$RTCOnDeviceChangePoller1=this.$RTCOnDeviceChangePoller1.filter(function(j){return j!==i});this.$RTCOnDeviceChangePoller6()};h.prototype.$RTCOnDeviceChangePoller5=function(){"use strict";if(this.$RTCOnDeviceChangePoller4!==0)return;this.$RTCOnDeviceChangePoller4=setTimeout(this.$RTCOnDeviceChangePoller7,0)};h.prototype.$RTCOnDeviceChangePoller6=function(){"use strict";if(this.$RTCOnDeviceChangePoller1.length>0)return;if(this.$RTCOnDeviceChangePoller4!==0){clearTimeout(this.$RTCOnDeviceChangePoller4);this.$RTCOnDeviceChangePoller4=0}};f.exports=h}),null);
__d("FBRTCUserMediaRequest",["Promise","FBRTCAudioConstraints","FBRTCConstants","FBRTCVideoConstraints","RTCMediaDevices"],(function a(b,c,d,e,f,g){"use strict";function h(i){var j=arguments.length<=1||arguments[1]===undefined?c("FBRTCConstants").VideoQuality.SD_VIDEO:arguments[1],k=arguments[2];this.streamType=i;this.videoQuality=j;this.isAudioOnly=k;this.audioSource=null;this.videoSource=null}h.prototype.$FBRTCUserMediaRequest1=function(){var i=new(c("FBRTCAudioConstraints"))(this.streamType,this.audioSource),j=new(c("FBRTCVideoConstraints"))(this.streamType,this.videoQuality,this.videoSource),k={audio:i.getConstraints(),video:j.getConstraints()};if(!this.isAudioOnly)return c("Promise").resolve(k);return c("RTCMediaDevices").enumerateDevices().then(function(l){if(l.every(function(m){var n=m.kind;return n!=="videoinput"}))k.video=false;return k})["catch"](function(){return c("Promise").resolve(k)})};h.prototype.request=function(){return this.$FBRTCUserMediaRequest1().then(function(i){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)return navigator.mediaDevices.getUserMedia(i);return new(c("Promise"))(function(j,k){if(navigator.getUserMedia)navigator.getUserMedia(i,j,k);else if(navigator.webkitGetUserMedia)navigator.webkitGetUserMedia(i,j,k);else if(navigator.mozGetUserMedia)navigator.mozGetUserMedia(i,j,k);else k("getUserMedia not supported")})})};f.exports=h}),null);
__d("FBRTCUserSettings",["Promise","FBRTCConfig","RTCMediaDevices","mixInEventEmitter"],(function a(b,c,d,e,f,g){"use strict";var h={audioInput:"",audioOutput:"default",videoInput:"",remoteStream:null,_audioInputLabel:null,_videoInputLabel:null,isEnabled:function i(){return Boolean(c("RTCMediaDevices").isSupported("enumerateDevices")&&c("FBRTCConfig").settingsEnabled())},selectAudioInputByLabel:function i(j){if(!this.audioInput)this.audioInput=this._selectByLabel(j,this._audioInputLabel);return this.audioInput},selectVideoInputByLabel:function i(j){if(!this.videoInput)this.videoInput=this._selectByLabel(j,this._videoInputLabel);return this.videoInput},_selectByLabel:function i(j,k){for(var l=j,m=Array.isArray(l),n=0,l=m?l:l[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var o;if(m){if(n>=l.length)break;o=l[n++]}else{n=l.next();if(n.done)break;o=n.value}var p=o;if(k&&k===p.label)return p.deviceId}return null},previewStart:function i(){this.emit("previewStarted")},previewEnd:function i(){this.emit("previewEnded")},save:function i(j){var k=j.audioInput,l=j.audioOutput,m=j.videoInput;return new(c("Promise"))(function(n){var o=!!(k&&this.audioInput!==k||m&&this.videoInput!==m);this.audioInput=k;this.audioOutput=l;this.videoInput=m;this.emit("saved",o);n(o)}.bind(this))},updateForLocalStream:function i(j){if(j.videoMediaSourceId)this.videoInput=j.videoMediaSourceId;else{var k=j.getVideoTracks(),l=k[0];if(l)this._videoInputLabel=l.label}if(j.audioMediaSourceId)this.audioInput=j.audioMediaSourceId;else{var m=j.getAudioTracks(),n=m[0];if(n)this._audioInputLabel=n.label}},updateForRemoteStream:function i(j){this.remoteStream=j;this.emit("remoteStreamChanged")},addListener:function i(){},emit:function i(){}};c("mixInEventEmitter")(h,{previewStarted:true,previewEnded:true,remoteStreamChanged:true,saved:true});f.exports=h}),null);
__d("FBRTCVideo.react",["cx","FBRTCStreamWrapper","FBRTCUtils","React","ReactDOM","joinClasses","shallowEqual"],(function a(b,c,d,e,f,g,h){"use strict";var i,j,k=c("React").PropTypes,l=c("React").Component;i=babelHelpers.inherits(m,l);j=i&&i.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=j.constructor).call.apply(n,[this].concat(q)),this.state={currentStream:null},this.streamListener=null,o}m.prototype.componentWillReceiveProps=function(n){var o=n.stream;if(o!==this.props.stream){if(this.streamListener)this.streamListener.remove();this.streamListener=o?o.addListener("streamStarted",function(){return this.$FBRTCVideo1()}.bind(this)):null}};m.prototype.shouldComponentUpdate=function(n){return!c("shallowEqual")(this.props,n)||this.$FBRTCVideo2(n)};m.prototype.$FBRTCVideo2=function(n){var o=n.stream,p=o?o.getStream():null;return p!==this.state.currentStream};m.prototype.render=function(){return c("React").createElement("video",{className:c("joinClasses")(this.props.className,"_1yvx"),autoPlay:true,muted:this.props.muted,onContextMenu:function n(o){return o.preventDefault()},onMouseDown:this.props.onMouseDown,onMouseUp:this.props.onMouseUp,onMouseMove:this.props.onMouseMove,onTouchStart:this.props.onTouchStart,onTouchEnd:this.props.onTouchEnd,onTouchMove:this.props.onTouchMove})};m.prototype.componentDidMount=function(){this.$FBRTCVideo3();this.$FBRTCVideo1()};m.prototype.componentDidUpdate=function(n){if(this.$FBRTCVideo2(n)||n.mediaStream!==this.props.mediaStream)this.$FBRTCVideo3();if(n.audioSinkID!==this.props.audioSinkID)this.$FBRTCVideo1()};m.prototype.$FBRTCVideo3=function(){var n=this.props,o=n.stream,p=n.mediaStream,q=c("ReactDOM").findDOMNode(this);if(q)if(o){o.attachToVideoTag(q);this.setState({currentStream:o.getStream()})}else if(p)c("FBRTCUtils").attachMediaStream(q,p)};m.prototype.$FBRTCVideo1=function(){var n=this.props.audioSinkID,o=c("ReactDOM").findDOMNode(this);if(n&&o&&typeof o.setSinkId==="function")o.setSinkId(n)};m.defaultProps={muted:false};m.propTypes={audioSinkID:k.string,className:k.string,mediaStream:k.any,muted:k.bool,stream:k.instanceOf(c("FBRTCStreamWrapper"))};f.exports=m}),null);
__d("RTCSettingsMediaDeviceSelector.react",["fbt","React","XUISingleSelector.react"],(function a(b,c,d,e,f,g,h){"use strict";var i=c("XUISingleSelector.react").Option,j=function j(m){var n=m.devices,o=m.defaultValue,p=babelHelpers.objectWithoutProperties(m,["devices","defaultValue"]);return n.length>0?c("React").createElement(c("XUISingleSelector.react"),babelHelpers["extends"]({defaultValue:o||n[0].deviceId},p),l(n)):c("React").createElement(c("XUISingleSelector.react"),babelHelpers["extends"]({},p,{disabled:true}),c("React").createElement(i,{value:null},"---"))},k={videoinput:"Camera",audioinput:"Microphone",audiooutput:"Audio Output"};function l(m){var n=0;return m.map(function(o){var p=o.label?o.label:h._({"Camera":"Camera{number}","Microphone":"Microphone{number}","Audio Output":"Audio output{number}"},[h["enum"](k[o.kind],{Camera:"Camera",Microphone:"Microphone","Audio Output":"Audio Output"}),h.param("number",++n)]);return c("React").createElement(i,{value:o.deviceId,key:o.deviceId},p)})}f.exports=j}),null);
__d("FBRTCSettingsDialog.react",["cx","fbt","Promise","FBRTCAudioSpectrumAnalyser.react","FBRTCConfig","FBRTCConstants","FBRTCDialog.react","FBRTCDialogBody.react","FBRTCDialogFooter.react","FBRTCDialogTitle.react","FBRTCStreamWrapper","FBRTCUserMediaRequest","FBRTCUserSettings","FBRTCUtils","FBRTCVideo.react","Link.react","React","ReactDOM","RTCMediaDevices","RTCSettingsMediaDeviceSelector.react","XUIDialogCancelButton.react","XUIDialogSaveButton.react","XUIGrayText.react"],(function a(b,c,d,e,f,g,h,i){"use strict";var j,k;j=babelHelpers.inherits(l,c("React").Component);k=j&&j.prototype;function l(q,r){k.constructor.call(this,q,r);this.$FBRTCSettingsDialog11=function(s){var t=s.value;this.$FBRTCSettingsDialog12({videoInput:t});this.$FBRTCSettingsDialog4()}.bind(this);this.$FBRTCSettingsDialog13=function(s){var t=s.value;this.$FBRTCSettingsDialog12({audioInput:t});this.$FBRTCSettingsDialog4()}.bind(this);this.$FBRTCSettingsDialog14=function(s){var t=s.value;this.$FBRTCSettingsDialog12({audioOutput:t,dirty:true});this.$FBRTCSettingsDialog15()}.bind(this);this.$FBRTCSettingsDialog7=function(){c("FBRTCUserSettings").save({audioInput:this.state.audioInput,audioOutput:this.state.audioOutput,videoInput:this.state.videoInput})}.bind(this);this.$FBRTCSettingsDialog2=function(){var s=c("ReactDOM").findDOMNode(this.refs.audioPreview),t=c("FBRTCUserSettings").remoteStream;if(t&&s)c("FBRTCUtils").attachMediaStream(s,t);this.$FBRTCSettingsDialog15()}.bind(this);this.$FBRTCSettingsDialog4=function(){return new(c("Promise"))(function(s,t){var u=this.state,v=u.audioInput,w=u.stream,x=u.videoInput;if(v&&x)p(v,x).then(function(y){w.setStream(y);return this.$FBRTCSettingsDialog3()}.bind(this)).done(s,t);else t()}.bind(this))}.bind(this);this.state={dirty:false,stream:new(c("FBRTCStreamWrapper"))(),loading:true,audioInput:c("FBRTCUserSettings").audioInput,audioInputs:[],audioOutput:c("FBRTCUserSettings").audioOutput,audioOutputs:[],videoInput:c("FBRTCUserSettings").videoInput,videoInputs:[]};this.$FBRTCSettingsDialog1=c("FBRTCUserSettings").addListener("remoteStreamChanged",this.$FBRTCSettingsDialog2)}l.prototype.componentDidMount=function(){this.$FBRTCSettingsDialog3().then(function(q){var r=q.audioInputs,s=q.audioOutputs,t=q.videoInputs;this.setState({audioInput:c("FBRTCUserSettings").selectAudioInputByLabel(r),videoInput:c("FBRTCUserSettings").selectVideoInputByLabel(t)})}.bind(this)).then(this.$FBRTCSettingsDialog4).done(function(){if(c("FBRTCUtils").supportsSetSink()){c("FBRTCUserSettings").previewStart();this.$FBRTCSettingsDialog2()}}.bind(this))};l.prototype.render=function(){return c("React").createElement(c("FBRTCDialog.react"),{width:365,shown:true,onToggle:this.props.onToggle},c("React").createElement(c("FBRTCDialogTitle.react"),{showCloseButton:true},c("React").createElement("span",null,i._("Settings"))),c("React").createElement(c("FBRTCDialogBody.react"),null,this.$FBRTCSettingsDialog5()),c("React").createElement(c("FBRTCDialogFooter.react"),{leftContent:this.$FBRTCSettingsDialog6()},c("React").createElement(c("XUIDialogCancelButton.react"),null),c("React").createElement(c("XUIDialogSaveButton.react"),{use:"confirm",disabled:!this.state.dirty,onClick:this.$FBRTCSettingsDialog7})))};l.prototype.componentWillUnmount=function(){this.$FBRTCSettingsDialog1.remove();c("FBRTCUserSettings").previewEnd()};l.prototype.$FBRTCSettingsDialog5=function(){if(this.state.loading)return c("React").createElement("div",{className:"_48fc loading"});return c("React").createElement("div",{className:"_48fc"},this.$FBRTCSettingsDialog8(),this.$FBRTCSettingsDialog9(),this.$FBRTCSettingsDialog10(),c("React").createElement(c("XUIGrayText.react"),{shade:"light"},i._("Tip: Try restarting your browser if you're having trouble with your camera or microphone.")))};l.prototype.$FBRTCSettingsDialog8=function(){var q=this.state,r=q.stream,s=q.videoInput,t=q.videoInputs;if(t.length<1)return null;var u=!this.props.callModel.supportsSdpUpdate();return c("React").createElement("div",{className:"_48fd"},c("React").createElement(m,null,i._("Camera")),c("React").createElement(c("RTCSettingsMediaDeviceSelector.react"),{devices:t,name:"camera_selection",onChange:this.$FBRTCSettingsDialog11,defaultValue:s,disabled:u,width:"200px"}),c("React").createElement("div",{className:"_48ff"},c("React").createElement(c("FBRTCVideo.react"),{ref:"videoPreview",stream:r,muted:true,className:"_48fg"})))};l.prototype.$FBRTCSettingsDialog12=function(q){this.setState(babelHelpers["extends"]({},q,{dirty:this.state.dirty||Object.keys(q).some(function(r){return this.state[r]!==q[r]}.bind(this))}))};l.prototype.$FBRTCSettingsDialog9=function(){var q=this.state,r=q.audioInput,s=q.audioInputs,t=q.stream;if(s.length<1)return null;var u=!this.props.callModel.supportsSdpUpdate();return c("React").createElement("div",{className:"_48fd"},c("React").createElement(m,null,i._("Microphone")),c("React").createElement(c("RTCSettingsMediaDeviceSelector.react"),{devices:s,name:"microphone_selection",onChange:this.$FBRTCSettingsDialog13,defaultValue:r,disabled:u,width:"200px"}),c("React").createElement("div",{className:"_48fh"},c("React").createElement(c("FBRTCAudioSpectrumAnalyser.react"),{stream:t})))};l.prototype.$FBRTCSettingsDialog10=function(){var q=this.state,r=q.audioOutput,s=q.audioOutputs;if(s.length<1)return null;return c("React").createElement("div",{className:"_48fd"},c("React").createElement(m,null,i._("Audio output")),c("React").createElement(c("RTCSettingsMediaDeviceSelector.react"),{devices:s,name:"audio_output_selection",onChange:this.$FBRTCSettingsDialog14,defaultValue:r,disabled:!c("FBRTCUtils").supportsSetSink(),width:"200px"}),c("React").createElement("div",{className:"_48fh"},c("React").createElement("audio",{autoPlay:true,ref:"audioPreview"})))};l.prototype.$FBRTCSettingsDialog6=function(){return c("React").createElement("div",null,c("React").createElement(c("XUIGrayText.react"),{shade:"light"},c("React").createElement(c("Link.react"),{href:c("FBRTCConfig").userMediaErrorUrl(),target:"_blank"},i._("Get help"))))};l.prototype.$FBRTCSettingsDialog15=function(){var q=c("ReactDOM").findDOMNode(this.refs.audioPreview),r=this.state.audioOutput;if(r&&q&&typeof q.setSinkId==="function")q.setSinkId(r)};l.prototype.$FBRTCSettingsDialog3=function(){this.setState({loading:true});return c("RTCMediaDevices").enumerateDevices().then(o).then(function(q){var r=q.audioInputs,s=q.audioOutputs,t=q.videoInputs,u=this.state,v=u.audioInput,w=u.audioOutput,x=u.videoInput;this.setState({loading:false,audioInputs:r,audioInput:v||n(r[0]),audioOutputs:s,audioOutput:w||n(s[0]),videoInputs:t,videoInput:x||n(t[0])});return{audioInputs:r,audioOutputs:s,videoInputs:t}}.bind(this))["catch"](function(q){this.setState({loading:false});throw q}.bind(this))};var m=function m(q){var r=q.children;return c("React").createElement(c("XUIGrayText.react"),{display:"block",size:"medium",shade:"medium",className:"_48fe"},r)};function n(q){if(!q)return null;return q.deviceId}function o(q){var r=[],s=[],t=[];for(var u=q,v=Array.isArray(u),w=0,u=v?u:u[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var x;if(v){if(w>=u.length)break;x=u[w++]}else{w=u.next();if(w.done)break;x=w.value}var y=x;switch(y.kind){case"audioinput":r.push(y);break;case"audiooutput":s.push(y);break;case"videoinput":t.push(y);break;default:}}return{audioInputs:r,audioOutputs:s,videoInputs:t}}function p(q,r){var s=new(c("FBRTCUserMediaRequest"))(c("FBRTCConstants").StreamType.AUDIO_VIDEO);s.audioSource=q;s.videoSource=r;return s.request()}f.exports=l}),null);
__d("FBRTCVideoEscalationDialog.react",["fbt","FBRTCCallControlActions","React","XUIDialog.react","XUIDialogBody.react","XUIDialogButton.react","XUIDialogFooter.react"],(function a(b,c,d,e,f,g,h){"use strict";var i,j,k=c("React").PropTypes,l=440;i=babelHelpers.inherits(m,c("React").Component);j=i&&i.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=j.constructor).call.apply(n,[this].concat(q)),this.$FBRTCVideoEscalationDialog2=function(s){this.props.hideDialog();c("FBRTCCallControlActions").acceptEscalation()}.bind(this),o}m.prototype.render=function(){return c("React").createElement(c("XUIDialog.react"),{layerHideOnBlur:false,shown:true,width:l},c("React").createElement(c("XUIDialogBody.react"),null,c("React").createElement("p",null,h._("{name} would like to video chat. Click \"Accept\" to enable your camera.",[h.param("name",this.props.peerName)]))),c("React").createElement(c("XUIDialogFooter.react"),null,c("React").createElement(c("XUIDialogButton.react"),{action:"cancel",label:h._("Decline"),onClick:this.$FBRTCVideoEscalationDialog1}),c("React").createElement(c("XUIDialogButton.react"),{action:"confirm",label:h._("Accept"),onClick:this.$FBRTCVideoEscalationDialog2,use:"confirm"})))};m.prototype.$FBRTCVideoEscalationDialog1=function(n){c("FBRTCCallControlActions").declineEscalation()};m.propTypes={peerName:k.string.isRequired,hideDialog:k.func.isRequired};f.exports=m}),null);
__d("FBRTCCallDialogController",["FBRTCCallModel","FBRTCScreenSharingModel","FBRTCSettingsDialog.react","FBRTCStruct","FBRTCMediaAccessErrorDialog.react","FBRTCPeerBrowserUnsupportedDialog.react","FBRTCScreenSharingUnsupportedBrowserDialog.react","FBRTCScreenSharingInstallExtensionDialog.react","FBRTCUserSettings","FBRTCVideoEscalationDialog.react","React","ReactDOM"],(function a(b,c,d,e,f,g){var h,i,j=new(c("FBRTCStruct"))(["ERROR_ACCESSING_MEDIA","PEER_BROWSER_UNSUPPORTED","SETTINGS","SCREEN_SHARING_UNSUPPORTED","INSTALL_SCREEN_SHARING_EXT","VIDEO_ESCALATION"]);h=babelHelpers.inherits(k,c("React").Component);i=h&&h.prototype;function k(){var m,n;"use strict";for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return n=(m=i.constructor).call.apply(m,[this].concat(p)),this.$DialogOwner1=function(r){setTimeout(function(){if(!r)l.hideDialog()},0)},n}k.prototype.render=function(){"use strict";if(this.props.dialogType===j.ERROR_ACCESSING_MEDIA)return c("React").createElement(c("FBRTCMediaAccessErrorDialog.react"),{key:"dialog"});if(this.props.dialogType===j.PEER_BROWSER_UNSUPPORTED)if(this.props.peerName)return c("React").createElement(c("FBRTCPeerBrowserUnsupportedDialog.react"),{peerName:this.props.peerName,key:"dialog"});if(this.props.dialogType===j.SETTINGS)return c("React").createElement(c("FBRTCSettingsDialog.react"),{onToggle:this.$DialogOwner1,callModel:this.props.callModel,key:"dialog"});if(this.props.dialogType===j.SCREEN_SHARING_UNSUPPORTED)return c("React").createElement(c("FBRTCScreenSharingUnsupportedBrowserDialog.react"),{onToggle:this.$DialogOwner1,key:"dialog"});if(this.props.dialogType===j.INSTALL_SCREEN_SHARING_EXT)return c("React").createElement(c("FBRTCScreenSharingInstallExtensionDialog.react"),{onToggle:this.$DialogOwner1,peerID:this.props.peerID,sessionID:this.props.sessionID,key:"dialog"});if(this.props.dialogType===j.VIDEO_ESCALATION)if(this.props.peerName)return c("React").createElement(c("FBRTCVideoEscalationDialog.react"),{hideDialog:function m(){l.hideDialog()},onToggle:this.$DialogOwner1,peerName:this.props.peerName,key:"dialog"});return null};var l={dialogTypes:j,container:null,setDialogContainer:function m(n){this.container=n;this.currentDialogType=null;this.callModel=null;this._render()},showDialog:function m(n,o){this.currentDialogType=n;this._setCallModel(o);this._render()},hideDialog:function m(){this.currentDialogType=null;this._render()},hideDialogType:function m(n){if(n===this.currentDialogType)this.hideDialog()},_render:function m(){var n,o,p;if(this.callModel instanceof c("FBRTCCallModel")){n=this.callModel.peerID;o=this.callModel.callID;p=this.callModel.peerName()}else if(this.callModel instanceof c("FBRTCScreenSharingModel")){n=this.callModel.getPeerID();o=this.callModel.getSessionID()}c("ReactDOM").render(c("React").createElement(k,{dialogType:this.currentDialogType,peerID:n,sessionID:o,peerName:p,callModel:this.callModel}),this.container)},_setCallModel:function m(n){if(n!==this.callModel){this.callModel=n;if(this.callModel)this.callModel.addListener(this._onCallModelChanged.bind(this))}},_onCallModelChanged:function m(){var n=[j.SETTINGS,j.SCREEN_SHARING_UNSUPPORTED,j.INSTALL_SCREEN_SHARING_EXT,j.VIDEO_ESCALATION];if(this.callModel.isEnded()&&n.indexOf(this.currentDialogType)>-1)this.hideDialog()}};c("FBRTCUserSettings").addListener("saved",l.hideDialog,l);f.exports=l}),null);
__d("FBRTCStarRatingActions",["FBRTCDispatcher","keyMirror"],(function a(b,c,d,e,f,g){"use strict";var h=c("keyMirror")({SUBMIT_RATING:null,SUBMIT_FEEDBACK:null,RATING_SHOWN:null,FEEDBACK_SHOWN:null}),i={Types:h,submitRating:function j(k){c("FBRTCDispatcher").dispatch({type:h.SUBMIT_RATING,rating:k})},submitFeedback:function j(k){c("FBRTCDispatcher").dispatch({type:h.SUBMIT_FEEDBACK,feedback:k})},ratingShown:function j(){c("FBRTCDispatcher").dispatch({type:h.RATING_SHOWN})},feedbackShown:function j(){c("FBRTCDispatcher").dispatch({type:h.FEEDBACK_SHOWN})}};f.exports=i}),null);
__d("FBRTCCallModelStatePusher",["FBRTCCallControlActions","FBRTCCallModel","FBRTCConfig","FBRTCConstants","FBRTCDispatcher","FBRTCStarRatingActions"],(function a(b,c,d,e,f,g){var h=3e4,i=1e4;function j(k){"use strict";this.$FBRTCCallModelStatePusher1=null;this.$FBRTCCallModelStatePusher2=k;this.$FBRTCCallModelStatePusher2.addListener(this.$FBRTCCallModelStatePusher3.bind(this));c("FBRTCDispatcher").register(this.$FBRTCCallModelStatePusher4.bind(this))}j.prototype.$FBRTCCallModelStatePusher5=function(){"use strict";return this.$FBRTCCallModelStatePusher2.uiState===c("FBRTCCallModel").UIState.CALL_ENDED&&this.$FBRTCCallModelStatePusher2.wasConnected&&this.$FBRTCCallModelStatePusher2.endCallReason===c("FBRTCConstants").CallEndReason.HANGUP_CALL&&!c("FBRTCConfig").isVCEndpointCall()};j.prototype.$FBRTCCallModelStatePusher3=function(){"use strict";if(this.$FBRTCCallModelStatePusher2.uiState===c("FBRTCCallModel").UIState.CALL_ENDED)if(this.$FBRTCCallModelStatePusher5())this.$FBRTCCallModelStatePusher6(3e3,c("FBRTCCallModel").UIState.CALL_ENDED,c("FBRTCCallModel").UIState.COLLECT_RATING);else this.$FBRTCCallModelStatePusher7(i);else if(this.$FBRTCCallModelStatePusher2.uiState===c("FBRTCCallModel").UIState.COLLECT_RATING)this.$FBRTCCallModelStatePusher7(h)};j.prototype.$FBRTCCallModelStatePusher4=function(k){"use strict";if(k.type===c("FBRTCStarRatingActions").Types.FEEDBACK_SHOWN||k.type===c("FBRTCCallControlActions").Types.REDIAL_CALL)this.$FBRTCCallModelStatePusher8()};j.prototype.$FBRTCCallModelStatePusher7=function(k){"use strict";this.$FBRTCCallModelStatePusher1=setTimeout(function(){window.close()},k)};j.prototype.$FBRTCCallModelStatePusher8=function(){"use strict";clearTimeout(this.$FBRTCCallModelStatePusher1);this.$FBRTCCallModelStatePusher1=null};j.prototype.$FBRTCCallModelStatePusher6=function(k,l,m){"use strict";var n=this.$FBRTCCallModelStatePusher2;setTimeout(function(){n.setStateFrom(l,m)},k)};f.exports=j}),null);
__d("FBRTCCallMonitor",["FBRTCCallSummaryStore"],(function a(b,c,d,e,f,g){var h=1e4,i=3e3;function j(k){"use strict";this.$FBRTCCallMonitor1=k;this.$FBRTCCallMonitor2=null;this.$FBRTCCallMonitor3=c("FBRTCCallSummaryStore").getInstance()}j.prototype.startHeartbeat=function(k){"use strict";if(this.$FBRTCCallMonitor1.isEnded())return;var l=k();if(l)this.onCallHeartbeat(l);var m=this;setTimeout(function(){m.startHeartbeat(k)},h)};j.prototype.onCallHeartbeat=function(k){"use strict";var l=new Date().valueOf();if(!this.$FBRTCCallMonitor2||l-this.$FBRTCCallMonitor2>i)k.save(this.$FBRTCCallMonitor3)};f.exports=j}),null);
__d("FBRTCExperiment",["FBRTCExperimentsConfig","QE"],(function a(b,c,d,e,f,g){"use strict";h.gen=function(i){var j={params:{},in_experiment:false,auto_exposure:false},k=c("FBRTCExperimentsConfig")[i]||j,l=new h(i,k.params,k.in_experiment);if(k.auto_exposure)l.logExposure(i);return l};function h(i,j,k){this.$FBRTCExperiment2=i;this.$FBRTCExperiment3=j;this.$FBRTCExperiment1=k}h.prototype.logExposure=function(){if(this.$FBRTCExperiment1)c("QE").logExposure(this.$FBRTCExperiment2)};h.prototype.getParam=function(i,j){if(this.$FBRTCExperiment3[i])return this.$FBRTCExperiment3[i].toString();return j};h.prototype.getInt=function(i,j){if(this.$FBRTCExperiment3[i])return parseInt(this.$FBRTCExperiment3[i],10);return j};h.prototype.getBool=function(i,j){var k=this.$FBRTCExperiment3;if(k[i])return k[i]==="1"||k[i]===1||k[i]==="true";return j};f.exports=h}),null);
__d("FBRTCIceCache",[],(function a(b,c,d,e,f,g){function h(){"use strict";this.$FBRTCIceCache1={}}h.prototype.reset=function(i,j){"use strict";if(!this.$FBRTCIceCache1[i])this.$FBRTCIceCache1[i]={};this.$FBRTCIceCache1[i][j]=[]};h.prototype.cacheCandidate=function(i,j,k){"use strict";if(!this.$FBRTCIceCache1[i])this.$FBRTCIceCache1[i]={};if(!this.$FBRTCIceCache1[i][j])this.$FBRTCIceCache1[i][j]=[];this.$FBRTCIceCache1[i][j].unshift(k)};h.prototype.drainCandidates=function(i,j,k){"use strict";if(this.$FBRTCIceCache1[i]&&this.$FBRTCIceCache1[i][j]){var l;while(this.$FBRTCIceCache1[i][j].length>0){l=this.$FBRTCIceCache1[i][j].pop();k(l)}}};f.exports=h}),null);
__d("FBRTCMessage",["FBRTCConstants","FBRTCExperiment","FBRTCSdpUtils","FBRTCSupport","UserAgent"],(function a(b,c,d,e,f,g){var h="mobile";function i(j){"use strict";if(!this.$FBRTCMessage1(j))throw new Error("invalid webrtc message");this.originalMessageData=j;this.peerID=j.from;this.callID=parseInt(j.call_id,10);this.msg=JSON.parse(j.payload);this.msgType=this.msg.type;this.msgID=this.msg.msg_id;this.ackID=this.msg.ack_id;this.source=j.source;this.peerSupportsVideoInterop=!!this.msg.supports_video_interop;this.$FBRTCMessage2();this.$FBRTCMessage3();this.$FBRTCMessage4();this.$FBRTCMessage5()}i.prototype.$FBRTCMessage1=function(j){"use strict";return j.from&&j.call_id&&j.payload};i.prototype.$FBRTCMessage2=function(){"use strict";if(c("FBRTCSupport").isVideoInteropSupported()&&this.peerSupportsVideoInterop)return;if(this.isFromMobile())this.disableVideo()};i.prototype.disableVideo=function(){"use strict";if(this.msg.sdp)this.msg.sdp=c("FBRTCSdpUtils").disableVideo(this.msg.sdp);if(this.msgType===c("FBRTCConstants").PayloadType.SET_VIDEO||this.msgType===c("FBRTCConstants").PayloadType.OFFER||this.msgType===c("FBRTCConstants").PayloadType.ICERESTART_OFFER||this.msgType===c("FBRTCConstants").PayloadType.ANSWER||this.msgType===c("FBRTCConstants").PayloadType.ICERESTART_ANSWER)this.msg.videoon=false};i.prototype.$FBRTCMessage3=function(){"use strict";if(this.isFromMobile()&&this.msg.sdp&&this.msgType!==c("FBRTCConstants").PayloadType.ICE_CANDIDATE)this.msg.sdp=c("FBRTCSdpUtils").removeFEC(this.msg.sdp)};i.prototype.$FBRTCMessage4=function(){"use strict";if(this.isFromMobile()&&c("FBRTCSupport").isWebrtcSupported()&&this.msg.sdp&&this.msgType!==c("FBRTCConstants").PayloadType.ICE_CANDIDATE){var j=c("FBRTCExperiment").gen("rtc_browser_use_h264"),k=j.getParam("allow_h264","no");if(k!=="yes")this.msg.sdp=c("FBRTCSdpUtils").removeH264(this.msg.sdp)}};i.prototype.$FBRTCMessage5=function(){"use strict";if(this.isFromMobile()&&c("FBRTCSupport").isWebrtcSupported()&&this.msg.sdp&&this.msgType!==c("FBRTCConstants").PayloadType.ICE_CANDIDATE){var j=c("FBRTCExperiment").gen("rtc_browser_use_vp9"),k=j.getParam("allow_vp9","no");if(k!=="yes")this.msg.sdp=c("FBRTCSdpUtils").removeVP9(this.msg.sdp)}};i.prototype.isOffer=function(){"use strict";return this.msgType===c("FBRTCConstants").PayloadType.OFFER};i.prototype.isFromMobile=function(){"use strict";return this.source===h};i.prototype.isRemoteVideoSupported=function(){"use strict";if(!this.msg.sdp||this.msgType===c("FBRTCConstants").PayloadType.ICE_CANDIDATE)return true;return c("FBRTCSdpUtils").isVideoSupported(this.msg.sdp)};i.prototype.isRetry=function(){"use strict";return!!this.msg.flag};i.prototype.isForCall=function(j){"use strict";return!j||j===this.callID||this.msgType===c("FBRTCConstants").PayloadType.OFFER||this.msgType===c("FBRTCConstants").PayloadType.ICERESTART_OFFER||this.msgType===c("FBRTCConstants").PayloadType.PCRESTART_OFFER||this.msgType===c("FBRTCConstants").PayloadType.ICE_CANDIDATE};i.prototype.getSignalingExperiments=function(){"use strict";if(this.isFromMobile()&&!this.msg.experiments)return["sdp_update"];return this.msg.experiments};f.exports=i}),null);
__d("FBRTCMessageDedup",[],(function a(b,c,d,e,f,g){var h={},i={check:function j(k,l,m){if(!h[k])h[k]={};if(!h[k][l])h[k][l]={};if(h[k][l][m])return false;h[k][l][m]=true;return true}};f.exports=i}),null);
__d("BanzaiScribe",["Banzai"],(function a(b,c,d,e,f,g){function h(j){return{log:function k(l,m,n){var o=[m];if(n!=null)o.push(n);c("Banzai").post("scribe:"+l,o,j)}}}var i=h({});i.create=h;f.exports=i}),null);
__d("SamplingPolicyBase",[],(function a(b,c,d,e,f,g){function h(){"use strict";throw new Error("Tried to instantiate SamplingPolicyBase")}h.prototype.getName=function(){"use strict";return this.name};h.prototype.isSampled=function(){"use strict";if(typeof this.sampled=="undefined")this.sampled=this.decideIfSampled();return this.sampled};f.exports=h}),null);
__d("FbtraceForcedByServerPolicy",["FbtraceForcedByServer","SamplingPolicyBase"],(function a(b,c,d,e,f,g){"use strict";var h=void 0;function i(){this.name="FbtraceForcedByServerPolicy"}i.get=function(){if(typeof h=="undefined")h=new i();return h};function j(){return c("FbtraceForcedByServer").forced}Object.assign(i.prototype,c("SamplingPolicyBase").prototype,{decideIfSampled:j});f.exports=i}),null);
__d("guardFunction",[],(function a(b,c,d,e,f,g){function h(i,j,k){return function(){if(i.apply(k||this,arguments))j.apply(k||this,arguments)}}f.exports=h}),null);
__d("Fbtrace",["Arbiter","ArtilleryTraceIDUtils","BanzaiScribe","FbtraceForcedByServer","FbtraceForcedByServerPolicy","SiteData","guardFunction"],(function a(b,c,d,e,f,g){"use strict";function h(){Object.assign(this,h)}Object.assign(h,{isOn:function s(){return false},replySend:function s(t,u){},requestSend:function s(t,u,v){m(t,u);return{metadata:function w(){return undefined},replyReceive:function w(v){}}}});var i=new h();function j(s,t,u){if(!s)throw{name:"ArgumentError",message:"no valid service name specified"};if(!t)throw{name:"ArgumentError",message:"no valid version specified"};var v=c("BanzaiScribe"),w=0,x=c("ArtilleryTraceIDUtils").newTraceId(),y=c("ArtilleryTraceIDUtils").newObjectId(),z=c("ArtilleryTraceIDUtils").traceIdToBucket(x),A={service:s,version:t},B=function B(G){if(typeof G=="undefined")return"undefined";if(typeof G!="string")G=B(JSON.stringify(G));return G},C=function C(u){var G="";for(var H in u){if(G.length>0)G+="\x02";G+=B(H)+"\x03"+B(u[H])}return G},D=function D(G,y,event,u,H){w++;return[H,w,x,G,y,B(event),C(u)].join("\x01")},E=function E(G,y,event,u,H){if(!H&&typeof H=="undefined")H=Date.now()*1e3;var I=D(G,y,event,u,H);v.log("fbtrace",I,z)},F=function F(){return y};E(c("ArtilleryTraceIDUtils").getDummyId(),y,"#rqrecv",Object.assign(u||{},A));Object.assign(this,j,{replySend:function G(H,u){u=babelHelpers["extends"]({},u,A,{success:H?"true":"false"});E(c("ArtilleryTraceIDUtils").getDummyId(),y,"#rpsend",u)},requestSend:function G(H,I,u){m(H,I);var J=F(),y=c("ArtilleryTraceIDUtils").newObjectId();u=babelHelpers["extends"]({},u,A,{op:H,"remote:service":I});E(J,y,"#rqsend",u);return{metadata:function K(){return x+y},replyReceive:function K(u){E(J,y,"#rprecv",Object.assign(u||{},A))},parentNode:this}}})}Object.assign(j,{isOn:function s(){return true}});function k(){return i}function l(s,t,u){u=u||{};u.init=true;var v=c("FbtraceForcedByServerPolicy").get();if(v.isSampled())return new j(s,t,u);else return new h()}function m(s,t){if(!s)throw{name:"ArgumentError",message:"no valid operation specified"};if(!t)throw{name:"ArgumentError",message:"no valid remote:service specified"}}function n(s,t){var u=i,v=void 0;i=s;try{v=t()}finally{i=u}return v}var o=function o(s,t){var u=k(),v=t.request,w=false;if(!u.isOn()&&c("FbtraceForcedByServer").forced&&/\/upload\/(?:composer|photos)\/|\/ajax\/composerx\/attachment\/media\//.test(v.uri.toString())){u=l("photo_upload_kludge",String(c("SiteData").client_revision||"dev"),{policy:"PhotoUpload"});w=true}if(u.isOn()){var x=w?{policy:"PhotoUpload"}:{};if(v.userActionId)x.user_action_id=v.userActionId;var y=u.requestSend(v.uri.toString(),"www",x);v.fbtraceRemoteNode=y;v.transport.setRequestHeader("X-Fbtrace-Meta",y.metadata())}},p=function p(s,t){t.request.fbtraceRemoteNode.replyReceive({is_last:t.response.is_last,success:true});setTimeout(function(){t.request.fbtraceRemoteNode.parentNode.replySend(true,{})},0)},q=function q(s,t){t.request.fbtraceRemoteNode.replyReceive({is_last:t.response.is_last,success:false,error_code:t.response.error,error_summary:t.response.errorSummary,error_description:t.response.errorDescription});setTimeout(function(){t.request.fbtraceRemoteNode.parentNode.replySend(false,{})},0)},r=function r(s,t){return t.request.fbtraceRemoteNode};c("Arbiter").subscribe("AsyncRequest/will_send",o);c("Arbiter").subscribe("AsyncRequest/response",c("guardFunction")(r,p));c("Arbiter").subscribe("AsyncRequest/error",c("guardFunction")(r,q));f.exports={defaultNode:k,requestReceive:l,withDefaultNode:n}}),null);
__d("XCollabCallSendMessageController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/collab/sendmessage/",{recipient_id:{type:"Int",required:true},msg_id:{type:"Int",required:true},message_info:{type:"String",required:true},webrtc_fbtrace:{type:"Int"}})}),null);
__d("XVideoCallSendMessageController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/videocall/sendmessage/",{recipient_id:{type:"Int",required:true},msg_id:{type:"Int",required:true},message_info:{type:"String",required:true},webrtc_fbtrace:{type:"Int"}})}),null);
__d("FBRTCMessageSender",["errorCode","CurrentUser","FBRTCConfig","FBRTCConstants","FBRTCLogger","FBRTCUtils","Fbtrace","Map","SiteData","FBRTCSupport","XVideoCallSendMessageController","XCollabCallSendMessageController"],(function a(b,c,d,e,f,g,h){var i=0;function j(){"use strict";this.onSendFailure=null;this.$FBRTCMessageSender1=c("FBRTCLogger").getInstance()}j.prototype.sendOffer=function(k,l,m,n,o){"use strict";return this.$FBRTCMessageSender2(c("FBRTCConstants").PayloadType.OFFER,k,l,m,n,o)};j.prototype.sendAnswer=function(k,l,m,n,o){"use strict";return this.$FBRTCMessageSender2(c("FBRTCConstants").PayloadType.ANSWER,k,l,m,n,o)};j.prototype.sendPCRestartOffer=function(k,l,m,n,o){"use strict";return this.$FBRTCMessageSender2(c("FBRTCConstants").PayloadType.PCRESTART_OFFER,k,l,m,n,o)};j.prototype.sendSdpUpdate=function(k,l,m,n,o){"use strict";return this.$FBRTCMessageSender2(c("FBRTCConstants").PayloadType.SDP_UPDATE,k,l,m,n,o)};j.prototype.resendSdpMessage=function(k,l){"use strict";l.flag=1;this.$FBRTCMessageSender3(k,l)};j.prototype.resendPayload=function(k,l){"use strict";l.flag=1;this.$FBRTCMessageSender4(k,l)};j.prototype.$FBRTCMessageSender2=function(k,l,m,n,o,p){"use strict";var q=this.$FBRTCMessageSender5(m,k);q.sdp=n;if(k===c("FBRTCConstants").PayloadType.OFFER){q.handlescollision=true;q.pranswer=false}if(k===c("FBRTCConstants").PayloadType.OFFER||k===c("FBRTCConstants").PayloadType.ANSWER){q.icerestart=false;q.experiments=c("FBRTCConfig").supportedSignalingExperiments()}q.videoon=o;q.attributes=p;q.ull=c("FBRTCConstants").convertFromUploadLogLevel(c("FBRTCUtils").getLocalUploadLogLevel());this.$FBRTCMessageSender3(l,q);return q};j.prototype.sendIceCandidate=function(k,l,m){"use strict";var n=this.$FBRTCMessageSender5(l,c("FBRTCConstants").PayloadType.ICE_CANDIDATE);n.sdp_mid=m.sdpMid;n.label=m.sdpMLineIndex;n.sdp=m.candidate;if(m.isDirectScreenShareFromRecipient){n.attributes={};n.attributes.isDirectScreenShareFromRecipient=m.isDirectScreenShareFromRecipient}this.$FBRTCMessageSender4(k,n)};j.prototype.sendHangup=function(k,l,m,n,o){"use strict";var p=this.$FBRTCMessageSender5(l,c("FBRTCConstants").PayloadType.HANGUP);p.reason=c("FBRTCConstants").callEndReasonString(m);p.subreason=o||"";this.$FBRTCMessageSender4(k,p,n)};j.prototype.sendOtherDismiss=function(k){"use strict";var l=this.$FBRTCMessageSender5(k,c("FBRTCConstants").PayloadType.OTHER_DISMISS);this.$FBRTCMessageSender4(c("CurrentUser").getID(),l)};j.prototype.sendOfferAck=function(k,l,m){var n=arguments.length<=3||arguments[3]===undefined?new(c("Map"))():arguments[3];"use strict";this.$FBRTCMessageSender6(k,l,m,c("FBRTCConstants").PayloadType.OFFER_ACK,n)};j.prototype.sendOfferNack=function(k,l,m){"use strict";this.$FBRTCMessageSender6(k,l,m,c("FBRTCConstants").PayloadType.OFFER_NACK,new(c("Map"))([["error_code",1356043]]))};j.prototype.sendAnswerAck=function(k,l,m){"use strict";this.$FBRTCMessageSender6(k,l,m,c("FBRTCConstants").PayloadType.ANSWER_ACK)};j.prototype.sendAck=function(k,l,m){"use strict";this.$FBRTCMessageSender6(k,l,m,c("FBRTCConstants").PayloadType.ACK,new(c("Map"))([["ack_type",m.type]]))};j.prototype.sendMuteStateUpdate=function(k,l,m){"use strict";var n=this.$FBRTCMessageSender5(l,c("FBRTCConstants").PayloadType.SET_VIDEO);n.videoon=m;this.$FBRTCMessageSender4(k,n)};j.prototype.sendVideoEscalationRequest=function(k,l,m){"use strict";return this.sendVideoRequestResponse(k,l,0,m)};j.prototype.sendVideoRequestResponse=function(k,l,m,n){"use strict";var o=this.$FBRTCMessageSender5(l,c("FBRTCConstants").PayloadType.VIDEO_REQUEST);o.ack_id=m;o.videoon=n;o.capability=c("FBRTCSupport").getCapabilities();this.$FBRTCMessageSender4(k,o);return o};j.prototype.sendMsgAck=function(){"use strict"};j.prototype.sendOk=function(){"use strict"};j.prototype.sendPranswer=function(){"use strict"};j.prototype.sendIcerestartAnswer=function(){"use strict"};j.prototype.$FBRTCMessageSender5=function(k,l){"use strict";var m=c("FBRTCUtils").generateRandomInt(),n={version:i,type:l,call_id:k,msg_id:m};if(this.$FBRTCMessageSender7(l))n.supports_video_interop=true;return n};j.prototype.$FBRTCMessageSender7=function(k){"use strict";if(c("FBRTCSupport").isVideoInteropSupported())return k===c("FBRTCConstants").PayloadType.OFFER||k===c("FBRTCConstants").PayloadType.ANSWER||k===c("FBRTCConstants").PayloadType.PRANSWER||k===c("FBRTCConstants").PayloadType.ICERESTART_OFFER||k===c("FBRTCConstants").PayloadType.ICERESTART_ANSWER||k===c("FBRTCConstants").PayloadType.PCRESTART_OFFER||k===c("FBRTCConstants").PayloadType.PCRESTART_ANSWER||k===c("FBRTCConstants").PayloadType.SDP_UPDATE||k===c("FBRTCConstants").PayloadType.SET_VIDEO||k===c("FBRTCConstants").PayloadType.VIDEO_REQUEST;return false};j.prototype.$FBRTCMessageSender3=function(k,l){"use strict";this.$FBRTCMessageSender4(k,l,false,true,true)};j.prototype.$FBRTCMessageSender6=function(k,l,m,n){"use strict";var o=(arguments.length<=4?undefined:arguments[4])||new(c("Map"))(),p=this.$FBRTCMessageSender5(l,n);p.ack_id=m.msg_id;if(m.flag===1)p.flag=1;p.ull=c("FBRTCConstants").convertFromUploadLogLevel(c("FBRTCUtils").getLocalUploadLogLevel());o.forEach(function(q,r,s){p[r]=q});this.$FBRTCMessageSender4(k,p)};j.prototype.$FBRTCMessageSender4=function(k,l,m,n,o){"use strict";var p=l.msg_id,q={peer_id:k,call_id:l.call_id,msg_id:p,msg_type:l.type},r={call_id:l.call_id,msg_id:p,user_id:c("CurrentUser").getID(),recipient_id:k,msg_type:l.type,app_id:256281040558,app_version:String(c("SiteData").client_revision||"dev"),op:"sendServerRequest:"+l.type,policy:"WebRTC"},s=c("Fbtrace").requestReceive("browser",String(c("SiteData").client_revision||"dev"),r),t=(c("FBRTCUtils").isPeerVCEndpoint(k)?c("XCollabCallSendMessageController"):c("XVideoCallSendMessageController")).getURIBuilder().setInt("recipient_id",k).setInt("msg_id",p).setString("message_info",JSON.stringify(l)).setInt("webrtc_fbtrace",s.isOn()?1:0).getURI();if(n)var u=this.$FBRTCMessageSender4.bind(this,k,l,m,false,o);var v=this.$FBRTCMessageSender8.bind(this,q),w=this.$FBRTCMessageSender9.bind(this,q,u,o);c("Fbtrace").withDefaultNode(s,function(){c("FBRTCUtils").sendServerRequest(t,v,w,m)});if(this.onMessageSent)this.onMessageSent(k,l);this.$FBRTCMessageSender1.logSentMessage(k,l.call_id,l)};j.prototype.$FBRTCMessageSender8=function(k){"use strict";this.$FBRTCMessageSender1.logSentMessageSuccess(k.peer_id,k.call_id,k.msg_type,k.msg_id)};j.prototype.$FBRTCMessageSender9=function(k,l,m,n){"use strict";if(n)var o=n.getError?n.getError():n;this.$FBRTCMessageSender1.logSentMessageFailure(k.peer_id,k.call_id,k.msg_type,k.msg_id,o);var p=null;if(o===1356001||o===1356049)p=c("FBRTCConstants").CallEndReason.NO_PERMISSION;else if(o===1356046||o===1356045)p=c("FBRTCConstants").CallEndReason.CALLER_NOT_VISIBLE;else if(o===1356003||o===1356002||o===1356044)p=c("FBRTCConstants").CallEndReason.OTHER_NOT_CAPABLE;if(!p&&l){l();return}if(m&&this.onSendFailure){if(!p)p=c("FBRTCConstants").CallEndReason.SIGNALING_MESSAGE_FAILED;this.onSendFailure(p,o,k.msg_type)}};f.exports=j}),null);
__d("FBRTCRetriableMessage",["mixInEventEmitter","FBRTCConstants"],(function a(b,c,d,e,f,g){var h=1e4,i=7e3,j=1;function k(l){"use strict";this.$FBRTCRetriableMessage1=l;this.$FBRTCRetriableMessage2=h;this.$FBRTCRetriableMessage3=j;this.$FBRTCRetriableMessage4=null;this.$FBRTCRetriableMessage5=null;this.$FBRTCRetriableMessage6=null}k.prototype.sendMessage=function(l,m,n,o,p,q){"use strict";this.$FBRTCRetriableMessage4=m;switch(l){case c("FBRTCConstants").PayloadType.PCRESTART_OFFER:this.$FBRTCRetriableMessage5=this.$FBRTCRetriableMessage1.sendPCRestartOffer(m,n,o,p,q);break;case c("FBRTCConstants").PayloadType.OFFER:this.$FBRTCRetriableMessage5=this.$FBRTCRetriableMessage1.sendOffer(m,n,o,p,q);break;case c("FBRTCConstants").PayloadType.ANSWER:this.$FBRTCRetriableMessage2=i;this.$FBRTCRetriableMessage5=this.$FBRTCRetriableMessage1.sendAnswer(m,n,o,p,q);break}this.$FBRTCRetriableMessage7()};k.prototype.isAckMsg=function(l){"use strict";return this.$FBRTCRetriableMessage5&&this.$FBRTCRetriableMessage5.msg_id===l.ack_id};k.prototype.stopRetrying=function(){"use strict";if(this.$FBRTCRetriableMessage6){clearTimeout(this.$FBRTCRetriableMessage6);this.$FBRTCRetriableMessage4=null;this.$FBRTCRetriableMessage5=null;this.$FBRTCRetriableMessage6=null}};k.prototype.$FBRTCRetriableMessage7=function(){"use strict";this.$FBRTCRetriableMessage6=setTimeout(this.$FBRTCRetriableMessage8.bind(this),this.$FBRTCRetriableMessage2)};k.prototype.$FBRTCRetriableMessage8=function(){"use strict";if(this.$FBRTCRetriableMessage3<1)this.emit("timeoutFailure");else{this.emit("sendingRetry");this.$FBRTCRetriableMessage1.resendSdpMessage(this.$FBRTCRetriableMessage4,this.$FBRTCRetriableMessage5);this.$FBRTCRetriableMessage7();this.$FBRTCRetriableMessage3-=1}};c("mixInEventEmitter")(k,{sendingRetry:true,timeoutFailure:true});f.exports=k}),null);
__d("FBRTCScreenMedia",["FBRTCConstants","FBRTCDispatcher","FBRTCUserMediaRequest","keyMirror"],(function a(b,c,d,e,f,g){"use strict";var h=c("keyMirror")({STREAM_READY:null,STREAM_FAILED:null}),i={STREAM_TYPE:c("FBRTCConstants").StreamType.SCREEN_CONTENT,Types:h,requestScreenMedia:function j(k){var l=arguments.length<=1||arguments[1]===undefined?c("FBRTCConstants").VideoQuality.CUSTOM_VIDEO:arguments[1],m=new(c("FBRTCUserMediaRequest"))(this.STREAM_TYPE,l);m.videoSource=k;m.audioSource=null;m.request().then(function(n){return this._onRequestSuccess(n)}.bind(this))["catch"](function(n){return this._onRequestFailure(n)}.bind(this))},_onRequestSuccess:function j(k){c("FBRTCDispatcher").dispatch({type:h.STREAM_READY,stream:k})},_onRequestFailure:function j(k){var l=k.name?k.name:k;c("FBRTCDispatcher").dispatch({type:h.STREAM_FAILED,error:l})}};f.exports=i}),null);
__d("FBRTCOfferOptions",["UserAgent"],(function a(b,c,d,e,f,g){"use strict";function h(){var i=arguments.length<=0||arguments[0]===undefined?false:arguments[0],j=arguments.length<=1||arguments[1]===undefined?false:arguments[1];this.$FBRTCOfferOptions2(i,j)}h.prototype.getOptions=function(){return this.$FBRTCOfferOptions1};h.prototype.setOptions=function(i){this.$FBRTCOfferOptions1=i};h.prototype.$FBRTCOfferOptions2=function(i,j){if(c("UserAgent").isBrowser("Chrome <= 37"))this.setOptions({mandatory:{OfferToReceiveAudio:i,OfferToReceiveVideo:j}});else this.setOptions({offerToReceiveAudio:i,offerToReceiveVideo:j})};f.exports=h}),null);
__d("FBRTCScreenSharingConnection",["FBRTCConstants","FBRTCOfferOptions","FBRTCPCConfig","FBRTCScreenSharingActions","FBRTCScreenSharingLogger"],(function a(b,c,d,e,f,g){"use strict";function h(){this.$FBRTCScreenSharingConnection11=function(i){this.$FBRTCScreenSharingConnection1.logToConsole(null,null,JSON.stringify(i,null,"\t"))}.bind(this);this.$FBRTCScreenSharingConnection1=c("FBRTCScreenSharingLogger").getInstance();this.$FBRTCScreenSharingConnection5=new(c("FBRTCOfferOptions"))(false,true);this.$FBRTCScreenSharingConnection2=window.RTCIceCandidate;this.$FBRTCScreenSharingConnection3=window.RTCSessionDescription;this.$FBRTCScreenSharingConnection4=window.webkitRTCPeerConnection;this.$FBRTCScreenSharingConnection7=null;this.$FBRTCScreenSharingConnection6=null}h.prototype.setStream=function(i){this.$FBRTCScreenSharingConnection7=i};h.prototype.createOffer=function(){if(!this.$FBRTCScreenSharingConnection6)this.$FBRTCScreenSharingConnection6=this.$FBRTCScreenSharingConnection8();this.$FBRTCScreenSharingConnection9(c("FBRTCConstants").PayloadType.OFFER)};h.prototype.onReceivedAnswerSDP=function(i){var j=new this.$FBRTCScreenSharingConnection3({type:c("FBRTCConstants").PayloadType.ANSWER,sdp:i}),k=this.$FBRTCScreenSharingConnection6;if(k)k.setRemoteDescription(j,this.$FBRTCScreenSharingConnection10.bind(this,j),this.$FBRTCScreenSharingConnection11)};h.prototype.onReceivedOfferSDP=function(i){var j=this.$FBRTCScreenSharingConnection6;if(!j){j=this.$FBRTCScreenSharingConnection8();this.$FBRTCScreenSharingConnection6=j}var k=new this.$FBRTCScreenSharingConnection3({type:c("FBRTCConstants").PayloadType.OFFER,sdp:i});j.setRemoteDescription(k,this.$FBRTCScreenSharingConnection10.bind(this,k),this.$FBRTCScreenSharingConnection11)};h.prototype.onReceivedRemoteIceCandidate=function(i){if(typeof i.sdp!=="string")return;var j=new this.$FBRTCScreenSharingConnection2({sdpMLineIndex:i.label,candidate:i.sdp,sdpMid:i.sdp_mid}),k=this.$FBRTCScreenSharingConnection6;if(k)k.addIceCandidate(j)};h.prototype.cleanPeerConnection=function(){var i=this.$FBRTCScreenSharingConnection6;if(i){i.onaddstream=null;i.onremovestream=null;i.onicecandidate=null;i.oniceconnectionstatechange=null;if(i.iceConnectionState!=="closed")i.close()}};h.prototype.$FBRTCScreenSharingConnection8=function(){var i=new this.$FBRTCScreenSharingConnection4(c("FBRTCPCConfig").getConfig(),c("FBRTCPCConfig").getConstraints());i.onaddstream=this.$FBRTCScreenSharingConnection12.bind(this);i.onicecandidate=this.$FBRTCScreenSharingConnection13.bind(this);i.oniceconnectionstatechange=this.$FBRTCScreenSharingConnection14.bind(this);if(this.$FBRTCScreenSharingConnection7)i.addStream(this.$FBRTCScreenSharingConnection7.getStream());return i};h.prototype.$FBRTCScreenSharingConnection13=function(event){if(event.candidate)c("FBRTCScreenSharingActions").localIceCandidateCreated(event.candidate)};h.prototype.$FBRTCScreenSharingConnection14=function(event){if(this.$FBRTCScreenSharingConnection6!=null)switch(this.$FBRTCScreenSharingConnection6.iceConnectionState){case"connected":case"completed":c("FBRTCScreenSharingActions").connected();break;case"closed":case"disconnected":case"failed":c("FBRTCScreenSharingActions").endSession();break;default:break}};h.prototype.$FBRTCScreenSharingConnection12=function(event){c("FBRTCScreenSharingActions").remoteStreamAdded(event.stream)};h.prototype.$FBRTCScreenSharingConnection9=function(i){var j=this.$FBRTCScreenSharingConnection6;if(j)j.createOffer(this.$FBRTCScreenSharingConnection15.bind(this,i),this.$FBRTCScreenSharingConnection11,this.$FBRTCScreenSharingConnection5.getOptions())};h.prototype.$FBRTCScreenSharingConnection15=function(i,j){var k=this.$FBRTCScreenSharingConnection6;j.sdp=this.$FBRTCScreenSharingConnection16(j.sdp);if(k)k.setLocalDescription(j,c("FBRTCScreenSharingActions").sdpCreated.bind(this,{type:i,sdp:j.sdp}),this.$FBRTCScreenSharingConnection11)};h.prototype.$FBRTCScreenSharingConnection16=function(i){return i.replace("UDP/TLS/RTP/SAVPF","RTP/SAVPF")};h.prototype.$FBRTCScreenSharingConnection10=function(i){if(i.type===c("FBRTCConstants").PayloadType.OFFER){var j=this.$FBRTCScreenSharingConnection6;if(j)j.createAnswer(this.$FBRTCScreenSharingConnection15.bind(this,c("FBRTCConstants").PayloadType.ANSWER),this.$FBRTCScreenSharingConnection11)}else if(i.type===c("FBRTCConstants").PayloadType.ANSWER)c("FBRTCScreenSharingActions").remoteDescriptionSet()};f.exports=h}),null);
__d("XVideoCallTurnDiscoveryController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/videocall/turndiscovery/",{version:{type:"Int",required:true}})}),null);
__d("FBRTCTurnDiscovery",["Promise","FBRTCLogger","FBRTCUtils","XVideoCallTurnDiscoveryController"],(function a(b,c,d,e,f,g){var h=3,i=null,j={requestTurnCreds:function k(l,m){var n=arguments.length<=2||arguments[2]===undefined?h:arguments[2];if(i)return i;var o=1,p=c("XVideoCallTurnDiscoveryController").getURIBuilder().setInt("version",o).getURI();i=new(c("Promise"))(function(q,r){s(n);function s(t){c("FBRTCUtils").sendServerRequest(p,function(u){var v=u.payload;return q(v)},function(){if(t>0){c("FBRTCLogger").getInstance().logError(m,l,"Failed turn; going to retry");s(t-1)}else r(new Error("failed"))})}});return i}};f.exports=j}),null);
__d("FBRTCScreenSharingController",["invariant","Promise","FBRTCCallDialogController","FBRTCConstants","FBRTCMessageHandler","FBRTCMessageListener","FBRTCMessageSender","FBRTCPCConfig","FBRTCScreenMedia","FBRTCScreenSharingActions","FBRTCScreenSharingConnection","FBRTCScreenSharingConstants","FBRTCScreenSharingLogger","FBRTCScreenSharingModel","FBRTCScreenSharingUI","FBRTCScreenSharingUtils","FBRTCStore","FBRTCTurnDiscovery","Random"],(function a(b,c,d,e,f,g,h){"use strict";var i,j;i=babelHelpers.inherits(k,c("FBRTCStore"));j=i&&i.prototype;function k(l,m,n){j.constructor.call(this);this.$FBRTCScreenSharingController23=function(o){var p=JSON.parse(o.payload);switch(o.msg_type){case c("FBRTCConstants").PayloadType.ICE_CANDIDATE:this.$FBRTCScreenSharingController1.onReceivedRemoteIceCandidate(p);break;case c("FBRTCConstants").PayloadType.ANSWER:this.$FBRTCScreenSharingController1.onReceivedAnswerSDP(p.sdp);break;case c("FBRTCConstants").PayloadType.HANGUP:this.onDirectScreenSharingEndSession();break;default:break}}.bind(this);this.$FBRTCScreenSharingController13=function(o){var p=o.origin,q=o.data;if(p!==window.location.origin||!(q.recipient&&q.recipient==="SC_DOM")||!q.type)return;window.removeEventListener("message",this.$FBRTCScreenSharingController13);var r=c("FBRTCScreenSharingLogger").Action;switch(q.type){case"SC_EXT_INSTALLED":break;case"SC_DIALOG_SUCCESS":this.$FBRTCScreenSharingController20(r.SCREEN_SHARING_DIALOG_SUCCESS);this.$FBRTCScreenSharingController24(q.streamId);break;case"SC_DIALOG_CANCEL":this.$FBRTCScreenSharingController20(r.SCREEN_SHARING_DIALOG_CANCEL);this.$FBRTCScreenSharingController17();break;case"SC_CANCELLED":this.$FBRTCScreenSharingController20(r.SCREEN_SHARING_CANCELLED);this.$FBRTCScreenSharingController17();break;default:this.$FBRTCScreenSharingController25("UNEXPECTED MESSAGE TYPE: "+q.type)}}.bind(this);this.$FBRTCScreenSharingController2=n;this.$FBRTCScreenSharingController3=false;this.$FBRTCScreenSharingController4=false;this.$FBRTCScreenSharingController5=false;this.$FBRTCScreenSharingController6=null;this.$FBRTCScreenSharingController8=c("FBRTCScreenSharingLogger").getInstance();this.$FBRTCScreenSharingController11=l;this.$FBRTCScreenSharingController12=m!=null?m:c("Random").uint32();this.$FBRTCScreenSharingController10=new(c("FBRTCScreenSharingModel"))(this.$FBRTCScreenSharingController11,this.$FBRTCScreenSharingController12);this.$FBRTCScreenSharingController12!==null&&this.$FBRTCScreenSharingController12!==undefined||h(0);this.initPromise=this.$FBRTCScreenSharingController14(n,m)}k.prototype.$FBRTCScreenSharingController15=function(l){var m=arguments.length<=1||arguments[1]===undefined?function(){}:arguments[1];if(this.$FBRTCScreenSharingController2)c("FBRTCTurnDiscovery").requestTurnCreds(this.$FBRTCScreenSharingController12.toString(),this.$FBRTCScreenSharingController11.toString()).then(function(n){c("FBRTCPCConfig").setTurnCredentials(n);l()})["catch"](m)};k.prototype.$FBRTCScreenSharingController14=function(l,m){if(!c("FBRTCScreenSharingUtils").isScreenSharingSupported())return c("Promise").reject("screen sharing not supported");if(l)this.$FBRTCScreenSharingController16(m);else this.$FBRTCScreenSharingController10.addListener(this.$FBRTCScreenSharingController17.bind(this));return c("FBRTCScreenSharingUtils").checkExtensionInstalled()};k.prototype.isEnabled=function(){return this.$FBRTCScreenSharingController5&&this.$FBRTCScreenSharingController10.isEnabled()};k.prototype.getStream=function(){return this.$FBRTCScreenSharingController10.getStream()};k.prototype.onStop=function(){this.$FBRTCScreenSharingController10.onStop()};k.prototype.onEndCall=function(){c("FBRTCScreenSharingUI").close();this.onStop()};k.prototype.setRemoteStream=function(l){if(!l)c("FBRTCScreenSharingUI").close();this.$FBRTCScreenSharingController10.setStream(l,true)};k.prototype.initializeAsSender=function(){this.$FBRTCScreenSharingController3=false};k.prototype.initializeAsReceiver=function(l,m){this.$FBRTCScreenSharingController15(function(){this.$FBRTCScreenSharingController3=true;this.$FBRTCScreenSharingController1.onReceivedOfferSDP(l);this.$FBRTCScreenSharingController6=m}.bind(this))};k.prototype.toggleScreenSharing=function(){var l=arguments.length<=0||arguments[0]===undefined?null:arguments[0];if(this.$FBRTCScreenSharingController18(l)){var m=this.$FBRTCScreenSharingController10.isEnabled()||this.$FBRTCScreenSharingController4?"SC_CANCEL":"SC_REQUEST";this.$FBRTCScreenSharingController19(m);this.$FBRTCScreenSharingController20(c("FBRTCScreenSharingLogger").Action.SCREEN_SHARING_TOGGLED,"status: "+(this.isEnabled()?"enabled":"disabled"))}};k.prototype.onDirectScreenSharingEndSession=function(){this.onStop()};k.prototype.$FBRTCScreenSharingController18=function(l){var m=l?l:this.$FBRTCScreenSharingController10;if(!c("FBRTCCallDialogController").container)c("FBRTCCallDialogController").setDialogContainer(document.body.appendChild(document.createElement("div")));if(!c("FBRTCScreenSharingUtils").isSupportedBrowser()){c("FBRTCCallDialogController").showDialog(c("FBRTCCallDialogController").dialogTypes.SCREEN_SHARING_UNSUPPORTED,m);return false}else if(!c("FBRTCScreenSharingUtils").isExtensionInstalled()){c("FBRTCCallDialogController").showDialog(c("FBRTCCallDialogController").dialogTypes.INSTALL_SCREEN_SHARING_EXT,m);return false}return true};k.prototype.$FBRTCScreenSharingController21=function(){var l=arguments.length<=0||arguments[0]===undefined?false:arguments[0];this.$FBRTCScreenSharingController4=true;this.toggleScreenSharing();c("FBRTCScreenSharingUI").close();if(this.$FBRTCScreenSharingController1)this.$FBRTCScreenSharingController1.cleanPeerConnection();if(!this.$FBRTCScreenSharingController3)c("FBRTCMessageHandler").resetListener();if(l)this.$FBRTCScreenSharingController22()};k.prototype.$FBRTCScreenSharingController19=function(l){l==="SC_REQUEST"||l==="SC_CANCEL"||l==="SC_RESET_PORT"||h(0);window.postMessage({recipient:c("FBRTCScreenSharingUtils").RECIPIENT,type:l,text:"communicate with screen sharing extension"},"*");if(l==="SC_REQUEST"||l==="SC_CANCEL")window.addEventListener("message",this.$FBRTCScreenSharingController13)};k.prototype.$FBRTCScreenSharingController16=function(l){this.$FBRTCScreenSharingController19("SC_RESET_PORT");this.$FBRTCScreenSharingController9=new(c("FBRTCMessageSender"))();this.$FBRTCScreenSharingController1=new(c("FBRTCScreenSharingConnection"))();this.$FBRTCScreenSharingController7=false;this.$FBRTCScreenSharingController10.addListener(this.$FBRTCScreenSharingController21.bind(this,true))};k.prototype.$FBRTCScreenSharingController24=function(l){if(this.$FBRTCScreenSharingController5&&!this.$FBRTCScreenSharingController2){this.$FBRTCScreenSharingController8.logToConsole(this.$FBRTCScreenSharingController11,this.$FBRTCScreenSharingController12,"Screen sharing already enabled, do nothing");return}this.$FBRTCScreenSharingController10.onStart(l);if(this.$FBRTCScreenSharingController10.isEnabled())c("FBRTCScreenMedia").requestScreenMedia(l)};k.prototype.$FBRTCScreenSharingController17=function(){if(!this.$FBRTCScreenSharingController5){this.$FBRTCScreenSharingController8.logToConsole(this.$FBRTCScreenSharingController11,this.$FBRTCScreenSharingController12,"Screen sharing already disabled, do nothing");return}this.$FBRTCScreenSharingController20(c("FBRTCScreenSharingLogger").Action.SCREEN_SHARING_DISABLED);this.$FBRTCScreenSharingController5=false;this.__emitChange()};k.prototype.$FBRTCScreenSharingController26=function(l){this.$FBRTCScreenSharingController5=!!l.stream;this.$FBRTCScreenSharingController10.setStream(l.stream,false);if(this.$FBRTCScreenSharingController2){this.$FBRTCScreenSharingController1.setStream(this.$FBRTCScreenSharingController10.getStream());this.$FBRTCScreenSharingController15(function(){this.$FBRTCScreenSharingController1.createOffer()}.bind(this))}this.$FBRTCScreenSharingController20(c("FBRTCScreenSharingLogger").Action.SCREEN_SHARING_ENABLED);this.__emitChange()};k.prototype.$FBRTCScreenSharingController27=function(l){this.$FBRTCScreenSharingController8.logError(this.$FBRTCScreenSharingController11,this.$FBRTCScreenSharingController12,this.$FBRTCScreenSharingController2,"Failed retrieving the screen stream with error: "+l.error)};k.prototype.$FBRTCScreenSharingController28=function(l){if(l&&l.candidate){l.isDirectScreenShareFromRecipient=this.$FBRTCScreenSharingController3;this.$FBRTCScreenSharingController9.sendIceCandidate(this.$FBRTCScreenSharingController11,this.$FBRTCScreenSharingController12,l)}};k.prototype.$FBRTCScreenSharingController29=function(l){this.$FBRTCScreenSharingController9.sendOffer(this.$FBRTCScreenSharingController11,this.$FBRTCScreenSharingController12,l,false,{isDirectScreenShareFromRecipient:this.$FBRTCScreenSharingController3})};k.prototype.$FBRTCScreenSharingController30=function(l){this.$FBRTCScreenSharingController9.sendAnswer(this.$FBRTCScreenSharingController11,this.$FBRTCScreenSharingController12,l,false,{isDirectScreenShareFromRecipient:this.$FBRTCScreenSharingController3})};k.prototype.$FBRTCScreenSharingController22=function(){this.$FBRTCScreenSharingController9.sendHangup(this.$FBRTCScreenSharingController11,this.$FBRTCScreenSharingController12,c("FBRTCConstants").CallEndReason.HANGUP_CALL,true,"DirectScreenSharing")};k.prototype.$FBRTCScreenSharingController31=function(){var l=this.$FBRTCScreenSharingController6;if(l)l.drainQueue(this.$FBRTCScreenSharingController11,this.$FBRTCScreenSharingController32.bind(this))};k.prototype.$FBRTCScreenSharingController32=function(l){var m=JSON.parse(l.payload);this.$FBRTCScreenSharingController1.onReceivedRemoteIceCandidate(m)};k.prototype.$FBRTCScreenSharingController33=function(l){switch(l.description.type){case c("FBRTCConstants").PayloadType.OFFER:this.$FBRTCScreenSharingController34(l.description.sdp);break;case c("FBRTCConstants").PayloadType.ANSWER:this.$FBRTCScreenSharingController35(l.description.sdp);break;default:break}};k.prototype.$FBRTCScreenSharingController34=function(l){c("FBRTCScreenSharingUI").open(c("FBRTCScreenSharingConstants").DIRECT_SENDER,this.$FBRTCScreenSharingController10.getStream(),this.$FBRTCScreenSharingController11);this.$FBRTCScreenSharingController29(l)};k.prototype.$FBRTCScreenSharingController35=function(l){this.$FBRTCScreenSharingController30(l);if(!this.$FBRTCScreenSharingController7)this.$FBRTCScreenSharingController31()};k.prototype.$FBRTCScreenSharingController36=function(l){if(!this.$FBRTCScreenSharingController3)return;this.$FBRTCScreenSharingController10.setStream(l.stream,true,true);c("FBRTCScreenSharingUI").open(c("FBRTCScreenSharingConstants").DIRECT_RECIPIENT,this.$FBRTCScreenSharingController10.getStream(),this.$FBRTCScreenSharingController11)};k.prototype.$FBRTCScreenSharingController37=function(l){if(!this.$FBRTCScreenSharingController7)this.$FBRTCScreenSharingController28(l.candidate)};k.prototype.$FBRTCScreenSharingController38=function(){c("FBRTCMessageListener").removeMessageHandler();c("FBRTCMessageListener").init(false,this.$FBRTCScreenSharingController11);c("FBRTCMessageListener").setMessageHandler(this.$FBRTCScreenSharingController23,this)};k.prototype.$FBRTCScreenSharingController20=function(l){var m,n=this.$FBRTCScreenSharingController11,o=this.$FBRTCScreenSharingController12,p=this.$FBRTCScreenSharingController2;for(var q=arguments.length,r=Array(q>1?q-1:0),s=1;s<q;s++)r[s-1]=arguments[s];(m=this.$FBRTCScreenSharingController8).logAction.apply(m,[n,o,l,p].concat(r))};k.prototype.$FBRTCScreenSharingController25=function(){var l,m=this.$FBRTCScreenSharingController11,n=this.$FBRTCScreenSharingController12,o=this.$FBRTCScreenSharingController2;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];(l=this.$FBRTCScreenSharingController8).logError.apply(l,[m,n,o].concat(q))};k.prototype.__onDispatch=function(l){if(this.$FBRTCScreenSharingController4)return;switch(l.type){case c("FBRTCScreenMedia").Types.STREAM_READY:this.$FBRTCScreenSharingController26(l);break;case c("FBRTCScreenMedia").Types.STREAM_FAILED:this.$FBRTCScreenSharingController27(l);break;case c("FBRTCScreenSharingActions").ConnectionEventTypes.SDP_CREATED:this.$FBRTCScreenSharingController33(l);break;case c("FBRTCScreenSharingActions").ConnectionEventTypes.REMOTE_STREAM_ADDED:this.$FBRTCScreenSharingController36(l);break;case c("FBRTCScreenSharingActions").ConnectionEventTypes.LOCAL_ICE_CANDIDATE_CREATED:this.$FBRTCScreenSharingController37(l);break;case c("FBRTCScreenSharingActions").ControlEventTypes.END_SESSION:this.onDirectScreenSharingEndSession();break;case c("FBRTCScreenSharingActions").ConnectionEventTypes.OFFER_ACK:this.$FBRTCScreenSharingController38();break;case c("FBRTCScreenSharingActions").ConnectionEventTypes.REMOTE_DESCRIPTION_SET:break;default:break}};f.exports=k}),null);
__d("XGroupCallController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/groupcall/{?conference_name}/",{conference_name:{type:"String",required:true},call_id:{type:"Int"},users_to_ring:{type:"FBIDSet",defaultValue:[]},has_video:{type:"Bool",defaultValue:true},server_info_data:{type:"String"},nonce:{type:"String"}})}),null);
__d("XGroupCallSigningController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/groupcall/init/",{conference_name:{type:"String",required:true},call_id:{type:"Int"},users_to_ring:{type:"FBIDSet",defaultValue:[]},has_video:{type:"Bool",defaultValue:false},server_info_data:{type:"String"},nonce:{type:"String"}})}),null);
__d("XVideoCallController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/videocall/incall/",{peer_id:{type:"FBID",required:true},call_id:{type:"Int"},is_caller:{type:"Bool",defaultValue:false},audio_only:{type:"Bool",defaultValue:false},nonce:{type:"String"}})}),null);
__d("XVideoCallInitController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/videocall/init/",{peer_id:{type:"FBID",required:true},call_id:{type:"Int",required:true},is_caller:{type:"Bool",defaultValue:false},audio_only:{type:"Bool",defaultValue:false},nonce:{type:"String"}})}),null);
__d("XWirelessScreenSharingController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/screen_sharing/{?session_id}/",{nonce:{type:"String"},peer_id:{type:"FBID",required:true},session_id:{type:"Int"}})}),null);
__d("FBRTCUrlManager",["regeneratorRuntime","Promise","CurrentUser","FBRTCConfig","FBRTCLogger","FBRTCUtils","MessengerRTCFunnelLogger","URI","XGroupCallController","XGroupCallSigningController","XVideoCallController","XVideoCallInitController","XWirelessScreenSharingController"],(function a(b,c,d,e,f,g){var h=3,i=function i(p,q,r,s){c("FBRTCLogger").getInstance().logCallAction(p,q,c("FBRTCLogger").CallAction.OLD_URI);return c("XVideoCallController").getURIBuilder().setFBID("peer_id",p).setInt("call_id",q).setBool("is_caller",r).setBool("audio_only",s).getURI()},j=function j(p,q,r,s,t,u){var v=arguments.length<=6||arguments[6]===undefined?h:arguments[6],w=arguments.length<=7||arguments[7]===undefined?"":arguments[7];if(v===undefined||v===null)v=h;var x=c("XVideoCallInitController").getURIBuilder().setFBID("peer_id",p).setInt("call_id",q).setBool("is_caller",r).setBool("audio_only",s).getURI();x=c("FBRTCUtils").isPeerVCEndpoint(p)||w==="quickdial"?k(x):x;c("FBRTCUtils").sendServerRequest(x,function(y){t(y.payload.uri)},function(y){if(v>0)j(p,q,r,s,t,u,v-1,w);else t(i(p,q,r,s))})};function k(p){if(c("CurrentUser").isEmployee()){p=p.setSubdomain(c("CurrentUser").hasWorkUser()||c("CurrentUser").isWorkUser()?"fb":"www");var q="/intern/";return c("URI").getRequestURI().getPath().substr(0,q.length)!==q?p:p.setDomain(p.getDomain().toString().replace(/.(intern|cstools)./,"."))}return p}function l(p){var q=p.conferenceName,r=p.callID,s=p.usersToRing,t=p.hasVideo,u=p.nonce,v=p.serverInfoData,w;return c("regeneratorRuntime").async(function x(y){while(1)switch(y.prev=y.next){case 0:w=c("XGroupCallSigningController").getURIBuilder().setString("conference_name",q).setInt("call_id",r).setFBIDSet("users_to_ring",s).setBool("has_video",t).setString("server_info_data",v).setString("nonce",u).getURI();return y.abrupt("return",new(c("Promise"))(function(z,A){c("FBRTCUtils").sendServerRequest(w,function(B){c("MessengerRTCFunnelLogger").appendAction("got_server_call_uri");z(B.payload.uri)},function(B){A(B)})}));case 2:case"end":return y.stop()}},null,this)}var m=function m(p,q,r,s,t,u,v){if(v===undefined||v===null)v=h;var w=c("XGroupCallSigningController").getURIBuilder().setFBID("call_id",p).setBool("is_caller",r).setBool("audio_only",s).setFBIDSet("users_to_ring",q).getURI();c("FBRTCUtils").sendServerRequest(w,function(x){t(x.payload.uri)},function(x){if(v>0)m(p,q,r,s,t,u,v-1);else{var y=c("XGroupCallController").getURIBuilder().setFBID("call_id",p).setBool("is_caller",r).setBool("audio_only",s).setFBIDSet("users_to_ring",q).getURI();t(y)}})},n=function n(p){if(c("FBRTCConfig").disableURLManager())return;window.history.replaceState({},"",p)},o={init:function p(q){this._peerID=q},onCallStarted:function p(){n(i(this._peerID))},getCallUri:j,getGroupCallUri:function m(p,q,r,s,t,u){var v;return c("regeneratorRuntime").async(function w(x){while(1)switch(x.prev=x.next){case 0:v=0;case 1:if(!(v<3)){x.next=14;break}x.prev=2;x.next=5;return c("regeneratorRuntime").awrap(l({conferenceName:p,callID:q,usersToRing:r,hasVideo:s,nonce:t,serverInfoData:u}));case 5:return x.abrupt("return",x.sent);case 8:x.prev=8;x.t0=x["catch"](2);case 11:v++;x.next=1;break;case 14:c("MessengerRTCFunnelLogger").appendAction("use_local_call_uri");return x.abrupt("return",c("XGroupCallController").getURIBuilder().setString("conference_name",p).setInt("call_id",q).setFBIDSet("users_to_ring",r).setBool("has_video",s).setString("server_info_data",u).setString("nonce",t).getURI());case 16:case"end":return x.stop()}},null,this,[[2,8]])},getNonceUri:function p(q,r,s,t,u){var v=arguments.length<=5||arguments[5]===undefined?"":arguments[5],w=c("XVideoCallController").getURIBuilder().setFBID("peer_id",q).setInt("call_id",r).setBool("is_caller",s).setBool("audio_only",t).setString("nonce",u).getURI();return c("FBRTCUtils").isPeerVCEndpoint(q)||v==="quickdial"?k(w):w},getWirelessScreenSharingUri:function p(q,r,s){var t=c("XWirelessScreenSharingController").getURIBuilder().setFBID("peer_id",r).setInt("session_id",s).setString("nonce",q).getURI();return k(t)}};f.exports=o}),null);
__d("FBRTCStreamTester",["mixInEventEmitter","FBRTCUtils"],(function a(b,c,d,e,f,g){var h=100,i=30;function j(k){"use strict";if(!k)k={};this.$FBRTCStreamTester1=k.retries||i;this.$FBRTCStreamTester2=k.testInterval||h;this.$FBRTCStreamTester3=null;this.$FBRTCStreamTester4=null;this.$FBRTCStreamTester5=false}j.prototype.testStream=function(k,l){"use strict";this.$FBRTCStreamTester3=k;if(!l){this.$FBRTCStreamTester5=true;this.$FBRTCStreamTester4=document.createElement("video");this.$FBRTCStreamTester4.muted=true;c("FBRTCUtils").attachMediaStream(this.$FBRTCStreamTester4,this.$FBRTCStreamTester3);this.$FBRTCStreamTester4.play()}else{this.$FBRTCStreamTester5=false;this.$FBRTCStreamTester4=l}this.$FBRTCStreamTester6(this.$FBRTCStreamTester1)};j.prototype.$FBRTCStreamTester6=function(k){"use strict";if(this.$FBRTCStreamTester3.getVideoTracks().length===0||this.$FBRTCStreamTester4.currentTime>0){this.$FBRTCStreamTester7();this.emit("streamWorking")}else if(k<1){this.$FBRTCStreamTester7();this.emit("streamBroken")}else setTimeout(this.$FBRTCStreamTester6.bind(this,k-1),this.$FBRTCStreamTester2)};j.prototype.$FBRTCStreamTester7=function(){"use strict";if(this.$FBRTCStreamTester5)this.$FBRTCStreamTester4.pause();this.$FBRTCStreamTester4=null;this.$FBRTCStreamTester3=null};c("mixInEventEmitter")(j,{streamWorking:true,streamBroken:true});f.exports=j}),null);
__d("FBRTCUserMedia",["mixInEventEmitter","FBRTCConstants","FBRTCLogger","FBRTCStreamTester","FBRTCStreamWrapper","FBRTCUserMediaRequest","MessengerRTCFunnelLogger"],(function a(b,c,d,e,f,g){var h={_localStream:null,_accessGranted:false,_pendingRequest:null,_failedVideoSources:[],_failedAudioSources:[],requestUserMedia:function i(j,k,l,m,n){if(this._localStream&&!l&&!m)this.emit("streamReady",this._localStream);else{this._startRequestListeners();this._pendingRequest=new(c("FBRTCUserMediaRequest"))(j,k,n);this._pendingRequest.audioSource=l;this._pendingRequest.videoSource=m;this._request()}},_request:function i(){if(this._pendingRequest){this._pendingRequest.request().then(function(j){return this._onRequestSuccess(j)}.bind(this),function(j){return this._onRequestFailure(j)}.bind(this));c("MessengerRTCFunnelLogger").appendAction("user_media_requested")}},end:function i(){this._stopEventListeners();if(this._localStream){c("FBRTCStreamWrapper").stopStream(this._localStream);this._localStream=null}},_startRequestListeners:function i(){if(navigator.mozGetUserMedia){this._evListener=this._onMediaPromptHidden.bind(this);document.addEventListener("mousedown",this._evListener);document.addEventListener("focus",this._evListener)}},_stopEventListeners:function i(){if(navigator.mozGetUserMedia){if(this._promptTimeout)clearTimeout(this._promptTimeout);document.removeEventListener("mousedown",this._evListener);document.removeEventListener("focus",this._evListener)}},_onMediaPromptHidden:function i(){this._promptTimeout=setTimeout(function(){if(!this._accessGranted&&this._pendingRequest)this._request()}.bind(this),1500)},_onRequestSuccess:function i(j){this._stopEventListeners();c("MessengerRTCFunnelLogger").appendAction("user_media_succeeded");if(!this._accessGranted){this._accessGranted=true;this.emit("accessGranted")}j.videoMediaSourceId=this._pendingRequest.videoSource;j.audioMediaSourceId=this._pendingRequest.audioSource;var k=new(c("FBRTCStreamTester"))();k.addListener("streamWorking",function(){this._pendingRequest=null;if(this._localStream&&this._localStream!==j)c("FBRTCStreamWrapper").stopStream(this._localStream);this._localStream=j;this.emit("streamReady",this._localStream)}.bind(this));k.addListener("streamBroken",function(){c("FBRTCStreamWrapper").stopStream(j);this._onRequestFailure("StreamFailedToStart")}.bind(this));k.testStream(j)},_onRequestFailure:function i(j){this._stopEventListeners();var k=this._getErrorName(j);c("MessengerRTCFunnelLogger").appendAction("user_media_rejected",k);if(this._shouldRetryRequest(k,this._pendingRequest)){this._configureRequestForRetry(this._pendingRequest,k);return}if(k==="InvalidStateError"){c("FBRTCLogger").getInstance().logErrorWithoutID("Invalid state while requesting user media");return}this._pendingRequest=null;if(k==="PERMISSION_DENIED"||k==="PermissionDeniedError"||k==="PermissionDismissedError")this.emit("accessDenied",k);else{if(k==="NO_DEVICES_FOUND")k="DevicesNotFoundError";c("FBRTCLogger").getInstance().logErrorWithoutID("getUserMedia error: "+k);this.emit("accessFailed",k)}},_getErrorName:function i(j){if(j.name)return j.name;return j},_shouldRetryRequest:function i(j,k){return k.streamType!==c("FBRTCConstants").StreamType.AUDIO_ONLY&&(j==="DevicesNotFoundError"||j==="StreamFailedToStart")},_configureRequestForRetry:function i(j,k){if(k==="StreamFailedToStart"&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources){if(j.videoSource)this._failedVideoSources.push(j.videoSource);window.MediaStreamTrack.getSources(function(l){for(var m=0;m<l.length;m++){var n=l[m];if(n.kind==="video"&&this._failedVideoSources.indexOf(n.id)===-1){j.videoSource=n.id;this._request();return}}j.streamType=c("FBRTCConstants").StreamType.AUDIO_ONLY;this._request()}.bind(this))}else{j.streamType=c("FBRTCConstants").StreamType.AUDIO_ONLY;this._request()}}};c("mixInEventEmitter")(h,{streamReady:true,accessGranted:true,accessDenied:true,accessFailed:true});f.exports=h}),null);
__d("FBRTCVideoEscalationStore",["FBRTCCallControlActions","FBRTCConstants","FBRTCStore","keyMirror"],(function a(b,c,d,e,f,g){"use strict";var h,i,j=25e3,k=1e4,l=c("keyMirror")({direct_video:null,escalated:null,escalation_declined:null,voip:null});h=babelHelpers.inherits(m,c("FBRTCStore"));i=h&&h.prototype;function m(n,o,p){i.constructor.call(this);this.$FBRTCVideoEscalationStore7=n;this.$FBRTCVideoEscalationStore2=o;this.$FBRTCVideoEscalationStore1=p;this.$FBRTCVideoEscalationStore4=p;this.$FBRTCVideoEscalationStore3=false;this.$FBRTCVideoEscalationStore5=null;this.$FBRTCVideoEscalationStore8=null}m.prototype.isPending=function(){return!!this.$FBRTCVideoEscalationStore5};m.prototype.callHasEscalated=function(){return this.$FBRTCVideoEscalationStore1};m.prototype.getCallType=function(){if(!this.$FBRTCVideoEscalationStore2.isRemoteVideoSupported)return l.voip;else if(this.$FBRTCVideoEscalationStore4)return l.direct_video;else if(this.$FBRTCVideoEscalationStore1)return l.escalated;else if(this.$FBRTCVideoEscalationStore3)return l.escalation_declined;return l.voip};m.prototype.__onDispatch=function(n){switch(n.type){case c("FBRTCCallControlActions").Types.RECEIVED_SIGNALING_MESSAGE:var o=n.message;if(n.message_type===c("FBRTCConstants").PayloadType.VIDEO_REQUEST){this.$FBRTCVideoEscalationStore3=true;if(o.ackID)this.$FBRTCVideoEscalationStore10(o);else this.$FBRTCVideoEscalationStore11(o)}if(n.message_type===c("FBRTCConstants").PayloadType.ACK&&o.msg.ack_type===c("FBRTCConstants").PayloadType.VIDEO_REQUEST)this.$FBRTCVideoEscalationStore12(o);break;case c("FBRTCCallControlActions").Types.ACCEPT_ESCALATION:this.$FBRTCVideoEscalationStore13(true);break;case c("FBRTCCallControlActions").Types.DECLINE_ESCALATION:this.$FBRTCVideoEscalationStore13(false);break;case c("FBRTCCallControlActions").Types.TOGGLE_MUTE_VIDEO:this.$FBRTCVideoEscalationStore3=true;this.getDispatcher().waitFor([this.$FBRTCVideoEscalationStore2.getDispatchToken()]);this.$FBRTCVideoEscalationStore14();break}};m.prototype.$FBRTCVideoEscalationStore12=function(n){if(this.$FBRTCVideoEscalationStore8&&this.$FBRTCVideoEscalationStore8.msg_id===n.ackID)this.$FBRTCVideoEscalationStore15()};m.prototype.$FBRTCVideoEscalationStore15=function(){clearTimeout(this.$FBRTCVideoEscalationStore6)};m.prototype.$FBRTCVideoEscalationStore16=function(){this.$FBRTCVideoEscalationStore6=setTimeout(function(){if(!this.$FBRTCVideoEscalationStore8)return;this.$FBRTCVideoEscalationStore7.resendPayload(this.$FBRTCVideoEscalationStore2.peerID,this.$FBRTCVideoEscalationStore8)}.bind(this),k)};m.prototype.$FBRTCVideoEscalationStore10=function(n){if(!this.$FBRTCVideoEscalationStore8||n.ackID!==this.$FBRTCVideoEscalationStore8.msg_id)return;clearTimeout(this.$FBRTCVideoEscalationStore9);this.$FBRTCVideoEscalationStore15();var o=n.msg,p=n.peerID,q=n.callID,r=this.$FBRTCVideoEscalationStore17(o);this.$FBRTCVideoEscalationStore7.sendAck(p,q,o);this.$FBRTCVideoEscalationStore8=null;this.$FBRTCVideoEscalationStore1=r;this.$FBRTCVideoEscalationStore18(r);if(!r&&this.$FBRTCVideoEscalationStore2.localStream.hasVideo())this.$FBRTCVideoEscalationStore2.localStream.toggleMuteVideo();this.__emitChange()};m.prototype.$FBRTCVideoEscalationStore11=function(n){if(this.$FBRTCVideoEscalationStore1){if(this.$FBRTCVideoEscalationStore17(n.msg)){this.$FBRTCVideoEscalationStore5=n;this.$FBRTCVideoEscalationStore13(true)}else this.$FBRTCVideoEscalationStore2.remoteStream.setVideoEnabled(false);return}var o=n.msg,p=n.peerID,q=n.callID;this.$FBRTCVideoEscalationStore7.sendAck(p,q,o);if(this.$FBRTCVideoEscalationStore17(o)){this.$FBRTCVideoEscalationStore5=n;this.$FBRTCVideoEscalationStore9=setTimeout(function(){c("FBRTCCallControlActions").declineEscalation()},j)}else this.$FBRTCVideoEscalationStore5=null;this.__emitChange()};m.prototype.$FBRTCVideoEscalationStore13=function(n){clearTimeout(this.$FBRTCVideoEscalationStore9);if(this.$FBRTCVideoEscalationStore5){var o=this.$FBRTCVideoEscalationStore5,p=o.peerID,q=o.callID,r=o.msgID;this.$FBRTCVideoEscalationStore8=this.$FBRTCVideoEscalationStore7.sendVideoRequestResponse(p,q,r,n);this.$FBRTCVideoEscalationStore16();this.$FBRTCVideoEscalationStore1=n;this.$FBRTCVideoEscalationStore5=null;this.__emitChange()}};m.prototype.$FBRTCVideoEscalationStore14=function(){if(this.$FBRTCVideoEscalationStore1){this.$FBRTCVideoEscalationStore19();return}this.$FBRTCVideoEscalationStore8=this.$FBRTCVideoEscalationStore7.sendVideoEscalationRequest(this.$FBRTCVideoEscalationStore2.peerID,this.$FBRTCVideoEscalationStore2.callID,this.$FBRTCVideoEscalationStore2.localStream.hasVideo());if(this.$FBRTCVideoEscalationStore2.localStream.hasVideo()){this.$FBRTCVideoEscalationStore16();this.$FBRTCVideoEscalationStore9=setTimeout(function(){if(this.$FBRTCVideoEscalationStore2.localStream.hasVideo())c("FBRTCCallControlActions").toggleMuteVideo()}.bind(this),j)}else{this.$FBRTCVideoEscalationStore15();clearTimeout(this.$FBRTCVideoEscalationStore9);this.$FBRTCVideoEscalationStore8=null}this.__emitChange()};m.prototype.$FBRTCVideoEscalationStore19=function(){if(!this.$FBRTCVideoEscalationStore2.isRemoteVideoSupported)return;this.$FBRTCVideoEscalationStore7.sendMuteStateUpdate(this.$FBRTCVideoEscalationStore2.peerID,this.$FBRTCVideoEscalationStore2.callID,this.$FBRTCVideoEscalationStore2.localStream.hasVideo())};m.prototype.$FBRTCVideoEscalationStore18=function(n){this.$FBRTCVideoEscalationStore2.remoteStream.setVideoEnabled(n)};m.prototype.$FBRTCVideoEscalationStore17=function(n){return!!(n.reqVideoOn||n.videoon)};f.exports=m}),null);
__d("FBRTCRingback",["RTCConfig","Sound","FBRTCCallModel"],(function a(b,c,d,e,f,g){var h=[c("RTCConfig").ringback_mp3_url,c("RTCConfig").ringback_ogg_url],i={monitorCallModel:function j(k){if(this._subscription)this._subscription.remove();this._callModel=k;this._subscription=k.addListener(this._onChange.bind(this))},_soundIsPlaying:false,_onChange:function j(){if(this._callModel.uiState===c("FBRTCCallModel").UIState.RINGING)this._startSound();else this._stopSound()},_startSound:function j(){if(!this._soundIsPlaying){c("Sound").play(h,this._syncToken(),true);this._soundIsPlaying=true}},_syncToken:function j(){return"ring_back_"+this._callModel.callID.toString()},_stopSound:function j(){if(this._soundIsPlaying){c("Sound").stop(h);this._soundIsPlaying=false}}};f.exports=i}),null);
__d("FBRTCStarRatingStore",["FBRTCLogger","FBRTCStore","FBRTCStarRatingActions"],(function a(b,c,d,e,f,g){"use strict";var h,i;h=babelHelpers.inherits(j,c("FBRTCStore"));i=h&&h.prototype;function j(k,l){i.constructor.call(this);this.$FBRTCStarRatingStore1=k;this.$FBRTCStarRatingStore2=l}j.prototype.setCallSummary=function(k){this.$FBRTCStarRatingStore1=k};j.prototype.__onDispatch=function(k){switch(k.type){case c("FBRTCStarRatingActions").Types.SUBMIT_RATING:this.$FBRTCStarRatingStore3(k.rating);break;case c("FBRTCStarRatingActions").Types.SUBMIT_FEEDBACK:this.$FBRTCStarRatingStore4(k.feedback);break;case c("FBRTCStarRatingActions").Types.RATING_SHOWN:this.$FBRTCStarRatingStore5();break}};j.prototype.$FBRTCStarRatingStore3=function(k){this.$FBRTCStarRatingStore1.addExtraInfo(c("FBRTCLogger").Key.RATING,k);this.$FBRTCStarRatingStore1.save(this.$FBRTCStarRatingStore2)};j.prototype.$FBRTCStarRatingStore4=function(k){this.$FBRTCStarRatingStore1.addExtraInfo(c("FBRTCLogger").Key.SURVEY_DETAILS,k);this.$FBRTCStarRatingStore1.save(this.$FBRTCStarRatingStore2)};j.prototype.$FBRTCStarRatingStore5=function(){this.$FBRTCStarRatingStore1.addExtraInfo(c("FBRTCLogger").Key.RATING_SHOWN,"1");this.$FBRTCStarRatingStore1.save(this.$FBRTCStarRatingStore2)};f.exports=j}),null);
__d("FBRTCViewController",["FBRTCCallModel","FBRTCConstants","FBRTCLogger","FBRTCRingback","FBRTCStarRatingStore"],(function a(b,c,d,e,f,g){var h=500;function i(j,k,l){"use strict";this.$FBRTCViewController1=j;this.$FBRTCViewController2=new(c("FBRTCStarRatingStore"))(k,l);this.$FBRTCViewController3=false;this.$FBRTCViewController4=c("FBRTCLogger").getInstance()}i.prototype.init=function(){"use strict";c("FBRTCRingback").monitorCallModel(this.$FBRTCViewController1);this.$FBRTCViewController1.fetchPeerInfo()};i.prototype.onLocalStreamReady=function(j){"use strict";this.$FBRTCViewController1.setLocalStream(j);if(this.$FBRTCViewController1.uiState>c("FBRTCCallModel").UIState.MORE_INIT)this.$FBRTCViewController4.logInfo(this.$FBRTCViewController1.peerID,this.$FBRTCViewController1.callID,"UI: Already @ MORE_INIT, no update");else if(this.$FBRTCViewController1.canStartCall()&&!this.$FBRTCViewController1.isCaller)this.$FBRTCViewController1.setState(c("FBRTCCallModel").UIState.CALL_CONNECTING);else this.$FBRTCViewController1.setState(c("FBRTCCallModel").UIState.MORE_INIT)};i.prototype.waitForUserInput=function(){"use strict";this.$FBRTCViewController1.setStateFrom(c("FBRTCCallModel").UIState.INIT,c("FBRTCCallModel").UIState.AWAITING_USER_START)};i.prototype.userMediaRequested=function(){"use strict";setTimeout(function(){var j=this.$FBRTCViewController1.uiState;if(j===c("FBRTCCallModel").UIState.INIT||j>=c("FBRTCCallModel").UIState.CALL_ENDED)this.$FBRTCViewController1.setState(c("FBRTCCallModel").UIState.PENDING_LOCAL_MEDIA)}.bind(this),h)};i.prototype.userMediaGranted=function(){"use strict";this.$FBRTCViewController1.setState(c("FBRTCCallModel").UIState.MORE_INIT)};i.prototype.userMediaDenied=function(){"use strict";this.$FBRTCViewController1.setState(c("FBRTCCallModel").UIState.USER_MEDIA_DENIED)};i.prototype.onTurnCredentialsReady=function(j){"use strict";if(!this.$FBRTCViewController1.isCaller)this.$FBRTCViewController1.setStateFrom(c("FBRTCCallModel").UIState.MORE_INIT,c("FBRTCCallModel").UIState.CALL_CONNECTING)};i.prototype.onMessageTypeSent=function(j){"use strict";if(j!==c("FBRTCConstants").PayloadType.OFFER&&j!==c("FBRTCConstants").PayloadType.PCRESTART_OFFER)return;if(j===c("FBRTCConstants").PayloadType.PCRESTART_OFFER)this.$FBRTCViewController3=true;if(j===c("FBRTCConstants").PayloadType.OFFER)this.$FBRTCViewController1.setState(c("FBRTCCallModel").UIState.CONTACTING)};i.prototype.onMessageTypeReceived=function(j){"use strict";if(this.$FBRTCViewController3){if(j===c("FBRTCConstants").PayloadType.ANSWER)this.$FBRTCViewController1.setStateFrom(c("FBRTCCallModel").UIState.CONTACTING,c("FBRTCCallModel").UIState.CALL_CONNECTING)}else if(j===c("FBRTCConstants").PayloadType.OFFER_ACK)this.$FBRTCViewController1.setStateFrom(c("FBRTCCallModel").UIState.CONTACTING,c("FBRTCCallModel").UIState.RINGING);else if(j===c("FBRTCConstants").PayloadType.ANSWER)if(this.$FBRTCViewController1.uiState===c("FBRTCCallModel").UIState.CONTACTING||this.$FBRTCViewController1.uiState===c("FBRTCCallModel").UIState.RINGING)this.$FBRTCViewController1.setState(c("FBRTCCallModel").UIState.CALL_CONNECTING)};i.prototype.onRemoteStreamAdded=function(event){"use strict";this.$FBRTCViewController1.setRemoteStream(event.stream)};i.prototype.end=function(j,k,l){"use strict";this.$FBRTCViewController1.endCallReason=j;this.$FBRTCViewController1.endCallSubreason=l;this.$FBRTCViewController1.isRemoteEnded=k;this.$FBRTCViewController1.setState(c("FBRTCCallModel").UIState.CALL_ENDED)};i.prototype.reset=function(j,k){"use strict";this.$FBRTCViewController1.resetForReconnect(j);this.$FBRTCViewController2.setCallSummary(k);this.$FBRTCViewController1.setState(c("FBRTCCallModel").UIState.CALL_CONNECTING)};i.prototype.$FBRTCViewController5=function(j,k){"use strict";this.$FBRTCViewController4.logCallAction(this.$FBRTCViewController1.peerID,this.$FBRTCViewController1.callID,j,k?"true":"false")};f.exports=i}),null);
__d("FBRTCWindowManager",[],(function a(b,c,d,e,f,g){var h={height:0,width:0,top:0,left:0},i={height:447,width:675,bottomRightOffset:50},j={init:function k(l,m){this._window=l;this._callModel=m;m.addListener(this._setProgressIndicator.bind(this));this._setProgressIndicator();this._monitorOpenerForChanges();this._storePosition()},updatePosition:function k(l){if(!this._window)return;if(l&&h.height>0&&h.width>0){this._window.moveTo(h.left,h.top);this._window.resizeTo(h.width,h.height);return}this._storePosition();this._window.resizeTo(i.width,i.height);var m=screen.width-i.width-i.bottomRightOffset,n=screen.height-i.height-i.bottomRightOffset;this._window.moveTo(m,n)},reload:function k(){if(this._window&&!this._window.closed)this._window.location.reload()},close:function k(){if(this._window&&!this._window.closed)this._window.close()},_setProgressIndicator:function k(){if(this._callModel.isEnded())this._window.rtcCallInProgessWith=null;else this._window.rtcCallInProgessWith=this._callModel.peerID.toString()},_monitorOpenerForChanges:function k(){if(this._window.opener)try{this._window.opener.addEventListener("unload",function(event){this._passWindowToOpener(10)}.bind(this))}catch(l){}},_passWindowToOpener:function k(l){setTimeout(function(){setTimeout(function(){if(this._window.opener&&!this._window.opener.closed)this._window.opener.rtcCallChildWindow=this._window}.bind(this),1);if(l>1)this._passWindowToOpener(l-1)}.bind(this),1e3)},_storePosition:function k(){if(this._window){if(this._window.innerWidth!==undefined){h.height=this._window.outerHeight;h.width=this._window.outerWidth}else{h.height=this._window.screen.height;h.width=this._window.screen.width}if(this._window.screenLeft!==undefined){h.left=this._window.screenLeft;h.top=this._window.screenTop}else{h.left=this._window.screenX;h.top=this._window.screenY}}}};f.exports=j}),null);
__d("FBRTCCallController",["fbt","ChannelManager","ErrorUtils","Run","Bootloader","CollabCallMessengerBrowserEventEnum","FBRTCCallConnection","FBRTCCallConnectionMonitor","FBRTCCallControlActions","FBRTCCallModel","FBRTCCallMonitor","FBRTCCallSummary","FBRTCCallSummaryStore","FBRTCConfig","FBRTCConstants","FBRTCDispatcher","FBRTCExperiment","FBRTCIceCache","FBRTCLocalMessageQueue","FBRTCLogger","FBRTCMessage","FBRTCMessageDedup","FBRTCMessageListener","FBRTCMessageSender","FBRTCPCConfig","FBRTCTurnDiscovery","FBRTCUserMedia","FBRTCViewController","FBRTCCallModelStatePusher","FBRTCCallDialogController","FBRTCRetriableMessage","FBRTCUserSettings","FBRTCScreenSharingController","FBRTCScreenSharingUtils","FBRTCSdpUtils","FBRTCUrlManager","FBRTCUtils","FBRTCVideoEscalationStore","FBRTCWindowManager","MessengerRTCFunnelLogger","RTCConfig","randomInt"],(function a(b,c,d,e,f,g,h){var i=6e4,j=3e3;function k(){return c("randomInt")(0,4294967295)}c("ChannelManager").startChannelManager();function l(o,p,q,r,s){"use strict";m.call(this);this.$FBRTCCallController1=r;this.$FBRTCCallController2=s;this.$FBRTCCallController3=c("FBRTCLogger").getInstance();this.$FBRTCCallController4=new(c("FBRTCLocalMessageQueue"))();this.$FBRTCCallController5=c("FBRTCCallSummaryStore").getInstance();this.$FBRTCCallController6=null;this.$FBRTCCallController7=false;if(!q){var t=this.$FBRTCCallController4.getOffer(o);if(t){this.$FBRTCCallController6=new(c("FBRTCMessage"))(t);c("FBRTCMessageDedup").check(o,this.$FBRTCCallController6.callID,this.$FBRTCCallController6.msgID)}else q=true}if(!p)p=this.$FBRTCCallController6?this.$FBRTCCallController6.callID:k();this.$FBRTCCallController3.logCallAction(o,p,c("FBRTCLogger").CallAction.POPUP_OPENED);this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").CALL_CONTROLLER_INIT);c("MessengerRTCFunnelLogger").addFunnelTags([r?"audio_only":"video"]);this.$FBRTCCallController9=new(c("FBRTCCallModel"))({peerID:o,callID:p,isCaller:q,isAudioOnly:r});if(this.$FBRTCCallController6)this.$FBRTCCallController9.onSDPMessageFromPeer(this.$FBRTCCallController6);this.$FBRTCCallController9.localStream.setVideoEnabled(!r);this.$FBRTCCallController10=new(c("FBRTCCallModelStatePusher"))(this.$FBRTCCallController9);this.$FBRTCCallController11=c("FBRTCCallSummary").restoreOrInitialize(this.$FBRTCCallController5,o,p,q,this.$FBRTCCallController6&&this.$FBRTCCallController6.msg);this.$FBRTCCallController11.setClientVersion("1.0");this.$FBRTCCallController11.setIsUsingMultiway(this.$FBRTCCallController2);this.$FBRTCCallController11.onPopupOpened();c("FBRTCUrlManager").init(this.$FBRTCCallController9.peerID);c("FBRTCWindowManager").init(window,this.$FBRTCCallController9);this.$FBRTCCallController12=new(c("FBRTCScreenSharingController"))(o,p,false);if(c("FBRTCScreenSharingUtils").isScreenSharingSupported())this.$FBRTCCallController12.addListener(this.$FBRTCCallController13.bind(this));this.$FBRTCCallController14=new(c("FBRTCViewController"))(this.$FBRTCCallController9,this.$FBRTCCallController11,this.$FBRTCCallController5);this.$FBRTCCallController14.init();this.$FBRTCCallController15=new(c("FBRTCCallConnection"))();this.$FBRTCCallController15.addListener("remoteStreamAdded",this.$FBRTCCallController16,this);this.$FBRTCCallController15.addListener("remoteStreamRemoved",this.$FBRTCCallController17,this);this.$FBRTCCallController15.addListener("sdpCreated",this.$FBRTCCallController18,this);this.$FBRTCCallController15.addListener("localIceCandidateCreated",this.$FBRTCCallController19,this);this.$FBRTCCallController15.addListener("remoteDescriptionSet",this.$FBRTCCallController20,this);this.$FBRTCCallController15.addListener("connected",this.$FBRTCCallController21,this);this.$FBRTCCallController15.addListener("disconnected",this.$FBRTCCallController22,this);this.$FBRTCCallController15.addListener("connectionUnstable",this.$FBRTCCallController23,this);this.$FBRTCCallController15.addListener("connectionError",this.$FBRTCCallController24,this);this.$FBRTCCallController25=false;this.$FBRTCCallController26=new(c("FBRTCCallConnectionMonitor"))(this.$FBRTCCallController15,this.$FBRTCCallController11);this.$FBRTCCallController26.addListener("connectionPoor",this.$FBRTCCallController27,this);this.$FBRTCCallController28=new(c("FBRTCMessageSender"))();this.$FBRTCCallController28.onMessageSent=this.$FBRTCCallController29.bind(this);this.$FBRTCCallController28.onSendFailure=this.$FBRTCCallController30.bind(this);this.$FBRTCCallController31=null;this.$FBRTCCallController32=null;this.$FBRTCCallController33=new(c("FBRTCVideoEscalationStore"))(this.$FBRTCCallController28,this.$FBRTCCallController9,!r);this.$FBRTCCallController11.setCallType(this.$FBRTCCallController33.getCallType());this.$FBRTCCallController33.addListener(this.$FBRTCCallController34.bind(this));this.$FBRTCCallController35=new(c("FBRTCIceCache"))();this.$FBRTCCallController36=false;c("Run").onBeforeUnload(this.$FBRTCCallController37.bind(this),false);c("Run").onUnload(this.$FBRTCCallController38.bind(this));c("ErrorUtils").addListener(this.$FBRTCCallController39.bind(this),true);c("FBRTCMessageListener").init(true,this.$FBRTCCallController9.peerID);c("FBRTCMessageListener").setMessageHandler(this.$FBRTCCallController40,this);var u=this;this.$FBRTCCallController41=new(c("FBRTCCallMonitor"))(this.$FBRTCCallController9);this.$FBRTCCallController41.startHeartbeat(function(){return u.$FBRTCCallController11});this.$FBRTCCallController42=null;c("FBRTCUserSettings").addListener("saved",this.$FBRTCCallController43,this);if(c("FBRTCConfig").isVCEndpointCall()&&c("RTCConfig").CollabDisableBrowserTurnDiscoveryGK){this.$FBRTCCallController3.logInfo(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,"Skipping the TURN discovery");this.$FBRTCCallController44()}else c("FBRTCTurnDiscovery").requestTurnCreds(this.$FBRTCCallController9.callID,this.$FBRTCCallController9.peerID).done(function(v){return this.$FBRTCCallController45(v)}.bind(this),function(){return this.$FBRTCCallController46()}.bind(this));c("FBRTCDispatcher").register(this.__onDispatch.bind(this));this.$FBRTCCallController47=setTimeout(function(){this.waitForUserInput()}.bind(this),1500);n(function(v){var w=v.logConnectionStats(function(){return this.$FBRTCCallController15.getStatsNative()}.bind(this),o,p),x=w.start,y=w.stop;this.$FBRTCCallController15.addListener("connected",function(){x();this.$FBRTCCallController15.addListener("isEnding",y)}.bind(this))}.bind(this))}l.prototype.__onDispatch=function(o){"use strict";c("MessengerRTCFunnelLogger").logRTCP2PV1Action(o.type);switch(o.type){case c("FBRTCCallControlActions").Types.HANG_UP:this.$FBRTCCallController48(c("FBRTCConstants").CallEndReason.HANGUP_CALL,false,true,false);break;case c("FBRTCCallControlActions").Types.TOGGLE_SCREEN_SHARING:if(this.$FBRTCCallController12)this.$FBRTCCallController12.toggleScreenSharing(this.$FBRTCCallController9);break;case c("FBRTCCallControlActions").Types.SHOW_SETTINGS:c("FBRTCCallDialogController").showDialog(c("FBRTCCallDialogController").dialogTypes.SETTINGS,this.$FBRTCCallController9);break;case c("FBRTCCallControlActions").Types.ACCEPT_ESCALATION:this.$FBRTCCallController9.localStream.setVideoEnabled(true);this.$FBRTCCallController49(true);break;case c("FBRTCCallControlActions").Types.RESET_CALL:this.$FBRTCCallController50(o);break;case c("FBRTCCallControlActions").Types.PARENT_WINDOW_START_CALL:if(this.$FBRTCCallController9.canBeStartedByParentWindow())this.startCallProcess();break;case c("FBRTCCallControlActions").Types.REDIAL_CALL:this.$FBRTCCallController9.resetCallInfo(k());this.$FBRTCCallController11=new(c("FBRTCCallSummary"))({peerID:this.$FBRTCCallController9.peerID,callID:this.$FBRTCCallController9.callID,isCaller:true});this.$FBRTCCallController11.setClientVersion("1.0");this.$FBRTCCallController11.setIsUsingMultiway(this.$FBRTCCallController2);this.$FBRTCCallController51(c("FBRTCLogger").Trigger.REDIAL_BUTTON);break;case c("FBRTCCallControlActions").Types.START_CALL:this.$FBRTCCallController51(c("FBRTCLogger").Trigger.POPUP_CALL_START_BUTTON);break}};l.prototype.getCallModel=function(){"use strict";return this.$FBRTCCallController9};l.prototype.getConnection=function(){"use strict";return this.$FBRTCCallController15};l.prototype.sendData=function(o,p){"use strict";this.$FBRTCCallController15.sendData({topic:o,data:p})};l.prototype.addDataChannelListener=function(o,p){"use strict";return this.$FBRTCCallController15.addListener("data_message",o,p)};l.prototype.$FBRTCCallController51=function(o){"use strict";this.$FBRTCCallController11.onCallStarted(o);this.startCallProcess()};l.prototype.startCallProcess=function(){"use strict";this.$FBRTCCallController52();this.$FBRTCCallController14.userMediaRequested();this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").CALL_PROCESS_STARTED)};l.prototype.waitForUserInput=function(){"use strict";this.$FBRTCCallController14.waitForUserInput()};l.prototype.$FBRTCCallController52=function(){"use strict";var o=this.$FBRTCCallController9.localStream;c("FBRTCUserMedia").once("streamReady",this.$FBRTCCallController53,this);c("FBRTCUserMedia").addListener("accessDenied",this.$FBRTCCallController54,this);c("FBRTCUserMedia").addListener("accessFailed",this.$FBRTCCallController55,this);c("FBRTCUserMedia").addListener("accessGranted",this.$FBRTCCallController56,this);o.addListener("streamStarted",function(){this.$FBRTCCallController11.setVideoCaptureStats(o.videoWidth,o.videoHeight);this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").LOCAL_STREAM_STARTED,o.getStream())}.bind(this));this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").REQUEST_USER_MEDIA,"init");this.$FBRTCCallController57()};l.prototype.$FBRTCCallController57=function(){"use strict";var o;if(!this.$FBRTCCallController9.isRemoteVideoSupported)o=c("FBRTCConstants").VideoQuality.NO_VIDEO;else if(this.$FBRTCCallController9.isPeerOnMobile)o=c("FBRTCConstants").VideoQuality.LQ_VIDEO;else if(c("FBRTCConfig").isVCEndpointCall())o=c("FBRTCConstants").VideoQuality.CUSTOM_VIDEO;else if(this.$FBRTCCallController9.isCaller&&this.$FBRTCCallController9.uiState>=c("FBRTCCallModel").UIState.CALL_CONNECTING){var p=c("FBRTCExperiment").gen("rtc_web_video_quality_3"),q=p.getParam("renegotiate_to_hd","no");if(q==="yes")o=c("FBRTCConstants").VideoQuality.HD_VIDEO;else o=c("FBRTCConstants").VideoQuality.SD_VIDEO}else o=c("FBRTCConstants").VideoQuality.SD_VIDEO;var r=c("FBRTCConstants").StreamType.AUDIO_ONLY;if(this.$FBRTCCallController9.localStream&&this.$FBRTCCallController9.localStream.hasVideoTracks())r=c("FBRTCConstants").StreamType.AUDIO_VIDEO;var s=c("FBRTCUserSettings").audioInput,t=c("FBRTCUserSettings").videoInput;this.$FBRTCCallController58=o;this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").REQUEST_USER_MEDIA,{streamType:r,videoQuality:o,audioInput:s,videoInput:t});c("FBRTCUserMedia").requestUserMedia(r,o,s,t,this.$FBRTCCallController1)};l.prototype.$FBRTCCallController13=function(){"use strict";var o=this.$FBRTCCallController12.isEnabled(),p=this.$FBRTCCallController12.getStream();if(o)this.$FBRTCCallController15.addScreenStream(p);else{this.$FBRTCCallController15.removeScreenStream(p);this.$FBRTCCallController12.onStop()}this.$FBRTCCallController59();c("FBRTCWindowManager").updatePosition(!o);if(o)this.$FBRTCCallController9.setLocalScreenStream(p);else this.$FBRTCCallController9.setLocalScreenStream(null);this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").SCREEN_SHARING_TOGGLED,o)};l.prototype.$FBRTCCallController61=function(){"use strict";if(!this.$FBRTCCallController9.isRemoteVideoSupported&&this.$FBRTCCallController58===c("FBRTCConstants").VideoQuality.NO_VIDEO)return;else if(this.$FBRTCCallController9.isPeerOnMobile&&this.$FBRTCCallController58===c("FBRTCConstants").VideoQuality.LQ_VIDEO)return;this.$FBRTCCallController59()};l.prototype.$FBRTCCallController39=function(o){"use strict";var p=o.message+"; "+o.stackFrames[0].identifier;this.$FBRTCCallController3.logError(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,"JSError: "+p)};l.prototype.$FBRTCCallController37=function(){"use strict";if(this.$FBRTCCallController9.isInProgress())return h._("Leaving this page will end your call.")};l.prototype.$FBRTCCallController38=function(){"use strict";if(this.$FBRTCCallController9.isEnded())return;var o=this.$FBRTCCallController9.isUserMediaPending(),p=this.$FBRTCCallController9.isUserMediaDenied(),q=c("FBRTCConstants").CallEndReason.HANGUP_CALL,r="BrowserClosed";if(o||p){q=c("FBRTCConstants").CallEndReason.CLIENT_ERROR;r=o?"MediaPending":"MediaDenied"}else if(this.$FBRTCCallController9.isAwaitingUserStart())r="AwaitingUserStart";this.$FBRTCCallController48(q,false,true,true,r)};l.prototype.$FBRTCCallController45=function(o){"use strict";this.$FBRTCCallController3.logInfo(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,"Received Turn Creds");this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").TURN_CREDENTIALS_RECEIVED,o);c("FBRTCPCConfig").setTurnCredentials(o);this.$FBRTCCallController14.onTurnCredentialsReady(o);this.$FBRTCCallController44()};l.prototype.$FBRTCCallController46=function(){"use strict";this.$FBRTCCallController3.logError(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,"Failed to get turn creds");this.$FBRTCCallController48(c("FBRTCConstants").CallEndReason.CLIENT_ERROR,false,!this.$FBRTCCallController9.isCaller,false,"NoTurnCreds")};l.prototype.$FBRTCCallController44=function(){"use strict";if(this.$FBRTCCallController9.canStartCall()){c("FBRTCUrlManager").onCallStarted();var o=this.$FBRTCCallController9.localStream;this.$FBRTCCallController15.init(o);if(!this.$FBRTCCallController6)this.$FBRTCCallController15.createOffer();else{if(this.$FBRTCCallController6.isFromMobile()&&!o.hasVideoTracks())this.$FBRTCCallController6.disableVideo();if(Object.prototype.hasOwnProperty.call(this.$FBRTCCallController6.msg,"videoon"))this.$FBRTCCallController49(this.$FBRTCCallController6.msg.videoon);this.$FBRTCCallController9.setSignalingExperiments(this.$FBRTCCallController6.getSignalingExperiments());this.$FBRTCCallController62(this.$FBRTCCallController6.msg.sdp,true,this.$FBRTCCallController6.msg.attributes);this.$FBRTCCallController4.removeOffer(this.$FBRTCCallController9.peerID);this.$FBRTCCallController6=null}this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").CALL_START_TRY)}else this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").CALL_START_TRY,"not ready")};l.prototype.$FBRTCCallController59=function(){"use strict";if(this.$FBRTCCallController9.isAwaitingAnswer())this.$FBRTCCallController25=true;else{this.$FBRTCCallController25=false;this.$FBRTCCallController57();var o=[];if(this.$FBRTCCallController9.supportsSdpUpdate()){var p=this.$FBRTCCallController9.supportsMultipleStreamsPlanB();this.$FBRTCCallController15.createSdpUpdate(p);o.push("SDP update",p?"plan B":null)}else{this.$FBRTCCallController7=true;this.$FBRTCCallController35.reset(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID);this.$FBRTCCallController36=false;this.$FBRTCCallController15.createOffer();o.push("new offer")}this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").RENEGOTIATION,o)}};l.prototype.$FBRTCCallController65=function(o,p){"use strict";this.$FBRTCCallController28.sendSdpUpdate(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,o,this.$FBRTCCallController9.localStream.hasVideo(),p)};l.prototype.$FBRTCCallController63=function(o,p){"use strict";var q;if(!this.$FBRTCCallController7)q=c("FBRTCConstants").PayloadType.OFFER;else{q=c("FBRTCConstants").PayloadType.PCRESTART_OFFER;this.$FBRTCCallController7=false}this.$FBRTCCallController31=new(c("FBRTCRetriableMessage"))(this.$FBRTCCallController28);this.$FBRTCCallController31.addListener("sendingRetry",this.$FBRTCCallController66.bind(this));this.$FBRTCCallController31.addListener("timeoutFailure",this.$FBRTCCallController67.bind(this));this.$FBRTCCallController31.sendMessage(q,this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,o,this.$FBRTCCallController9.localStream.hasVideo(),p);this.$FBRTCCallController42=setTimeout(function(){this.$FBRTCCallController48(c("FBRTCConstants").CallEndReason.NO_ANSWER_TIMEOUT,false,true,false)}.bind(this),i)};l.prototype.$FBRTCCallController67=function(){"use strict";var o;if(this.$FBRTCCallController9.receivedNack){o=c("FBRTCConstants").CallEndReason.UNSUPPORTED_VERSION;c("FBRTCCallDialogController").showDialog(c("FBRTCCallDialogController").dialogTypes.PEER_BROWSER_UNSUPPORTED,this.$FBRTCCallController9)}else o=c("FBRTCConstants").CallEndReason.OTHER_NOT_CAPABLE;this.$FBRTCCallController48(o,false,true,false,"TimedOut")};l.prototype.$FBRTCCallController49=function(o){"use strict";var p=this.$FBRTCCallController9.remoteStream;p.setVideoEnabled(o);this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").REMOTE_STREAM_MUTE_TOGGLED,p.getStream())};l.prototype.$FBRTCCallController64=function(o,p){"use strict";var q=this.$FBRTCCallController9.localStream.hasVideo()&&this.$FBRTCCallController9.isRemoteVideoSupported;this.$FBRTCCallController32=new(c("FBRTCRetriableMessage"))(this.$FBRTCCallController28);this.$FBRTCCallController32.addListener("sendingRetry",this.$FBRTCCallController66.bind(this));this.$FBRTCCallController32.sendMessage(c("FBRTCConstants").PayloadType.ANSWER,this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,o,q,p)};l.prototype.$FBRTCCallController66=function(){"use strict";var o=this.$FBRTCCallController15.getCreatedIceCandidates();for(var p=0;p<o.length;p++)this.$FBRTCCallController68(o[p])};l.prototype.$FBRTCCallController68=function(o){"use strict";this.$FBRTCCallController28.sendIceCandidate(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,o)};l.prototype.$FBRTCCallController62=function(o,p,q){"use strict";this.$FBRTCCallController15.setPeerSupportsVideo(this.$FBRTCCallController9.isRemoteVideoSupported);if(this.$FBRTCCallController9.isPeerOnMobile)o=c("FBRTCSdpUtils").setVideoBitrateConstraint(o);if(p)this.$FBRTCCallController15.onReceivedOfferSDP(o,q);else this.$FBRTCCallController15.onReceivedAnswerSDP(o,q)};l.prototype.$FBRTCCallController30=function(o,p){"use strict";this.$FBRTCCallController48(o,false,false,false,p)};l.prototype.$FBRTCCallController29=function(o,p){"use strict";var q=p.call_id,r=p.type;if(this.$FBRTCCallController9.isEnded()){this.$FBRTCCallController3.logError(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,"Message sent after call ended: "+r);return}if(this.$FBRTCCallController9.peerID!==o||this.$FBRTCCallController9.callID!==q)return;this.$FBRTCCallController14.onMessageTypeSent(r);this.$FBRTCCallController11.onMessageSent(p);this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").MESSAGE_SENT,p.msg_id)};l.prototype.$FBRTCCallController70=function(o){"use strict";var p=o.peerID,q=o.callID,r=o.msg,s=new(c("FBRTCCallSummary"))({peerID:p,callID:q,isCaller:false});s.setClientVersion("1.0");s.setIsUsingMultiway(this.$FBRTCCallController2);s.onFullMessageReceived(o);this.$FBRTCCallController28.sendOfferAck(p,q,r);s.onOfferAckSent(r);var t=c("FBRTCConstants").CallEndReason.IN_ANOTHER_CALL;this.$FBRTCCallController79(p,q,t);s.onCallEnded(t,false);s.save(this.$FBRTCCallController5)};l.prototype.$FBRTCCallController71=function(o){"use strict";var p=o.msg;if(p.calltype){this.$FBRTCCallController28.sendOfferNack(this.$FBRTCCallController9.peerID,p.call_id,p);return}this.$FBRTCCallController28.sendOfferAck(this.$FBRTCCallController9.peerID,p.call_id,p);this.$FBRTCCallController28.sendOtherDismiss(p.call_id);if(this.$FBRTCCallController80(p))this.$FBRTCCallController81(o);else this.$FBRTCCallController82(o)};l.prototype.$FBRTCCallController73=function(o){var p=o.msg;"use strict";var q=p.attributes,r=p.sdp;if(Object.prototype.hasOwnProperty.call(p,"videoon"))this.$FBRTCCallController49(p.videoon);if(this.$FBRTCCallController9.isPeerOnMobile)r=c("FBRTCSdpUtils").setVideoBitrateConstraint(r);this.$FBRTCCallController15.onReceivedSdpUpdate(r,q);this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").SDP_UPDATE,{sdp:r,attributes:q})};l.prototype.$FBRTCCallController80=function(o){"use strict";if(o.call_id===this.$FBRTCCallController9.callID)return true;return(this.$FBRTCCallController42||!this.$FBRTCCallController6)&&(!this.$FBRTCCallController9.callID||o.call_id!==this.$FBRTCCallController9.callID)&&this.$FBRTCCallController9.isCaller&&(!o.handlescollision||o.call_id<this.$FBRTCCallController9.callID)};l.prototype.$FBRTCCallController81=function(o){"use strict";var p=o.msg;if(Object.prototype.hasOwnProperty.call(p,"videoon"))this.$FBRTCCallController49(p.videoon);this.$FBRTCCallController83();this.$FBRTCCallController84();this.$FBRTCCallController69();if(this.$FBRTCCallController9.callID!==p.call_id){var q=c("FBRTCConstants").CallEndReason.OTHER_INSTANCE_HANDLED;this.$FBRTCCallController79(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,q);this.$FBRTCCallController11.onCallEnded(q,false);this.$FBRTCCallController11.save(this.$FBRTCCallController5);this.$FBRTCCallController11=new(c("FBRTCCallSummary"))({peerID:this.$FBRTCCallController9.peerID,callID:p.call_id,isCaller:false});this.$FBRTCCallController11.setClientVersion("1.0");this.$FBRTCCallController11.setIsUsingMultiway(this.$FBRTCCallController2);this.$FBRTCCallController11.onFullMessageReceived(o);this.$FBRTCCallController11.onOfferAckSent(p);this.$FBRTCCallController3.logEvent(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,"Handling offer collision")}else this.$FBRTCCallController3.logEvent(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,"Handling offer refresh");this.$FBRTCCallController15.end();this.$FBRTCCallController36=false;this.$FBRTCCallController14.reset(p.call_id,this.$FBRTCCallController11);this.$FBRTCCallController9.onSDPMessageFromPeer(o);this.$FBRTCCallController6=o;this.$FBRTCCallController44();this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").OFFER_ACCEPTED,o.msgID)};l.prototype.$FBRTCCallController82=function(o){"use strict";this.$FBRTCCallController3.logEvent(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,"Ignoring offer");this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").OFFER_IGNORED,o.msgID)};l.prototype.$FBRTCCallController72=function(o){"use strict";var p=o.msg;this.$FBRTCCallController83();this.$FBRTCCallController84();this.$FBRTCCallController28.sendAnswerAck(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,p);this.$FBRTCCallController9.onSDPMessageFromPeer(o);if(this.$FBRTCCallController25)this.$FBRTCCallController59();else{this.$FBRTCCallController62(p.sdp,false,p.attributes);if(Object.prototype.hasOwnProperty.call(p,"videoon"))this.$FBRTCCallController49(p.videoon)}};l.prototype.$FBRTCCallController78=function(o){"use strict";var p=o.msg;if(this.$FBRTCCallController31&&this.$FBRTCCallController31.isAckMsg(p)){this.$FBRTCCallController11.onMsgAckReceived(o,true);this.$FBRTCCallController14.onMessageTypeReceived(c("FBRTCConstants").PayloadType.OFFER_ACK);this.$FBRTCCallController76(o)}else if(this.$FBRTCCallController32&&this.$FBRTCCallController32.isAckMsg(p)){this.$FBRTCCallController11.onMsgAckReceived(o,false);this.$FBRTCCallController77()}};l.prototype.$FBRTCCallController76=function(o){"use strict";this.$FBRTCCallController11.setUploadLogLevel(c("FBRTCUtils").getUploadLogLevel(c("FBRTCConstants").convertToUploadLogLevel(o.msg.ull)));this.$FBRTCCallController11.save(this.$FBRTCCallController5);this.$FBRTCCallController83();this.$FBRTCCallController41.onCallHeartbeat(this.$FBRTCCallController11)};l.prototype.$FBRTCCallController77=function(){"use strict";this.$FBRTCCallController69()};l.prototype.$FBRTCCallController74=function(o){"use strict";var p=o.msg;if(p.call_id===this.$FBRTCCallController9.callID&&this.$FBRTCCallController36)this.$FBRTCCallController15.onReceivedRemoteIceCandidate(p);else this.$FBRTCCallController35.cacheCandidate(this.$FBRTCCallController9.peerID,p.call_id,p)};l.prototype.$FBRTCCallController75=function(o){"use strict";var p=o.msg;if(p.call_id===this.$FBRTCCallController9.callID)this.$FBRTCCallController48(p.reason,true,false,false,p.subreason);else{var q=p.call_id.toString();this.$FBRTCCallController3.logError(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,"Receiving hangup for a different call: "+q);this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").HANGUP_CALL_ID_MISSMATCH,q)}};l.prototype.$FBRTCCallController50=function(o){"use strict";var p=o.trigger;if(!p||p!==c("FBRTCLogger").Trigger.RESET_CALL)return;var q=c("FBRTCConstants").CallEndReason.HANGUP_CALL;this.$FBRTCCallController48(q,false,true,false,"CallReset");c("FBRTCWindowManager").reload()};l.prototype.$FBRTCCallController48=function(o,p,q,r,s){"use strict";if(typeof o=="string"||o instanceof String)o=c("FBRTCConstants").endCallReasonFromString(o);var t=c("FBRTCConstants").fullCallEndReasonString(o,p);this.$FBRTCCallController3.logCallAction(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,c("FBRTCLogger").CallAction.END_CALL,t);c("MessengerRTCFunnelLogger").logRTCP2PV1Action("END_CALL",t);this.$FBRTCCallController83();this.$FBRTCCallController84();this.$FBRTCCallController69();if(this.$FBRTCCallController9.isEnded()){this.$FBRTCCallController3.logError(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,"Ending an already-ended call");return}if(q)this.$FBRTCCallController79(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,o,r,s);this.$FBRTCCallController12.onEndCall();this.$FBRTCCallController15.end();c("FBRTCUserMedia").end();this.$FBRTCCallController14.end(o,p,s);this.$FBRTCCallController11.setCallType(this.$FBRTCCallController33.getCallType());this.$FBRTCCallController11.setVideoDurations(this.$FBRTCCallController9.getLocalVideoDuration(),this.$FBRTCCallController9.getRemoteVideoDuration());this.$FBRTCCallController11.onCallEnded(o,p,null,s);this.$FBRTCCallController11.save(this.$FBRTCCallController5);clearTimeout(this.$FBRTCCallController60);this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").CALL_ENDED,{reason:t,reasonID:o,subReason:s,isRemoteEnded:p});if(o===c("FBRTCConstants").CallEndReason.HANGUP_CALL&&s==="CallReset"&&p)c("FBRTCWindowManager").close()};l.prototype.$FBRTCCallController79=function(o,p,q,r,s){"use strict";this.$FBRTCCallController28.sendHangup(o,p,q,r,s);this.$FBRTCCallController28.sendOtherDismiss(p)};l.prototype.$FBRTCCallController83=function(){"use strict";if(this.$FBRTCCallController31)this.$FBRTCCallController31.stopRetrying()};l.prototype.$FBRTCCallController69=function(){"use strict";if(this.$FBRTCCallController32)this.$FBRTCCallController32.stopRetrying()};l.prototype.$FBRTCCallController84=function(){"use strict";if(this.$FBRTCCallController42)clearTimeout(this.$FBRTCCallController42);this.$FBRTCCallController42=null};l.prototype.$FBRTCCallController34=function(){"use strict";if(this.$FBRTCCallController33.isPending())c("FBRTCCallDialogController").showDialog(c("FBRTCCallDialogController").dialogTypes.VIDEO_ESCALATION,this.$FBRTCCallController9);else c("FBRTCCallDialogController").hideDialogType(c("FBRTCCallDialogController").dialogTypes.VIDEO_ESCALATION);this.$FBRTCCallController11.setCallType(this.$FBRTCCallController33.getCallType());this.$FBRTCCallController11.save(this.$FBRTCCallController5)};l.prototype.$FBRTCCallController8=function(event,o){"use strict";if(!c("FBRTCConfig").isVCEndpointCall())return;n(function(p){return p.log(event,{peerID:this.$FBRTCCallController9.peerID,callID:this.$FBRTCCallController9.callID,eventDetails:o})}.bind(this))};var m=function m(){this.$FBRTCCallController43=function(o){this.$FBRTCCallController3.logCallAction(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,c("FBRTCLogger").CallAction.USER_SETTINGS_CHANGED);this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").USER_SETTINGS_CHANGED,{updateStream:o});if(o){c("FBRTCUserMedia").once("streamReady",function(p){c("FBRTCUserSettings").updateForLocalStream(p);this.$FBRTCCallController9.setLocalStream(p);this.$FBRTCCallController59()}.bind(this));this.$FBRTCCallController57()}}.bind(this);this.$FBRTCCallController16=function(event){var o=event.stream;this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").REMOTE_STREAM_ADDED,o);if(this.$FBRTCCallController15.isScreenStream(o)&&this.$FBRTCCallController15.getRemoteStreamsCount()>1){this.$FBRTCCallController12.setRemoteStream(o);this.$FBRTCCallController9.setRemoteScreenStream(this.$FBRTCCallController12.getStream())}else{this.$FBRTCCallController14.onRemoteStreamAdded(event);c("FBRTCUserSettings").updateForRemoteStream(o);if(!c("RTCConfig").RtcWwwDisableRenegotiation)if(this.$FBRTCCallController9.isCaller&&this.$FBRTCCallController9.supportsSdpUpdate())this.$FBRTCCallController60=setTimeout(function(){this.$FBRTCCallController61()}.bind(this),j)}}.bind(this);this.$FBRTCCallController17=function(o){var p=o.stream;this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").REMOTE_STREAM_REMOVED,p);var q=this.$FBRTCCallController9.getRemoteScreenStream();if(q&&p&&q.getStreamId()==p.id){this.$FBRTCCallController9.setRemoteScreenStream(null);this.$FBRTCCallController12.setRemoteStream(null)}clearTimeout(this.$FBRTCCallController60)}.bind(this);this.$FBRTCCallController23=function(){this.$FBRTCCallController3.logInfo(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,"Network unstable");this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").CONNECTION_INFO,"unstable")}.bind(this);this.$FBRTCCallController27=function(){this.$FBRTCCallController3.logInfo(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,"Network poor");this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").CONNECTION_INFO,"poor");if(c("FBRTCConfig").shouldAutoDisableVideo())this.$FBRTCCallController9.autoDisableVideo()}.bind(this);this.$FBRTCCallController53=function(o){c("FBRTCUserSettings").updateForLocalStream(o);this.$FBRTCCallController14.onLocalStreamReady(o);this.$FBRTCCallController44();this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").LOCAL_STREAM_READY,o)}.bind(this);this.$FBRTCCallController54=function(){this.$FBRTCCallController3.logCallAction(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,c("FBRTCLogger").CallAction.DENIED_PERMISSION);this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").REQUEST_USER_MEDIA,"denied");this.$FBRTCCallController14.userMediaDenied()}.bind(this);this.$FBRTCCallController55=function(o){this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").REQUEST_USER_MEDIA,"failed");this.$FBRTCCallController48(c("FBRTCConstants").CallEndReason.CLIENT_ERROR,false,true,false,o);c("FBRTCCallDialogController").showDialog(c("FBRTCCallDialogController").dialogTypes.ERROR_ACCESSING_MEDIA,this.$FBRTCCallController9)}.bind(this);this.$FBRTCCallController56=function(){this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").REQUEST_USER_MEDIA,"granted");this.$FBRTCCallController14.userMediaGranted()}.bind(this);this.$FBRTCCallController18=function(o){switch(o.type){case"offer":this.$FBRTCCallController63(o.sdp,o.attributes);break;case"answer":this.$FBRTCCallController64(o.sdp,o.attributes);break;case"sdp_update":this.$FBRTCCallController65(o.sdp,o.attributes);break;default:break}}.bind(this);this.$FBRTCCallController19=function(o){this.$FBRTCCallController68(o)}.bind(this);this.$FBRTCCallController20=function(){this.$FBRTCCallController36=true;var o=this;this.$FBRTCCallController35.drainCandidates(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,function(p){o.$FBRTCCallController15.onReceivedRemoteIceCandidate(p)})}.bind(this);this.$FBRTCCallController21=function(){this.$FBRTCCallController69();this.$FBRTCCallController11.onCallConnected();this.$FBRTCCallController11.onNetworkReady();this.$FBRTCCallController41.onCallHeartbeat(this.$FBRTCCallController11);this.$FBRTCCallController3.logInfo(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,"Call Connected");this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").CALL_CONNECTED);c("MessengerRTCFunnelLogger").logRTCP2PV1Action("call_connected")}.bind(this);this.$FBRTCCallController22=function(){this.$FBRTCCallController48(c("FBRTCConstants").CallEndReason.CONNECTION_DROPPED,false,true,false)}.bind(this);this.$FBRTCCallController24=function(o){this.$FBRTCCallController48(c("FBRTCConstants").CallEndReason.WEBRTC_ERROR,false,true,false,o.endCallSubreason);this.$FBRTCCallController3.logError(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,"webrtc error: "+JSON.stringify(o.details));this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").RTC_ERROR,o.details)}.bind(this);this.$FBRTCCallController40=function(o){var p;try{p=new(c("FBRTCMessage"))(o)}catch(q){this.$FBRTCCallController3.logError(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,"Unknown data: "+JSON.stringify(o));return}this.$FBRTCCallController3.logReceivedMessage(p.peerID,p.callID,p.msg);this.$FBRTCCallController8(c("CollabCallMessengerBrowserEventEnum").MESSAGE_RECEIVED,p.msgID);if(this.$FBRTCCallController9.isEnded()){this.$FBRTCCallController3.logInfo(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,"Ignoring message (call ended): "+p.msgID);return}if(!c("FBRTCMessageDedup").check(p.peerID,p.callID,p.msgID)){this.$FBRTCCallController3.logInfo(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,"Ignoring message (duplicate): "+p.msgID);return}if(this.$FBRTCCallController9.isAwaitingUserStart())return;if(this.$FBRTCCallController9.peerID&&this.$FBRTCCallController9.peerID!==p.peerID){if(p.isOffer())this.$FBRTCCallController70(p);this.$FBRTCCallController3.logInfo(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,"Ignoring message (different peer): "+p.msgID);return}if(!p.isForCall(this.$FBRTCCallController9.callID)){this.$FBRTCCallController3.logInfo(this.$FBRTCCallController9.peerID,this.$FBRTCCallController9.callID,"Ignoring message (different call): "+p.msgID);return}this.$FBRTCCallController14.onMessageTypeReceived(p.msgType);if(this.$FBRTCCallController9.callID&&this.$FBRTCCallController9.callID===p.callID)this.$FBRTCCallController11.onFullMessageReceived(p);this.$FBRTCCallController9.setSignalingExperiments(p.getSignalingExperiments());switch(p.msgType){case c("FBRTCConstants").PayloadType.OFFER:case c("FBRTCConstants").PayloadType.ICERESTART_OFFER:case c("FBRTCConstants").PayloadType.PCRESTART_OFFER:this.$FBRTCCallController71(p);break;case c("FBRTCConstants").PayloadType.ANSWER:case c("FBRTCConstants").PayloadType.ICERESTART_ANSWER:case c("FBRTCConstants").PayloadType.PCRESTART_ANSWER:this.$FBRTCCallController72(p);this.$FBRTCCallController41.onCallHeartbeat(this.$FBRTCCallController11);break;case c("FBRTCConstants").PayloadType.SDP_UPDATE:this.$FBRTCCallController73(p);break;case c("FBRTCConstants").PayloadType.ICE_CANDIDATE:this.$FBRTCCallController74(p);break;case c("FBRTCConstants").PayloadType.HANGUP:this.$FBRTCCallController75(p);break;case c("FBRTCConstants").PayloadType.OFFER_ACK:this.$FBRTCCallController76(p);break;case c("FBRTCConstants").PayloadType.OFFER_NACK:this.$FBRTCCallController9.receivedNack=true;break;case c("FBRTCConstants").PayloadType.ANSWER_ACK:this.$FBRTCCallController77();break;case c("FBRTCConstants").PayloadType.MSG_ACK:this.$FBRTCCallController78(p);break;case c("FBRTCConstants").PayloadType.SET_VIDEO:if(this.$FBRTCCallController9.isRemoteVideoSupported&&!this.$FBRTCCallController9.$FBRTCCallController1)this.$FBRTCCallController49(p.msg.videoon);break;case c("FBRTCConstants").PayloadType.VIDEO_REQUEST:case c("FBRTCConstants").PayloadType.ACK:case c("FBRTCConstants").PayloadType.OK:case c("FBRTCConstants").PayloadType.PING:case c("FBRTCConstants").PayloadType.PING_ACK:case c("FBRTCConstants").PayloadType.OTHER_DISMISS:case c("FBRTCConstants").PayloadType.PRANSWER:break;default:break}c("FBRTCCallControlActions").receivedSignalingMessage(p)}.bind(this)};function n(o){if(!c("FBRTCConfig").isVCEndpointCall())return;c("Bootloader").loadModules(["CollabMessengerLogger"],o,"FBRTCCallController")}f.exports=l}),null);
__d("FBRTCBackground.react",["cx","MessengerFaviconUrls","Image.react","React"],(function a(b,c,d,e,f,g,h){"use strict";var i,j,k=c("React").PropTypes;i=babelHelpers.inherits(l,c("React").PureComponent);j=i&&i.prototype;function l(m,n){j.constructor.call(this,m,n);this.$FBRTCBackground2=function(){this.setState({showCoverPhoto:false})}.bind(this);this.$FBRTCBackground1();this.state={showCoverPhoto:true}}l.prototype.render=function(){if(this.props.messengerUI)return null;var m=this.props.src;if(this.state.showCoverPhoto&&m)return c("React").createElement("div",{className:"_1_5p"},c("React").createElement("div",{className:"_1_5q"}),c("React").createElement(c("Image.react"),{src:m,className:"_1_5r",alt:"",onError:this.$FBRTCBackground2}));else return c("React").createElement("div",{className:"_1_5p"})};l.prototype.$FBRTCBackground1=function(){var m=document.querySelector('link[rel*=icon][href*=".ico"]');if(m instanceof HTMLLinkElement)m.href=c("MessengerFaviconUrls")["default"]};l.propTypes={messengerUI:k.bool.isRequired,src:k.string};f.exports=l}),null);
__d("FBRTCCallControlButton.react",["cx","React","emptyFunction"],(function a(b,c,d,e,f,g,h){"use strict";var i,j,k=c("React").PropTypes,l={END:0,FULL_SCREEN:1,MUTE:2,SETTINGS:3,SHARE_SCREEN:4,VIDEO:5};i=babelHelpers.inherits(m,c("React").PureComponent);j=i&&i.prototype;m.prototype.defaultProps=function(){return{active:false,disabled:false,endButton:false,highlighted:false}};m.prototype.render=function(){var n="_5lms"+(this.props.highlighted?" _5lmy":"")+(this.props.endButton?" _5lmz":""),o=this.props,p=o.iconType,q=o.active,r=o.disabled;return c("React").createElement("button",{onClick:this.props.disabled?c("emptyFunction"):this.props.onClick,className:n,ref:this.props.ref,"data-testid":this.props["data-testid"],tabIndex:"0",role:"button","aria-label":this.props.title,"data-hover":r?undefined:"tooltip","data-tooltip-alignh":"center","data-tooltip-content":this.props.title},this.$FBRTCCallControlButton1(p,!!q,!!r))};m.prototype.$FBRTCCallControlButton1=function(n,o,p){if(o)return c("React").createElement("i",{className:"_5ln2"+(n===l.END?" _5ln3":"")+(n===l.FULL_SCREEN?" _5lng":"")+(n===l.MUTE?" _5lnh":"")+(n===l.SETTINGS?" _5lni":"")+(n===l.SHARE_SCREEN?" _5lnj":"")+(n===l.VIDEO?" _5lnk":"")});return c("React").createElement("i",{className:"_5ln2"+(p?" _5h3-":"")+(n===l.END?" _5ln3":"")+(n===l.FULL_SCREEN?" _5lnl":"")+(n===l.MUTE?" _5lnm":"")+(n===l.SETTINGS?" _5lni":"")+(n===l.SHARE_SCREEN?" _5lnn":"")+(n===l.VIDEO?" _5lnp":"")})};function m(){i.apply(this,arguments)}m.IconTypes=l;m.propTypes={active:k.bool,disabled:k.bool,endButton:k.bool,highlighted:k.bool,iconType:k.number.isRequired,onClick:k.func.isRequired,ref:k.string,title:k.node};f.exports=m}),null);
__d("FBRTCCallControlPopover.react",["fbt","LayerFadeOnHide","LayerFadeOnShow","React","XUIContextualDialog.react","XUIContextualDialogBody.react","XUIContextualDialogTitle.react"],(function a(b,c,d,e,f,g,h){"use strict";var i,j,k=c("React").PropTypes,l={NONE:0,REMOTE_VIDEO_UNSUPPORTED:1,NO_VIDEO_TRACKS:2,VIDEO_AUTO_DISABLED:3,SCREENSHARING_UNAVAILABLE:4,PEER_IS_SHARING_SCREEN:5,IS_AUDIO_CALL:6};i=babelHelpers.inherits(m,c("React").PureComponent);j=i&&i.prototype;m.prototype.render=function(){var n=this.$FBRTCCallControlPopover1();if(n)return c("React").createElement(c("XUIContextualDialog.react"),this.$FBRTCCallControlPopover2(),n,this.$FBRTCCallControlPopover3());return c("React").createElement(c("XUIContextualDialog.react"),this.$FBRTCCallControlPopover2(),this.$FBRTCCallControlPopover3())};m.prototype.$FBRTCCallControlPopover1=function(){if(this.props.reason===l.NO_VIDEO_TRACKS)return c("React").createElement(c("XUIContextualDialogTitle.react"),{className:this.props.className},h._("Can't find camera"));return null};m.prototype.$FBRTCCallControlPopover3=function(){var n=null;switch(this.props.reason){case l.NONE:break;case l.REMOTE_VIDEO_UNSUPPORTED:n=h._("Video is disabled for this call because {name}'s device does not support video.",[h.param("name",this.props.peerName)]);break;case l.NO_VIDEO_TRACKS:n=h._("Connect your camera and refresh the page to turn on video. If your camera is already connected, try restarting your browser.");break;case l.VIDEO_AUTO_DISABLED:n=h._("Video is paused because the connection is slow.");break;case l.SCREENSHARING_UNAVAILABLE:n=this.props.isVCEndpointCall?h._("Screen sharing is not currently available for Messenger to room calls."):h._("Screen sharing is disabled for this call because {name}'s device does not support receiving screen shares.",[h.param("name",this.props.peerName)]);break;case l.PEER_IS_SHARING_SCREEN:n=h._("{name} is already sharing their screen. You can share your screen as soon as they've stopped sharing.",[h.param("name",this.props.peerName)]);break;case l.IS_AUDIO_CALL:n=h._("Screen sharing is only available for video calls.");break}return c("React").createElement(c("XUIContextualDialogBody.react"),{className:this.props.className},n)};m.prototype.$FBRTCCallControlPopover2=function(){var n={alignment:"left",behaviors:{LayerFadeOnHide:c("LayerFadeOnHide"),LayerFadeOnShow:c("LayerFadeOnShow")},contextRef:function(){return this.props.reference}.bind(this),hoverContextRef:function(){return this.props.reference}.bind(this),position:"above",shown:false,width:this.props.width};return n};function m(){i.apply(this,arguments)}m.Types=l;m.propTypes={reason:k.number.isRequired,peerName:k.string.isRequired,isVCEndpointCall:k.bool,reference:k.object.isRequired,width:k.number.isRequired};f.exports=m}),null);
__d("RTCCallActionTypes",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({INCOMING_CALL_SUCCESS:"INCOMING_CALL_SUCCESS",RESET:"RESET",REMOTE_VIDEO_MUTED:"REMOTE_VIDEO_MUTED",REMOTE_VIDEO_UNMUTED:"REMOTE_VIDEO_UNMUTED"})}),null);
__d("RTCGroupCallActionTypes",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({CALL:"CALL",CALL_SUCCESS:"CALL_SUCCESS",CALL_ERROR:"CALL_ERROR",INIT:"INIT",WAIT_FOR_USER_INPUT:"WAIT_FOR_USER_INPUT",SET_CALL_SUMMARY:"SET_CALL_SUMMARY",SET_MW_CALL_TYPE:"SET_MW_CALL_TYPE",SET_LAYOUT:"SET_LAYOUT",SET_DOMINANT_SPEAKER:"SET_DOMINANT_SPEAKER",SET_PINNED_SPEAKER:"SET_PINNED_SPEAKER",SET_USE_DOMINANT_SPEAKE_VIEW:"SET_USE_DOMINANT_SPEAKE_VIEW",SET_GRID_VIEW:"SET_GRID_VIEW",SET_STRIP_VIEW:"SET_STRIP_VIEW",INIT_THREAD:"INIT_THREAD",ON_PARTICIPANT_LEFT:"ON_PARTICIPANT_LEFT",ON_PARTICIPANTS_ADDED:"ON_PARTICIPANTS_ADDED",ADD_PARTICIPANTS_TO_RING:"ADD_PARTICIPANTS_TO_RING",JOIN:"JOIN",JOIN_SUCCESS:"JOIN_SUCCESS",JOIN_ERROR:"JOIN_ERROR",HANGUP:"HANGUP",HANGUP_SUCCESS:"HANGUP_SUCCESS",HANGUP_ERROR:"HANGUP_ERROR",ON_CONFERENCE_STATE:"ON_CONFERENCE_STATE",DISMISS:"DISMISS",END_CALL:"END_CALL",ON_JOIN_REQUEST_SENT:"ON_JOIN_REQUEST_SENT",ON_JOIN_RESPONSE:"ON_JOIN_RESPONSE",ON_SERVER_MEDIA_UPDATE_SUCCESS:"ON_SERVER_MEDIA_UPDATE_SUCCESS",ON_CLIENT_MEDIA_UPDATE_RESPONSE:"ON_CLIENT_MEDIA_UPDATE_RESPONSE",INIT_LOCAL_USER:"INIT_LOCAL_USER",INIT_REMOTE_USERS:"INIT_REMOTE_USERS",ADD_REMOTE_STREAM:"ADD_REMOTE_STREAM",REMOVE_REMOTE_STREAM:"REMOVE_REMOTE_STREAM",REMOVE_ALL_REMOTE_STREAMS:"REMOVE_ALL_REMOTE_STREAMS",ADD_REMOTE_TRACK:"ADD_REMOTE_TRACK",REMOVE_REMOTE_TRACK:"REMOVE_REMOTE_TRACK",AUDIO_MUTED:"AUDIO_MUTED",AUDIO_UNMUTED:"AUDIO_UNMUTED",VIDEO_MUTED:"VIDEO_MUTED",VIDEO_UNMUTED:"VIDEO_UNMUTED",SELF_VIEW_COLLAPSED:"SELF_VIEW_COLLAPSED",SELF_VIEW_UNCOLLAPSED:"SELF_VIEW_UNCOLLAPSED",ADD_LOCAL_STREAM:"ADD_LOCAL_STREAM",REMOVE_LOCAL_STREAM:"REMOVE_LOCAL_STREAM",REPLACE_LOCAL_STREAM:"REPLACE_LOCAL_STREAM",REMOVE_ALL_LOCAL_STREAMS:"REMOVE_ALL_LOCAL_STREAMS",ADD_LOCAL_SCREEN_STREAM:"ADD_LOCAL_SCREEN_STREAM",REMOVE_LOCAL_SCREEN_STREAM:"REMOVE_LOCAL_SCREEN_STREAM",REMOVE_ALL_LOCAL_SCREEN_STREAMS:"REMOVE_ALL_LOCAL_SCREEN_STREAMS",ADD_REMOTE_SCREEN_STREAM:"ADD_REMOTE_SCREEN_STREAM",REMOVE_REMOTE_SCREEN_STREAM:"REMOVE_REMOTE_SCREEN_STREAM",TOGGLE_REMOTE_STREAM:"TOGGLE_REMOTE_STREAM",SUBMIT_RATING:"SUBMIT_RATING",SUBMIT_FEEDBACK:"SUBMIT_FEEDBACK",RATING_SHOWN:"RATING_SHOWN",FEEDBACK_SHOWN:"FEEDBACK_SHOWN"})}),null);
__d("RTCGroupCallDispatcher",["ExplicitRegistrationDispatcher"],(function a(b,c,d,e,f,g){var h,i;h=babelHelpers.inherits(j,c("ExplicitRegistrationDispatcher"));i=h&&h.prototype;function j(k){"use strict";i.constructor.call(this,k);this.dispatch=this.dispatch.bind(this)}f.exports=new j({strict:true})}),null);
__d("RTCCallActions",["RTCCallActionTypes","RTCGroupCallActionTypes","RTCGroupCallDispatcher","RTCUtils","emptyFunction","mixInEventEmitter"],(function a(b,c,d,e,f,g){"use strict";var h={addListener:c("emptyFunction"),emit:c("emptyFunction"),initialize:function i(j,k,l,m,n){c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").INIT,conferenceName:k,callID:m,serverInfoData:l,protocol:j,callTrigger:n})},reset:function i(j){c("RTCGroupCallDispatcher").dispatch({type:c("RTCCallActionTypes").RESET,conferenceName:j})},setCallSummary:function i(j){c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").SET_CALL_SUMMARY,callSummary:j})},call:function i(j,k){c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").CALL,usersToRing:j,peerConnection:k})},callSuccess:function i(){var j=arguments.length<=0||arguments[0]===undefined?false:arguments[0];c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").CALL_SUCCESS,connected:j})},incomingCallSuccess:function i(){c("RTCGroupCallDispatcher").dispatch({type:c("RTCCallActionTypes").INCOMING_CALL_SUCCESS})},callError:function i(j){c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").CALL_ERROR,endCallReason:c("RTCUtils").endCallReasonFromResponseStatusCode(j),endCallSubreason:"Call error: "+(j||0)})},hangupSuccess:function i(){c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").HANGUP_SUCCESS})},hangupError:function i(j){c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").HANGUP_ERROR,error:j})},join:function i(j){h.call([],j)},hangup:function i(j,k){c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").HANGUP,hangupReason:j,detailedReasonString:k,endCallReason:c("RTCUtils").endCallReasonFromHangupReason(j)})},initLocalUser:function i(j){c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").INIT_LOCAL_USER,localUser:j})},initRemoteUsers:function i(j){c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").INIT_REMOTE_USERS,remoteUsers:j})},addLocalStream:function i(j){c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").ADD_LOCAL_STREAM,stream:j})},removeLocalStream:function i(j){c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").REMOVE_LOCAL_STREAM,stream:j})},replaceLocalStream:function i(j,k){c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").REPLACE_LOCAL_STREAM,oldStream:j,newStream:k})},removeAllLocalStreams:function i(){var j=arguments.length<=0||arguments[0]===undefined?false:arguments[0];c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").REMOVE_ALL_LOCAL_STREAMS,stopStreams:j})},removeAllLocalScreenStreams:function i(){var j=arguments.length<=0||arguments[0]===undefined?false:arguments[0];c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").REMOVE_ALL_LOCAL_SCREEN_STREAMS,stopStreams:j})},addRemoteStream:function i(j,k){c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").ADD_REMOTE_STREAM,stream:j,userID:k})},removeRemoteStream:function i(j,k){c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").REMOVE_REMOTE_STREAM,stream:j,userID:k})},removeAllRemoteStreams:function i(j){c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").REMOVE_ALL_REMOTE_STREAMS,userID:j})},addRemoteTrack:function i(j,k){c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").ADD_REMOTE_TRACK,stream:j,track:k})},removeRemoteTrack:function i(j,k){c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").REMOVE_REMOTE_TRACK,stream:j,track:k})},addLocalScreenStream:function i(j){c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").ADD_LOCAL_SCREEN_STREAM,stream:j})},removeLocalScreenStream:function i(j){c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").REMOVE_LOCAL_SCREEN_STREAM,stream:j})},addRemoteScreenStream:function i(j,k){c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").ADD_REMOTE_SCREEN_STREAM,stream:j,userID:k})},removeRemoteScreenStream:function i(j,k){c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").REMOVE_REMOTE_SCREEN_STREAM,stream:j,userID:k})},endCall:function i(j,k){c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").END_CALL,endCallReason:j,endCallSubreason:k})},waitForUserInput:function i(){c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").WAIT_FOR_USER_INPUT})},toggleMuteAudio:function i(j){c("RTCGroupCallDispatcher").dispatch({type:j?c("RTCGroupCallActionTypes").AUDIO_UNMUTED:c("RTCGroupCallActionTypes").AUDIO_MUTED})},toggleMuteVideo:function i(j){c("RTCGroupCallDispatcher").dispatch({type:j?c("RTCGroupCallActionTypes").VIDEO_UNMUTED:c("RTCGroupCallActionTypes").VIDEO_MUTED})},toggleMuteRemoteVideo:function i(j,k){c("RTCGroupCallDispatcher").dispatch({type:j?c("RTCCallActionTypes").REMOTE_VIDEO_MUTED:c("RTCCallActionTypes").REMOTE_VIDEO_UNMUTED,userID:k})},toggleSelfView:function i(j){c("RTCGroupCallDispatcher").dispatch({type:j?c("RTCGroupCallActionTypes").SELF_VIEW_COLLAPSED:c("RTCGroupCallActionTypes").SELF_VIEW_UNCOLLAPSED})},submitRating:function i(j){c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").SUBMIT_RATING,rating:j})},submitFeedback:function i(j){c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").SUBMIT_FEEDBACK,feedback:j})},ratingShown:function i(){c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").RATING_SHOWN})},feedbackShown:function i(){c("RTCGroupCallDispatcher").dispatch({type:c("RTCGroupCallActionTypes").FEEDBACK_SHOWN})}};c("mixInEventEmitter")(h,{onIceConnectionStateChange:true});f.exports=h}),null);
__d("VideoCallWebDriverIDs",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({END_CALL_BUTTON:"endCallButton",FULL_SCREEN_BUTTON:"fullScreenButton",INCALL_VIDEO_CONTAINER:"incallVideoContainer",RTC_APP_VIEW_LOGO:"RTCAppViewLogo",RTC_APP_VIEW_START_CALL_BUTTON:"RTCAppViewStartCallButton",STAR_RATING_VIEW:"starRatingView",TOGGLE_AUDIO_BUTTON:"toggleAudioButton",TOGGLE_VIDEO_BUTTON:"toggleVideoButton"})}),null);
__d("FBRTCCallEndButton.react",["fbt","FBRTCCallControlActions","FBRTCCallControlButton.react","FBRTCHangupReason","React","RTCCallActions","VideoCallWebDriverIDs"],(function a(b,c,d,e,f,g,h){"use strict";var i=function i(j){var k=h._("End Call"),l=function l(){if(j.onClick)j.onClick();c("FBRTCCallControlActions").hangUp();c("RTCCallActions").hangup(c("FBRTCHangupReason").HANGUP_CALL,"")};return c("React").createElement(c("FBRTCCallControlButton.react"),{endButton:true,title:k,iconType:c("FBRTCCallControlButton.react").IconTypes.END,onClick:l,"data-testid":c("VideoCallWebDriverIDs").END_CALL_BUTTON})};f.exports=i}),null);
__d("FBRTCCallControls.react",["cx","fbt","React","FBRTCCallControlActions","FBRTCCallControlButton.react","FBRTCCallEndButton.react","FBRTCCallControlPopover.react","FBRTCConfig","FBRTCFullScreenController","FBRTCScreenSharingUtils","FBRTCUserSettings","ScreenSharingWebDriverIDs","keyMirror"],(function a(b,c,d,e,f,g,h,i){"use strict";var j,k,l=c("React").Component,m=c("React").PropTypes,n=1e4,o=c("keyMirror")({READY:null,SHOWN:null,COMPLETE:null});j=babelHelpers.inherits(p,l);k=j&&j.prototype;function p(){var q,r;for(var s=arguments.length,t=Array(s),u=0;u<s;u++)t[u]=arguments[u];return r=(q=k.constructor).call.apply(q,[this].concat(t)),this.state={forceVisible:o.READY,hasFocus:false},this.$FBRTCCallControls2=function(){this.forceUpdate()}.bind(this),this.$FBRTCCallControls12=function(){c("FBRTCCallControlActions").toggleMuteVideo()},this.$FBRTCCallControls13=function(){c("FBRTCCallControlActions").toggleMuteAudio()},this.$FBRTCCallControls15=function(){if(c("FBRTCScreenSharingUtils").isScreenSharingSupported())if(this.props.canPeerReceiveScreenSharing&&!this.props.hasRemoteScreenStream)c("FBRTCCallControlActions").toggleScreenSharing();else c("FBRTCScreenSharingUtils").logFailedAttempt(this.props.peerID,Number(this.props.callID))}.bind(this),this.onFocus=function(){this.setState({hasFocus:true})}.bind(this),this.onBlur=function(){this.setState({hasFocus:false})}.bind(this),r}p.prototype.componentDidMount=function(){this.$FBRTCCallControls1=c("FBRTCFullScreenController").addListener(this.$FBRTCCallControls2)};p.prototype.componentWillUnmount=function(){if(this.$FBRTCCallControls1){this.$FBRTCCallControls1.remove();this.$FBRTCCallControls1=null}};p.prototype.componentWillReceiveProps=function(q){var r=this.state.forceVisible;if(q.videoIsAutoDisabled||q.hasStream&&!q.hasVideo){if(r===o.READY){this.setState({forceVisible:o.SHOWN});setTimeout(function(){this.setState({forceVisible:o.COMPLETE})}.bind(this),n)}}else if(r===o.SHOWN)this.setState({forceVisible:o.COMPLETE})};p.prototype.$FBRTCCallControls3=function(q){var r=65;return c("FBRTCUserSettings").isEnabled()?q:q-r};p.prototype.$FBRTCCallControls4=function(){var q=null,r=null,s={};if(!this.props.isRemoteVideoSupported)q=c("FBRTCCallControlPopover.react").Types.REMOTE_VIDEO_UNSUPPORTED;else if(!this.props.hasVideo)q=c("FBRTCCallControlPopover.react").Types.NO_VIDEO_TRACKS;else if(this.props.videoIsAutoDisabled)q=c("FBRTCCallControlPopover.react").Types.VIDEO_AUTO_DISABLED;if(q)s.videoPopover=c("React").createElement(c("FBRTCCallControlPopover.react"),{reason:q,peerName:this.props.peerShortName,reference:this.refs.videoButton,width:this.$FBRTCCallControls3(320)});if(c("FBRTCScreenSharingUtils").isScreenSharingSupported()){if(this.props.isConnected&&!this.props.canPeerReceiveScreenSharing)r=c("FBRTCCallControlPopover.react").Types.SCREENSHARING_UNAVAILABLE;else if(this.props.hasRemoteScreenStream)r=c("FBRTCCallControlPopover.react").Types.PEER_IS_SHARING_SCREEN;if(r)s.screenSharingPopover=c("React").createElement(c("FBRTCCallControlPopover.react"),{reason:r,peerName:this.props.peerShortName,isVCEndpointCall:c("FBRTCConfig").isVCEndpointCall(),reference:this.refs.shareScreenButton,width:this.$FBRTCCallControls3(255)})}return s};p.prototype.render=function(){var q=this.props,r=q.isVideoMuted,s=q.isAudioMuted,t=q.showSettings,u=c("FBRTCUserSettings").isEnabled()&&t,v=c("FBRTCFullScreenController").isFullScreen(),w=this.$FBRTCCallControls5(),x=!w&&r,y=c("FBRTCScreenSharingUtils").isScreenSharingSupported(),z=s,A=this.$FBRTCCallControls4();return c("React").createElement("div",{className:"_4bbt"},c("React").createElement("div",{className:this.$FBRTCCallControls6(),onFocus:this.onFocus,onBlur:this.onBlur},this.$FBRTCCallControls7(x,w),this.$FBRTCCallControls8(z),this.$FBRTCCallControls9(y),c("React").createElement(c("FBRTCCallEndButton.react"),null),this.$FBRTCCallControls10(u),this.$FBRTCCallControls11(v),A.videoPopover,A.screenSharingPopover))};p.prototype.$FBRTCCallControls5=function(){var q=this.props,r=q.isConnected,s=q.isRemoteVideoSupported,t=q.hasVideo;return!s||!t||!r};p.prototype.$FBRTCCallControls7=function(q,r){var s=q?i._("Enable Your Video"):i._("Disable Your Video");return c("React").createElement(c("FBRTCCallControlButton.react"),{active:q,disabled:r,highlighted:q,title:s,iconType:c("FBRTCCallControlButton.react").IconTypes.VIDEO,onClick:this.$FBRTCCallControls12,ref:"videoButton"})};p.prototype.$FBRTCCallControls8=function(q){var r=q?i._("Unmute your microphone"):i._("Mute your microphone");return c("React").createElement(c("FBRTCCallControlButton.react"),{active:q,iconType:c("FBRTCCallControlButton.react").IconTypes.MUTE,highlighted:q,title:r,onClick:this.$FBRTCCallControls13})};p.prototype.$FBRTCCallControls14=function(){if(c("FBRTCUserSettings").isEnabled())c("FBRTCCallControlActions").showSettings()};p.prototype.$FBRTCCallControls10=function(q){if(q){var r=i._("Settings");return c("React").createElement(c("FBRTCCallControlButton.react"),{iconType:c("FBRTCCallControlButton.react").IconTypes.SETTINGS,title:r,onClick:this.$FBRTCCallControls14})}return null};p.prototype.$FBRTCCallControls9=function(q){if(!q)return null;var r=this.props,s=r.canPeerReceiveScreenSharing,t=r.isScreenSharingEnabled,u=s&&t,v=!s||!this.props.isConnected||this.props.hasRemoteScreenStream,w=i._("Share Your Screen");return c("React").createElement(c("FBRTCCallControlButton.react"),{active:u,disabled:v,highlighted:u,iconType:c("FBRTCCallControlButton.react").IconTypes.SHARE_SCREEN,title:w,onClick:this.$FBRTCCallControls15,ref:"shareScreenButton","data-testid":c("ScreenSharingWebDriverIDs").SHARE_SCREEN_BUTTON})};p.prototype.$FBRTCCallControls16=function(){c("FBRTCCallControlActions").toggleFullScreen()};p.prototype.$FBRTCCallControls11=function(q){var r=q?i._("Exit Full Screen"):i._("Enter Full Screen");return c("React").createElement(c("FBRTCCallControlButton.react"),{active:q,title:r,iconType:c("FBRTCCallControlButton.react").IconTypes.FULL_SCREEN,onClick:this.$FBRTCCallControls16})};p.prototype.$FBRTCCallControls6=function(){var q=!this.props.hasStream||this.props.isEnded,r=this.props.isMouseActive||this.state.hasFocus||this.state.forceVisible===o.SHOWN;return"_4bbx"+(q?" _4bby":"")+(r?" _4bbz":"")};p.defaultProps={hasRemoteScreenStream:false,isMouseActive:true,isRemoteVideoSupported:true,isScreenSharingEnabled:false,showSettings:false,videoIsAutoDisabled:false};p.propTypes={canPeerReceiveScreenSharing:m.bool,hasAudio:m.bool.isRequired,hasRemoteScreenStream:m.bool,hasStream:m.bool.isRequired,hasVideo:m.bool.isRequired,isAudioMuted:m.bool.isRequired,isConnected:m.bool.isRequired,isEnded:m.bool.isRequired,isMouseActive:m.bool,isRemoteVideoSupported:m.bool,isScreenSharingEnabled:m.bool,isVideoMuted:m.bool.isRequired,peerShortName:m.string.isRequired,showSettings:m.bool,videoIsAutoDisabled:m.bool,callID:m.string.isRequired,peerID:m.oneOfType([m.number,m.string]).isRequired};f.exports=p}),null);
__d("FBRTCButton.react",["cx","messengerButtonReact","React","XUIOverlayButton.react","joinClasses"],(function a(b,c,d,e,f,g,h){"use strict";var i,j,k=c("messengerButtonReact").jsComponent,l=c("React").PropTypes;i=babelHelpers.inherits(m,c("React").PureComponent);j=i&&i.prototype;m.prototype.render=function(){var n=this.props,o=n.className,p=n.messengerUI,q=n.type,r=babelHelpers.objectWithoutProperties(n,["className","messengerUI","type"]);if(p)return c("React").createElement(k,babelHelpers["extends"]({className:o,type:q},r));return c("React").createElement(c("XUIOverlayButton.react"),babelHelpers["extends"]({className:c("joinClasses")("_1-7l",o)},r))};function m(){i.apply(this,arguments)}m.propTypes={label:l.node.isRequired,messengerUI:l.bool.isRequired,type:l.oneOf(["primary","secondary"]).isRequired};f.exports=m}),null);
__d("FBRTCCallEndMessage.react",["cx","fbt","FBRTCConstants","ReactComponentWithPureRenderMixin","React"],(function a(b,c,d,e,f,g,h,i){"use strict";var j=c("FBRTCConstants").CallEndReason,k=c("FBRTCConstants").CollabCallEndSubreason,l=c("React").PropTypes,m=c("React").createClass({displayName:"FBRTCCallEndMessage",mixins:[c("ReactComponentWithPureRenderMixin")],propTypes:{endCallReason:l.number,endCallSubreason:l.any,isCollabCall:l.bool},defaultProps:{isCollabCall:false},render:function n(){return c("React").createElement("div",{className:"_2ze8"},this._getCallEndReason(),this._getCallEndSubreason())},_getCallEndSubreason:function n(){var o=this.props,p=o.isCollabCall,q=o.endCallReason,r=o.endCallSubreason;if(!p)return null;if(q!==j.OTHER_NOT_CAPABLE&&q!==j.SIGNALING_MESSAGE_FAILED)return null;switch(r){case k.REMOTE_PEER_HANGUP:case k.REMOTE_PEER_REJECT:return null;case k.CLOSED_BY_MCU:return" - Call expired";case k.CLOSED_AS_STALE:return" - Server failed, call is stale";case k.CALL_INITIALIZATION_FAILED:return" - Call initialization to room failed";case k.SIP_CONNECTION_INITIALIZATION_FAILED:return" or No Answer";case k.LOST_MCU_CONNECTION:return" - MCU Media connection failed";case k.LOST_MCU_THRIFT_CONNECTION:return" - MCU infrastructure dropped connection";case k.LOST_SIP_ADAPTER_CONNECTION:return" - SIP infrastructure dropped connection";case k.MCU_NO_AUDIO_STREAM:return" - Invalid audio stream";case k.MCU_INVALID_STREAM_CONFIGURATION:return" - Invalid stream configuration";case k.UNKNOWN:default:return" - Unexpected call failure: "+r}},_getCallEndReason:function n(){var o=this.props,p=o.endCallReason,q=o.endCallSubreason,r=i._("Not Reachable");switch(p){case j.NO_ANSWER_TIMEOUT:case j.IGNORE_CALL:return i._("No Answer");case j.INCOMING_TIMEOUT:case j.NO_PERMISSION:case j.OTHER_CARRIER_BLOCKED:return r;case j.OTHER_NOT_CAPABLE:return q!==k.MCU_INVALID_STREAM_CONFIGURATION?r:i._("Too many clients connected to the room");case j.SIGNALING_MESSAGE_FAILED:case j.WEBRTC_ERROR:case j.NO_UI_ERROR:case j.CALLER_NOT_VISIBLE:case j.CLIENT_ERROR:return i._("Call Failed");case j.UNSUPPORTED_VERSION:return i._("Can't connect Call");case j.IN_ANOTHER_CALL:return i._("On Another Call");case j.CARRIER_BLOCKED:return i._("Switch to Wi-Fi to complete your call");case j.CLIENT_INTERRUPTED:return i._("Call Interrupted");case j.HANGUP_CALL:case j.ACCEPT_AFTER_HANGUP:return i._("Call ended");case j.CONNECTION_DROPPED:return i._("Connection lost");case j.OTHER_INSTANCE_HANDLED:return"";default:return""}}});f.exports=m}),null);
__d("FBRTCCallTimer.react",["React"],(function a(b,c,d,e,f,g){"use strict";var h,i,j=c("React").PureComponent;h=babelHelpers.inherits(k,j);i=h&&h.prototype;function k(){var l,m;for(var n=arguments.length,o=Array(n),p=0;p<n;p++)o[p]=arguments[p];return m=(l=i.constructor).call.apply(l,[this].concat(o)),this.state={secondsElapsed:Math.floor(Date.now()/1e3)-this.props.start},this.$FBRTCCallTimer2=function(){this.setState({secondsElapsed:Math.floor(Date.now()/1e3)-this.props.start})}.bind(this),m}k.prototype.componentDidMount=function(){this.$FBRTCCallTimer1=setInterval(this.$FBRTCCallTimer2,1e3)};k.prototype.componentWillUnmount=function(){clearInterval(this.$FBRTCCallTimer1)};k.prototype.render=function(){var l=this.state.secondsElapsed;return c("React").createElement("span",null,l>=3600?("0"+Math.floor(l/3600)).slice(-2)+":":"",("0"+Math.floor(l%3600/60)).slice(-2),":",("0"+l%60).slice(-2))};f.exports=k}),null);
__d("FBRTCSpinner.react",["MessengerSpinner.react","React","XUISpinner.react"],(function a(b,c,d,e,f,g){"use strict";var h,i,j=c("React").PropTypes;h=babelHelpers.inherits(k,c("React").PureComponent);i=h&&h.prototype;k.prototype.render=function(){if(this.props.messengerUI)return c("React").createElement(c("MessengerSpinner.react"),{color:"blue"});return c("React").createElement(c("XUISpinner.react"),{background:"dark",size:"large"})};function k(){h.apply(this,arguments)}k.propTypes={messengerUI:j.bool.isRequired};f.exports=k}),null);
__d("FBRTCCallStateInfo.react",["cx","fbt","FBRTCButton.react","FBRTCCallControlActions","FBRTCCallEndMessage.react","FBRTCCallModel","FBRTCCallTimer.react","FBRTCConstants","FBRTCSpinner.react","Image.react","MessengerContactImage.react","React"],(function a(b,c,d,e,f,g,h,i){var j,k,l=function l(n,o){switch(n.uiState){case c("FBRTCCallModel").UIState.INIT:case c("FBRTCCallModel").UIState.PENDING_LOCAL_MEDIA:case c("FBRTCCallModel").UIState.MORE_INIT:case c("FBRTCCallModel").UIState.USER_MEDIA_DENIED:return c("React").createElement(c("FBRTCSpinner.react"),{messengerUI:o});case c("FBRTCCallModel").UIState.CONTACTING:return c("React").createElement("p",{className:"_2ze8"},i._("Contacting..."));case c("FBRTCCallModel").UIState.RINGING:return c("React").createElement("p",{className:"_2ze8"},i._("Ringing..."));case c("FBRTCCallModel").UIState.CALL_CONNECTING:return c("React").createElement("p",{className:"_2ze8"},i._("Connecting..."));case c("FBRTCCallModel").UIState.CALL_CONNECTED:if(!this._start)this._start=Math.floor(Date.now()/1e3);return c("React").createElement("p",{className:"_2ze8"},c("React").createElement(c("FBRTCCallTimer.react"),{start:this._start}));case c("FBRTCCallModel").UIState.CALL_ENDED:return c("React").createElement(c("FBRTCCallEndMessage.react"),{endCallReason:n.endCallReason});default:return""}};j=babelHelpers.inherits(m,c("React").Component);k=j&&j.prototype;function m(){var n,o;"use strict";for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=k.constructor).call.apply(n,[this].concat(q)),this.revealContainer=function(){var s="_4j_h",t=document.getElementsByClassName(s)[0];if(t)t.className=s},this.onCloseButtonClicked=function(s){window.close();return},this.renderMessage=function(){var s=this.props.callModel;if(s.uiState===c("FBRTCCallModel").UIState.AWAITING_USER_START)return c("React").createElement("p",{className:"_4j_k"},i._("Ready to call {name}?",[i.param("name",s.peerShortName())]));return c("React").createElement("p",{className:"_4j_k"},this.props.callModel.peerName())}.bind(this),this.renderSubMessage=function(){return l(this.props.callModel,this.props.messengerUI)}.bind(this),this.renderPeerImage=function(s){if(s.peerPicUrl()){if(this.props.messengerUI)return c("React").createElement(c("MessengerContactImage.react"),{className:"_3z3i",isMessengerUser:true,size:75,src:s.peerPicUrl()});return c("React").createElement(c("Image.react"),{className:"_4j_j",src:s.peerPicUrl(),alt:i._("Profile picture"),onLoad:this.revealContainer,onError:this.revealContainer})}return""}.bind(this),this.shouldRenderCloseButton=function(){var s=this.props.callModel;return s.uiState===c("FBRTCCallModel").UIState.CALL_ENDED&&(!s.wasConnected||s.endCallReason!==c("FBRTCConstants").CallEndReason.HANGUP_CALL)}.bind(this),this.renderCloseWindowButton=function(){if(this.shouldRenderCloseButton())return c("React").createElement(c("FBRTCButton.react"),{label:i._("Close Window"),messengerUI:this.props.messengerUI,onClick:this.onCloseButtonClicked,type:"primary"});else return""}.bind(this),this.renderStartCallButton=function(){var s=this.props.callModel;if(s.uiState===c("FBRTCCallModel").UIState.AWAITING_USER_START)return c("React").createElement(c("FBRTCButton.react"),{label:i._("Start Call"),messengerUI:this.props.messengerUI,onClick:c("FBRTCCallControlActions").startCall,type:"primary"});else return""}.bind(this),o}m.prototype.componentDidMount=function(){"use strict";setTimeout(function(){this.revealContainer()}.bind(this),2e3)};m.prototype.render=function(){"use strict";var n=this.props.callModel;return c("React").createElement("div",{className:"_4j_i"},this.renderPeerImage(n),this.renderMessage(),this.renderSubMessage(),this.renderCloseWindowButton(),this.renderStartCallButton())};f.exports=m}),null);
__d("FBRTCFadeInMixin",["cx","ReactDOM","joinClasses"],(function a(b,c,d,e,f,g,h){var i={componentDidMount:function j(){var k=c("ReactDOM").findDOMNode(this);k.style.opacity=0;k.className=c("joinClasses")(k.className,"_2hy");setTimeout(function(){k.style.opacity=1},1)}};f.exports=i}),null);
__d("FBRTCCollabCallFeedbackView.react",["ix","cx","fbt","FBRTCButton.react","FBRTCCallControlActions","FBRTCCallEndMessage.react","FBRTCCallModel","FBRTCFadeInMixin","Image.react","ReactComponentWithPureRenderMixin","React","fbglyph"],(function a(b,c,d,e,f,g,h,i,j){"use strict";var k=c("React").PropTypes,l=241233369258619,m=c("React").createClass({displayName:"FBRTCCollabCallFeedbackView",mixins:[c("FBRTCFadeInMixin"),c("ReactComponentWithPureRenderMixin")],propTypes:{callModel:k.instanceOf(c("FBRTCCallModel")).isRequired,messengerUI:k.bool.isRequired},closeCurrentWindow:function n(){window.close()},messageString:function n(){return j._("Please leave feedback in the VC Feedback group")},render:function n(){var o=this.props.callModel,p=c("React").createElement(c("Image.react"),{src:h("114515")});return c("React").createElement("div",null,c("React").createElement("div",{className:"_1-7k"},c("React").createElement(c("FBRTCCallEndMessage.react"),{endCallReason:o.endCallReason,endCallSubreason:o.endCallSubreason,isCollabCall:true}),c("React").createElement("p",{className:"_4j_k"},this.messageString()),c("React").createElement("div",null,c("React").createElement(c("FBRTCButton.react"),{label:j._("Close Window"),messengerUI:this.props.messengerUI,onClick:this.closeCurrentWindow,type:"secondary"}),c("React").createElement(c("FBRTCButton.react"),{label:j._("Leave Feedback"),messengerUI:this.props.messengerUI,href:"/groups/"+l,onClick:this.closeCurrentWindow,target:"_blank",type:"primary"}))),c("React").createElement("div",{className:"_15wx"},c("React").createElement(c("FBRTCButton.react"),{className:"_15wy",label:j._("Redial"),image:p,messengerUI:this.props.messengerUI,use:"special",onClick:c("FBRTCCallControlActions").redialCall,type:"secondary"})))}});f.exports=m}),null);
__d("FBRTCActiveMouseMixin",[],(function a(b,c,d,e,f,g){"use strict";var h=3e3,i=[],j=null,k=false;function l(o){m(true);if(j!==null)clearTimeout(j);j=setTimeout(function(){j=null;m(false)},h)}function m(o){if(o===k)return;k=o;i.map(function(p){p(k)})}var n={componentWillMount:function o(){if(this.activeMouseCallback){if(i.length==0)window.addEventListener("mousemove",l);i.push(this.activeMouseCallback)}},componentWillUnmount:function o(){if(this.activeMouseCallback){var p=i.indexOf(this.activeMouseCallback);if(p>-1)i.splice(p,1);if(i.length==0){if(j!==null)clearTimeout(j);window.removeEventListener("mousemove",l)}}}};f.exports=n}),null);
__d("FBRTCScreenSharingControls.react",["cx","fbt","FBRTCActiveMouseMixin","FBRTCCallControlButton.react","FBRTCScreenSharingConstants","React"],(function a(b,c,d,e,f,g,h,i){"use strict";var j=c("React").PropTypes,k=c("React").createClass({displayName:"FBRTCScreenSharingControls",mixins:[c("FBRTCActiveMouseMixin")],propTypes:{uiType:j.string},activeMouseCallback:function l(m){this.setState({mouseActive:m})},getDefaultProps:function l(){return{uiType:c("FBRTCScreenSharingConstants").DIRECT_SENDER}},getInitialState:function l(){return{mouseActive:true}},_endSession:function l(){if(window.opener&&window.opener.closeScreenSharingWindow)window.opener.closeScreenSharingWindow()},render:function l(){return c("React").createElement("div",{className:"_4bbt"},c("React").createElement("div",{className:this._wrapperClasses()},this._endSessionButton()))},_endSessionButton:function l(){var m=i._("End screen share");return c("React").createElement(c("FBRTCCallControlButton.react"),{endButton:true,title:m,iconType:c("FBRTCCallControlButton.react").IconTypes.END,onClick:this._endSession})},_wrapperClasses:function l(){var m=this._isSender()?true:this.state.mouseActive;return"_4bbx"+(m?" _4bbz":"")},_isSender:function l(){return this.props.uiType===c("FBRTCScreenSharingConstants").DIRECT_SENDER}});f.exports=k}),null);
__d("FBRTCScreenSharingView.react",["cx","CSS","FBRTCCallControlActions","FBRTCScreenSharingConstants","FBRTCScreenSharingControls.react","FBRTCVideo.react","React"],(function a(b,c,d,e,f,g,h){"use strict";var i,j;i=babelHelpers.inherits(k,c("React").Component);j=i&&i.prototype;function k(){var l,m;for(var n=arguments.length,o=Array(n),p=0;p<n;p++)o[p]=arguments[p];return m=(l=j.constructor).call.apply(l,[this].concat(o)),this.state={screenStream:null,uiType:c("FBRTCScreenSharingConstants").FROM_VIDEO_CALL},m}k.prototype.componentDidMount=function(){if(!this.props.isStandalone||this.state.screenStream){if(this.state.screenStream===null)this.setState({screenStream:this.props.screenStream});return}if(document.documentElement)c("CSS").addClass(document.documentElement,"_2ujx");if(window.opener.getRemoteMediaStream){var l=window.opener.getRemoteMediaStream();if(l)this.setState({screenStream:l})}if(window.opener.getUIType)this.setState({uiType:window.opener.getUIType()});window.onunload=window.opener.closeScreenSharingWindow};k.prototype.componentWillUnmount=function(){if(this.props.isStandalone)if(document.documentElement)c("CSS").removeClass(document.documentElement,"_2ujx")};k.prototype.render=function(){var l=this.state.screenStream;if(l&&l.hasStream())return c("React").createElement("div",{className:"_2uqm"+(this.props.isStandalone?" _2uqn":"")},this.$FBRTCScreenSharingView1(),this.$FBRTCScreenSharingView2(),c("React").createElement("div",{className:"_2uqq"},c("React").createElement(c("FBRTCVideo.react"),{className:"_3pb5 _1yvx",mediaStream:l.getStream()})));else return c("React").createElement("div",{className:"_2uql"})};k.prototype.$FBRTCScreenSharingView1=function(){if(!this.props.isStandalone)return c("React").createElement("button",{className:"_2uqo",onClick:c("FBRTCCallControlActions").openScreenInNewWindow},c("React").createElement("i",{className:"_2uqp"}));return null};k.prototype.$FBRTCScreenSharingView2=function(){if(this.$FBRTCScreenSharingView3())return c("React").createElement(c("FBRTCScreenSharingControls.react"),{uiType:this.state.uiType});return null};k.prototype.$FBRTCScreenSharingView4=function(){return this.state.uiType===c("FBRTCScreenSharingConstants").DIRECT_SENDER};k.prototype.$FBRTCScreenSharingView5=function(){return this.state.uiType===c("FBRTCScreenSharingConstants").DIRECT_RECIPIENT};k.prototype.$FBRTCScreenSharingView3=function(){return this.$FBRTCScreenSharingView4()||this.$FBRTCScreenSharingView5()};k.defaultProps={isStandalone:false};f.exports=k}),null);
__d("FBRTCInCallView.react",["cx","FBRTCScreenSharingUI","FBRTCScreenSharingView.react","FBRTCStreamWrapper","FBRTCUserSettings","FBRTCVideo.react","React","VideoCallWebDriverIDs"],(function a(b,c,d,e,f,g,h){"use strict";var i,j,k=c("React").PropTypes,l=c("React").Component;i=babelHelpers.inherits(m,l);j=i&&i.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=j.constructor).call.apply(n,[this].concat(q)),this.state={audioSinkID:null,settingsActivateListener:null,settingsDeactivateListener:null,settingsSaveListener:null,muted:false},this.$FBRTCInCallView2=function(){var s=this.props,t=s.isCallConnected,u=s.hasCallEnded;return"_of-"+(t||u?" _of_":"")+(t?" _og0":"")+(u?" _og1":"")}.bind(this),this.$FBRTCInCallView3=function(s){var t=this.props.isRemoteVideoMuted;return"_og2"+(t?" _og3":"")+(s?" _og4":"")}.bind(this),o}m.prototype.$FBRTCInCallView1=function(n){return!!n&&!c("FBRTCScreenSharingUI").isOpen()};m.prototype.render=function(){var n=this.props,o=n.hasRemoteMediaStream,p=n.remoteMediaStream,q=n.remoteScreenStreamWrapper,r=n.remoteStreamWrapper,s=this.state,t=s.audioSinkID,u=s.muted,v=this.$FBRTCInCallView1(q);if(!o&&!v)return c("React").createElement("div",{className:"_hgl"});return c("React").createElement("div",{className:this.$FBRTCInCallView2()},c("React").createElement("div",{className:this.$FBRTCInCallView3(v),"data-testid":c("VideoCallWebDriverIDs").INCALL_VIDEO_CONTAINER},c("React").createElement(c("FBRTCVideo.react"),{audioSinkID:t,muted:u,stream:r,mediaStream:p})),this.$FBRTCInCallView4(q,v))};m.prototype.$FBRTCInCallView4=function(n,o){if(!n||!o)return null;return c("React").createElement(c("FBRTCScreenSharingView.react"),{canSwitchScreens:false,screenStream:n})};m.prototype.componentDidMount=function(){var n=c("FBRTCUserSettings").addListener("previewStarted",function(){return this.setState({muted:true})}.bind(this)),o=c("FBRTCUserSettings").addListener("previewEnded",function(){return this.setState({muted:false})}.bind(this)),p=c("FBRTCUserSettings").addListener("saved",function(){return this.setState({audioSinkID:c("FBRTCUserSettings").audioOutput})}.bind(this));this.setState({settingsActivateListener:n,settingsDeactivateListener:o,settingsSaveListener:p})};m.prototype.componentWillUnmount=function(){var n=this.state,o=n.settingsActivateListener,p=n.settingsDeactivateListener,q=n.settingsSaveListener;o&&o.remove();p&&p.remove();q&&q.remove()};m.propTypes={hasCallEnded:k.bool,hasRemoteMediaStream:k.bool,isCallConnected:k.bool,isRemoteVideoMuted:k.bool,remoteScreenStreamWrapper:k.instanceOf(c("FBRTCStreamWrapper")),remoteStreamWrapper:k.instanceOf(c("FBRTCStreamWrapper")),remoteMediaStream:k.any};f.exports=m}),null);
__d("FBRTCMediaAccessPrompt.react",["cx","fbt","React","ReactDOM","UserAgent","Link.react","XUIText.react","CurrentUser","FBRTCCallModel","FBRTCConfig"],(function a(b,c,d,e,f,g,h,i){var j,k;j=babelHelpers.inherits(l,c("React").Component);k=j&&j.prototype;function l(){var m,n;"use strict";for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return n=(m=k.constructor).call.apply(m,[this].concat(p)),this.isVisible=function(r){return(c("UserAgent").isBrowser("Chrome")||c("UserAgent").isBrowser("Firefox"))&&r===c("FBRTCCallModel").UIState.PENDING_LOCAL_MEDIA},this.dialogTitle=function(){if(c("UserAgent").isBrowser("Chrome"))return i._("Click \"Allow\" to Make a Call");else return i._("Click the camera and choose \"Share Selected Devices\"")},this.dialogLowerBody=function(){return i._("You can always turn these off later.")},this.learnMoreLink=function(){return c("React").createElement(c("Link.react"),{href:c("FBRTCConfig").userMediaPermissionErrorUrl(),target:"_blank"},i._("Learn more"))},n}l.prototype.componentWillUpdate=function(m,n){"use strict";var o=m.callModel.uiState;if(this.isVisible(o)){clearTimeout(this.timeout);c("ReactDOM").findDOMNode(this).style.display="block"}};l.prototype.componentDidUpdate=function(m,n){"use strict";var o=this.props.callModel.uiState;if(!this.isVisible(o))this.timeout=setTimeout(function(){c("ReactDOM").findDOMNode(this).style.display="none"}.bind(this),500)};l.prototype.componentWillUnmount=function(){"use strict";clearTimeout(this.timeout)};l.prototype.dialogBody=function(){"use strict";if(!c("CurrentUser").isWorkUser())return i._("To make a video call on Facebook, you need to turn on your camera and microphone. This will let your friend see and hear you during the call.");else return i._("To make a video call on Workplace, you need to turn your camera and microphone on. This will let your colleague see and hear you during the call.")};l.prototype.render=function(){"use strict";var m=this.props.callModel.uiState;return c("React").createElement("div",{className:"_3jne"+(!this.isVisible(m)?" _3jnf":"")},c("React").createElement("div",{className:"_3jnu"},c("React").createElement("h1",{className:"_3jnv"},this.dialogTitle()),c("React").createElement(c("XUIText.react"),{className:"_3jnw",display:"block",size:"small"},this.dialogBody()),c("React").createElement(c("XUIText.react"),{className:"_3jnw",display:"block",size:"small"},this.dialogLowerBody()," ",this.learnMoreLink())))};f.exports=l}),null);
__d("FBRTCMediaDeniedPrompt.react",["cx","fbt","React","UserAgent","XUIContextualDialog.react","XUIContextualDialogBody.react","XUIContextualDialogTitle.react","FBRTCCallModel"],(function a(b,c,d,e,f,g,h,i){var j,k;j=babelHelpers.inherits(l,c("React").Component);k=j&&j.prototype;l.prototype.showDialog=function(){"use strict";var m=this.props.callModel;return m.uiState===c("FBRTCCallModel").UIState.USER_MEDIA_DENIED};l.prototype.arrowAlignment=function(){"use strict";return c("UserAgent").isBrowser("Chrome")?"right":"left"};l.prototype.dialogTitle=function(){"use strict";return i._("Click to Turn on Camera\/Microphone")};l.prototype.dialogBody=function(){"use strict";return i._("To use video calling, you need to turn on your camera and microphone during the call.")};l.prototype.renderLayers=function(){"use strict";return c("React").createElement(c("XUIContextualDialog.react"),{contextRef:function(){return this.refs.mpTarget}.bind(this),shown:this.showDialog(),position:"below",alignment:this.arrowAlignment(),width:c("XUIContextualDialog.react").WIDTH.NORMAL,key:"popover"},c("React").createElement(c("XUIContextualDialogTitle.react"),null,this.dialogTitle()),c("React").createElement(c("XUIContextualDialogBody.react"),null,this.dialogBody()))};l.prototype.render=function(){"use strict";return c("React").createElement("span",null,c("React").createElement("div",{className:"_3wrz",ref:"mpTarget"}),this.renderLayers())};function l(){"use strict";j.apply(this,arguments)}f.exports=l}),null);
__d("FBRTCVideoMuteOverlay.react",["cx","Image.react","React"],(function a(b,c,d,e,f,g,h){"use strict";var i,j,k=c("React").PropTypes;i=babelHelpers.inherits(l,c("React").PureComponent);j=i&&i.prototype;l.prototype.render=function(){var m="_30ve"+(this.props.videoMuted?" _30vf":"");return c("React").createElement("div",{className:m},c("React").createElement(c("Image.react"),{src:this.props.imageSrc,alt:"video muted"}))};function l(){i.apply(this,arguments)}l.propTypes={videoMuted:k.bool.isRequired,imageSrc:k.oneOfType([k.string,k.object]).isRequired};f.exports=l}),null);
__d("FBRTCSelfView.react",["cx","FBRTCActiveMouseMixin","FBRTCCallModel","FBRTCCallControlActions","FBRTCVideo.react","FBRTCVideoMuteOverlay.react","React"],(function a(b,c,d,e,f,g,h){"use strict";var i=c("React").PropTypes,j=c("React").createClass({displayName:"FBRTCSelfView",mixins:[c("FBRTCActiveMouseMixin")],propTypes:{callModel:i.instanceOf(c("FBRTCCallModel")).isRequired},getInitialState:function k(){return{}},activeMouseCallback:function k(l){if(this.isMounted())this.setState({mouseActive:l})},toggleIconClass:function k(l,m){return"_2q_n"+(l?" _2q_o":"")+(!l?" _2q_p":"")+(!m?" _2q_q":"")},wrapperClasses:function k(l){return"_2q_r"+(!l.selfViewOpen?" _2q_s":"")},overlayClasses:function k(l){var m=l.localStream.hasAudio();return"_2q_t"+(m?" _2q_u":"")},buttonClasses:function k(){return"_2q_w"+(this.state.mouseActive?" _sxz":"")},render:function k(){var l=this.props.callModel,m=l.selfViewOpen,n=l.isScreenSharingEnabled()?"_nxg":"_2q_y",o=l.isScreenSharingEnabled()?l.getLocalScreenStream():l.localStream;return c("React").createElement("div",{className:"_2q_v"},c("React").createElement("button",{className:this.buttonClasses(),onClick:c("FBRTCCallControlActions").toggleSelfView},c("React").createElement("i",{className:this.toggleIconClass(true,!m)}),c("React").createElement("i",{className:this.toggleIconClass(false,m)})),c("React").createElement("div",{className:this.wrapperClasses(l)},c("React").createElement("div",{className:"_5aq5"},c("React").createElement(c("FBRTCVideoMuteOverlay.react"),{videoMuted:!o.hasVideo(),imageSrc:l.selfPicUrl()}),c("React").createElement("div",{className:this.overlayClasses(l)},c("React").createElement("i",{className:"_2q_x"})),c("React").createElement(c("FBRTCVideo.react"),{muted:true,className:n,stream:o}))))}});f.exports=j}),null);
__d("FBRTCFeedbackCompleteView.react",["cx","fbt","FBRTCButton.react","FBRTCCallControlActions","FBRTCFadeInMixin","React"],(function a(b,c,d,e,f,g,h,i){var j=c("React").createClass({displayName:"FBRTCFeedbackCompleteView",mixins:[c("FBRTCFadeInMixin")],onCallBackButtonClicked:function k(){return},onCloseButtonClicked:function k(){window.close();return},messageString:function k(){if(this.props.skipped)return i._("Your call has ended");return i._("Thank you for your feedback!")},render:function k(){return c("React").createElement("div",{className:"_1-7k"},c("React").createElement("p",{className:"_4j_k"},this.messageString()),c("React").createElement("div",null,this.props.isGroupCall?null:c("React").createElement(c("FBRTCButton.react"),{className:"_g6b",label:i._("Close Window"),messengerUI:this.props.messengerUI,onClick:this.onCloseButtonClicked,type:"primary"}),this.props.isGroupCall?null:c("React").createElement(c("FBRTCButton.react"),{className:"_g6b",label:i._("Call Back"),messengerUI:this.props.messengerUI,onClick:c("FBRTCCallControlActions").redialCall,type:"primary"})))}});f.exports=j}),null);
__d("FBRTCFeedbackView.react",["cx","fbt","FBRTCButton.react","FBRTCFadeInMixin","FBRTCFeedbackCompleteView.react","FBRTCStarRatingActions","React"],(function a(b,c,d,e,f,g,h,i){var j=c("React").createClass({displayName:"FBRTCFeedbackView",mixins:[c("FBRTCFadeInMixin")],getInitialState:function k(){return{submitted:false,skipped:false,feedbackText:""}},componentDidMount:function k(){c("FBRTCStarRatingActions").feedbackShown()},onSubmitButtonClicked:function k(){if(this.canSubmitFeedback()){this.setState({submitted:true});c("FBRTCStarRatingActions").submitFeedback(this.state.feedbackText)}},onNotNowClicked:function k(){this.setState({skipped:true,submitted:true});return},canSubmitFeedback:function k(){return this.state.feedbackText!==""},feedbackChanged:function k(l){this.setState({feedbackText:l.target.value});l.preventDefault()},render:function k(){if(this.state.submitted)return c("React").createElement(c("FBRTCFeedbackCompleteView.react"),{messengerUI:this.props.messengerUI,skipped:this.state.skipped});return c("React").createElement("div",{className:"_1-7k"},c("React").createElement("p",{className:"_4j_k"},i._("Give Feedback")),c("React").createElement("div",{className:"_4ru1"},c("React").createElement("label",{htmlFor:"fbwebrtcfeedback",className:"_4j_k _4ru2"},i._("What was the worst problem you experienced?")),c("React").createElement("textarea",{className:"_4ru3",id:"fbwebrtcfeedback",rows:"4",onChange:this.feedbackChanged,placeholder:i._("Enter your feedback")}),c("React").createElement("div",{className:"_s97"},c("React").createElement(c("FBRTCButton.react"),{className:"_g6b",label:i._("Not Now"),messengerUI:this.props.messengerUI,onClick:this.onNotNowClicked,type:"secondary"}),c("React").createElement(c("FBRTCButton.react"),{className:"_g6b",disabled:!this.canSubmitFeedback(),label:i._("Submit"),messengerUI:this.props.messengerUI,onClick:this.onSubmitButtonClicked,type:"primary"}))))}});f.exports=j}),null);
__d("FBRTCStarRatingView.react",["cx","fbt","FBRTCButton.react","FBRTCFadeInMixin","FBRTCFeedbackCompleteView.react","FBRTCFeedbackView.react","FBRTCStarRatingActions","React","StarsInput.react","VideoCallWebDriverIDs"],(function a(b,c,d,e,f,g,h,i){var j=c("React").createClass({displayName:"FBRTCStarRatingView",mixins:[c("FBRTCFadeInMixin")],getInitialState:function k(){return{rating:0,submitted:false,skipped:false,feedbackText:""}},componentDidMount:function k(){c("FBRTCStarRatingActions").ratingShown()},onCallBackButtonClicked:function k(){return},onCloseButtonClicked:function k(){window.close();return},onStarClicked:function k(l){this.setState({rating:l})},onSubmitButtonClicked:function k(){if(this.state.rating>0){this.setState({submitted:true});c("FBRTCStarRatingActions").submitRating(this.state.rating)}},onNotNowClicked:function k(){this.setState({skipped:true,submitted:true});return},getRatingString:function k(){switch(this.state.rating){case 1:return i._("Poor");case 2:return i._("Fair");case 3:return i._("Good");case 4:return i._("Very good");case 5:return i._("Excellent");default:return"---"}},shouldAskForFeedback:function k(){return this.state.rating===1&&this.state.submitted&&!this.state.skipped},render:function k(){if(this.shouldAskForFeedback())return c("React").createElement(c("FBRTCFeedbackView.react"),{messengerUI:this.props.messengerUI});else if(this.state.submitted)return c("React").createElement(c("FBRTCFeedbackCompleteView.react"),{skipped:this.state.skipped,messengerUI:this.props.messengerUI});var l=this.getRatingString();return c("React").createElement("div",{className:"_1-7k","data-testid":c("VideoCallWebDriverIDs").STAR_RATING_VIEW},c("React").createElement("p",{className:"_4j_k"},this.props.hasVideo?i._("Please rate the quality of your video call."):i._("Please rate the quality of your audio call.")),c("React").createElement("p",{className:"_4j_k _a16"},l),c("React").createElement(c("StarsInput.react"),{allowMultipleSubmissions:true,onClick:this.onStarClicked}),c("React").createElement("div",{className:"_s97"},c("React").createElement(c("FBRTCButton.react"),{className:"_g6b",label:i._("Not Now"),messengerUI:this.props.messengerUI,onClick:this.onNotNowClicked,type:"secondary"}),c("React").createElement(c("FBRTCButton.react"),{className:"_g6b",label:i._("Submit"),disabled:this.state.rating===0,messengerUI:this.props.messengerUI,onClick:this.onSubmitButtonClicked,type:"primary"})))}});f.exports=j}),null);
__d("FBRTCView.react",["cx","FBRTCBackground.react","FBRTCCallControls.react","FBRTCCallModel","FBRTCCallStateInfo.react","FBRTCConfig","FBRTCUtils","FBRTCCollabCallFeedbackView.react","FBRTCInCallView.react","FBRTCMediaAccessPrompt.react","FBRTCSelfView.react","FBRTCMediaDeniedPrompt.react","FBRTCStarRatingView.react","React","VideoCallWebDriverIDs"],(function a(b,c,d,e,f,g,h){"use strict";var i,j,k=c("React").PropTypes,l=c("React").Component;i=babelHelpers.inherits(m,l);j=i&&i.prototype;m.prototype.render=function(){var n=this.props,o=n.callModel,p=n.messengerUI,q=o.backgroundUrl(),r=o.getLocalVideoDuration()>0&&o.getRemoteVideoDuration()>0;if(c("FBRTCConfig").isVCEndpointCall()&&o.uiState===c("FBRTCCallModel").UIState.CALL_ENDED)return c("React").createElement("div",{className:this.$FBRTCView2()},c("React").createElement(c("FBRTCBackground.react"),{src:q,messengerUI:p}),this.$FBRTCView3(),c("React").createElement(c("FBRTCCollabCallFeedbackView.react"),{callModel:o,messengerUI:p}));if(o.uiState===c("FBRTCCallModel").UIState.COLLECT_RATING)return c("React").createElement("div",{className:this.$FBRTCView2()},c("React").createElement(c("FBRTCBackground.react"),babelHelpers["extends"]({messengerUI:p},{src:q})),this.$FBRTCView3(),c("React").createElement(c("FBRTCStarRatingView.react"),{hasVideo:r,messengerUI:p}));else{var s=o.localStream,t=o.remoteStream;return c("React").createElement("div",{className:this.$FBRTCView2()},c("React").createElement(c("FBRTCMediaAccessPrompt.react"),{callModel:o}),c("React").createElement(c("FBRTCMediaDeniedPrompt.react"),{callModel:o}),c("React").createElement(c("FBRTCCallStateInfo.react"),{callModel:o,messengerUI:p}),c("React").createElement(c("FBRTCBackground.react"),{src:q,messengerUI:p}),this.$FBRTCView3(),c("React").createElement(c("FBRTCInCallView.react"),{hasCallEnded:o.isEnded(),hasRemoteMediaStream:t.hasStream(),isCallConnected:o.isConnected(),isRemoteVideoMuted:!t.hasVideo(),remoteScreenStreamWrapper:o.getRemoteScreenStream(),remoteStreamWrapper:t}),this.$FBRTCView4(o),c("React").createElement(c("FBRTCCallControls.react"),{callID:o.callID.toString(),canPeerReceiveScreenSharing:o.canPeerReceiveScreenSharing(),hasAudio:s.hasAudioTracks(),hasRemoteScreenStream:o.getRemoteScreenStream()!==null,hasStream:s.hasStream(),hasVideo:s.hasVideoTracks(),isAudioMuted:!s.hasAudio(),isConnected:o.isConnected(),isEnded:o.isEnded(),isRemoteVideoSupported:o.isRemoteVideoSupported,isScreenSharingEnabled:o.isScreenSharingEnabled(),isVideoMuted:!s.hasVideo(),peerID:o.peerID,peerShortName:o.peerShortName(),showSettings:o.supportsSdpUpdate()||c("FBRTCUtils").supportsSetSink(),videoIsAutoDisabled:o.videoIsAutoDisabled()}))}};m.prototype.$FBRTCView2=function(){return"_3ref"+(this.props.messengerUI?" _17cj":"")};m.prototype.$FBRTCView3=function(){if(!this.props.messengerUI){var n="_263g _56ut";return c("React").createElement("i",{className:n,"data-testid":c("VideoCallWebDriverIDs").RTC_APP_VIEW_LOGO})}return null};m.prototype.$FBRTCView4=function(n){if(!this.props.excludeSelfView&&n.isRemoteVideoSupported&&!n.isEnded())return c("React").createElement(c("FBRTCSelfView.react"),{callModel:n});return null};m.prototype.componentDidMount=function(){var n=this.props.callModel;if(n)this.$FBRTCView1=n.addListener(function(){return this.forceUpdate()}.bind(this))};m.prototype.componentWillUnmount=function(){if(this.$FBRTCView1)this.$FBRTCView1.remove()};function m(){i.apply(this,arguments)}m.propTypes={callModel:k.instanceOf(c("FBRTCCallModel")).isRequired,messengerUI:k.bool.isRequired,excludeSelfView:k.bool};f.exports=m}),null);
__d("FBRTCApplication",["PageHooks","Bootloader","FBRTCCallController","FBRTCConfig","FBRTCLogger","FBRTCSupport","FBRTCView.react","MessengerRTCFunnelLogger","React","ReactDOM"],(function a(b,c,d,e,f,g){if(!window.PageHooks)c("PageHooks");var h={init:function i(j,k,l,m,n,o,p,q){p=p||document.getElementById("fbRTC/container");var r=c("FBRTCLogger").getInstance();r.logInfo(j,k,"Starting Call Controller");c("MessengerRTCFunnelLogger").setWindowNonce(q);c("MessengerRTCFunnelLogger").addFunnelTags([o>0?"is_multi_way":"not_multi_way",l?"caller":"callee","v1"]);document.documentElement.style.overflow="hidden";if(!c("FBRTCSupport").isWebrtcSupported()){r.logError(j,k,"Webrtc not supported");c("MessengerRTCFunnelLogger").endFunnel("unsupported_browser")}else if(c("FBRTCConfig").isVCEndpointCall()&&!c("FBRTCSupport").isCollabSupported()){r.logError(j,k,"browser not supported by collab");c("MessengerRTCFunnelLogger").endFunnel("unsupported_browser");c("Bootloader").loadModules(["FBRTCUnsupportedBrowserMessage"],function(t){t.showForUnsupportedCollabCall()},"FBRTCApplication");document.getElementById("fbRTC/scrollBox").style.display="none"}else{var s=new(c("FBRTCCallController"))(j,k,l,n,o);c("ReactDOM").render(c("React").createElement(c("FBRTCView.react"),{callModel:s.getCallModel(),messengerUI:c("FBRTCConfig").useMessengerCallUI()}),p)}}};f.exports=h}),null);