if (self.CavalryLogger) { CavalryLogger.start_js(["fmbL7"]); }

__d("RTCCallType",["keyMirror"],(function a(b,c,d,e,f,g){"use strict";var h=c("keyMirror")({AUDIO_ONLY:null,VIDEO_ONLY:null,AUDIO_VIDEO:null,NO_AUDIO_VIDEO:null});f.exports=h}),null);
__d("RTCMediaDevicesActionTypes",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({ENUMERATE_MEDIA_DEVICES:"ENUMERATE_MEDIA_DEVICES"})}),null);
__d("RTCMediaDevicesActions",["RTCGroupCallDispatcher","RTCMediaDevicesActionTypes"],(function a(b,c,d,e,f,g){"use strict";var h={enumerate:function i(j){c("RTCGroupCallDispatcher").dispatch({type:c("RTCMediaDevicesActionTypes").ENUMERATE_MEDIA_DEVICES,devices:j})}};f.exports=h}),null);
__d("RTCMediaDevicesStore",["FluxReduceStore","RTCGroupCallDispatcher","RTCMediaDevices","RTCMediaDevicesActions","RTCMediaDevicesActionTypes"],(function a(b,c,d,e,f,g){"use strict";var h,i;h=babelHelpers.inherits(j,c("FluxReduceStore"));i=h&&h.prototype;function j(){i.constructor.call(this,c("RTCGroupCallDispatcher"));this.$RTCMediaDevicesStore1();c("RTCMediaDevices").addEventListener("devicechange",this.$RTCMediaDevicesStore1)}j.prototype.$RTCMediaDevicesStore1=function(){c("RTCMediaDevices").enumerateDevices().then(function(m){return c("RTCMediaDevicesActions").enumerate(m)})["catch"](function(m){})};j.prototype.getInitialState=function(){return null};j.prototype.reduce=function(m,n){var o=n.type,p=n.devices;switch(o){case c("RTCMediaDevicesActionTypes").ENUMERATE_MEDIA_DEVICES:return[].concat(p);default:return m}};j.prototype.refresh=function(){this.$RTCMediaDevicesStore1()};j.prototype.getByLabel=function(m,n){var o=this.getState();if(!o)return null;return o.find(function(p){return p.kind===n&&p.label===m})||o.find(function(p){return p.kind===n&&l(p.label,m)})};var k=/#\d+\s(\([\da-f]{4}:[\da-f]{4}\))$|\s#\d+$/;function l(m,n){return m.replace(k,"$1")===n.replace(k,"$1")}f.exports=new j()}),null);
__d("RTCP2PCallWindowHandler",["RTCCallStore","RTCP2PCallStore","RTCP2PConstants"],(function a(b,c,d,e,f,g){"use strict";var h=c("RTCP2PConstants").ConnectionStatus,i=void 0,j={init:function k(l){if(this._isWindowOpened())this.close();i=l;this.updateCallInProgressIndicator();this._monitorOpenerForChanges()},updateCallInProgressIndicator:function k(l){if(!this._isWindowOpened())return;var m=c("RTCCallStore").getState(),n=m.remoteUsers,o=l?l:c("RTCP2PCallStore").getState().connectionStatus;if(!n.count()||o===h.DISCONNECTED)i.rtcCallInProgessWith=null;else i.rtcCallInProgessWith=n.first().FBID.toString()},reload:function k(){if(this._isWindowOpened())i.location.reload()},close:function k(){if(this._isWindowOpened())i.close()},_monitorOpenerForChanges:function k(){if(i.opener)try{i.opener.addEventListener("unload",function(event){this._passWindowToOpener()}.bind(this))}catch(l){}},_passWindowToOpener:function k(){var l=arguments.length<=0||arguments[0]===undefined?10:arguments[0];setTimeout(function(){if(!this._isWindowOpened()||l<=1)return;if(i.opener&&!i.opener.closed)i.opener.rtcCallChildWindow=i;else this._passWindowToOpener(l-1)}.bind(this),1e3)},_isWindowOpened:function k(){return!!(i&&!i.closed)}};f.exports=j}),null);
__d("RTCScreenSharingWindowHandler",["RTCP2PCallActions","RTCUtils","XScreenSharingController"],(function a(b,c,d,e,f,g){var h=960,i=540,j=void 0,k={open:function l(m,n){j=window.open("about:blank","Screen Sharing",this._getWindowFeatures());c("RTCUtils").getStreamVideoResolution(n)["catch"](function(o){this._setupScreenSharingWindow(m,n,null)}.bind(this)).done(function(o){this._setupScreenSharingWindow(m,n,o)}.bind(this))},_setupScreenSharingWindow:function l(m,n,o){var p,q=this;window.getRemoteMediaStream=function(){return n};window.closeScreenSharingWindow=this._onUnload;if(o)(function(){var r=q._getConstrainedSize(o.width,o.height),s=r.width,t=r.height;j.resizeTo(s,t);setTimeout(function(){this._adjustScreenSize({width:s,height:t})}.bind(q),200)})();j.location=this._getUnsignedUri(m);if(window.focus&&this.isWindowOpened())j.focus()},_adjustScreenSize:function l(m){if(!j)return;j.resizeTo(m.width,m.height+(m.height-j.innerHeight))},close:function l(){if(j){var m=null;if(j.opener&&!j.opener.closed)m=j.opener;j.close();j=null;if(m)m.postMessage({recipient:"SC_CONTENT_SCRIPT",type:"SC_RESET_PORT",text:"reset comm port"},"*")}},isWindowOpened:function l(){return!!(j&&!j.closed)},_onUnload:function l(){c("RTCP2PCallActions").togglePopOutScreenContent()},_getWindowFeatures:function l(){var m=screen.availLeft,n=screen.availTop,o=this._getConstrainedSize(Math.min(h,screen.width-m),Math.min(i,screen.height-n)),p=o.width,q=o.height,r={height:"height="+q.toString(),width:"width="+p.toString(),top:"top="+n.toString(),left:"left="+m.toString()};return["menubar=no","location=no","scrollbars=no","status=no","personalbar=no",r.height,r.width,r.top,r.left].join(",")},_getConstrainedSize:function l(m,n){var o=0;if(m>h){o=h/m;n*=o;m*=o}if(n>i){o=i/n;m*=o;n*=o}return{width:m,height:n}},_getUnsignedUri:function l(m){return c("XScreenSharingController").getURIBuilder().setFBID("peer_id",m).getURI()}};f.exports=k}),null);
__d("RTCP2PCallActionTypes",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({P2P_DISMISS_NUX:"P2P_DISMISS_NUX",P2P_INIT_NUX_STATE:"P2P_INIT_NUX_STATE",P2P_MARK_NUX_VIEWED:"P2P_MARK_NUX_VIEWED",P2P_PROCESS_MESSAGE:"P2P_PROCESS_MESSAGE",P2P_SET_IS_CALLER:"P2P_SET_IS_CALLER",P2P_STAR_RATING_DONE:"P2P_STAR_RATING_DONE",POP_IN_SCREEN_CONTENT:"POP_IN_SCREEN_CONTENT",POP_OUT_SCREEN_CONTENT:"POP_OUT_SCREEN_CONTENT",SET_CALL_TYPE:"SET_CALL_TYPE",SET_CONNECTION_STATUS:"SET_CONNECTION_STATUS",SET_END_CALL_REASON:"SET_END_CALL_REASON",SET_REMOTE_SIGNALING_EXPERIMENTS:"SET_REMOTE_SIGNALING_EXPERIMENTS"})}),null);
__d("RTCP2PCallActions",["RTCGroupCallDispatcher","RTCP2PCallActionTypes","RTCP2PCallWindowHandler"],(function a(b,c,d,e,f,g){"use strict";var h={reload:function i(){c("RTCP2PCallWindowHandler").reload()},setCallType:function i(j){c("RTCGroupCallDispatcher").dispatch({type:c("RTCP2PCallActionTypes").SET_CALL_TYPE,callType:j})},setConnectionStatus:function i(j){c("RTCGroupCallDispatcher").dispatch({type:c("RTCP2PCallActionTypes").SET_CONNECTION_STATUS,connectionStatus:j})},setEndCallReason:function i(j){c("RTCGroupCallDispatcher").dispatch({type:c("RTCP2PCallActionTypes").SET_END_CALL_REASON,endCallReason:j})},setRemoteSignalingExperiments:function i(j){c("RTCGroupCallDispatcher").dispatch({type:c("RTCP2PCallActionTypes").SET_REMOTE_SIGNALING_EXPERIMENTS,remoteSignalingExperiments:j})},togglePopOutScreenContent:function i(j){c("RTCGroupCallDispatcher").dispatch({type:j?c("RTCP2PCallActionTypes").POP_OUT_SCREEN_CONTENT:c("RTCP2PCallActionTypes").POP_IN_SCREEN_CONTENT,stream:j})},processMessage:function i(j){c("RTCGroupCallDispatcher").dispatch({type:c("RTCP2PCallActionTypes").P2P_PROCESS_MESSAGE,message:j})},setIsCaller:function i(j){c("RTCGroupCallDispatcher").dispatch({type:c("RTCP2PCallActionTypes").P2P_SET_IS_CALLER,isCaller:j})},starRatingDone:function i(){var j=arguments.length<=0||arguments[0]===undefined?true:arguments[0];c("RTCGroupCallDispatcher").dispatch({type:c("RTCP2PCallActionTypes").P2P_STAR_RATING_DONE,done:j})}};f.exports=h}),null);
__d("RTCP2PCallEscalationActionTypes",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({P2P_CALL_ESCALATION_ACK:"P2P_CALL_ESCALATION_ACK",P2P_CALL_ESCALATION_FAILURE:"P2P_CALL_ESCALATION_FAILURE",P2P_CALL_ESCALATION_SET_REQUEST:"P2P_CALL_ESCALATION_SET_REQUEST",P2P_CALL_ESCALATION_SET_RESPONSE:"P2P_CALL_ESCALATION_SET_RESPONSE",P2P_CALL_ESCALATION_START:"P2P_CALL_ESCALATION_START",P2P_CALL_ESCALATION_SUCCESS:"P2P_CALL_ESCALATION_SUCCESS"})}),null);
__d("RTCP2PCallEscalationStoreReducers",["RTCP2PCallEscalationActionTypes","RTCP2PCallStore"],(function a(b,c,d,e,f,g){"use strict";var h=function h(k,l){switch(l.type){case c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_START:if(k.inProgress)return k;if(k.escalated||!c("RTCP2PCallStore").isAudioOnly())return k;return k.set("awaitingACK",true).set("failureReason",null).set("inProgress",true).set("token",c("RTCP2PCallStore").getState().protocolHandler.generateEscalationRequestToken());case c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_SUCCESS:if(!k.inProgress)return k;else if("token"in l&&l.token!==k.token)return k;return k.set("awaitingACK",false).set("escalated",true).set("inProgress",false).set("request",null).set("response",true).set("token",null);case c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_FAILURE:if(!k.inProgress)return k;else if("token"in l&&l.token!==k.token)return k;return k.set("awaitingACK",false).set("escalated",false).set("failureReason",l.reason||null).set("inProgress",false).set("request",null).set("response",l.response||null).set("token",null);default:return k}},i=function i(k,l){switch(l.type){case c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_SET_REQUEST:if(l.request==null)return k;return k.set("inProgress",true).set("request",l.request).set("response",null);case c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_SET_RESPONSE:if(l.response==null)return k;else if(k.request==null)return k;return k.set("awaitingACK",true).set("response",l.response).set("token",c("RTCP2PCallStore").getState().protocolHandler.generateEscalationResponseToken(k.request,l.response));case c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_ACK:if(l.token==null)return k;if(!k.awaitingACK)return k;else if(k.response==null||k.request==null)return k;else if(l.token!==k.token)return k;return k.set("awaitingACK",false).set("escalated",k.response).set("inProgress",false).set("request",null).set("response",null).set("token",null);default:return k}},j=function j(k,l){switch(l.type){case c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_ACK:if(l.token==null)return k;if(!k.awaitingACK)return k;else if(l.token!==k.token)return k;return k.set("awaitingACK",false);default:return k}};f.exports={Alice:h,Bob:i,common:j}}),null);
__d("RTCP2PCallReducer",["RTCCallActionTypes","RTCCallStore","RTCCallType","RTCGroupCallActionTypes","RTCGroupCallDispatcher","RTCP2PCallActionTypes","RTCP2PCallEscalationActionTypes","RTCP2PCallEscalationStore","RTCP2PCallWindowHandler","RTCP2PConstants","RTCP2PProtocolHandler","RTCScreenSharingWindowHandler","RTCSignalingExperiments"],(function a(b,c,d,e,f,g){"use strict";var h=c("RTCP2PConstants").ConnectionStatus;function i(t,u){switch(u.type){case c("RTCCallActionTypes").RESET:c("RTCGroupCallDispatcher").waitFor([c("RTCCallStore").getDispatchToken()]);var v=c("RTCCallStore").getState().remoteUsers.first();if(v==null)return t;t.protocolHandler.destroy();var w=new(c("RTCP2PProtocolHandler"))();w.init(v.FBID,Number(u.conferenceName));return t.set("connectionStatus",h.INIT).set("endCallReason",null).set("protocolHandler",w).set("signalingExperiments",new(c("RTCSignalingExperiments"))());default:return t}}function j(t,u){switch(u.type){case c("RTCGroupCallActionTypes").HANGUP:case c("RTCGroupCallActionTypes").DISMISS:case c("RTCGroupCallActionTypes").HANGUP_ERROR:case c("RTCGroupCallActionTypes").HANGUP_SUCCESS:case c("RTCGroupCallActionTypes").END_CALL:case c("RTCGroupCallActionTypes").REMOVE_REMOTE_SCREEN_STREAM:case c("RTCCallActionTypes").RESET:c("RTCScreenSharingWindowHandler").close();return t.set("isScreenContentPoppedOut",c("RTCScreenSharingWindowHandler").isWindowOpened());default:return t}}function k(t,u){switch(u.type){case c("RTCP2PCallActionTypes").SET_CALL_TYPE:return t.set("callType",u.callType);case c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_SET_RESPONSE:c("RTCGroupCallDispatcher").waitFor([c("RTCP2PCallEscalationStore").getDispatchToken()]);return t.set("callType",u.response?c("RTCCallType").AUDIO_VIDEO:c("RTCCallType").AUDIO_ONLY);case c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_FAILURE:return t.set("callType",c("RTCCallType").AUDIO_ONLY);case c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_SUCCESS:return t.set("callType",c("RTCCallType").AUDIO_VIDEO);default:return t}}function l(t,u){switch(u.type){case c("RTCP2PCallActionTypes").SET_CONNECTION_STATUS:if(t.connectionStatus!==u.connectionStatus){c("RTCP2PCallWindowHandler").updateCallInProgressIndicator(u.connectionStatus);return t.set("connectionStatus",u.connectionStatus)}default:return t}}function m(t,u){switch(u.type){case c("RTCP2PCallActionTypes").SET_END_CALL_REASON:return t.set("endCallReason",u.endCallReason);default:return t}}function n(t,u){switch(u.type){case c("RTCP2PCallActionTypes").POP_IN_SCREEN_CONTENT:c("RTCScreenSharingWindowHandler").close();return t.set("isScreenContentPoppedOut",c("RTCScreenSharingWindowHandler").isWindowOpened());case c("RTCP2PCallActionTypes").POP_OUT_SCREEN_CONTENT:var v=c("RTCCallStore").getState().remoteUsers.first().FBID;c("RTCScreenSharingWindowHandler").open(v,u.stream);return t.set("isScreenContentPoppedOut",c("RTCScreenSharingWindowHandler").isWindowOpened());default:return t}}function o(t,u){switch(u.type){case c("RTCP2PCallActionTypes").SET_REMOTE_SIGNALING_EXPERIMENTS:return t.set("signalingExperiments",t.signalingExperiments.setRemote(u.remoteSignalingExperiments));default:return t}}function p(t,u){switch(u.type){case c("RTCP2PCallActionTypes").P2P_PROCESS_MESSAGE:return t.set("isRemoteVideoSupported",u.message.isRemoteVideoSupported()).set("isPeerOnMobile",u.message.isFromMobile());default:return t}}function q(t,u){switch(u.type){case c("RTCP2PCallActionTypes").P2P_SET_IS_CALLER:return t.set("isCaller",u.isCaller);default:return t}}function r(t,u){switch(u.type){case c("RTCP2PCallActionTypes").SET_CONNECTION_STATUS:if(u.connectionStatus===h.CONNECTED)return t.set("wasConnected",true);return t;case c("RTCCallActionTypes").RESET:return t.set("wasConnected",false);default:return t}}function s(t,u){switch(u.type){case c("RTCP2PCallActionTypes").P2P_STAR_RATING_DONE:return t.set("wasStarRatingDone",u.done);case c("RTCCallActionTypes").RESET:return t.set("wasStarRatingDone",false);default:return t}}f.exports={callInit:i,callEnd:j,processCallType:k,processConnectionStatus:l,processEndCallReason:m,processPoppedOutScreenContent:n,processSignalingExperiments:o,processMessage:p,processIsCaller:q,processWasConnected:r,processWasStarRatingDone:s}}),null);
__d("RTCP2PCallEscalationStoreState",["immutable"],(function a(b,c,d,e,f,g){var h,i;h=babelHelpers.inherits(j,c("immutable").Record({awaitingACK:false,escalated:false,failureReason:null,inProgress:false,request:null,response:null,token:null}));i=h&&h.prototype;function j(){"use strict";h.apply(this,arguments)}f.exports=j}),null);
__d("RTCP2PCallEscalationStore",["FBRTCConfig","FluxReduceStore","RTCGroupCallDispatcher","RTCP2PCallEscalationStoreState","RTCP2PCallEscalationStoreReducers","RTCP2PCallStore"],(function a(b,c,d,e,f,g){"use strict";var h,i,j=[c("RTCP2PCallEscalationStoreReducers").Alice,c("RTCP2PCallEscalationStoreReducers").Bob,c("RTCP2PCallEscalationStoreReducers").common];h=babelHelpers.inherits(k,c("FluxReduceStore"));i=h&&h.prototype;k.prototype.getInitialState=function(){return new(c("RTCP2PCallEscalationStoreState"))()};k.prototype.reduce=function(l,m){return j.reduce(function(l,n){return n(l,m)},l)};k.prototype.isInProgress=function(){return this.getState().inProgress};k.prototype.isEscalated=function(){return this.getState().escalated};k.prototype.isNegotiationAllowed=function(){var l=this.getState();return c("RTCP2PCallStore").getState().isPeerOnMobile||!c("FBRTCConfig").canPeerUseV2()||!l.request};k.prototype.isStarted=function(){var l=this.getState();return l.inProgress&&l.token!==null};k.prototype.getToken=function(){return this.getState().token};function k(){h.apply(this,arguments)}f.exports=new k(c("RTCGroupCallDispatcher"))}),null);
__d("RTCP2PCallAdminMessageReducers",["FBRTCAdminMessage","FBRTCCallConstants","RTCCallStore","RTCCallType","RTCP2PCallActionTypes","RTCGroupCallActionTypes","RTCGroupCallDispatcher","RTCP2PConstants"],(function a(b,c,d,e,f,g){"use strict";var h=c("FBRTCCallConstants").FBRTCCallType,i=c("RTCP2PConstants").ConnectionStatus;function j(m,n){switch(n.type){case c("RTCGroupCallActionTypes").SET_CALL_SUMMARY:c("RTCGroupCallDispatcher").waitFor([c("RTCCallStore").getDispatchToken()]);var o=c("RTCCallStore").getState(),p=o.callSummary;return m.set("adminMessage",new(c("FBRTCAdminMessage"))(p.peerID,p.callID));default:return m}}function k(m,n){switch(n.type){case c("RTCP2PCallActionTypes").SET_CONNECTION_STATUS:var o=m.adminMessage;if(o&&n.connectionStatus===i.CONNECTED)o.onCallConnected();return m;default:return m}}function l(m,n){switch(n.type){case c("RTCP2PCallActionTypes").SET_END_CALL_REASON:var o=m.adminMessage;if(o){o.onCallEnded();if(m.isCaller)o.submit(m.callType===c("RTCCallType").AUDIO_ONLY?h.VOICE_CALL:h.VIDEO_CALL,n.endCallReason.getReasonID())}return m;default:return m}}f.exports={processCallInit:j,processCallStart:k,processCallEnd:l}}),null);
__d("RTCP2PCallStore",["FluxReduceStore","RTCCallType","RTCGroupCallDispatcher","RTCP2PCallAdminMessageReducers","RTCP2PCallReducer","RTCP2PCallStoreState"],(function a(b,c,d,e,f,g){"use strict";var h,i,j=[c("RTCP2PCallReducer").callEnd,c("RTCP2PCallReducer").callInit,c("RTCP2PCallReducer").processCallType,c("RTCP2PCallReducer").processConnectionStatus,c("RTCP2PCallReducer").processEndCallReason,c("RTCP2PCallReducer").processPoppedOutScreenContent,c("RTCP2PCallReducer").processSignalingExperiments,c("RTCP2PCallReducer").processMessage,c("RTCP2PCallReducer").processIsCaller,c("RTCP2PCallReducer").processWasConnected,c("RTCP2PCallReducer").processWasStarRatingDone,c("RTCP2PCallAdminMessageReducers").processCallInit,c("RTCP2PCallAdminMessageReducers").processCallStart,c("RTCP2PCallAdminMessageReducers").processCallEnd];h=babelHelpers.inherits(k,c("FluxReduceStore"));i=h&&h.prototype;k.prototype.getInitialState=function(){return new(c("RTCP2PCallStoreState"))()};k.prototype.reduce=function(l,m){return j.reduce(function(l,n){return n(l,m)},l)};k.prototype.isAudioOnly=function(){return this.getState().callType===c("RTCCallType").AUDIO_ONLY};k.prototype.isCaller=function(){return this.getState().isCaller};function k(){h.apply(this,arguments)}f.exports=new k(c("RTCGroupCallDispatcher"))}),null);
__d("RTCP2PCallStoreState",["immutable","RTCSignalingExperiments","RTCCallType","RTCP2PConstants","RTCP2PProtocolHandler"],(function a(b,c,d,e,f,g){"use strict";var h,i,j=c("RTCP2PConstants").ConnectionStatus,k={adminMessage:null,callType:c("RTCCallType").AUDIO_ONLY,connectionStatus:j.INIT,endCallReason:null,isCaller:false,isPeerOnMobile:false,isRemoteVideoSupported:true,isScreenContentPoppedOut:false,protocolHandler:new(c("RTCP2PProtocolHandler"))(),signalingExperiments:new(c("RTCSignalingExperiments"))(),wasConnected:false,wasStarRatingDone:false};h=babelHelpers.inherits(l,c("immutable").Record(k));i=h&&h.prototype;function l(){h.apply(this,arguments)}f.exports=l}),null);
__d("RTCP2PCallEscalationActions",["RTCCallActionTypes","RTCGroupCallDispatcher","RTCP2PCallEscalationActionTypes"],(function a(b,c,d,e,f,g){"use strict";var h={start:function i(){c("RTCGroupCallDispatcher").dispatch({type:c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_START})},setRequest:function i(j){c("RTCGroupCallDispatcher").dispatch({type:c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_SET_REQUEST,request:j})},cancel:function i(){c("RTCGroupCallDispatcher").dispatch({type:c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_FAILURE,reason:"cancelled"})},timeout:function i(){c("RTCGroupCallDispatcher").dispatch({type:c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_FAILURE,reason:"timeout"})},handleACK:function i(j){c("RTCGroupCallDispatcher").dispatch({type:c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_ACK,token:j})},approve:function i(){c("RTCGroupCallDispatcher").dispatch({type:c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_SUCCESS})},setResponse:function i(j){c("RTCGroupCallDispatcher").dispatch({type:c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_SET_RESPONSE,response:j})},parseResponse:function i(j,k){if(j)c("RTCGroupCallDispatcher").dispatch({type:c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_SUCCESS,token:k});else c("RTCGroupCallDispatcher").dispatch({type:c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_FAILURE,reason:"denied",token:k,response:false})},muteRemoteVideo:function i(){c("RTCGroupCallDispatcher").dispatch({type:c("RTCCallActionTypes").REMOTE_VIDEO_MUTED})}};f.exports=h}),null);
__d("RTCP2PCallEscalator",["FBRTCConstants","RTCP2PCallEscalationStore","RTCP2PCallEscalationActions"],(function a(b,c,d,e,f,g){"use strict";var h=c("FBRTCConstants").PayloadType,i=25e3;j.isEscalated=function(){return c("RTCP2PCallEscalationStore").isEscalated()};j.isNegotiationAllowed=function(){return c("RTCP2PCallEscalationStore").isNegotiationAllowed()};function j(m,n,o){this.$RTCP2PCallEscalator3=m;this.$RTCP2PCallEscalator1=n;this.$RTCP2PCallEscalator2=o;this.$RTCP2PCallEscalator6()}j.prototype.$RTCP2PCallEscalator6=function(){var m=c("RTCP2PCallEscalationStore").getState();this.$RTCP2PCallEscalator4=c("RTCP2PCallEscalationStore").addListener(function(){var n=c("RTCP2PCallEscalationStore").getState();if(n===m)return;if(!n.awaitingACK&&n.awaitingACK!==m.awaitingACK)clearTimeout(this.$RTCP2PCallEscalator5);m=n}.bind(this))};j.prototype.destroy=function(){l("P2P Escalator %o","destroy");this.$RTCP2PCallEscalator4.remove();clearTimeout(this.$RTCP2PCallEscalator5)};j.prototype.generateRequestToken=function(){var m=c("RTCP2PCallEscalationStore").getState(),n=m.token;if(n!=null){l("P2P Escalator %o","request token","reuse");return n}l("P2P Escalator %o","request token");var o=this.$RTCP2PCallEscalator2.sendVideoEscalationRequest(this.$RTCP2PCallEscalator3,this.$RTCP2PCallEscalator1,true);clearTimeout(this.$RTCP2PCallEscalator5);this.$RTCP2PCallEscalator5=this.$RTCP2PCallEscalator7();return o.msg_id.toString()};j.prototype.generateResponseToken=function(m,n){var o=c("RTCP2PCallEscalationStore").getState(),p=o.token;if(p!=null){l("P2P Escalator %o","response token","reuse");return p}l("P2P Escalator %o %o %o","response token",n,m);var q=m.peerID,r=m.callID,s=m.msgID,t=this.$RTCP2PCallEscalator2.sendVideoRequestResponse(q,r,s,n);clearTimeout(this.$RTCP2PCallEscalator5);this.$RTCP2PCallEscalator5=this.$RTCP2PCallEscalator7();return t.msg_id.toString()};j.prototype.$RTCP2PCallEscalator7=function(){return setTimeout(c("RTCP2PCallEscalationActions").timeout,i)};j.prototype.parseMessage=function(m){l("P2P Escalator %o","parse message",this.$RTCP2PCallEscalator3,m.msgType);switch(m.msgType){case h.VIDEO_REQUEST:if(m.ackID)this.$RTCP2PCallEscalator8(m);else this.$RTCP2PCallEscalator9(m);break;case h.ACK:if(m.msg.ack_type===h.VIDEO_REQUEST)c("RTCP2PCallEscalationActions").handleACK(m.ackID.toString());break}};j.prototype.$RTCP2PCallEscalator8=function(m){l("P2P Escalator %o","parse response",m);var n=m.ackID.toString();if(c("RTCP2PCallEscalationStore").getToken()===n)this.$RTCP2PCallEscalator10(m);c("RTCP2PCallEscalationActions").parseResponse(k(m.msg),n)};j.prototype.$RTCP2PCallEscalator9=function(m){l("P2P Escalator %o","parse request",m);if(c("RTCP2PCallEscalationStore").isInProgress()){l("P2P Escalator %o","auto-approve","mutual consent");c("RTCP2PCallEscalationActions").approve();this.$RTCP2PCallEscalator10(m);this.generateResponseToken(m,true);return}if(c("RTCP2PCallEscalationStore").isEscalated()){if(k(m.msg)){l("P2P Escalator %o","auto-approve");this.$RTCP2PCallEscalator10(m);this.generateResponseToken(m,true)}else{l("P2P Escalator %o","mute remote video");c("RTCP2PCallEscalationActions").muteRemoteVideo()}return}l("P2P Escalator %o %o","request",m);this.$RTCP2PCallEscalator10(m);c("RTCP2PCallEscalationActions").setRequest(m)};j.prototype.$RTCP2PCallEscalator10=function(m){var n=m.peerID,o=m.callID,p=m.msg;l("P2P Escalator %o","ACK","sent");this.$RTCP2PCallEscalator2.sendAck(n,o,p)};j.ACK_TIMEOUT=i;function k(m){var n=m.reqVideoOn,o=m.videoon;return Boolean(n||o)}function l(){}f.exports=j}),null);
__d("XRTCCallNUXController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/rtc/call/nuxstatus/",{})}),null);
__d("RTCP2PCallNUXActions",["FBRTCUtils","RTCGroupCallDispatcher","RTCP2PCallActionTypes","XRTCCallNUXController","dangerouslyBypassDispatchError"],(function a(b,c,d,e,f,g){"use strict";var h={refreshNUXState:function i(){c("FBRTCUtils").sendServerRequest(c("XRTCCallNUXController").getURIBuilder().getURI(),function(j){var k=j.payload;c("RTCGroupCallDispatcher").dispatch({type:c("RTCP2PCallActionTypes").P2P_INIT_NUX_STATE,payload:k})},function(){})},markNUXViewed:function i(j){try{c("RTCGroupCallDispatcher").dispatch({type:c("RTCP2PCallActionTypes").P2P_MARK_NUX_VIEWED,nuxID:j})}catch(k){c("dangerouslyBypassDispatchError")(function(){return c("RTCGroupCallDispatcher").dispatch({type:c("RTCP2PCallActionTypes").P2P_MARK_NUX_VIEWED,nuxID:j})})}},dismissNUX:function i(j){c("RTCGroupCallDispatcher").dispatch({type:c("RTCP2PCallActionTypes").P2P_DISMISS_NUX,nuxID:j})}};f.exports=h}),null);
__d("RTCPeerConnectionQueue",[],(function a(b,c,d,e,f,g){"use strict";function h(){this.$RTCPeerConnectionQueue1=[];this.$RTCPeerConnectionQueue2=[]}h.prototype.push=function(i,j){switch(i){case"add":this.$RTCPeerConnectionQueue1.push(j);break;case"remove":this.$RTCPeerConnectionQueue2.push(j);break}};h.prototype.drain=function(){this.$RTCPeerConnectionQueue3(this.$RTCPeerConnectionQueue2);this.clear("remove");this.$RTCPeerConnectionQueue3(this.$RTCPeerConnectionQueue1);this.clear("add")};h.prototype.$RTCPeerConnectionQueue3=function(i){if(i.length<1)return;for(var j=i,k=Array.isArray(j),l=0,j=k?j:j[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var m;if(k){if(l>=j.length)break;m=j[l++]}else{l=j.next();if(l.done)break;m=l.value}var n=m;try{n()}catch(o){}}};h.prototype.clear=function(i){switch(i){case"add":this.$RTCPeerConnectionQueue1=[];break;case"remove":this.$RTCPeerConnectionQueue2=[];break;default:this.$RTCPeerConnectionQueue1=[];this.$RTCPeerConnectionQueue2=[]}};f.exports=h}),null);
__d("RTCP2PProtocolHandler",["invariant","Promise","Bootloader","ChannelManager","CollabCallMessengerBrowserEventEnum","ErrorUtils","FBRTCCallControlActions","FBRTCCallSummary","FBRTCCallSummaryStore","FBRTCConfig","FBRTCConstants","FBRTCIceCache","FBRTCLocalMessageQueue","FBRTCLogger","FBRTCMessage","FBRTCMessageDedup","FBRTCMessageListener","FBRTCMessageSender","FBRTCPCConfig","FBRTCPeerConnection","FBRTCRetriableMessage","FBRTCSdpUtils","FBRTCTurnDiscovery","FBRTCUrlManager","FBRTCUserSettings","FBRTCUtils","RTCCallActions","RTCCallStore","RTCConferenceState","RTCConfig","RTCEndCallReason","RTCP2PCallActions","RTCP2PCallEscalator","RTCP2PCallNUXActions","RTCP2PCallStore","RTCP2PCallWindowHandler","RTCP2PConstants","RTCPeerConnectionQueue","RTCSessionDescription","RTCUserMediaConstraints","RTCUtils","RTCStreamDurationTracker","debounce"],(function a(b,c,d,e,f,g,h){"use strict";var i=c("RTCP2PConstants").ConnectionStatus,j=c("FBRTCConstants").CallEndReason,k=c("FBRTCConstants").SignalingProtocol,l=c("FBRTCConstants").VideoQuality,m=6e4;function n(){this.$RTCP2PProtocolHandler5={streams:{}};this.$RTCP2PProtocolHandler6=c("FBRTCLogger").getInstance();this.$RTCP2PProtocolHandler8=false;this.$RTCP2PProtocolHandler9=true;this.$RTCP2PProtocolHandler10=false;this.$RTCP2PProtocolHandler11="passive";this.$RTCP2PProtocolHandler15=new(c("FBRTCIceCache"))();this.$RTCP2PProtocolHandler16=false;this.$RTCP2PProtocolHandler19=0;this.$RTCP2PProtocolHandler21=new(c("RTCStreamDurationTracker"))("video");this.$RTCP2PProtocolHandler22=new(c("RTCStreamDurationTracker"))("video");this.$RTCP2PProtocolHandler23=false;this.$RTCP2PProtocolHandler50=function(s){this.$RTCP2PProtocolHandler29(j.WEBRTC_ERROR,false,true,false,s.message);r(s)}.bind(this);this.$RTCP2PProtocolHandler37=function(s){var t=s.candidate;if(t)this.$RTCP2PProtocolHandler51(t)}.bind(this);this.$RTCP2PProtocolHandler38=function(s){var t=s.target,u=t.iceConnectionState;this.$RTCP2PProtocolHandler26(c("CollabCallMessengerBrowserEventEnum").ICE_CONNECTION_STATE_CHANGE,u);q("P2P:PC iceconnectionstatechange %o",u);clearTimeout(this.$RTCP2PProtocolHandler19);switch(u){case"checking":this.$RTCP2PProtocolHandler10=true;break;case"connected":case"completed":this.$RTCP2PProtocolHandler52();break;case"failed":this.$RTCP2PProtocolHandler19=setTimeout(function(){if(c("RTCConfig").CollaborationBrowserConfig.ICE_recovery&&c("FBRTCConfig").isVCEndpointCall()){this.$RTCP2PProtocolHandler53("ICE failure");return}this.$RTCP2PProtocolHandler50(new Error("ICE failed"));c("RTCP2PCallActions").setConnectionStatus(i.DISCONNECTED)}.bind(this),c("RTCConfig").CollaborationBrowserConfig.ICE_failed_timeout);break;case"disconnected":this.$RTCP2PProtocolHandler19=setTimeout(function(){this.$RTCP2PProtocolHandler29(j.CONNECTION_DROPPED,false,true,false)}.bind(this),c("RTCConfig").CollaborationBrowserConfig.ICE_disconnected_timeout);break;case"closed":break}}.bind(this);this.$RTCP2PProtocolHandler57=function(){var s=this.$RTCP2PProtocolHandler4.getCreatedIceCandidates();for(var t=0;t<s.length;t++)this.$RTCP2PProtocolHandler51(s[t])}.bind(this);this.$RTCP2PProtocolHandler39=function(s){var t=s.target.iceGatheringState;this.$RTCP2PProtocolHandler26(c("CollabCallMessengerBrowserEventEnum").ICE_GATHERING_STATE_CHANGE,t);q("P2P:PC icegatheringstatechange %o",t)}.bind(this);this.$RTCP2PProtocolHandler40=function(s){var t=s.errorCode,u=s.errorText,v=s.hostCandidate,w=s.url;this.$RTCP2PProtocolHandler26(c("CollabCallMessengerBrowserEventEnum").ICE_CANDIDATE_ERROR,{errorCode:t,errorText:u,hostCandidate:v,url:w});q("P2P:PC icecandidateerror %o: %s %o %o",t,u)}.bind(this);this.$RTCP2PProtocolHandler58=function(){var s=void 0;if(this.$RTCP2PProtocolHandler20)s=j.UNSUPPORTED_VERSION;else s=j.OTHER_NOT_CAPABLE;this.$RTCP2PProtocolHandler29(s,false,true,false,"TimedOut")}.bind(this);this.$RTCP2PProtocolHandler43=c("debounce")(function(s){var t=s.target;if(t.iceConnectionState==="closed"){q("P2P:PC negotiationneeded pc is %o",t.iceConnectionState);return}else if(!this.$RTCP2PProtocolHandler9){this.$RTCP2PProtocolHandler26(c("CollabCallMessengerBrowserEventEnum").RENEGOTIATION,"ignore");q("P2P:PC negotiationneeded %o","ignore");return}else if(!c("RTCP2PCallEscalator").isNegotiationAllowed()){this.$RTCP2PProtocolHandler26(c("CollabCallMessengerBrowserEventEnum").RENEGOTIATION,"not allowed - escalating");q("P2P:PC negotiationneeded %o","not allowed","escalating");return}else if(this.$RTCP2PProtocolHandler8){this.$RTCP2PProtocolHandler26(c("CollabCallMessengerBrowserEventEnum").RENEGOTIATION,"retry");q("P2P:PC SDP lock %o, will retry in a bit","on");setTimeout(function(){return this.$RTCP2PProtocolHandler43(s)}.bind(this),100);return}else q("P2P:PC SDP lock %o","off");this.$RTCP2PProtocolHandler9=false;var u=[];q("P2P:PC negotiationneeded @ signalingState %o",t.signalingState);if(t.signalingState==="stable"){if(this.$RTCP2PProtocolHandler10){var v=c("RTCP2PCallStore").getState(),w=v.signalingExperiments;if(!w.support("sdp_update")){this.$RTCP2PProtocolHandler54();u.push("new offer")}else{var x=w.support("multiple_streams_plan_b");u.push("SDP update",x?"plan B":null)}this.$RTCP2PProtocolHandler11="passive"}this.$RTCP2PProtocolHandler26(c("CollabCallMessengerBrowserEventEnum").RENEGOTIATION,"create offer");this.$RTCP2PProtocolHandler55().then(function(y){if(y.strongDiff(this.$RTCP2PProtocolHandler4.getLocalDescription())){q("P2P SDP difference %o - set offer","strong");this.$RTCP2PProtocolHandler26(c("CollabCallMessengerBrowserEventEnum").RENEGOTIATION,u);return y}q("P2P SDP difference %o - noop","weak");return null}.bind(this)).then(function(y){if(y){if(this.$RTCP2PProtocolHandler10)c("RTCP2PCallActions").setConnectionStatus(i.RECONNECTING);this.$RTCP2PProtocolHandler56(y)}this.$RTCP2PProtocolHandler11="active"}.bind(this))["catch"](this.$RTCP2PProtocolHandler50)}}.bind(this),50);this.$RTCP2PProtocolHandler44=function(s){if(this.$RTCP2PProtocolHandler23){this.$RTCP2PProtocolHandler24.push("add",function(){return this.$RTCP2PProtocolHandler44(s)}.bind(this));return}var t=s.stream,u=this.$RTCP2PProtocolHandler59(t),v=this.$RTCP2PProtocolHandler1;if(u===c("FBRTCConstants").StreamType.SCREEN_CONTENT){c("RTCCallActions").addRemoteScreenStream(t,v);if(!c("RTCP2PCallStore").getState().signalingExperiments.support("multiple_streams_plan_b")&&t.getAudioTracks().length>0)this.$RTCP2PProtocolHandler22.track(t)}else{c("FBRTCUserSettings").updateForRemoteStream(t);c("RTCCallActions").addRemoteStream(t,v);this.$RTCP2PProtocolHandler22.track(t);this.$RTCP2PProtocolHandler52()}this.$RTCP2PProtocolHandler26(c("CollabCallMessengerBrowserEventEnum").REMOTE_STREAM_ADDED,t);q("P2P:PC remote %o stream %o %o",u,"added",t)}.bind(this);this.$RTCP2PProtocolHandler45=function(s){if(this.$RTCP2PProtocolHandler23){this.$RTCP2PProtocolHandler24.push("remove",function(){return this.$RTCP2PProtocolHandler45(s)}.bind(this));return}var t=s.stream,u=this.$RTCP2PProtocolHandler59(t),v=this.$RTCP2PProtocolHandler1;if(u===c("FBRTCConstants").StreamType.SCREEN_CONTENT){c("RTCCallActions").removeRemoteScreenStream(t,v);var w=c("RTCCallStore").getState().remoteUsers.first();if(w){var x=w.streams.first();if(x)this.$RTCP2PProtocolHandler22.track(x)}}else c("RTCCallActions").removeRemoteStream(t,v);this.$RTCP2PProtocolHandler26(c("CollabCallMessengerBrowserEventEnum").REMOTE_STREAM_REMOVED,t);q("P2P:PC remote %o stream %o %o",u,"removed",t)}.bind(this);this.$RTCP2PProtocolHandler27=function(s){this.$RTCP2PProtocolHandler6.logInfo(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Received Turn Creds");this.$RTCP2PProtocolHandler26(c("CollabCallMessengerBrowserEventEnum").TURN_CREDENTIALS_RECEIVED,s);c("FBRTCPCConfig").setTurnCredentials(s)}.bind(this);this.$RTCP2PProtocolHandler28=function(){this.$RTCP2PProtocolHandler6.logError(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Failed to get turn creds");this.$RTCP2PProtocolHandler29(j.CLIENT_ERROR,false,!c("RTCP2PCallStore").isCaller(),false,"NoTurnCreds")}.bind(this);this.$RTCP2PProtocolHandler33=function(s,t){this.$RTCP2PProtocolHandler29(s,false,false,false,t)}.bind(this);this.$RTCP2PProtocolHandler32=function(s,t){var u=t.call_id;if(this.$RTCP2PProtocolHandler68()){this.$RTCP2PProtocolHandler6.logError(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Message sent after call ended: "+t.type);return}if(this.$RTCP2PProtocolHandler1!==s||this.$RTCP2PProtocolHandler2!==u)return;c("RTCCallStore").getState().callSummary.onMessageSent(t);this.$RTCP2PProtocolHandler26(c("CollabCallMessengerBrowserEventEnum").MESSAGE_SENT,t.msg_id)}.bind(this);this.$RTCP2PProtocolHandler35=function(s){var t=void 0;try{t=new(c("FBRTCMessage"))(s)}catch(u){this.$RTCP2PProtocolHandler6.logError(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Unknown data: "+JSON.stringify(s));return}this.$RTCP2PProtocolHandler6.logReceivedMessage(t.peerID,t.callID,t.msg);this.$RTCP2PProtocolHandler26(c("CollabCallMessengerBrowserEventEnum").MESSAGE_RECEIVED,t.msgID);if(this.$RTCP2PProtocolHandler68()){this.$RTCP2PProtocolHandler6.logInfo(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Ignoring message (call ended): "+t.msgID);return}if(!c("FBRTCMessageDedup").check(t.peerID,t.callID,t.msgID)){this.$RTCP2PProtocolHandler6.logInfo(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Ignoring message (duplicate): "+t.msgID);return}if(c("RTCCallStore").getState().callInfo.conferenceState===c("RTCConferenceState").AWAITING_USER_START){this.$RTCP2PProtocolHandler6.logInfo(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Ignoring message (awaiting user start): "+t.msgID);return}if(this.$RTCP2PProtocolHandler1&&this.$RTCP2PProtocolHandler1!==t.peerID){if(t.isOffer())this.$RTCP2PProtocolHandler69(t);this.$RTCP2PProtocolHandler6.logInfo(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Ignoring message (different peer): "+t.msgID);return}if(!t.isForCall(this.$RTCP2PProtocolHandler2)){this.$RTCP2PProtocolHandler6.logInfo(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Ignoring message (different call): "+t.msgID);return}if(this.$RTCP2PProtocolHandler2&&this.$RTCP2PProtocolHandler2===t.callID)c("RTCCallStore").getState().callSummary.onFullMessageReceived(t);c("RTCP2PCallActions").setRemoteSignalingExperiments(t.getSignalingExperiments());q("P2P msg.get %o %o",t.msgType,t);switch(t.msgType){case c("FBRTCConstants").PayloadType.ICERESTART_OFFER:case c("FBRTCConstants").PayloadType.PCRESTART_OFFER:this.$RTCP2PProtocolHandler54();this.$RTCP2PProtocolHandler70(t);break;case c("FBRTCConstants").PayloadType.OFFER:this.$RTCP2PProtocolHandler70(t);break;case c("FBRTCConstants").PayloadType.ANSWER:case c("FBRTCConstants").PayloadType.ICERESTART_ANSWER:case c("FBRTCConstants").PayloadType.PCRESTART_ANSWER:this.$RTCP2PProtocolHandler71(t);break;case c("FBRTCConstants").PayloadType.SDP_UPDATE:this.$RTCP2PProtocolHandler72(t);break;case c("FBRTCConstants").PayloadType.ICE_CANDIDATE:this.$RTCP2PProtocolHandler73(t);break;case c("FBRTCConstants").PayloadType.HANGUP:this.$RTCP2PProtocolHandler74(t);break;case c("FBRTCConstants").PayloadType.OFFER_ACK:this.$RTCP2PProtocolHandler75(t);break;case c("FBRTCConstants").PayloadType.OFFER_NACK:this.$RTCP2PProtocolHandler20=true;break;case c("FBRTCConstants").PayloadType.ANSWER_ACK:this.$RTCP2PProtocolHandler76();break;case c("FBRTCConstants").PayloadType.MSG_ACK:this.$RTCP2PProtocolHandler77(t);break;case c("FBRTCConstants").PayloadType.SET_VIDEO:if(c("RTCP2PCallStore").getState().isRemoteVideoSupported&&!c("RTCP2PCallStore").isAudioOnly())this.$RTCP2PProtocolHandler66(t.msg);break;case c("FBRTCConstants").PayloadType.VIDEO_REQUEST:case c("FBRTCConstants").PayloadType.ACK:case c("FBRTCConstants").PayloadType.OK:case c("FBRTCConstants").PayloadType.PING:case c("FBRTCConstants").PayloadType.PING_ACK:case c("FBRTCConstants").PayloadType.OTHER_DISMISS:case c("FBRTCConstants").PayloadType.PRANSWER:break;default:break}this.$RTCP2PProtocolHandler25.parseMessage(t);c("FBRTCCallControlActions").receivedSignalingMessage(t)}.bind(this);this.$RTCP2PProtocolHandler34=function(s){var t=s.message+"; "+s.stackFrames[0].identifier;this.$RTCP2PProtocolHandler6.logError(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"JSError: "+t)}.bind(this);c("ChannelManager").startChannelManager();this.$RTCP2PProtocolHandler26(c("CollabCallMessengerBrowserEventEnum").CALL_CONTROLLER_INIT)}n.prototype.init=function(s,t,u){this.$RTCP2PProtocolHandler1=s;this.$RTCP2PProtocolHandler2=t;if(u!=null)this.$RTCP2PProtocolHandler3=u};n.prototype.fetchTURNCredentials=function(){if(c("FBRTCConfig").isVCEndpointCall()&&c("RTCConfig").CollabDisableBrowserTurnDiscoveryGK){this.$RTCP2PProtocolHandler6.logInfo(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Skipping the TURN discovery");return c("Promise").resolve()}this.$RTCP2PProtocolHandler26(c("CollabCallMessengerBrowserEventEnum").CALL_START_TRY,"not ready");return c("FBRTCTurnDiscovery").requestTurnCreds(this.$RTCP2PProtocolHandler2.toString(),this.$RTCP2PProtocolHandler1).then(this.$RTCP2PProtocolHandler27,this.$RTCP2PProtocolHandler28)};n.prototype.endCall=function(){var s=arguments.length<=0||arguments[0]===undefined?j.HANGUP_CALL:arguments[0],t=arguments.length<=1||arguments[1]===undefined?"":arguments[1],u=arguments.length<=2||arguments[2]===undefined?false:arguments[2];c("RTCCallActions").hangup(s,t);this.$RTCP2PProtocolHandler29(s,false,true,u,t)};n.prototype.startCall=function(){this.$RTCP2PProtocolHandler26(c("CollabCallMessengerBrowserEventEnum").CALL_PROCESS_STARTED);this.$RTCP2PProtocolHandler4=this.$RTCP2PProtocolHandler30();this.$RTCP2PProtocolHandler31();this.$RTCP2PProtocolHandler24=new(c("RTCPeerConnectionQueue"))();this.$RTCP2PProtocolHandler7=new(c("FBRTCLocalMessageQueue"))();var s=c("RTCP2PCallStore").isCaller();if(!s){var t=this.$RTCP2PProtocolHandler7.getOffer(this.$RTCP2PProtocolHandler1);if(t){this.$RTCP2PProtocolHandler17=new(c("FBRTCMessage"))(t);c("FBRTCMessageDedup").check(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler17.callID,this.$RTCP2PProtocolHandler17.msgID)}else{s=true;c("RTCP2PCallActions").setIsCaller(s)}}this.$RTCP2PProtocolHandler9=s;if(this.$RTCP2PProtocolHandler17 instanceof c("FBRTCMessage"))c("RTCP2PCallActions").processMessage(this.$RTCP2PProtocolHandler17);var u=c("FBRTCCallSummary").restoreOrInitialize(c("FBRTCCallSummaryStore").getInstance(),this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,s,this.$RTCP2PProtocolHandler17&&this.$RTCP2PProtocolHandler17.msg);u.setClientVersion("2.0");u.setIsUsingMultiway(this.$RTCP2PProtocolHandler3);u.onPopupOpened();c("RTCCallActions").setCallSummary(u);c("FBRTCUrlManager").init(this.$RTCP2PProtocolHandler1);this.$RTCP2PProtocolHandler12=new(c("FBRTCMessageSender"))();this.$RTCP2PProtocolHandler12.onMessageSent=this.$RTCP2PProtocolHandler32;this.$RTCP2PProtocolHandler12.onSendFailure=this.$RTCP2PProtocolHandler33;this.$RTCP2PProtocolHandler25=new(c("RTCP2PCallEscalator"))(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,this.$RTCP2PProtocolHandler12);c("ErrorUtils").addListener(this.$RTCP2PProtocolHandler34,true);c("FBRTCMessageListener").setMessageHandler(this.$RTCP2PProtocolHandler35,this);this.$RTCP2PProtocolHandler36();c("RTCP2PCallActions").setConnectionStatus(i.CONTACTING);c("RTCCallActions").call([this.$RTCP2PProtocolHandler1],this.$RTCP2PProtocolHandler4)};n.prototype.$RTCP2PProtocolHandler30=function(){var s=new(c("FBRTCPeerConnection"))(k.P2P,c("FBRTCPCConfig").getConfig(),c("FBRTCPCConfig").getConstraints()),t=void 0,u=void 0,v=void 0,w=void 0;c("RTCCallStore").addListener(c("debounce")(function(){var x=c("RTCCallStore").getState(),y=x.localUser;if(!y||y===v)return;v=y;var z=y.isVideoMuted();if(w!==z){if(this.$RTCP2PProtocolHandler12&&w!=null)this.$RTCP2PProtocolHandler12.sendMuteStateUpdate(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,!z);w=z}var A=y.streams,B=y.screenStreams;if(A!==t||B!==u){t=A;u=B;this.$RTCP2PProtocolHandler31()}else this.$RTCP2PProtocolHandler21.update()}.bind(this),50));if(c("FBRTCConfig").isVCEndpointCall())s.createDataChannel("noop");s.addEventListener("icecandidate",this.$RTCP2PProtocolHandler37);s.addEventListener("iceconnectionstatechange",this.$RTCP2PProtocolHandler38);s.addEventListener("icegatheringstatechange",this.$RTCP2PProtocolHandler39);s.addEventListener("icecandidateerror",this.$RTCP2PProtocolHandler40);s.addEventListener("connectionstatechange",this.$RTCP2PProtocolHandler41);s.addEventListener("signalingstatechange",this.$RTCP2PProtocolHandler42);s.addEventListener("negotiationneeded",this.$RTCP2PProtocolHandler43);s.addEventListener("addstream",this.$RTCP2PProtocolHandler44);s.addEventListener("removestream",this.$RTCP2PProtocolHandler45);s.addEventListener("datachannel",this.$RTCP2PProtocolHandler46);this.$RTCP2PProtocolHandler47(s);return s};n.prototype.$RTCP2PProtocolHandler31=function(){if(this.$RTCP2PProtocolHandler4.getSignalingState()==="closed")return;var s=c("RTCCallStore").getState(),t=s.localUser;if(!t)return;var u=this.$RTCP2PProtocolHandler4.getLocalStreams(),v=t.streams.first(),w=t.screenStreams.first();if(c("RTCP2PCallStore").getState().signalingExperiments.support("multiple_streams_plan_b")){if(w&&!u.includes(w))this.$RTCP2PProtocolHandler48(w);if(v){if(!u.includes(v))this.$RTCP2PProtocolHandler48(v);this.$RTCP2PProtocolHandler21.track(v)}for(var x=u,y=Array.isArray(x),z=0,x=y?x:x[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var A;if(y){if(z>=x.length)break;A=x[z++]}else{z=x.next();if(z.done)break;A=z.value}var B=A;if(B!==w&&B!==v)this.$RTCP2PProtocolHandler49(B)}}else{var C=w||v;if(w){for(var D=w.getAudioTracks(),E=Array.isArray(D),F=0,D=E?D:D[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var G;if(E){if(F>=D.length)break;G=D[F++]}else{F=D.next();if(F.done)break;G=F.value}var H=G;w.removeTrack(H)}if(v){for(var I=v.getAudioTracks(),J=Array.isArray(I),K=0,I=J?I:I[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var L;if(J){if(K>=I.length)break;L=I[K++]}else{K=I.next();if(K.done)break;L=K.value}var M=L;w.addTrack(M)}this.$RTCP2PProtocolHandler48(w);this.$RTCP2PProtocolHandler21.track(w)}else this.$RTCP2PProtocolHandler48(w)}else if(v){if(!u.includes(v))this.$RTCP2PProtocolHandler48(v);this.$RTCP2PProtocolHandler21.track(v)}for(var N=u,O=Array.isArray(N),P=0,N=O?N:N[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var Q;if(O){if(P>=N.length)break;Q=N[P++]}else{P=N.next();if(P.done)break;Q=P.value}var R=Q;if(R!==C)this.$RTCP2PProtocolHandler49(R)}}};n.prototype.$RTCP2PProtocolHandler48=function(s){this.$RTCP2PProtocolHandler9=true;this.$RTCP2PProtocolHandler4.addStream(s)};n.prototype.$RTCP2PProtocolHandler49=function(s){this.$RTCP2PProtocolHandler9=true;this.$RTCP2PProtocolHandler4.removeStream(s);c("RTCUtils").stopMediaStream(s)};n.prototype.$RTCP2PProtocolHandler53=function(s){this.$RTCP2PProtocolHandler8=true;this.$RTCP2PProtocolHandler9=false;this.$RTCP2PProtocolHandler11="passive";this.$RTCP2PProtocolHandler54();q("P2P:PC recovering from %o",s);this.$RTCP2PProtocolHandler26(c("CollabCallMessengerBrowserEventEnum").CONNECTION_RECOVERY,s);this.$RTCP2PProtocolHandler55().then(function(t){c("RTCP2PCallActions").setConnectionStatus(i.RECONNECTING);this.$RTCP2PProtocolHandler56(t);this.$RTCP2PProtocolHandler11="active"}.bind(this))["catch"](this.$RTCP2PProtocolHandler50)};n.prototype.$RTCP2PProtocolHandler55=function(){return this.$RTCP2PProtocolHandler4.createOffer({offerToReceiveAudio:true,offerToReceiveVideo:!c("RTCP2PCallStore").isAudioOnly()})};n.prototype.$RTCP2PProtocolHandler51=function(s){this.$RTCP2PProtocolHandler12.sendIceCandidate(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,s)};n.prototype.$RTCP2PProtocolHandler41=function(s){var t=s.target;q("P2P:PC connectionstatechange %o",t.connectionState)};n.prototype.$RTCP2PProtocolHandler42=function(s){var t=s.target;q("P2P:PC signalingstatechange %o",t.signalingState)};n.prototype.$RTCP2PProtocolHandler54=function(){this.$RTCP2PProtocolHandler9=false;var s=this.$RTCP2PProtocolHandler1,t=c("RTCCallStore").getState().remoteUsers.first(),u=t.streams,v=t.screenStreams;this.$RTCP2PProtocolHandler23=true;this.$RTCP2PProtocolHandler24.clear("add");this.$RTCP2PProtocolHandler24.push("remove",function(){for(var w=u,x=Array.isArray(w),y=0,w=x?w:w[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var z;if(x){if(y>=w.length)break;z=w[y++]}else{y=w.next();if(y.done)break;z=y.value}var A=z;c("RTCCallActions").removeRemoteStream(A,s)}for(var B=v,C=Array.isArray(B),D=0,B=C?B:B[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var E;if(C){if(D>=B.length)break;E=B[D++]}else{D=B.next();if(D.done)break;E=D.value}var F=E;c("RTCCallActions").removeRemoteScreenStream(F,s)}});this.$RTCP2PProtocolHandler4.reset().then(function(){this.$RTCP2PProtocolHandler23=false;this.$RTCP2PProtocolHandler24.drain()}.bind(this))["catch"](r);if(c("FBRTCConfig").isVCEndpointCall())this.$RTCP2PProtocolHandler4.createDataChannel("noop")};n.prototype.$RTCP2PProtocolHandler59=function(s){var t=c("FBRTCConstants").StreamType;try{switch(this.$RTCP2PProtocolHandler5.streams[s.id].type){case t.SCREEN_CONTENT:return t.SCREEN_CONTENT;case t.AUDIO_VIDEO:return t.AUDIO_VIDEO;case t.AUDIO_ONLY:return t.AUDIO_ONLY;default:throw Error("no known stream type found, detecting")}}catch(u){return s.getVideoTracks().length>0?t.AUDIO_VIDEO:t.AUDIO_ONLY}};n.prototype.$RTCP2PProtocolHandler52=function(){this.$RTCP2PProtocolHandler21.isStarted()?this.$RTCP2PProtocolHandler21.update():this.$RTCP2PProtocolHandler21.start();this.$RTCP2PProtocolHandler22.isStarted()?this.$RTCP2PProtocolHandler22.update():this.$RTCP2PProtocolHandler22.start();c("RTCP2PCallActions").setConnectionStatus(i.CONNECTED);var s=c("RTCCallStore").getState(),t=s.callSummary;t.onCallConnected();t.onNetworkReady();t.save(c("FBRTCCallSummaryStore").getInstance())};n.prototype.$RTCP2PProtocolHandler46=function(s){var t=s.channel;q("P2P:PC datachannel %o",t)};n.initStream=function(s,t,u){return c("RTCUtils").getUserMedia({audio:c("RTCUserMediaConstraints").audio(t||""),video:s?babelHelpers["extends"]({aspectRatio:{exact:Number((16/9).toFixed(10))}},p(c("RTCUserMediaConstraints").video(l.HD_VIDEO,u||""))):false})};n.replaceLocalStream=function(s){var t=c("RTCCallStore").getState().localUser.streams.first();c("RTCCallActions").replaceLocalStream(t,s)};n.prototype.$RTCP2PProtocolHandler36=function(){c("FBRTCUrlManager").onCallStarted();q("P2P start call offer %o",this.$RTCP2PProtocolHandler17);if(this.$RTCP2PProtocolHandler17){this.$RTCP2PProtocolHandler8=true;this.$RTCP2PProtocolHandler9=false;var s=this.$RTCP2PProtocolHandler17.msg,t=s.sdp,u=s.attributes;c("RTCP2PCallActions").setRemoteSignalingExperiments(this.$RTCP2PProtocolHandler17.getSignalingExperiments());this.$RTCP2PProtocolHandler60(t,"offer",u);this.$RTCP2PProtocolHandler7.removeOffer(this.$RTCP2PProtocolHandler1);this.$RTCP2PProtocolHandler17=null}this.$RTCP2PProtocolHandler26(c("CollabCallMessengerBrowserEventEnum").CALL_START_TRY)};n.prototype.$RTCP2PProtocolHandler56=function(s){q("P2P SDP %o created %o",s.type,s);this.$RTCP2PProtocolHandler8=true;return this.$RTCP2PProtocolHandler4.setLocalDescription(s).then(function(t){return t.toDesc()}).then(function(t){var u=t.sdp,v=t.type;q("P2P SDP %o set %o",v,{sdp:u});switch(v){case"offer":if(c("RTCP2PCallStore").getState().signalingExperiments.support("sdp_update"))this.$RTCP2PProtocolHandler61(u);else this.$RTCP2PProtocolHandler62(u);break;case"answer":this.$RTCP2PProtocolHandler63(u);break;default:break}}.bind(this))["catch"](this.$RTCP2PProtocolHandler50)};n.prototype.$RTCP2PProtocolHandler64=function(){return{streams:this.$RTCP2PProtocolHandler65()}};n.prototype.$RTCP2PProtocolHandler65=function(){var s={},t=c("RTCCallStore").getState(),u=t.localUser.screenStreams;for(var v=this.$RTCP2PProtocolHandler4.getLocalStreams(),w=Array.isArray(v),x=0,v=w?v:v[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var y;if(w){if(x>=v.length)break;y=v[x++]}else{x=v.next();if(x.done)break;y=x.value}var z=y,A=u.includes(z)?c("FBRTCConstants").StreamType.SCREEN_CONTENT:z.getVideoTracks().length?c("FBRTCConstants").StreamType.AUDIO_VIDEO:c("FBRTCConstants").StreamType.AUDIO_ONLY;s[z.id]={type:A}}return s};n.prototype.$RTCP2PProtocolHandler61=function(s){var t=c("RTCCallStore").getState(),u=t.localUser;this.$RTCP2PProtocolHandler12.sendSdpUpdate(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,s,!c("RTCP2PCallStore").isAudioOnly()&&!u.isVideoMuted(),this.$RTCP2PProtocolHandler64())};n.prototype.$RTCP2PProtocolHandler62=function(s){var t=this.$RTCP2PProtocolHandler10?c("FBRTCConstants").PayloadType.PCRESTART_OFFER:c("FBRTCConstants").PayloadType.OFFER;q("P2P offer type %o",t);this.$RTCP2PProtocolHandler13=new(c("FBRTCRetriableMessage"))(this.$RTCP2PProtocolHandler12);this.$RTCP2PProtocolHandler13.addListener("sendingRetry",this.$RTCP2PProtocolHandler57);this.$RTCP2PProtocolHandler13.addListener("timeoutFailure",this.$RTCP2PProtocolHandler58);this.$RTCP2PProtocolHandler13.sendMessage(t,this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,s,!c("RTCP2PCallStore").isAudioOnly(),this.$RTCP2PProtocolHandler64());this.$RTCP2PProtocolHandler18=setTimeout(function(){this.$RTCP2PProtocolHandler29(j.NO_ANSWER_TIMEOUT,false,true,false)}.bind(this),m)};n.prototype.$RTCP2PProtocolHandler66=function(s){if(!Object.prototype.hasOwnProperty.call(s,"videoon"))return;var t=!s.videoon;c("RTCCallActions").toggleMuteRemoteVideo(t,this.$RTCP2PProtocolHandler1);for(var u=this.$RTCP2PProtocolHandler4.getRemoteStreams(),v=Array.isArray(u),w=0,u=v?u:u[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var x;if(v){if(w>=u.length)break;x=u[w++]}else{w=u.next();if(w.done)break;x=w.value}var y=x;if(y.getAudioTracks().length>0){this.$RTCP2PProtocolHandler26(c("CollabCallMessengerBrowserEventEnum").REMOTE_STREAM_MUTE_TOGGLED,y);return}}this.$RTCP2PProtocolHandler22.update()};n.prototype.$RTCP2PProtocolHandler63=function(s){this.$RTCP2PProtocolHandler14=new(c("FBRTCRetriableMessage"))(this.$RTCP2PProtocolHandler12);this.$RTCP2PProtocolHandler14.addListener("sendingRetry",this.$RTCP2PProtocolHandler57);this.$RTCP2PProtocolHandler14.sendMessage(c("FBRTCConstants").PayloadType.ANSWER,this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,s,!c("RTCP2PCallStore").isAudioOnly(),this.$RTCP2PProtocolHandler64())};n.prototype.$RTCP2PProtocolHandler67=function(r){this.$RTCP2PProtocolHandler29(j.WEBRTC_ERROR,false,true,false,r.endCallSubreason);this.$RTCP2PProtocolHandler6.logError(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"webrtc error: "+JSON.stringify(r.details));this.$RTCP2PProtocolHandler26(c("CollabCallMessengerBrowserEventEnum").RTC_ERROR,r.details)};n.prototype.$RTCP2PProtocolHandler69=function(s){var t=s.peerID,u=s.callID,v=s.msg,w=new(c("FBRTCCallSummary"))({peerID:t,callID:u,isCaller:false});w.setClientVersion("2.0");w.setIsUsingMultiway(this.$RTCP2PProtocolHandler3);w.onFullMessageReceived(s);this.$RTCP2PProtocolHandler12.sendOfferAck(t,u,v);w.onOfferAckSent(v);var x=new(c("RTCEndCallReason"))(j.IN_ANOTHER_CALL);this.$RTCP2PProtocolHandler78(t,u,x,false);w.onCallEnded(x.getReasonID(),false);w.save(c("FBRTCCallSummaryStore").getInstance())};n.prototype.$RTCP2PProtocolHandler70=function(s){q("P2P handle %o","offer");var t=this.$RTCP2PProtocolHandler4.getSignalingState();if(t!=="stable"){q("P2P ignore %o; wrong signaling state: %o","offer",t);return}var u=s.msg;if(u.calltype){this.$RTCP2PProtocolHandler12.sendOfferNack(this.$RTCP2PProtocolHandler1,u.call_id,u);return}this.$RTCP2PProtocolHandler12.sendOfferAck(this.$RTCP2PProtocolHandler1,u.call_id,u);this.$RTCP2PProtocolHandler12.sendOtherDismiss(u.call_id);if(this.$RTCP2PProtocolHandler79(u))this.$RTCP2PProtocolHandler80(s);else this.$RTCP2PProtocolHandler81(s)};n.prototype.$RTCP2PProtocolHandler80=function(s){var t=s.msg;this.$RTCP2PProtocolHandler66(t);this.$RTCP2PProtocolHandler82();this.$RTCP2PProtocolHandler83();this.$RTCP2PProtocolHandler84();if(this.$RTCP2PProtocolHandler2!==t.call_id){var u=new(c("RTCEndCallReason"))(j.OTHER_INSTANCE_HANDLED);this.$RTCP2PProtocolHandler78(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,u,false);var v=c("RTCCallStore").getState(),w=v.callSummary;w.onCallEnded(u.getReasonID(),false);w.save(c("FBRTCCallSummaryStore").getInstance());var x=new(c("FBRTCCallSummary"))({peerID:this.$RTCP2PProtocolHandler1,callID:t.call_id,isCaller:false});x.setClientVersion("2.0");x.setIsUsingMultiway(this.$RTCP2PProtocolHandler3);x.onFullMessageReceived(s);x.onOfferAckSent(t);c("RTCCallActions").setCallSummary(x);this.$RTCP2PProtocolHandler6.logEvent(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Handling offer collision")}else this.$RTCP2PProtocolHandler6.logEvent(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Handling offer refresh");this.$RTCP2PProtocolHandler16=false;this.$RTCP2PProtocolHandler17=s;c("RTCP2PCallActions").processMessage(s);this.$RTCP2PProtocolHandler36();this.$RTCP2PProtocolHandler26(c("CollabCallMessengerBrowserEventEnum").OFFER_ACCEPTED,s.msgID)};n.prototype.$RTCP2PProtocolHandler81=function(s){q("P2P:PC ignoring offer %o",s);this.$RTCP2PProtocolHandler6.logEvent(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Ignoring offer");this.$RTCP2PProtocolHandler26(c("CollabCallMessengerBrowserEventEnum").OFFER_IGNORED,s.msgID)};n.prototype.$RTCP2PProtocolHandler72=function(s){var t=s.msg;this.$RTCP2PProtocolHandler66(t);switch(this.$RTCP2PProtocolHandler4.getSignalingState()){case"stable":this.$RTCP2PProtocolHandler60(t.sdp,"offer",t.attributes);break;case"have-local-offer":var u=c("RTCP2PCallStore").getState().isPeerOnMobile&&!c("RTCP2PCallStore").isCaller()?"passive":this.$RTCP2PProtocolHandler11;this.$RTCP2PProtocolHandler60(c("FBRTCSdpUtils").setDtlsRole(t.sdp,u),"answer",t.attributes).then(function(){return this.$RTCP2PProtocolHandler85()}.bind(this))["catch"](this.$RTCP2PProtocolHandler50);break;case"have-remote-offer":setTimeout(function(){return this.$RTCP2PProtocolHandler72(s)}.bind(this),1e3);break;case"have-local-pranswer":case"have-remote-pranswer":q("P2P SDP update unexpected signalingState %o",this.$RTCP2PProtocolHandler4.getSignalingState());break;case"closed":break}this.$RTCP2PProtocolHandler26(c("CollabCallMessengerBrowserEventEnum").SDP_UPDATE,[t.sdp,t.attributes])};n.prototype.$RTCP2PProtocolHandler85=function(){this.$RTCP2PProtocolHandler8=false};n.prototype.$RTCP2PProtocolHandler60=function(s,t,u){q("P2P SDP %o update %o %o",t,{sdp:s},u);this.$RTCP2PProtocolHandler86(u);return this.$RTCP2PProtocolHandler4.setRemoteDescription(new(c("RTCSessionDescription"))(k.P2P,{type:t,sdp:s},{USE_DTLS_OVER_CRYPTO:c("RTCP2PCallStore").getState().isPeerOnMobile})).then(function(){q("P2P drain remote ICE");this.$RTCP2PProtocolHandler16=true;this.$RTCP2PProtocolHandler15.drainCandidates(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,function(v){return this.$RTCP2PProtocolHandler4.onReceivedRemoteIceCandidate(v)}.bind(this))}.bind(this)).then(function(){if(t!=="offer")return null;return this.$RTCP2PProtocolHandler4.createAnswer().then(function(v){this.$RTCP2PProtocolHandler56(v);this.$RTCP2PProtocolHandler26(c("CollabCallMessengerBrowserEventEnum").SDP_UPDATE,{answer:v.toSdp()})}.bind(this))}.bind(this))["catch"](this.$RTCP2PProtocolHandler50)};n.prototype.$RTCP2PProtocolHandler86=function(s){var t,u=this;if(s)(function(){var v=s.streams;u.$RTCP2PProtocolHandler5=babelHelpers["extends"]({},u.$RTCP2PProtocolHandler5,s,{streams:babelHelpers["extends"]({},u.$RTCP2PProtocolHandler5.streams,v)});Object.keys(v).some(function(w){if(v[w].type===c("FBRTCConstants").StreamType.SCREEN_CONTENT){c("RTCCallActions").removeAllLocalScreenStreams(true);return true}return false})})()};n.prototype.$RTCP2PProtocolHandler79=function(s){if(s.call_id===this.$RTCP2PProtocolHandler2)return true;return Boolean((this.$RTCP2PProtocolHandler18||!this.$RTCP2PProtocolHandler17)&&(!this.$RTCP2PProtocolHandler2||s.call_id!==this.$RTCP2PProtocolHandler2)&&c("RTCP2PCallStore").isCaller()&&(!s.handlescollision||s.call_id<this.$RTCP2PProtocolHandler2))};n.prototype.$RTCP2PProtocolHandler71=function(s){q("P2P handle %o","answer");var t=this.$RTCP2PProtocolHandler4.getSignalingState();if(t!=="have-local-offer"){q("P2P ignore %o; wrong signaling state: %o","answer",t);return}var u=s.msg;this.$RTCP2PProtocolHandler82();this.$RTCP2PProtocolHandler83();this.$RTCP2PProtocolHandler12.sendAnswerAck(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,u);c("RTCP2PCallActions").processMessage(s);c("RTCP2PCallActions").setConnectionStatus(i.CONNECTING);this.$RTCP2PProtocolHandler60(u.sdp,"answer",u.attributes).then(function(){this.$RTCP2PProtocolHandler85();c("RTCCallActions").callSuccess(true)}.bind(this))["catch"](this.$RTCP2PProtocolHandler50);this.$RTCP2PProtocolHandler66(u)};n.prototype.$RTCP2PProtocolHandler77=function(s){var t=s.msg,u=c("RTCCallStore").getState(),v=u.callSummary;if(this.$RTCP2PProtocolHandler13&&this.$RTCP2PProtocolHandler13.isAckMsg(t)){v.onMsgAckReceived(s,true);this.$RTCP2PProtocolHandler75(s)}else if(this.$RTCP2PProtocolHandler14&&this.$RTCP2PProtocolHandler14.isAckMsg(t)){v.onMsgAckReceived(s,false);this.$RTCP2PProtocolHandler76()}};n.prototype.$RTCP2PProtocolHandler75=function(s){var t=c("RTCCallStore").getState(),u=t.callSummary;c("RTCP2PCallActions").setConnectionStatus(i.RINGING);u.setUploadLogLevel(c("FBRTCUtils").getUploadLogLevel(c("FBRTCConstants").convertToUploadLogLevel(s.msg.ull)));u.save(c("FBRTCCallSummaryStore").getInstance());this.$RTCP2PProtocolHandler82()};n.prototype.$RTCP2PProtocolHandler76=function(){this.$RTCP2PProtocolHandler84();this.$RTCP2PProtocolHandler85();c("RTCCallActions").incomingCallSuccess()};n.prototype.$RTCP2PProtocolHandler73=function(s){var t=s.msg;if(t.call_id===this.$RTCP2PProtocolHandler2&&this.$RTCP2PProtocolHandler16)this.$RTCP2PProtocolHandler4.onReceivedRemoteIceCandidate(t);else this.$RTCP2PProtocolHandler15.cacheCandidate(this.$RTCP2PProtocolHandler1,t.call_id,t)};n.prototype.$RTCP2PProtocolHandler74=function(s){var t=s.msg,u=t.call_id,v=t.reason,w=t.subreason;if(u===this.$RTCP2PProtocolHandler2)this.$RTCP2PProtocolHandler29(v,true,false,false,w);else{this.$RTCP2PProtocolHandler6.logError(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Receiving hangup for a different call: "+u.toString());this.$RTCP2PProtocolHandler26(c("CollabCallMessengerBrowserEventEnum").HANGUP_CALL_ID_MISSMATCH,u.toString())}};n.prototype.$RTCP2PProtocolHandler29=function(s,t,u,v,w){var x=new(c("RTCEndCallReason"))(s).setSubreason(w).setRemoteEnded(t);c("RTCP2PCallActions").setEndCallReason(x);c("RTCP2PCallNUXActions").refreshNUXState();this.$RTCP2PProtocolHandler6.logCallAction(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,c("FBRTCLogger").CallAction.END_CALL,x.toStrName());this.$RTCP2PProtocolHandler82();this.$RTCP2PProtocolHandler83();this.$RTCP2PProtocolHandler84();if(this.$RTCP2PProtocolHandler68()){this.$RTCP2PProtocolHandler6.logError(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Ending an already-ended call");return}if(u)this.$RTCP2PProtocolHandler78(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,x,v);this.$RTCP2PProtocolHandler21.stop();this.$RTCP2PProtocolHandler22.stop();this.$RTCP2PProtocolHandler4.close();c("RTCCallActions").hangupSuccess();c("RTCCallActions").removeAllLocalStreams(true);c("RTCCallActions").removeAllLocalScreenStreams(true);c("RTCP2PCallActions").setConnectionStatus(i.DISCONNECTED);var y=c("RTCCallStore").getState(),z=y.callSummary;z.setCallType("voip");z.setVideoDurations(this.$RTCP2PProtocolHandler21.getDuration(),this.$RTCP2PProtocolHandler22.getDuration());z.onCallEnded(x.getReasonID(),t,null,x.getSubreason());z.save(c("FBRTCCallSummaryStore").getInstance());this.$RTCP2PProtocolHandler26(c("CollabCallMessengerBrowserEventEnum").CALL_ENDED,{reason:x.toStrName(),reasonID:x.getReasonID(),subReason:x.getSubreason(),isRemoteEnded:t});if(x.getReasonID()===j.HANGUP_CALL&&x.getSubreason()==="CallReset"&&t)c("RTCP2PCallWindowHandler").close()};n.prototype.$RTCP2PProtocolHandler78=function(s,t,u,v){this.$RTCP2PProtocolHandler12.sendHangup(s,t,u.getReasonID(),v,u.getSubreason());this.$RTCP2PProtocolHandler12.sendOtherDismiss(t)};n.prototype.$RTCP2PProtocolHandler82=function(){if(this.$RTCP2PProtocolHandler13)this.$RTCP2PProtocolHandler13.stopRetrying()};n.prototype.$RTCP2PProtocolHandler84=function(){if(this.$RTCP2PProtocolHandler14)this.$RTCP2PProtocolHandler14.stopRetrying()};n.prototype.$RTCP2PProtocolHandler83=function(){if(this.$RTCP2PProtocolHandler18)clearTimeout(this.$RTCP2PProtocolHandler18);this.$RTCP2PProtocolHandler18=null};n.prototype.$RTCP2PProtocolHandler68=function(){return c("RTCCallStore").getState().callInfo.conferenceState===c("RTCConferenceState").TERMINATED};n.prototype.$RTCP2PProtocolHandler47=function(s){o(function(t){var u=t.logConnectionStats(function(){var z=s.getSignalingState();return z!=="closed"?s.getStats():c("Promise").reject("peer connection closed")},this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2),v=u.start,w=u.stop,x=function(z){var A=z.target,B=A.iceConnectionState;if(B==="completed"||B==="connected"){q("P2P collab stats %o","start");this.$RTCP2PProtocolHandler6.logInfo(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Call Connected");this.$RTCP2PProtocolHandler26(c("CollabCallMessengerBrowserEventEnum").CALL_CONNECTED);v();s.removeEventListener("iceconnectionstatechange",x);s.addEventListener("iceconnectionstatechange",y)}}.bind(this),y=function y(z){var A=z.target,B=A.iceConnectionState;if(B==="closed"){q("P2P collab stats %o","stop");w();s.removeEventListener("iceconnectionstatechange",y)}};s.addEventListener("iceconnectionstatechange",x)}.bind(this))};n.prototype.$RTCP2PProtocolHandler26=function(event,s){o(function(t){return t.log(event,{peerID:this.$RTCP2PProtocolHandler1,callID:this.$RTCP2PProtocolHandler2,eventDetails:s})}.bind(this))};n.prototype.destroy=function(){q("P2P %o","destroy()");this.$RTCP2PProtocolHandler24.clear();c("FBRTCMessageListener").removeMessageHandler();this.$RTCP2PProtocolHandler12.onMessageSent=null;this.$RTCP2PProtocolHandler12.onSendFailure=null};n.prototype.generateEscalationRequestToken=function(){return this.$RTCP2PProtocolHandler25.generateRequestToken()};n.prototype.generateEscalationResponseToken=function(s,t){return this.$RTCP2PProtocolHandler25.generateResponseToken(s,t)};function o(s){if(!c("FBRTCConfig").isVCEndpointCall())return;c("Bootloader").loadModules(["CollabMessengerLogger"],s,"RTCP2PProtocolHandler")}function p(s){s instanceof Object||h(0);return s}function q(){}function r(){}f.exports=n}),null);
__d("RTCP2PCallNUXIDs",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({RTC_P2P_REMOTE_STREAMS_SLIDER_NUX:4773,RTC_P2P_REMOTE_SCREEN_CONTENT_POP_OUT_NUX:4774,RTC_P2P_REMOTE_CAMERA_CONTROLS_NUX:4775,RTC_P2P_SETTINGS_NUX:4776})}),null);
__d("RTCP2PCallNUXReducer",["FBRTCUtils","RTCP2PCallActionTypes","RTCP2PCallNUXIDs","XBasicFBNuxDismissController","XBasicFBNuxViewController"],(function a(b,c,d,e,f,g){"use strict";function h(k,l){switch(l.type){case c("RTCP2PCallActionTypes").P2P_DISMISS_NUX:var m=c("XBasicFBNuxDismissController").getURIBuilder().setInt("nux_id",l.nuxID).getURI();c("FBRTCUtils").sendServerRequest(m);switch(l.nuxID){case c("RTCP2PCallNUXIDs").RTC_P2P_REMOTE_CAMERA_CONTROLS_NUX:return k.set("showRemoteCameraControlsNUX",false);case c("RTCP2PCallNUXIDs").RTC_P2P_REMOTE_SCREEN_CONTENT_POP_OUT_NUX:return k.set("showRemoteScreenContentPopOutNUX",false);case c("RTCP2PCallNUXIDs").RTC_P2P_REMOTE_STREAMS_SLIDER_NUX:return k.set("showRemoteStreamsSliderNUX",false);case c("RTCP2PCallNUXIDs").RTC_P2P_SETTINGS_NUX:return k.set("showSettingsNUX",false);default:return k}default:return k}}function i(k,l){switch(l.type){case c("RTCP2PCallActionTypes").P2P_INIT_NUX_STATE:var m=l.payload;return k.set("showRemoteCameraControlsNUX",m.showRemoteCameraControlsNUX).set("showRemoteScreenContentPopOutNUX",m.showRemoteScreenContentPopOutNUX).set("showRemoteStreamsSliderNUX",m.showRemoteStreamsSliderNUX).set("showSettingsNUX",m.showSettingsNUX);default:return k}}function j(k,l){switch(l.type){case c("RTCP2PCallActionTypes").P2P_MARK_NUX_VIEWED:var m=c("XBasicFBNuxViewController").getURIBuilder().setInt("nux_id",l.nuxID).getURI();c("FBRTCUtils").sendServerRequest(m);return k;default:return k}}f.exports={dismissNUX:h,markNUXViewed:j,refreshNUXState:i}}),null);
__d("RTCP2PCallNUXStoreState",["immutable"],(function a(b,c,d,e,f,g){"use strict";var h,i,j={showRemoteCameraControlsNUX:false,showRemoteScreenContentPopOutNUX:false,showRemoteStreamsSliderNUX:false,showSettingsNUX:false};h=babelHelpers.inherits(k,c("immutable").Record(j));i=h&&h.prototype;function k(){h.apply(this,arguments)}f.exports=k}),null);
__d("RTCP2PCallNUXStore",["FluxReduceStore","RTCGroupCallDispatcher","RTCP2PCallNUXActions","RTCP2PCallNUXReducer","RTCP2PCallNUXStoreState"],(function a(b,c,d,e,f,g){"use strict";var h,i,j=[c("RTCP2PCallNUXReducer").dismissNUX,c("RTCP2PCallNUXReducer").markNUXViewed,c("RTCP2PCallNUXReducer").refreshNUXState];h=babelHelpers.inherits(k,c("FluxReduceStore"));i=h&&h.prototype;function k(){i.constructor.call(this,c("RTCGroupCallDispatcher"));c("RTCP2PCallNUXActions").refreshNUXState()}k.prototype.getInitialState=function(){return new(c("RTCP2PCallNUXStoreState"))()};k.prototype.reduce=function(l,m){return j.reduce(function(l,n){return n(l,m)},l)};f.exports=new k()}),null);
__d("RTCP2PIncallView.react",["cx","fbt","FluxContainer","React","RTCGroupCallDispatcher","RTCIncallAudio.react","RTCIncallVideo.react","RTCP2PCallNUXActions","RTCP2PCallNUXIDs","RTCP2PCallNUXStore","VideoCallWebDriverIDs","XUIAmbientNUX.react"],(function a(b,c,d,e,f,g,h,i){"use strict";var j,k,l=c("React").PureComponent;j=babelHelpers.inherits(m,l);k=j&&j.prototype;m.getStores=function(){return[c("RTCP2PCallNUXStore")]};m.calculateState=function(){var n=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];return babelHelpers["extends"]({},n,{showNux:c("RTCP2PCallNUXStore").getState().showRemoteStreamsSliderNUX})};function m(n){k.constructor.call(this,n);this.state=m.calculateState({ratio:.5,resizing:false});this.$RTCP2PIncallView11=function(){document.addEventListener("keypress",this.$RTCP2PIncallView15)}.bind(this);this.$RTCP2PIncallView12=function(){document.removeEventListener("keypress",this.$RTCP2PIncallView15)}.bind(this);this.$RTCP2PIncallView15=function(o){var p=o.key,q=this.state.ratio;switch(p){case"ArrowLeft":this.$RTCP2PIncallView16(q-.025);break;case"ArrowRight":this.$RTCP2PIncallView16(q+.025);break;case"Escape":this.$RTCP2PIncallView13();break}}.bind(this);this.$RTCP2PIncallView13=function(){this.setState({ratio:.5})}.bind(this);this.$RTCP2PIncallView10=function(o){var p=o.clientX;if(!this.$RTCP2PIncallView1)return;this.$RTCP2PIncallView3=this.$RTCP2PIncallView1.offsetLeft;this.$RTCP2PIncallView4=this.$RTCP2PIncallView1.offsetWidth;this.setState({resizing:true},function(){return this.$RTCP2PIncallView17({clientX:p})}.bind(this));document.addEventListener("mousemove",this.$RTCP2PIncallView17);document.addEventListener("mouseup",this.$RTCP2PIncallView18);if(this.state.showNux)this.$RTCP2PIncallView19()}.bind(this);this.$RTCP2PIncallView17=function(o){var p=o.clientX;if(!this.state.resizing)return;this.$RTCP2PIncallView16((p-this.$RTCP2PIncallView3)/this.$RTCP2PIncallView4)}.bind(this);this.$RTCP2PIncallView18=function(){this.$RTCP2PIncallView20();this.setState({resizing:false})}.bind(this);this.$RTCP2PIncallView14=function(o){this.$RTCP2PIncallView2=o&&o.getDOMNode?o.getDOMNode():o}.bind(this);c("RTCGroupCallDispatcher").explicitlyRegisterStores([c("RTCP2PCallNUXStore")])}m.prototype.render=function(){var n=this.props.user;if(!n)return null;var o=n.streams,p=n.screenStreams;if(this.props.isAudioCall)return c("React").createElement("section",{className:"_1b9s"+(this.state.resizing?" resizing":""),ref:function(r){return this.$RTCP2PIncallView1=r}.bind(this)},this.props.children,c("React").createElement("div",{className:"_1b9t"},this.$RTCP2PIncallView5(o),this.$RTCP2PIncallView5(p)));var q=!(o.isEmpty()||p.isEmpty()||!this.props.renderScreenStreams);return c("React").createElement("section",{className:"_1b9s"+(this.state.resizing?" resizing":""),ref:function(r){return this.$RTCP2PIncallView1=r}.bind(this)},this.props.children,this.$RTCP2PIncallView6(p,q),this.$RTCP2PIncallView7(q),this.$RTCP2PIncallView8(q),this.$RTCP2PIncallView9(o,q,n.isVideoMuted()))};m.prototype.$RTCP2PIncallView5=function(n){var o=this.props.audioSinkID;return n.toArray().map(function(p,q){return c("React").createElement(c("RTCIncallAudio.react"),babelHelpers["extends"]({key:q},{audioSinkID:o,mediaStream:p}))})};m.prototype.$RTCP2PIncallView7=function(n){if(!n)return null;return c("React").createElement("div",{className:"_1b9u",onMouseDown:this.$RTCP2PIncallView10,onFocus:this.$RTCP2PIncallView11,onBlur:this.$RTCP2PIncallView12,onDoubleClick:this.$RTCP2PIncallView13,ref:this.$RTCP2PIncallView14,tabIndex:0})};m.prototype.$RTCP2PIncallView16=function(n){this.setState({ratio:Math.min(.85,Math.max(.15,n))})};m.prototype.$RTCP2PIncallView20=function(){document.removeEventListener("mousemove",this.$RTCP2PIncallView17);document.removeEventListener("mouseup",this.$RTCP2PIncallView18)};m.prototype.$RTCP2PIncallView19=function(){c("RTCP2PCallNUXActions").dismissNUX(c("RTCP2PCallNUXIDs").RTC_P2P_REMOTE_STREAMS_SLIDER_NUX)};m.prototype.$RTCP2PIncallView8=function(n){if(!this.state.showNux||!n||!this.$RTCP2PIncallView1)return null;var o=(this.$RTCP2PIncallView1.clientHeight-32)/2,p=i._("Control the size of the video and shared content by dragging the slider");c("RTCP2PCallNUXActions").markNUXViewed(c("RTCP2PCallNUXIDs").RTC_P2P_REMOTE_STREAMS_SLIDER_NUX);return c("React").createElement(c("XUIAmbientNUX.react"),{alignment:"left",contextRef:function(){return this.$RTCP2PIncallView2}.bind(this),customwidth:250,offsetY:o,onCloseButtonClick:this.$RTCP2PIncallView19,position:"right",shown:this.state.showNux,width:"custom"},p)};m.prototype.$RTCP2PIncallView6=function(n,o){if(n.isEmpty()||!this.props.renderScreenStreams)return null;var p=this.props.audioSinkID,q=o?{flexGrow:this.state.ratio}:null;return c("React").createElement("div",{className:"_1b9t",style:q},n.toArray().map(function(r,s){return c("React").createElement(c("RTCIncallVideo.react"),babelHelpers["extends"]({key:s},{audioSinkID:p,mediaStream:r}))}))};m.prototype.$RTCP2PIncallView9=function(n,o,p){if(n.isEmpty())return null;var q=this.props.audioSinkID,r=o?{flexGrow:1-this.state.ratio}:null;return c("React").createElement("div",{className:"_1b9t","data-testid":c("VideoCallWebDriverIDs").INCALL_VIDEO_CONTAINER,style:r},n.toArray().map(function(s,t){return s.getVideoTracks().length>0?c("React").createElement(c("RTCIncallVideo.react"),babelHelpers["extends"]({key:t},{audioSinkID:q,mediaStream:s,muted:p})):c("React").createElement(c("RTCIncallAudio.react"),babelHelpers["extends"]({key:t},{audioSinkID:q,mediaStream:s}))}))};m.prototype.componentWillReceiveProps=function(n){var o=n.user;if(o!==this.props.user)this.$RTCP2PIncallView13()};m.prototype.componentWillUnmount=function(){this.$RTCP2PIncallView20();document.removeEventListener("keypress",this.$RTCP2PIncallView15)};m.defaultProps={renderScreenStreams:true};f.exports=c("FluxContainer").create(m)}),null);
__d("RTCPeerInfo.react",["cx","fbt","Image.react","React","joinClasses"],(function a(b,c,d,e,f,g,h,i){"use strict";var j=function j(k){var l=k.children,m=k.className,n=k.peer,o=k.showName,p=o===undefined?true:o,q=babelHelpers.objectWithoutProperties(k,["children","className","peer","showName"]);return c("React").createElement("div",babelHelpers["extends"]({className:c("joinClasses")(m,"_dzr")},q),c("React").createElement(c("Image.react"),{className:"_dzs",src:n.profilePictureUrl,alt:i._("Profile picture")}),p?c("React").createElement("p",{className:"_dzt"},n.userName):null)};f.exports=j}),null);
__d("RTCRingBackTone.react",["RTCConfig","React","Sound"],(function a(b,c,d,e,f,g){"use strict";var h,i,j=c("React").Component,k=[c("RTCConfig").ringback_mp3_url,c("RTCConfig").ringback_ogg_url];h=babelHelpers.inherits(l,j);i=h&&h.prototype;function l(){var m,n;for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return n=(m=i.constructor).call.apply(m,[this].concat(p)),this.$RTCRingBackTone1=false,n}l.prototype.render=function(){return null};l.prototype.componentDidMount=function(){this.$RTCRingBackTone2(this.props.active,this.props.conferenceName)};l.prototype.shouldComponentUpdate=function(){return false};l.prototype.componentWillReceiveProps=function(m){var n=m.active,o=m.conferenceName;if(n===this.props.active)return;this.$RTCRingBackTone2(n,o)};l.prototype.$RTCRingBackTone2=function(m,n){if(m){if(!this.$RTCRingBackTone1){this.$RTCRingBackTone1=true;c("Sound").play(k,"ring_back_"+n,true)}}else this.$RTCRingBackTone3()};l.prototype.$RTCRingBackTone3=function(){if(this.$RTCRingBackTone1){this.$RTCRingBackTone1=false;c("Sound").stop(k)}};l.prototype.componentWillUnmount=function(){this.$RTCRingBackTone3()};l.defaultProps={active:false};f.exports=l}),null);
__d("RTCUserSettingsActionTypes",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({USER_SETTINGS_CANCEL_EDITING:"USER_SETTINGS_CANCEL_EDITING",USER_SETTINGS_EDIT:"USER_SETTINGS_EDIT",USER_SETTINGS_SAVE:"USER_SETTINGS_SAVE",USER_SETTINGS_SET_AUDIO_INPUT:"USER_SETTINGS_SET_AUDIO_INPUT",USER_SETTINGS_SET_AUDIO_OUTPUT:"USER_SETTINGS_SET_AUDIO_OUTPUT",USER_SETTINGS_SET_VIDEO_INPUT:"USER_SETTINGS_SET_VIDEO_INPUT"})}),null);
__d("RTCUserSettingsReducers",["RTCGroupCallActionTypes","RTCMediaDevicesStore","RTCUserSettingsActionTypes"],(function a(b,c,d,e,f,g){function h(k,l){switch(l.type){case c("RTCUserSettingsActionTypes").USER_SETTINGS_EDIT:return k.set("editing",true);case c("RTCUserSettingsActionTypes").USER_SETTINGS_CANCEL_EDITING:return k.set("editing",false);case c("RTCUserSettingsActionTypes").USER_SETTINGS_SAVE:return k.set("audioInput",l.audioInput).set("audioOutput",l.audioOutput).set("editing",false).set("videoInput",l.videoInput);case c("RTCUserSettingsActionTypes").USER_SETTINGS_SET_AUDIO_INPUT:return k.set("audioInput",l.audioInput);case c("RTCUserSettingsActionTypes").USER_SETTINGS_SET_AUDIO_OUTPUT:return k.set("audioOutput",l.audioOutput);case c("RTCUserSettingsActionTypes").USER_SETTINGS_SET_VIDEO_INPUT:return k.set("videoInput",l.videoInput);default:return k}}function i(k,l){switch(l.type){case c("RTCGroupCallActionTypes").ADD_LOCAL_STREAM:return k.set("audioInput",j(l.stream.getAudioTracks()[0],"audioinput")||k.audioInput).set("videoInput",j(l.stream.getVideoTracks()[0],"videoinput")||k.videoInput);default:return k}}function j(k,l){if(!k)return null;var m=c("RTCMediaDevicesStore").getByLabel(k.label,l);return m?m.deviceId:null}f.exports={activelySetSettings:h,passivelySetSettings:i}}),null);
__d("RTCUserSettingsStoreState",["immutable"],(function a(b,c,d,e,f,g){"use strict";var h,i;h=babelHelpers.inherits(j,c("immutable").Record({audioInput:null,audioOutput:null,editing:false,videoInput:null}));i=h&&h.prototype;function j(){h.apply(this,arguments)}f.exports=j}),null);
__d("RTCUserSettingsStore",["FluxReduceStore","RTCGroupCallDispatcher","RTCUserSettingsStoreState","RTCUserSettingsReducers"],(function a(b,c,d,e,f,g){"use strict";var h,i,j=[c("RTCUserSettingsReducers").activelySetSettings,c("RTCUserSettingsReducers").passivelySetSettings];h=babelHelpers.inherits(k,c("FluxReduceStore"));i=h&&h.prototype;function k(){i.constructor.call(this,c("RTCGroupCallDispatcher"))}k.prototype.getInitialState=function(){return new(c("RTCUserSettingsStoreState"))()};k.prototype.reduce=function(l,m){return j.reduce(function(l,n){return n(l,m)},l)};f.exports=new k()}),null);
__d("RTCP2PAppViewContent.react",["cx","fbt","FBRTCConfig","FBRTCConstants","FluxContainer","React","RTCAppSpinner.react","RTCAppViewMain.react","RTCCallConnectionStatus.react","RTCCallStateInfo.react","RTCConferenceState","RTCGroupCallDispatcher","RTCP2PIncallView.react","RTCP2PCallActions","RTCP2PCallEscalationStore","RTCP2PCallStore","RTCP2PConstants","RTCPeerInfo.react","RTCRingBackTone.react","RTCStarRating.react","RTCTextButton.react","RTCUserSettingsStore","VideoCallWebDriverIDs"],(function a(b,c,d,e,f,g,h,i){"use strict";var j,k,l=c("FBRTCConstants").CallEndReason,m=c("RTCP2PConstants").ConnectionStatus,n=c("React").PureComponent;j=babelHelpers.inherits(o,n);k=j&&j.prototype;o.getStores=function(){return[c("RTCP2PCallEscalationStore"),c("RTCP2PCallStore"),c("RTCUserSettingsStore")]};o.calculateState=function(){var r=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],s=c("RTCP2PCallEscalationStore").getState(),t=c("RTCP2PCallStore").getState(),u=t.wasConnected,v=t.wasStarRatingDone,w=c("RTCUserSettingsStore").getState(),x=w.audioOutput;return babelHelpers["extends"]({},r,{audioOutput:x,awaitingEscalationACK:s.awaitingACK,escalationInProgress:s.inProgress,escalationRequest:Boolean(s.request),wasConnected:u,wasStarRatingDone:v})};function o(r){k.constructor.call(this,r);this.state=o.calculateState();c("RTCGroupCallDispatcher").explicitlyRegisterStores([c("RTCP2PCallEscalationStore"),c("RTCUserSettingsStore")])}o.prototype.render=function(){var r=this.props,s=r.conferenceState,t=r.connectionStatus,u=r.endCallReason,v=r.isAudioCall,w=r.isScreenContentPoppedOut,x=r.remoteUser,y=this.state,z=y.wasConnected,A=y.wasStarRatingDone;if(!x)return c("React").createElement(c("RTCAppViewMain.react"),{fullBleed:true},c("React").createElement(c("RTCAppSpinner.react"),null));switch(s){case c("RTCConferenceState").NEW:return c("React").createElement(c("RTCAppViewMain.react"),{fullBleed:false},c("React").createElement(c("RTCCallStateInfo.react"),null,c("React").createElement(c("RTCPeerInfo.react"),{peer:x}),c("React").createElement(c("RTCAppSpinner.react"),null)));case c("RTCConferenceState").AWAITING_USER_START:return c("React").createElement(c("RTCAppViewMain.react"),{fullBleed:false},c("React").createElement(c("RTCCallStateInfo.react"),null,c("React").createElement(c("RTCPeerInfo.react"),{peer:x}),c("React").createElement(c("RTCCallConnectionStatus.react"),null,i._("Ready to call?")),c("React").createElement(c("RTCTextButton.react"),{className:"green _2fst","data-testid":c("VideoCallWebDriverIDs").RTC_APP_VIEW_START_CALL_BUTTON,label:i._("Start Call"),onClick:p})));case c("RTCConferenceState").CONNECTING:case c("RTCConferenceState").CONNECTED:return c("React").createElement(c("RTCAppViewMain.react"),{fullBleed:!v},c("React").createElement(c("RTCP2PIncallView.react"),babelHelpers["extends"]({audioSinkID:this.state.audioOutput,renderScreenStreams:!w,user:x},{isAudioCall:v}),c("React").createElement(c("RTCCallStateInfo.react"),{className:!v?"_2fsu":""},c("React").createElement(c("RTCPeerInfo.react"),{peer:x}),c("React").createElement(c("RTCCallConnectionStatus.react"),{connectionStatus:t},this.$RTCP2PAppViewContent1()))),this.$RTCP2PAppViewContent2())}if(!A&&z&&(!u||u.getReasonID()===l.HANGUP_CALL))return c("React").createElement(c("RTCAppViewMain.react"),{fullBleed:false},c("React").createElement(c("RTCStarRating.react"),babelHelpers["extends"]({isGroupCall:false,onDone:q},{isAudioCall:v})));else return c("React").createElement(c("RTCAppViewMain.react"),{fullBleed:false},c("React").createElement(c("RTCCallStateInfo.react"),null,c("React").createElement(c("RTCPeerInfo.react"),{peer:x}),c("React").createElement(c("RTCCallConnectionStatus.react"),{connectionStatus:t},u?u.toString(c("FBRTCConfig").isVCEndpointCall()):null)))};o.prototype.$RTCP2PAppViewContent1=function(){if(this.state.escalationRequest){if(this.state.awaitingEscalationACK)return i._("Sending response...");return i._("Would like to video chat...")}if(this.state.escalationInProgress)return i._("Requesting video...");return null};o.prototype.$RTCP2PAppViewContent2=function(){if(this.props.conferenceState===c("RTCConferenceState").CONNECTING)return c("React").createElement(c("RTCRingBackTone.react"),{active:this.props.connectionStatus===m.RINGING,conferenceName:this.props.conferenceName});return null};function p(){c("RTCP2PCallStore").getState().protocolHandler.startCall()}function q(){c("RTCP2PCallActions").starRatingDone(true)}f.exports=c("FluxContainer").create(o)}),null);
__d("RTCCallControlsEscalationAcceptButton.react",["cx","React","RTCCallControlsButton.react","joinClasses"],(function a(b,c,d,e,f,g,h){"use strict";var i,j,k=c("React").PureComponent;i=babelHelpers.inherits(l,k);j=i&&i.prototype;l.prototype.render=function(){var m=this.props,n=m.className,o=babelHelpers.objectWithoutProperties(m,["className"]);return c("React").createElement(c("RTCCallControlsButton.react"),babelHelpers["extends"]({className:c("joinClasses")(n,"opaque redial icon-48")},o),c("React").createElement("svg",{viewBox:"0 0 48 48"},c("React").createElement("path",{d:"M26 17H15c-1.126 0-2 .938-2 2v10c0 1.062.874 2 2 2h11 c1.126 0 2-.938 2-2V19c0-1.062-.874-2-2-2zm10 12h1V19h-1v10z m-6-2.727L35 29V19l-5 2.727v4.546z",fillRule:"evenodd"})))};function l(){i.apply(this,arguments)}f.exports=l}),null);
__d("RTCCallControlsEscalationDeclineButton.react",["cx","React","RTCCallControlsButton.react","joinClasses"],(function a(b,c,d,e,f,g,h){"use strict";var i,j,k=c("React").PureComponent;i=babelHelpers.inherits(l,k);j=i&&i.prototype;l.prototype.render=function(){var m=this.props,n=m.className,o=babelHelpers.objectWithoutProperties(m,["className"]);return c("React").createElement(c("RTCCallControlsButton.react"),babelHelpers["extends"]({className:c("joinClasses")(n,"icon-48 closeWindow")},o),c("React").createElement("svg",{viewBox:"0 0 48 48"},c("React").createElement("path",{d:"M24 25.4l-4.9 4.9c-.4 .4-1 .4-1.4 0c-.4-.4-.4-1 0-1.4L22.6 24 L17.6 19.1c-.4-.4-.4-1 0-1.4c.4-.4 1-.4 1.4 0L24 22.6l4.9-4.9 c.4-.4 1-.4 1.4 0c.4 .4 .4 1 0 1.4L25.4 24l4.9 4.9c.4 .4 .4 1 0 1.4c-.4 .4-1 .4-1.4 0L24 25.4z"})))};function l(){i.apply(this,arguments)}f.exports=l}),null);
__d("RTCDialogList.react",["React"],(function a(b,c,d,e,f,g){"use strict";var h,i;h=babelHelpers.inherits(j,c("React").Component);i=h&&h.prototype;j.prototype.render=function(){return c("React").createElement("ul",null,this.props.children)};function j(){h.apply(this,arguments)}f.exports=j}),null);
__d("RTCDialogListItem.react",["cx","React","joinClasses"],(function a(b,c,d,e,f,g,h){"use strict";var i,j;i=babelHelpers.inherits(k,c("React").Component);j=i&&i.prototype;k.prototype.render=function(){var l=c("joinClasses")("_4gtz",this.props.className);return c("React").createElement("li",babelHelpers["extends"]({onClick:this.props.onClick},{className:l}),this.props.children)};function k(){i.apply(this,arguments)}f.exports=k}),null);
__d("RTCInstallExtensionDialog.react",["cx","fbt","Bootloader","CollabCallMessengerBrowserEventEnum","LinkshimCallsites","LinkshimLink.react","React","RTCDialog.react","RTCDialogBody.react","RTCDialogHeader.react","RTCDialogHeaderButton.react","RTCCallStore","ScreenSharingWebDriverIDs","URI"],(function a(b,c,d,e,f,g,h,i){"use strict";var j,k,l=c("React").PureComponent,m="https://chrome.google.com/webstore/detail/degmgkchmbgaognjjlhggmhbcpicdifm";j=babelHelpers.inherits(n,l);k=j&&j.prototype;function n(){var o,p;for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return p=(o=k.constructor).call.apply(o,[this].concat(r)),this.$RTCInstallExtensionDialog4=function(){this.props.onToggle(false)}.bind(this),this.$RTCInstallExtensionDialog5=function(){this.props.onResetCallClick();this.props.onToggle(true)}.bind(this),this.$RTCInstallExtensionDialog6=function(){this.$RTCInstallExtensionDialog1(c("CollabCallMessengerBrowserEventEnum").SCREEN_SHARING_EXT_LINK)}.bind(this),p}n.prototype.componentDidMount=function(){this.$RTCInstallExtensionDialog1(c("CollabCallMessengerBrowserEventEnum").SCREEN_SHARING_EXT_DIALOG)};n.prototype.render=function(){return c("React").createElement(c("RTCDialog.react"),{onToggle:this.props.onToggle,width:544,layerHideOnBlur:false},this.$RTCInstallExtensionDialog2(),this.$RTCInstallExtensionDialog3())};n.prototype.$RTCInstallExtensionDialog2=function(){return c("React").createElement(c("RTCDialogHeader.react"),null,c("React").createElement("h1",{className:"_10mm"},i._("Install Screen Sharing Extension")),c("React").createElement(c("RTCDialogHeaderButton.react"),{label:i._("Cancel"),onClick:this.$RTCInstallExtensionDialog4}),c("React").createElement(c("RTCDialogHeaderButton.react"),{label:i._("Call Again"),onClick:this.$RTCInstallExtensionDialog5}))};n.prototype.$RTCInstallExtensionDialog3=function(){return c("React").createElement(c("RTCDialogBody.react"),{"data-testid":c("ScreenSharingWebDriverIDs").INSTALL_EXT_DIALOG},c("React").createElement("div",null,c("React").createElement("p",{className:"_2gx8"},i._("To share your screen, you'll need to install an extension. Then you can return here to start your call again.")),c("React").createElement(c("LinkshimLink.react"),{callsite:c("LinkshimCallsites").THIRD_PARTY_URL,className:"_2gx9",onClick:this.$RTCInstallExtensionDialog6,target:"_blank",uri:new(c("URI"))(m)},i._("Install screen sharing extension"))))};n.prototype.$RTCInstallExtensionDialog1=function(event){c("Bootloader").loadModules(["CollabMessengerLogger"],function(o){var p=c("RTCCallStore").getState(),q=p.localUser,r=p.callInfo;o.log(event,{peerID:q.FBID,callID:r.conferenceName})},"RTCInstallExtensionDialog.react")};f.exports=n}),null);
__d("RTCUnsupportedBrowserDialog.react",["cx","fbt","ix","FBRTCVersionDetection","Image.react","Link.react","Layout.react","React","RTCDialog.react","RTCDialogBody.react","RTCDialogHeader.react","RTCDialogHeaderButton.react","XUIText.react"],(function a(b,c,d,e,f,g,h,i,j){"use strict";var k,l,m=c("Layout.react").Column,n=c("React").PureComponent;k=babelHelpers.inherits(o,n);l=k&&k.prototype;function o(){var p,q;for(var r=arguments.length,s=Array(r),t=0;t<r;t++)s[t]=arguments[t];return q=(p=l.constructor).call.apply(p,[this].concat(s)),this.$RTCUnsupportedBrowserDialog3=function(){this.props.onToggle(false)}.bind(this),q}o.prototype.render=function(){return c("React").createElement(c("RTCDialog.react"),{onToggle:this.props.onToggle,width:544,layerHideOnBlur:false},this.$RTCUnsupportedBrowserDialog1(),this.$RTCUnsupportedBrowserDialog2())};o.prototype.$RTCUnsupportedBrowserDialog1=function(){var p=null;if(c("FBRTCVersionDetection").isChrome())p=i._("Update browser to share your screen");else p=i._("Switch browsers to share your screen");return c("React").createElement(c("RTCDialogHeader.react"),null,c("React").createElement("h1",{className:"_10mm"},p),c("React").createElement(c("RTCDialogHeaderButton.react"),{label:i._("Cancel"),onClick:this.$RTCUnsupportedBrowserDialog3}))};o.prototype.$RTCUnsupportedBrowserDialog2=function(){var p=c("FBRTCVersionDetection").isChrome()?this.$RTCUnsupportedBrowserDialog4():this.$RTCUnsupportedBrowserDialog5();return c("React").createElement(c("RTCDialogBody.react"),null,c("React").createElement("div",null,c("React").createElement("p",{className:"_2gx8"},p),this.$RTCUnsupportedBrowserDialog6()))};o.prototype.$RTCUnsupportedBrowserDialog4=function(){return i._("Screen sharing doesn't work in the older version of Google Chrome that you're using. To share your screen, please update Google Chrome.")};o.prototype.$RTCUnsupportedBrowserDialog5=function(){if(c("FBRTCVersionDetection").isFirefox())return i._("Screen sharing doesn't work in Mozilla Firefox yet. To share your screen, please open Facebook in Google Chrome.");else return i._("Screen sharing doesn't work in your browser yet. To share your screen, please open Facebook in Google Chrome.")};o.prototype.$RTCUnsupportedBrowserDialog6=function(){return c("React").createElement(c("Layout.react"),null,c("React").createElement(m,{style:{width:"100%",textAlign:"center"}},c("React").createElement(c("Link.react"),{href:"https://www.google.com/chrome/index.html",target:"_blank"},c("React").createElement(c("Image.react"),{className:"_4_if",src:j("28180"),alt:"Chrome",width:"64"}),c("React").createElement(c("XUIText.react"),{display:"block"},"Google Chrome"))))};f.exports=o}),null);
__d("RTCCallControlsToggleScreenSharingButton.react",["cx","fbt","Promise","Bootloader","CollabCallMessengerBrowserEventEnum","CollabRTCChromeScreenSharingExtension","React","RTCCallActions","RTCCallControlsButton.react","RTCCallStore","RTCDialog.react","RTCDialogList.react","RTCDialogListItem.react","RTCInstallExtensionDialog.react","RTCScreenSharing","RTCUnsupportedBrowserDialog.react","RTCUtils","ScreenSharingWebDriverIDs","joinClasses"],(function a(b,c,d,e,f,g,h,i){"use strict";var j,k,l=c("React").PropTypes,m=c("React").PureComponent;j=babelHelpers.inherits(n,m);k=j&&j.prototype;function n(){var o,p;for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return p=(o=k.constructor).call.apply(o,[this].concat(r)),this.$RTCCallControlsToggleScreenSharingButton2=function(){var t=this.context;if(t&&t.dialogHide)t.dialogHide();c("RTCUtils").initLocalScreenStream().then(function(u){return this.$RTCCallControlsToggleScreenSharingButton3().then(function(v){return u})}.bind(this)).then(function(u){c("RTCCallActions").addLocalScreenStream(u);this.$RTCCallControlsToggleScreenSharingButton4(c("CollabCallMessengerBrowserEventEnum").SCREEN_SHARING_TOGGLED,"status: enabled");return c("Promise").all(u.getVideoTracks().map(function(v){return new(c("Promise"))(function(w){v.addEventListener("ended",w)})})).then(function(){return c("RTCCallActions").removeLocalScreenStream(u)})}.bind(this))["catch"](function(u){var t=this.context;if(t&&t.dialogShow&&t.dialogHide){t.dialogHide();switch(u.message||u){case c("CollabRTCChromeScreenSharingExtension").EXTENSION_NOT_FOUND:case"notPermitted":t.dialogShow(c("React").createElement(c("RTCInstallExtensionDialog.react"),{onResetCallClick:this.$RTCCallControlsToggleScreenSharingButton5,onToggle:t.dialogHide}));break;case c("RTCScreenSharing").SCREEN_SHARING_NOT_SUPPORTED:t.dialogShow(c("React").createElement(c("RTCUnsupportedBrowserDialog.react"),{onToggle:t.dialogHide}));break}}}.bind(this))}.bind(this),this.$RTCCallControlsToggleScreenSharingButton5=function(){var t=this.props.onResetCallClick;if(t)t()}.bind(this),this.$RTCCallControlsToggleScreenSharingButton3=function(){var t=this.props.screenStream;if(!t)return c("Promise").resolve();c("RTCCallActions").removeLocalScreenStream(t);for(var u=t.getVideoTracks(),v=Array.isArray(u),w=0,u=v?u:u[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var x;if(v){if(w>=u.length)break;x=u[w++]}else{w=u.next();if(w.done)break;x=w.value}var y=x;y.stop()}var z=this.context;if(z&&z.dialogHide)z.dialogHide();this.$RTCCallControlsToggleScreenSharingButton4(c("CollabCallMessengerBrowserEventEnum").SCREEN_SHARING_TOGGLED,"status: disabled");return c("RTCScreenSharing").stop()}.bind(this),this.$RTCCallControlsToggleScreenSharingButton1=function(){var t,u=this,v=i._("Share a Different Window"),w=i._("Stop Screen Sharing"),x=i._("Cancel");if(this.props.highlighted){var t=function(){var y=u.context;if(y&&y.dialogShow)y.dialogShow(c("React").createElement(c("RTCDialog.react"),{onToggle:y.dialogHide,width:350,className:"_1z6a"},c("React").createElement(c("RTCDialogList.react"),null,c("React").createElement(c("RTCDialogListItem.react"),{onClick:u.$RTCCallControlsToggleScreenSharingButton2},v),c("React").createElement(c("RTCDialogListItem.react"),{className:"_1z6b",onClick:u.$RTCCallControlsToggleScreenSharingButton3},w),c("React").createElement(c("RTCDialogListItem.react"),{onClick:function z(){return y.dialogHide()}},x))));return{v:void 0}}();if(typeof t==="object")return t.v}this.$RTCCallControlsToggleScreenSharingButton2()}.bind(this),p}n.prototype.render=function(){var o=this.props,p=o.className,q=o.highlighted,r=o.onClick,s=babelHelpers.objectWithoutProperties(o,["className","highlighted","onClick"]),t=q?i._("Screen Sharing Options"):i._("Share Your Screen"),u=this.props.disabled?"M18.475 17H12v14h14.887l-.6-1H13V18h6.076l-.6-1zm3.5 0H36v14h-5.613\n        l-.6-1H35V18H22.576l-.6-1zm5.513 15H19v1h9.09l-.602-1zm-7.81-13H14v10\n        h11.685l-6.008-10zm3.5 0H34v10h-4.815l-6.008-10zm7.183 16.087l.86-.515\n        L18.858 14l-.858.515 12.36 20.572z":q?"M24.706 18l3.182 3.183a.5.5 0 0 1-.707.707L24 18.708l-3.182 3.182\n          a.5.5 0 0 1-.707-.707L23.292 18l-3.182-3.182a.5.5 0 0 1 .707-.707\n          L24 17.294l3.182-3.182a.5.5 0 0 1 .707.707zM28.999 17v1h6v12h-22\n          V18h6v-1h-7v14h24V17h-7zm-10 15h10v1h-10z":"M12 17v14h24V17H12zm23 13H13V18h22v12zm-16.001 2h10v1h-10z\n          m-4.986-13.005h20.018v10.009H14.013z";return c("React").createElement(c("RTCCallControlsButton.react"),babelHelpers["extends"]({className:c("joinClasses")(p,"semiopaque icon-48"),"data-testid":c("ScreenSharingWebDriverIDs").SHARE_SCREEN_BUTTON,onClick:r||this.$RTCCallControlsToggleScreenSharingButton1,title:t},{highlighted:q},s),c("React").createElement("svg",{viewBox:"0 0 48 48"},c("React").createElement("path",{d:u})))};n.prototype.componentWillUnmount=function(){var o=this.context;if(o&&o.dialogHide)o.dialogHide()};n.prototype.$RTCCallControlsToggleScreenSharingButton4=function(event,o){c("Bootloader").loadModules(["CollabMessengerLogger"],function(p){var q=c("RTCCallStore").getState(),r=q.localUser,s=q.callInfo;p.log(event,{peerID:r.FBID,callID:s.conferenceName,eventDetails:o})},"RTCCallControlsToggleScreenSharingButton.react")};n.contextTypes={dialogShow:l.func,dialogHide:l.func};n.defaultProps={disabled:false,highlighted:false};f.exports=n}),null);
__d("RTCP2PAppViewFooter.react",["cx","fbt","FBRTCCallControlPopover.react","FBRTCConfig","FBRTCScreenSharingUtils","FBRTCUtils","FluxContainer","React","RTCAppViewFooter.react","RTCCallActions","RTCCallControls.react","RTCCallControlsCloseWindowButton.react","RTCCallControlsEndCallButton.react","RTCCallControlsEscalationAcceptButton.react","RTCCallControlsEscalationDeclineButton.react","RTCCallControlsRedialButton.react","RTCCallControlsToggleAudioButton.react","RTCCallControlsToggleScreenSharingButton.react","RTCCallControlsToggleVideoButton.react","RTCCallStore","RTCConferenceState","RTCGroupCallDispatcher","RTCP2PCallActions","RTCP2PCallEscalationActions","RTCP2PCallEscalationStore","RTCP2PCallStore","RTCP2PProtocolHandler","RTCSelfView.react","RTCUserSettingsStore","RTCUtils","dangerouslyBypassDispatchError","keyMirror"],(function a(b,c,d,e,f,g,h,i){"use strict";var j,k,l,m,n,o,p=c("React").PureComponent,q=1e4,r=c("keyMirror")({READY:null,SHOWN:null,COMPLETE:null}),s=255,t=320;j=babelHelpers.inherits(u,p);k=j&&j.prototype;u.getStores=function(){return[c("RTCP2PCallEscalationStore")]};u.calculateState=function(){var C=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],D=c("RTCP2PCallEscalationStore").getState();return babelHelpers["extends"]({},C,{awaitingEscalationACK:D.awaitingACK,escalated:D.escalated,escalationInProgress:D.inProgress,escalationRequest:Boolean(D.request)})};function u(C){k.constructor.call(this,C);this.state=u.calculateState({forceVisible:r.READY});this.$RTCP2PAppViewFooter1=0;this.$RTCP2PAppViewFooter3=0;this.$RTCP2PAppViewFooter4=0;this.$RTCP2PAppViewFooter8=0;this.$RTCP2PAppViewFooter10=0;this.$RTCP2PAppViewFooter16=function(){if(this.state.escalationInProgress)c("RTCP2PCallEscalationActions").cancel();else c("RTCP2PProtocolHandler").initStream(true).then(function(D){this.$RTCP2PAppViewFooter6=D;c("RTCP2PCallEscalationActions").start()}.bind(this))["catch"](emptyFunction)}.bind(this);this.$RTCP2PAppViewFooter17=function(D){if(this.$RTCP2PAppViewFooter9!==D){this.$RTCP2PAppViewFooter9=D;this.forceUpdate()}}.bind(this);this.$RTCP2PAppViewFooter18=function(D){if(this.$RTCP2PAppViewFooter7!==D){this.$RTCP2PAppViewFooter7=D;this.forceUpdate()}}.bind(this);this.$RTCP2PAppViewFooter11=function(D){var E=D.width;if(this.$RTCP2PAppViewFooter10===E)return;this.$RTCP2PAppViewFooter10=E;this.$RTCP2PAppViewFooter19()}.bind(this);this.$RTCP2PAppViewFooter12=function(D){var E=D.width;if(this.$RTCP2PAppViewFooter1===E)return;this.$RTCP2PAppViewFooter1=E;this.$RTCP2PAppViewFooter19()}.bind(this);this.$RTCP2PAppViewFooter13=function(D){var E=D.width;if(this.$RTCP2PAppViewFooter8===E)return;this.$RTCP2PAppViewFooter8=E;this.$RTCP2PAppViewFooter19()}.bind(this);c("RTCGroupCallDispatcher").explicitlyRegisterStores([c("RTCCallStore"),c("RTCP2PCallEscalationStore"),c("RTCP2PCallStore"),c("RTCUserSettingsStore")])}u.prototype.render=function(){var C=this.props,D=C.canPeerReceiveScreenSharing,E=C.conferenceState,F=C.hasRemoteScreenStream,G=C.isAudioCall,H=C.isRemoteVideoSupported,I=C.localUser,J=C.remotePeerName,K=this.state.escalationInProgress;switch(E){case c("RTCConferenceState").CONNECTING:return c("React").createElement(c("RTCAppViewFooter.react"),{className:"_2s-6",onResize:this.$RTCP2PAppViewFooter11},c("React").createElement(c("RTCCallControls.react"),{autoHide:false,className:"_2s-7",onResize:this.$RTCP2PAppViewFooter12,ref:function(M){return this.$RTCP2PAppViewFooter2=M?M.getDOMNode():M}.bind(this)},c("React").createElement(v,babelHelpers["extends"]({disabled:!c("FBRTCConfig").isVCEndpointCall()},{localUser:I})),c("React").createElement(x,{localUser:I}),c("React").createElement(y,null),c("React").createElement(c("RTCCallControlsEndCallButton.react"),{onClick:B})),c("React").createElement(c("RTCSelfView.react"),{className:"_2s-8",onResize:this.$RTCP2PAppViewFooter13,user:I}));case c("RTCConferenceState").CONNECTED:if(this.state.escalationRequest){var L=this.state.awaitingEscalationACK;return c("React").createElement(c("RTCAppViewFooter.react"),{className:"_2s-6"},c("React").createElement(c("RTCCallControls.react"),{autoHide:false,className:"_2s-7"},c("React").createElement(c("RTCCallControlsEscalationDeclineButton.react"),{disabled:L,onClick:this.$RTCP2PAppViewFooter14,title:i._("Decline")}),c("React").createElement(c("RTCCallControlsEscalationAcceptButton.react"),{disabled:L,onClick:this.$RTCP2PAppViewFooter15,title:i._("Accept")})))}return c("React").createElement(c("RTCAppViewFooter.react"),{className:"_2s-6",onResize:this.$RTCP2PAppViewFooter11},c("React").createElement(c("RTCCallControls.react"),{autoHide:!G&&this.state.forceVisible!==r.SHOWN,className:"_2s-7",onResize:this.$RTCP2PAppViewFooter12,ref:function(M){return this.$RTCP2PAppViewFooter2=M?M.getDOMNode():M}.bind(this)},G&&H?c("React").createElement(c("RTCCallControlsToggleVideoButton.react"),{highlighted:K,title:K?i._("Disable Your Video"):i._("Enable Your Video"),onClick:this.$RTCP2PAppViewFooter16}):c("React").createElement(v,babelHelpers["extends"]({disabled:!H,ref:this.$RTCP2PAppViewFooter17},{localUser:I})),c("React").createElement(w,babelHelpers["extends"]({peerName:J,reference:this.$RTCP2PAppViewFooter9,videoIsAutoDisabled:this.props.videoIsAutoDisabled},{isRemoteVideoSupported:H,localUser:I})),c("React").createElement(x,{localUser:I}),c("React").createElement(y,babelHelpers["extends"]({disabled:G||!D||F,ref:this.$RTCP2PAppViewFooter18},{localUser:I})),c("React").createElement(z,babelHelpers["extends"]({peerName:J,reference:this.$RTCP2PAppViewFooter7},{canPeerReceiveScreenSharing:D,hasRemoteScreenStream:F,isAudioCall:G})),c("React").createElement(c("RTCCallControlsEndCallButton.react"),{onClick:B})),c("React").createElement(c("RTCSelfView.react"),{className:"_2s-8",onResize:this.$RTCP2PAppViewFooter13,user:I}));case c("RTCConferenceState").TERMINATING:return c("React").createElement(c("RTCAppViewFooter.react"),{className:"_2s-6",onResize:this.$RTCP2PAppViewFooter11},c("React").createElement(c("RTCCallControls.react"),{autoHide:false,className:"_2s-7",onResize:this.$RTCP2PAppViewFooter12,ref:function(M){return this.$RTCP2PAppViewFooter2=M?M.getDOMNode():M}.bind(this)},c("React").createElement(v,babelHelpers["extends"]({disabled:true},{localUser:I})),c("React").createElement(x,babelHelpers["extends"]({disabled:true},{localUser:I})),c("React").createElement(y,babelHelpers["extends"]({disabled:true},{localUser:I})),c("React").createElement(c("RTCCallControlsEndCallButton.react"),{disabled:true})),c("React").createElement(c("RTCSelfView.react"),{className:"_2s-8",onResize:this.$RTCP2PAppViewFooter13,user:I}));case c("RTCConferenceState").TERMINATED:return c("React").createElement(c("RTCAppViewFooter.react"),{className:"_2s-6"},c("React").createElement(c("RTCCallControls.react"),{autoHide:false,className:"_2s-7",onResize:this.$RTCP2PAppViewFooter12,ref:function(M){return this.$RTCP2PAppViewFooter2=M?M.getDOMNode():M}.bind(this)},c("React").createElement(c("RTCCallControlsCloseWindowButton.react"),null),c("React").createElement(A,null)));default:return c("React").createElement(c("RTCAppViewFooter.react"),{className:"_2s-6"})}};u.prototype.$RTCP2PAppViewFooter14=function(){c("RTCP2PCallEscalationActions").setResponse(false)};u.prototype.$RTCP2PAppViewFooter15=function(){c("RTCP2PProtocolHandler").initStream(true).then(function(C){c("RTCP2PCallEscalationActions").setResponse(true);c("RTCP2PProtocolHandler").replaceLocalStream(C)})["catch"](emptyFunction)};u.prototype.$RTCP2PAppViewFooter19=function(){var C,D=this;if(this.$RTCP2PAppViewFooter10===0||this.$RTCP2PAppViewFooter1===0)return;var E=Math.min(0,this.$RTCP2PAppViewFooter10/2-(this.$RTCP2PAppViewFooter1/2+this.$RTCP2PAppViewFooter8));if(E===this.$RTCP2PAppViewFooter3)return;this.$RTCP2PAppViewFooter3=E;if(this.$RTCP2PAppViewFooter2)(function(){var F=D.$RTCP2PAppViewFooter2.style;F.transition="none";D.$RTCP2PAppViewFooter4=requestAnimationFrame(function(){F.transform="translateX("+this.$RTCP2PAppViewFooter3+"px)";F.transition=""}.bind(D))})()};u.prototype.componentWillReceiveProps=function(C){var D=this.props.localUser,E=this.state.forceVisible;if(C.videoIsAutoDisabled||D.hasStream()&&!D.hasVideo()){if(E===r.READY){this.setState({forceVisible:r.SHOWN});this.$RTCP2PAppViewFooter5=setTimeout(function(){this.setState({forceVisible:r.COMPLETE})}.bind(this),q)}}else if(E===r.SHOWN)this.setState({forceVisible:r.COMPLETE})};u.prototype.componentDidUpdate=function(C,D){var E,F=this;if(D===this.state)return;if(D.escalationInProgress&&!this.state.escalationInProgress)if(this.$RTCP2PAppViewFooter6)(function(){var G=F.$RTCP2PAppViewFooter6;if(F.state.escalated)c("dangerouslyBypassDispatchError")(function(){c("RTCP2PProtocolHandler").replaceLocalStream(G)});else c("RTCUtils").stopMediaStream(G);F.$RTCP2PAppViewFooter6=null})()};u.prototype.componentWillUnmount=function(){if(this.$RTCP2PAppViewFooter6){c("RTCUtils").stopMediaStream(this.$RTCP2PAppViewFooter6);this.$RTCP2PAppViewFooter6=null}cancelAnimationFrame(this.$RTCP2PAppViewFooter4);clearTimeout(this.$RTCP2PAppViewFooter5)};u.defaultProps={isRemoteVideoSupported:true,videoIsAutoDisabled:false};l=babelHelpers.inherits(v,p);m=l&&l.prototype;v.prototype.render=function(){var C=this.props.localUser;return C?c("React").createElement(c("RTCCallControlsToggleVideoButton.react"),{disabled:this.props.disabled||!C.hasVideo(),highlighted:C.hasVideo()&&C.isVideoMuted()}):c("React").createElement(c("RTCCallControlsToggleVideoButton.react"),{disabled:true})};function v(){l.apply(this,arguments)}var w=function w(C){var D=C.isRemoteVideoSupported,E=C.localUser,F=C.peerName,G=C.reference,H=C.videoIsAutoDisabled;if(!G)return null;var I=null;if(!D)I=c("FBRTCCallControlPopover.react").Types.REMOTE_VIDEO_UNSUPPORTED;else if(!E.hasVideo())I=c("FBRTCCallControlPopover.react").Types.NO_VIDEO_TRACKS;else if(H)I=c("FBRTCCallControlPopover.react").Types.VIDEO_AUTO_DISABLED;return I?c("React").createElement(c("FBRTCCallControlPopover.react"),babelHelpers["extends"]({className:"_26bw",width:t},{peerName:F,reason:I,reference:G})):null},x=function x(C){var D=C.disabled,E=C.localUser;return E?c("React").createElement(c("RTCCallControlsToggleAudioButton.react"),babelHelpers["extends"]({highlighted:E.isAudioMuted()},{disabled:D})):c("React").createElement(c("RTCCallControlsToggleAudioButton.react"),{disabled:true})};n=babelHelpers.inherits(y,p);o=n&&n.prototype;y.prototype.render=function(){if(!c("FBRTCScreenSharingUtils").isScreenSharingSupported())return null;var C=this.props.localUser;if(!C)return c("React").createElement(c("RTCCallControlsToggleScreenSharingButton.react"),{disabled:true});var D=C.screenStreams.first();return c("React").createElement(c("RTCCallControlsToggleScreenSharingButton.react"),babelHelpers["extends"]({disabled:this.props.disabled,highlighted:D!=null,onResetCallClick:function E(){B();c("RTCP2PCallActions").reload()}},{screenStream:D}))};function y(){n.apply(this,arguments)}var z=function z(C){var D=C.canPeerReceiveScreenSharing,E=C.hasRemoteScreenStream,F=C.isAudioCall,G=C.peerName,H=C.reference;if(!H)return null;if(!c("FBRTCScreenSharingUtils").isScreenSharingSupported())return null;var I=null;if(!D)I=c("FBRTCCallControlPopover.react").Types.SCREENSHARING_UNAVAILABLE;else if(E)I=c("FBRTCCallControlPopover.react").Types.PEER_IS_SHARING_SCREEN;else if(F)I=c("FBRTCCallControlPopover.react").Types.IS_AUDIO_CALL;return I?c("React").createElement(c("FBRTCCallControlPopover.react"),babelHelpers["extends"]({className:"_26bw",isVCEndpointCall:c("FBRTCConfig").isVCEndpointCall(),width:s},{peerName:G,reason:I,reference:H})):null},A=c("FluxContainer").createFunctional(function(C){return c("React").createElement(c("RTCCallControlsRedialButton.react"),C)},function(){return[c("RTCP2PCallStore"),c("RTCUserSettingsStore")]},function(){var C=c("RTCP2PCallStore").isAudioOnly();return{isAudioCall:C,onClick:function D(){c("RTCCallActions").reset(c("FBRTCUtils").generateRandomInt().toString());var E=c("RTCUserSettingsStore").getState(),F=E.audioInput,G=E.videoInput;c("RTCP2PProtocolHandler").initStream(!C,F,G).then(function(H){c("RTCCallActions").addLocalStream(H);c("RTCP2PCallStore").getState().protocolHandler.startCall()})["catch"](function(H){})}}});function B(){return c("RTCP2PCallStore").getState().protocolHandler.endCall()}f.exports=c("FluxContainer").create(u)}),null);
__d("RTCCallControlsPopOutScreenContentButton.react",["cx","fbt","FluxContainer","React","RTCCallControlsButton.react","RTCGroupCallDispatcher","RTCP2PCallActions","RTCP2PCallNUXActions","RTCP2PCallNUXIDs","RTCP2PCallNUXStore","XUIAmbientNUX.react","joinClasses"],(function a(b,c,d,e,f,g,h,i){"use strict";var j,k,l=c("React").PureComponent;j=babelHelpers.inherits(m,l);k=j&&j.prototype;m.getStores=function(){return[c("RTCP2PCallNUXStore")]};m.calculateState=function(){var n=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];return babelHelpers["extends"]({},n,{showNux:c("RTCP2PCallNUXStore").getState().showRemoteScreenContentPopOutNUX})};function m(n){k.constructor.call(this,n);this.state=m.calculateState();this.$RTCCallControlsPopOutScreenContentButton2=function(){if(this.state.showNux)this.$RTCCallControlsPopOutScreenContentButton5();c("RTCP2PCallActions").togglePopOutScreenContent(this.props.mediaStream)}.bind(this);this.$RTCCallControlsPopOutScreenContentButton3=function(o){this.$RTCCallControlsPopOutScreenContentButton1=o&&o.getDOMNode?o.getDOMNode():o}.bind(this);c("RTCGroupCallDispatcher").explicitlyRegisterStores([c("RTCP2PCallNUXStore")])}m.prototype.render=function(){var n=!this.props.mediaStream,o=n?i._("Show Shared Content"):i._("Open Shared Content in New Window"),p=n?"M36.01 14.996H24.02a2 2 0 0 0-2 2v4.997h4.028a3 3 0 0 1 3\n        3v2.003h6.96a2 2 0 0 0 2-2v-8a2 2 0 0 0-2-2zm-10.004\n        8.007H14.018a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h11.988a2 2 0 0 0\n        2-2v-8a2 2 0 0 0-2-2zm0 10H14.018v-8h11.988v8z":"M26 23H14.012a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2H26a2 2 0 0 0 2-2v-8a2 2 0 0\n        0-2-2zm9.994-8H24.006a2 2 0 0 0-2 2v4.997h2V17h11.988v8h-6.967v2h6.967a2\n        2 0 0 0 2-2v-8a2 2 0 0 0-2-2z";return c("React").createElement("div",null,c("React").createElement(c("RTCCallControlsButton.react"),{className:c("joinClasses")(this.props.className,"transparent icon-50"),onClick:this.props.onClick||this.$RTCCallControlsPopOutScreenContentButton2,ref:this.$RTCCallControlsPopOutScreenContentButton3,title:this.props.title||o},c("React").createElement("svg",{viewBox:"0 0 50 50"},c("React").createElement("path",{d:p}),c("React").createElement("path",{className:(!n?"showIfHighlighted":"")+(n?" hideIfHighlighted":""),d:"M50.024 49.022h-50M50.024 48.02h-50M50.024 47.02h-50M50.024 46.02h-50M50.024 45.018h-50M50.024 44.017h-50M50.024 43.016h-50M50.024 42.016h-50M50.024 41.015h-50M50.024 40.014h-50M50.024 39.013h-50M50.024 38.012h-50M50.024 37.01h-50M50.024 36.01h-50M50.024 35.01h-50M50.024 34.008h-50M50.024 33.007h-50M50.024 32.006h-50M50.024 31.005h-50M50.024 30.005h-50M50.024 29.004h-50M50.024 28.003h-50M50.024 27.002h-50M50.024 26h-50M50.024 25h-50M50.024 24h-50M50.024 22.998h-50M50.024 21.997h-50M50.024 20.996h-50M50.024 19.995h-50M50.024 18.994h-50M50.024 17.994h-50M50.024 16.993h-50M50.024 15.992h-50M50.024 14.99h-50M50.024 13.99h-50M50.024 12.99h-50M50.024 11.988h-50M50.02410.987h-50M50.024 9.986h-50M50.024 8.985h-50M50.024 7.984h-50M50.024 6.984h-50M50.024 5.983h-50M50.024 4.982h-50M50.024 3.98h-50M50.024 2.98h-50M50.024 1.98h-50M50.024.978h-50"}))),this.$RTCCallControlsPopOutScreenContentButton4())};m.prototype.$RTCCallControlsPopOutScreenContentButton5=function(){c("RTCP2PCallNUXActions").dismissNUX(c("RTCP2PCallNUXIDs").RTC_P2P_REMOTE_SCREEN_CONTENT_POP_OUT_NUX)};m.prototype.$RTCCallControlsPopOutScreenContentButton4=function(){if(!this.state.showNux||!this.props.mediaStream)return null;c("RTCP2PCallNUXActions").markNUXViewed(c("RTCP2PCallNUXIDs").RTC_P2P_REMOTE_SCREEN_CONTENT_POP_OUT_NUX);var n=i._("Pop out shared content as a separate window");return c("React").createElement(c("XUIAmbientNUX.react"),{alignment:"right",contextRef:function(){return this.$RTCCallControlsPopOutScreenContentButton1}.bind(this),position:"below",shown:this.state.showNux,onCloseButtonClick:this.$RTCCallControlsPopOutScreenContentButton5,width:"auto"},n)};f.exports=c("FluxContainer").create(m)}),null);
__d("RTCSettingsAudioInputPreview.react",["cx","fbt","AudioContextSingleton","React","cancelAnimationFrame","joinClasses","requestAnimationFrame"],(function a(b,c,d,e,f,g,h,i){"use strict";var j,k,l=c("React").PureComponent,m={fftSize:32,minDecibels:-90,maxDecibels:-10,smoothingTimeConstant:1},n=Math.log2(128+1);j=babelHelpers.inherits(o,l);k=j&&j.prototype;function o(t){k.constructor.call(this,t);this.state={noAudioTrack:false};this.$RTCSettingsAudioInputPreview2=c("AudioContextSingleton").get();this.$RTCSettingsAudioInputPreview3=this.$RTCSettingsAudioInputPreview2.createGain();this.$RTCSettingsAudioInputPreview3.gain.value=t.gain;this.$RTCSettingsAudioInputPreview4=this.$RTCSettingsAudioInputPreview2.createAnalyser();Object.assign(this.$RTCSettingsAudioInputPreview4,m)}o.prototype.$RTCSettingsAudioInputPreview7=function(t){this.$RTCSettingsAudioInputPreview8();if(!(t&&this.$RTCSettingsAudioInputPreview1))return;if(t.getAudioTracks().length<1){this.setState({noAudioTrack:true});return}var u=this.$RTCSettingsAudioInputPreview1.getContext("2d");if(!u)return;if(this.$RTCSettingsAudioInputPreview5)this.$RTCSettingsAudioInputPreview5.disconnect();this.$RTCSettingsAudioInputPreview5=this.$RTCSettingsAudioInputPreview2.createMediaStreamSource(t);this.$RTCSettingsAudioInputPreview5.connect(this.$RTCSettingsAudioInputPreview3);this.$RTCSettingsAudioInputPreview3.connect(this.$RTCSettingsAudioInputPreview4);var v=this.$RTCSettingsAudioInputPreview4.frequencyBinCount,w=new Uint8Array(v),x=this.props,y=x.width,z=x.height,A=void 0,B=function(){this.$RTCSettingsAudioInputPreview4.getByteTimeDomainData(w);var C=p(w,y,z,A);A=C;u.clearRect(0,0,y,z);u.fillStyle=this.props.fillStyle;u.fill(r(C,y,z));this.$RTCSettingsAudioInputPreview6=c("requestAnimationFrame")(B)}.bind(this);this.$RTCSettingsAudioInputPreview6=c("requestAnimationFrame")(B)};o.prototype.$RTCSettingsAudioInputPreview8=function(){c("cancelAnimationFrame")(this.$RTCSettingsAudioInputPreview6)};o.prototype.render=function(){var t=this.props,u=t.className,v=t.height,w=t.width,x=babelHelpers.objectWithoutProperties(t,["className","height","width"]),y=this.state.noAudioTrack;return c("React").createElement("div",babelHelpers["extends"]({className:c("joinClasses")("_brl"+(y?" noAudioTrack":""),u)},x),y?c("React").createElement("span",null,this.props.noMicMessage):null,c("React").createElement("canvas",babelHelpers["extends"]({ref:function(z){return this.$RTCSettingsAudioInputPreview1=z}.bind(this)},{width:w,height:v})))};o.prototype.componentWillReceiveProps=function(t){var u=t.mediaStream,v=t.gain;this.$RTCSettingsAudioInputPreview3.gain.value=v;if(u!==this.props.mediaStream){this.setState({noAudioTrack:false});this.$RTCSettingsAudioInputPreview7(u)}};o.prototype.componentDidMount=function(){this.$RTCSettingsAudioInputPreview7(this.props.mediaStream)};o.prototype.componentWillUnmount=function(){this.$RTCSettingsAudioInputPreview8();if(this.$RTCSettingsAudioInputPreview5)this.$RTCSettingsAudioInputPreview5.disconnect();if(this.$RTCSettingsAudioInputPreview3)this.$RTCSettingsAudioInputPreview3.disconnect()};o.defaultProps={fillStyle:"rgba(255, 255, 255, .5)",gain:3.5,height:26,noMicMessage:i._("No Mic"),width:106};function p(t,u,v,w){return[128].concat(q(t),[128]).map(function(x,y,z){var A=v*(Math.log2(Math.abs(x)+1)/n);return{x:y*u/(z.length-1),y:w?Math.min(A,v-(v-w[y].y)*.95):A}})}function q(t){var u=[];for(var v=0;v*2<t.length;v++)u[v]=Math.min(t[v*2],t[v*2+1]||0);return u}function r(t,u,v){var w=new Path2D();w.moveTo(0,v);t.forEach(function(x,y,t){switch(y){case 0:w.lineTo(x.x,x.y);break;case 1:break;case t.length-1:w.bezierCurveTo.apply(w,s(x,t[y-1],x));w.lineTo(x.x,x.y);break;case 2:w.lineTo((5*t[y-2].x+t[y-1].x)/6,(5*t[y-2].y+t[y-1].y)/6);default:w.bezierCurveTo.apply(w,s(x,t[y-2],t[y-1]))}});w.lineTo(u,v);w.closePath();return w}function s(t,u,v){return[(2*u.x+v.x)/3,(2*u.y+v.y)/3,(u.x+2*v.x)/3,(u.y+2*v.y)/3,(u.x+4*v.x+t.x)/6,(u.y+4*v.y+t.y)/6]}f.exports=o}),null);
__d("RTCSettingsAudioOutputPreview.react",["cx","Promise","FBRTCUtils","React","MercurySoundsConfig"],(function a(b,c,d,e,f,g,h){"use strict";var i,j,k=c("React").PureComponent;i=babelHelpers.inherits(l,k);j=i&&i.prototype;function l(){var m,n;for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return n=(m=j.constructor).call.apply(m,[this].concat(p)),this.state={currentTime:0,disabled:true,duration:0,playing:false},this.$RTCSettingsAudioOutputPreview5=function(){var r=this.$RTCSettingsAudioOutputPreview1;if(!r||this.state.disabled)return;if(this.state.playing){r.pause();r.currentTime=0;this.$RTCSettingsAudioOutputPreview11()}else{this.setState({disabled:true});c("Promise").resolve(r.play()).done(function(){return this.setState({disabled:false})}.bind(this))}}.bind(this),this.$RTCSettingsAudioOutputPreview12=function(r){if(r)this.$RTCSettingsAudioOutputPreview2=r}.bind(this),this.$RTCSettingsAudioOutputPreview13=function(r){if(r){r.volume=.3;this.$RTCSettingsAudioOutputPreview1=r}}.bind(this),this.$RTCSettingsAudioOutputPreview14=function(r){var s=r.target;this.setState({disabled:false,duration:s.duration})}.bind(this),this.$RTCSettingsAudioOutputPreview15=function(){clearInterval(this.$RTCSettingsAudioOutputPreview3);this.setState({playing:true,currentTime:0});var r=Date.now(),s=function(){return this.setState({currentTime:(Date.now()-r)/1e3})}.bind(this);s();this.$RTCSettingsAudioOutputPreview3=setInterval(s,40)}.bind(this),this.$RTCSettingsAudioOutputPreview11=function(){clearInterval(this.$RTCSettingsAudioOutputPreview3);this.$RTCSettingsAudioOutputPreview3=setTimeout(function(){return this.setState({playing:false,currentTime:0})}.bind(this),250)}.bind(this),n}l.prototype.render=function(){return c("React").createElement("div",{className:"_10mu",tabIndex:0,onClick:this.$RTCSettingsAudioOutputPreview5,role:"presentation"},this.$RTCSettingsAudioOutputPreview6(),this.$RTCSettingsAudioOutputPreview7(),this.$RTCSettingsAudioOutputPreview8(),this.$RTCSettingsAudioOutputPreview9(),this.$RTCSettingsAudioOutputPreview10())};l.prototype.$RTCSettingsAudioOutputPreview6=function(){return c("React").createElement("audio",{ref:this.$RTCSettingsAudioOutputPreview12,autoPlay:true})};l.prototype.$RTCSettingsAudioOutputPreview7=function(){return c("React").createElement("audio",{ref:this.$RTCSettingsAudioOutputPreview13,autoPlay:false,loop:false,preload:"auto",onDurationChange:this.$RTCSettingsAudioOutputPreview14,onPlay:this.$RTCSettingsAudioOutputPreview15,onEnded:this.$RTCSettingsAudioOutputPreview11},c("React").createElement("source",{src:c("MercurySoundsConfig").settings_preview_sound_mp3_url,type:"audio/mpeg"}),c("React").createElement("source",{src:c("MercurySoundsConfig").settings_preview_sound_ogg_url,type:"audio/ogg"}))};l.prototype.$RTCSettingsAudioOutputPreview8=function(){var m=this.state.playing?c("React").createElement("path",{d:"M7 5h2v10H7V5zm4 0h2v10H11V5z"}):c("React").createElement("path",{d:"M7 6l6 4-6 4"});return c("React").createElement("svg",{className:"_odh button",viewBox:"0 0 20 20"},m)};l.prototype.$RTCSettingsAudioOutputPreview9=function(){var m=this.state,n=m.duration,o=m.currentTime;return c("React").createElement("div",{className:"_odz"},c("React").createElement("div",{className:"_od-",style:{transform:"scaleX("+(n?o/n:0)+")"}}))};l.prototype.$RTCSettingsAudioOutputPreview10=function(){var m=this.state.playing?this.state.currentTime:this.state.duration;return c("React").createElement("div",{className:"_odh text"},Math.floor(m)+"s")};l.prototype.componentDidMount=function(){var m=this.props,n=m.sinkID,o=m.mediaStream;this.$RTCSettingsAudioOutputPreview16(o);this.$RTCSettingsAudioOutputPreview4=setTimeout(function(){return this.$RTCSettingsAudioOutputPreview17(n)}.bind(this),1e3)};l.prototype.componentDidUpdate=function(m){var n=this.props,o=n.sinkID,p=n.mediaStream;if(p!==m.mediaStream){this.$RTCSettingsAudioOutputPreview16(p);this.$RTCSettingsAudioOutputPreview17(o)}else if(o!==m.sinkID)this.$RTCSettingsAudioOutputPreview17(o)};l.prototype.$RTCSettingsAudioOutputPreview16=function(m){if(this.$RTCSettingsAudioOutputPreview2&&m)c("FBRTCUtils").attachMediaStream(this.$RTCSettingsAudioOutputPreview2,m)};l.prototype.$RTCSettingsAudioOutputPreview17=function(m){clearTimeout(this.$RTCSettingsAudioOutputPreview4);if(!this.$RTCSettingsAudioOutputPreview18()||!m)return;[this.$RTCSettingsAudioOutputPreview2,this.$RTCSettingsAudioOutputPreview1].reduce(function(n,o){return o?n.then(function(){return o.setSinkId(m)}):n},c("Promise").resolve())["catch"](function(n){})};l.prototype.$RTCSettingsAudioOutputPreview18=function(){var m=HTMLAudioElement,n=m.prototype;return"sinkId"in n&&typeof n.setSinkId==="function"};l.prototype.componentWillUnmount=function(){if(this.$RTCSettingsAudioOutputPreview1)this.$RTCSettingsAudioOutputPreview1.pause();clearInterval(this.$RTCSettingsAudioOutputPreview3);clearInterval(this.$RTCSettingsAudioOutputPreview4);this.$RTCSettingsAudioOutputPreview2=null;this.$RTCSettingsAudioOutputPreview1=null};l.defaultProps={sinkID:null};f.exports=l}),null);
__d("RTCUserSettingsActions",["RTCGroupCallDispatcher","RTCUserSettingsActionTypes"],(function a(b,c,d,e,f,g){"use strict";var h={edit:function i(){c("RTCGroupCallDispatcher").dispatch({type:c("RTCUserSettingsActionTypes").USER_SETTINGS_EDIT})},cancel:function i(){c("RTCGroupCallDispatcher").dispatch({type:c("RTCUserSettingsActionTypes").USER_SETTINGS_CANCEL_EDITING})},save:function i(j){c("RTCGroupCallDispatcher").dispatch(babelHelpers["extends"]({type:c("RTCUserSettingsActionTypes").USER_SETTINGS_SAVE},j))},setAudioInput:function i(j){c("RTCGroupCallDispatcher").dispatch({type:c("RTCUserSettingsActionTypes").USER_SETTINGS_SET_AUDIO_INPUT,audioInput:j})},setAudioOutput:function i(j){c("RTCGroupCallDispatcher").dispatch({type:c("RTCUserSettingsActionTypes").USER_SETTINGS_SET_AUDIO_OUTPUT,audioOutput:j})},setVideoInput:function i(j){c("RTCGroupCallDispatcher").dispatch({type:c("RTCUserSettingsActionTypes").USER_SETTINGS_SET_VIDEO_INPUT,videoInput:j})}};f.exports=h}),null);
__d("RTCSettingsDialog.react",["cx","fbt","FBRTCConfig","FBRTCConstants","FBRTCUtils","FBRTCVideo.react","FluxContainer","Link.react","React","RTCDialog.react","RTCDialogBody.react","RTCDialogHeader.react","RTCDialogHeaderButton.react","RTCGroupCallDispatcher","RTCMediaDevicesStore","RTCSettingsAudioInputPreview.react","RTCSettingsAudioOutputPreview.react","RTCSettingsMediaDeviceSelector.react","RTCUserMediaConstraints","RTCUserSettingsActions","RTCUserSettingsStore","RTCUtils","XUIGrayText.react","XUIText.react","joinClasses"],(function a(b,c,d,e,f,g,h,i){"use strict";var j,k,l=c("FBRTCConstants").VideoQuality,m=c("React").PureComponent;function n(){var u=c("RTCUserSettingsStore").getState(),v=u.audioInput,w=u.audioOutput,x=u.videoInput;return{audioInput:v,audioOutput:w,devices:null,mediaStream:null,videoInput:x}}j=babelHelpers.inherits(o,m);k=j&&j.prototype;o.getStores=function(){return[c("RTCMediaDevicesStore")]};o.calculateState=function(){var u=arguments.length<=0||arguments[0]===undefined?n():arguments[0];return babelHelpers["extends"]({},u,{devices:c("RTCMediaDevicesStore").getState()})};function o(u){k.constructor.call(this,u);this.state=o.calculateState();this.$RTCSettingsDialog3=function(){c("RTCUserSettingsActions").cancel();this.props.onToggle(false)}.bind(this);this.$RTCSettingsDialog4=function(){var v=this.state,w=v.audioInput,x=v.audioOutput,y=v.videoInput;c("RTCUserSettingsActions").save({audioInput:w,audioOutput:x,videoInput:y});this.props.onToggle(false)}.bind(this);c("RTCGroupCallDispatcher").explicitlyRegisterStores([c("RTCMediaDevicesStore"),c("RTCUserSettingsStore")]);c("RTCMediaDevicesStore").refresh()}o.prototype.render=function(){if(!this.state.devices)return null;var u=this.props.onToggle;return c("React").createElement(c("RTCDialog.react"),{width:544,onToggle:u},this.$RTCSettingsDialog1(),this.$RTCSettingsDialog2())};o.prototype.$RTCSettingsDialog1=function(){return c("React").createElement(c("RTCDialogHeader.react"),null,c("React").createElement("h1",{className:"_10mm"},i._("Settings")),c("React").createElement(c("RTCDialogHeaderButton.react"),{label:i._("Cancel"),onClick:this.$RTCSettingsDialog3}),c("React").createElement(c("RTCDialogHeaderButton.react"),{label:i._("Save"),onClick:this.$RTCSettingsDialog4}))};o.prototype.$RTCSettingsDialog2=function(){return c("React").createElement(c("RTCDialogBody.react"),null,this.$RTCSettingsDialog5(),this.$RTCSettingsDialog6(),this.$RTCSettingsDialog7(),this.$RTCSettingsDialog8())};o.prototype.$RTCSettingsDialog5=function(){if(this.props.isAudioOnly)return null;return c("React").createElement(p,{className:"_10mn"},c("React").createElement(q,null,c("React").createElement(r,null,i._("Camera"))),c("React").createElement(q,null,c("React").createElement(c("RTCSettingsMediaDeviceSelector.react"),{devices:s(this.state.devices,"videoinput"),maxwidth:212,fullWidth:true,onChange:function(u){var v=u.value;return this.$RTCSettingsDialog9({videoInput:v})}.bind(this),defaultValue:this.state.videoInput})),c("React").createElement(q,null,c("React").createElement(c("FBRTCVideo.react"),{className:"_10mo",muted:true,mediaStream:this.state.mediaStream})))};o.prototype.$RTCSettingsDialog9=function(u){this.setState(u,function(){this.$RTCSettingsDialog10()}.bind(this))};o.prototype.$RTCSettingsDialog6=function(){return c("React").createElement(p,{className:"_10mn"},c("React").createElement(q,null,c("React").createElement(r,null,i._("Microphone"))),c("React").createElement(q,null,c("React").createElement(c("RTCSettingsMediaDeviceSelector.react"),{devices:s(this.state.devices,"audioinput"),maxwidth:212,fullWidth:true,onChange:function(u){var v=u.value;return this.$RTCSettingsDialog9({audioInput:v})}.bind(this),defaultValue:this.state.audioInput})),c("React").createElement(q,null,c("React").createElement(c("RTCSettingsAudioInputPreview.react"),{mediaStream:this.state.mediaStream})))};o.prototype.$RTCSettingsDialog7=function(){if(!c("FBRTCUtils").supportsSetSink())return null;return c("React").createElement(p,{className:"_10mn"},c("React").createElement(q,null,c("React").createElement(r,null,i._("Audio output"))),c("React").createElement(q,null,c("React").createElement(c("RTCSettingsMediaDeviceSelector.react"),{maxwidth:212,fullWidth:true,devices:s(this.state.devices,"audiooutput"),onChange:function(u){var v=u.value;return this.setState({audioOutput:v})}.bind(this),defaultValue:this.state.audioOutput})),c("React").createElement(q,null,c("React").createElement(c("RTCSettingsAudioOutputPreview.react"),{sinkID:this.state.audioOutput,mediaStream:this.props.remoteStream})))};o.prototype.$RTCSettingsDialog8=function(){return c("React").createElement("footer",{className:"_10mv _10mn"},c("React").createElement(q,null,c("React").createElement(c("XUIGrayText.react"),{shade:"light",size:"medium"},i._("Tip: Try restarting your browser if you're having trouble with your camera or microphone."))),c("React").createElement(q,null,c("React").createElement(c("XUIText.react"),{size:"medium"},c("React").createElement(c("Link.react"),{href:c("FBRTCConfig").userMediaErrorUrl(),target:"_blank"},i._("Get help")))))};o.prototype.componentDidMount=function(){c("RTCUserSettingsActions").edit();this.$RTCSettingsDialog10()["catch"](t)};o.prototype.$RTCSettingsDialog10=function(){var u=this.state,v=u.audioInput,w=u.mediaStream,x=u.videoInput;return c("RTCUtils").getUserMedia({audio:c("RTCUserMediaConstraints").audio(v),video:this.props.isAudioOnly?false:c("RTCUserMediaConstraints").video(l.HD_VIDEO,x)}).then(function(y){if(w)c("RTCUtils").stopMediaStream(w);this.setState({mediaStream:y})}.bind(this))};o.prototype.componentWillUpdate=function(u,v){if(v.audioInput!==this.state.audioInput||v.videoInput!==this.state.videoInput)this.$RTCSettingsDialog10()["catch"](t)};o.prototype.componentWillUnmount=function(){var u=this.state.mediaStream;if(u)c("RTCUtils").stopMediaStream(u)};var p=function p(u){var v=u.children,w=u.className,x=babelHelpers.objectWithoutProperties(u,["children","className"]);return c("React").createElement("section",babelHelpers["extends"]({className:c("joinClasses")(w,"_10mx")},x),v)},q=function q(u){var v=u.children,w=babelHelpers.objectWithoutProperties(u,["children"]);return c("React").createElement("div",babelHelpers["extends"]({className:"_10my"},w),v)},r=function r(u){var v=u.children,w=babelHelpers.objectWithoutProperties(u,["children"]);return c("React").createElement("h1",babelHelpers["extends"]({className:"_10mz"},w),v)};function s(u,v){return u?u.filter(function(w){return w.kind===v}):[]}function t(u){}f.exports=c("FluxContainer").create(o)}),null);
__d("RTCCallControlsShowSettingsButton.react",["cx","fbt","FBRTCUserSettings","FluxContainer","React","RTCCallControlsButton.react","RTCGroupCallDispatcher","RTCP2PCallNUXActions","RTCP2PCallNUXIDs","RTCP2PCallNUXStore","RTCSettingsDialog.react","RTCSVGIconDropShadowFilter.react","XUIAmbientNUX.react","joinClasses"],(function a(b,c,d,e,f,g,h,i){"use strict";var j,k,l=c("React").PropTypes,m=c("React").PureComponent;j=babelHelpers.inherits(n,m);k=j&&j.prototype;n.getStores=function(){return[c("RTCP2PCallNUXStore")]};n.calculateState=function(){var o=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];return babelHelpers["extends"]({},o,{showNux:c("RTCP2PCallNUXStore").getState().showSettingsNUX})};function n(o){k.constructor.call(this,o);this.state=n.calculateState({highlighted:false});this.$RTCCallControlsShowSettingsButton3=function(){if(!c("FBRTCUserSettings").isEnabled())return;var p=this.context;if(p&&p.dialogShow&&p.dialogHide){p.dialogShow(c("React").createElement(c("RTCSettingsDialog.react"),{isAudioOnly:this.props.isAudioOnly,onToggle:this.$RTCCallControlsShowSettingsButton9,remoteStream:this.props.remoteStream}));this.setState({highlighted:true})}if(this.state.showNux)this.$RTCCallControlsShowSettingsButton10()}.bind(this);this.$RTCCallControlsShowSettingsButton9=function(){this.setState({highlighted:false});this.context.dialogHide()}.bind(this);this.$RTCCallControlsShowSettingsButton5=function(p){if(p){this.$RTCCallControlsShowSettingsButton2=p.getURL();this.forceUpdate()}}.bind(this);this.$RTCCallControlsShowSettingsButton4=function(p){this.$RTCCallControlsShowSettingsButton1=p&&p.getDOMNode?p.getDOMNode():p}.bind(this);c("RTCGroupCallDispatcher").explicitlyRegisterStores([c("RTCP2PCallNUXStore")])}n.prototype.render=function(){var o=this.props,p=o.className,q=o.onClick,r=babelHelpers.objectWithoutProperties(o,["className","onClick"]),s=this.state.highlighted;return c("React").createElement("div",null,c("React").createElement(c("RTCCallControlsButton.react"),babelHelpers["extends"]({className:c("joinClasses")(p,"transparent icon-50"),onClick:q||this.$RTCCallControlsShowSettingsButton3},{highlighted:s},{ref:this.$RTCCallControlsShowSettingsButton4},r),c("React").createElement("svg",{viewBox:"0 0 50 50"},c("React").createElement("defs",null,c("React").createElement(c("RTCSVGIconDropShadowFilter.react"),{ref:this.$RTCCallControlsShowSettingsButton5,height:24,width:24})),c("React").createElement("g",{filter:this.$RTCCallControlsShowSettingsButton2},this.$RTCCallControlsShowSettingsButton6(s),this.$RTCCallControlsShowSettingsButton7(s)))),this.$RTCCallControlsShowSettingsButton8())};n.prototype.$RTCCallControlsShowSettingsButton6=function(o){return c("React").createElement("g",{className:(o?"showIfHighlighted":"")+(!o?" hideIfHighlighted":""),strokeWidth:"2"},c("React").createElement("path",{d:"M34.1 23.4l-1.4-.2c-1.1-.2-1.7-1.5-1-2.4l.8-1.1 c.3-.4.3-1-.1-1.3l-.9-.9c-.3-.4-.9-.4-1.3-.1l-1.1.8 c-.9.7-2.2.1-2.4-1l-.2-1.4c-.1-.5-.5-.9-1-.9h-1.3 c-.5 0-.9.4-1 .9l-.2 1.4c-.2 1.1-1.5 1.7-2.4 1l-1.1-.8 c-.4-.3-1-.3-1.3.1l-.9.9c-.3.4-.4.9-.1 1.3l.8 1.1 c.7.9.1 2.2-1 2.4l-1.4.2c-.5.1-.9.5-.9 1v1.3c0 .5.4.9.9 1l1.4.2 c1.1.2 1.7 1.5 1 2.4l-.8 1.1c-.3.4-.3 1 .1 1.3l.9.9 c.3.4.9.4 1.3.1l1.1-.8c.9-.7 2.2-.1 2.4 1l.2 1.4c.1.5.5.9 1 .9 h1.3c.5 0 .9-.4 1-.9l.2-1.4c.2-1.1 1.5-1.7 2.4-1l1.1.8 c.4.3 1 .3 1.3-.1l.9-.9c.4-.4.4-.9.1-1.3l-.8-1.1 c-.7-.9-.1-2.2 1-2.4l1.4-.2c.5-.1.9-.5.9-1v-1.3c0-.5-.4-1-.9-1z",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"}),c("React").createElement("circle",{cx:"25",cy:"25",r:"3.5",fill:"none"}))};n.prototype.$RTCCallControlsShowSettingsButton7=function(o){return c("React").createElement("path",{className:(!o?"showIfHighlighted":"")+(o?" hideIfHighlighted":""),d:"M34.2 22.9l-1.4-.2c-.4-.1-.6-.3-.8-.6-.1-.3-.1-.7.1-1L33 20 c.4-.6.4-1.4-.1-2l-.9-.9c-.3-.3-.7-.4-1.1-.4-.3 0-.6.1-.9.3l-1.1.8 c-.2.1-.4.2-.6.2-.4 0-.9-.3-1-.9l-.2-1.4c-.1-.7-.7-1.3-1.5-1.3h-1.3 c-.7 0-1.4.5-1.5 1.3l-.2 1.4c-.1.6-.6.9-1 .9-.2 0-.4-.1-.6-.2l-1-.8 c-.3-.2-.6-.3-.9-.3-.4 0-.8.2-1.1.4l-.9.9c-.5.5-.6 1.4-.1 2l.8 1.1 c.2.3.3.6.1 1-.1.3-.4.6-.8.6l-1.4.2c-.7.1-1.3.7-1.3 1.5v1.3 c0 .7.5 1.4 1.3 1.5l1.4.2c.3.1.6.3.8.6s.1.7-.1 1l-.8 1 c-.4.6-.4 1.4.1 2l.9.9c.3.3.7.4 1.1.4.3 0 .6-.1.9-.3l1.1-.8 c.2-.1.4-.2.6-.2.4 0 .9.3 1 .9l.2 1.4c.1.7.7 1.3 1.5 1.3h1.3 c.7 0 1.4-.5 1.5-1.3l.2-1.4c.1-.6.6-.9 1-.9.2 0 .4.1.6.2l1 .8 c.3.2.6.3.9.3.4 0 .8-.2 1.1-.4l.9-.9c.5-.5.6-1.4.1-2l-.8-1.1 c-.2-.3-.3-.7-.1-1 .1-.3.4-.6.8-.6l1.4-.2c.7-.1 1.3-.7 1.3-1.5 v-1.3c-.1-.7-.6-1.3-1.4-1.4zM25 28.5c-1.9 0-3.5-1.6-3.5-3.5 s1.6-3.5 3.5-3.5 3.5 1.6 3.5 3.5-1.6 3.5-3.5 3.5z"})};n.prototype.$RTCCallControlsShowSettingsButton10=function(){c("RTCP2PCallNUXActions").dismissNUX(c("RTCP2PCallNUXIDs").RTC_P2P_SETTINGS_NUX)};n.prototype.$RTCCallControlsShowSettingsButton8=function(){if(!this.state.showNux)return null;c("RTCP2PCallNUXActions").markNUXViewed(c("RTCP2PCallNUXIDs").RTC_P2P_SETTINGS_NUX);var o=i._("Change your microphone, camera and speaker devices");return c("React").createElement(c("XUIAmbientNUX.react"),{alignment:"right",contextRef:function(){return this.$RTCCallControlsShowSettingsButton1}.bind(this),position:"below",shown:true,onCloseButtonClick:this.$RTCCallControlsShowSettingsButton10,width:"auto"},o)};n.prototype.componentWillUnmount=function(){if(this.state.highlighted)this.context.dialogHide()};n.contextTypes={dialogShow:l.func,dialogHide:l.func};n.defaultProps={title:i._("Settings")};f.exports=c("FluxContainer").create(n)}),null);
__d("RTCP2PAppViewHeader.react",["FBRTCConfig","FBRTCUserSettings","React","RTCAppViewHeader.react","RTCCallControls.react","RTCCallControlsPopOutScreenContentButton.react","RTCCallControlsShowCameraControlsButton.react","RTCCallControlsShowSettingsButton.react","RTCCallControlsToggleFullScreenButton.react","RTCConferenceState","RTCP2PCallNUXStore"],(function a(b,c,d,e,f,g){"use strict";var h=function h(k){var l=k.conferenceState,m=k.isAudioCall,n=k.isScreenContentPoppedOut,o=k.remoteUser,p=!j({conferenceState:l,isAudioCall:m,isScreenContentPoppedOut:n,remoteUser:o});switch(l){case c("RTCConferenceState").CONNECTED:return c("React").createElement(c("RTCAppViewHeader.react"),{isAudioCall:m},c("React").createElement(c("RTCCallControls.react"),babelHelpers["extends"]({compact:true},{autoHide:p}),o&&o.hasScreenStream()?c("React").createElement(c("RTCCallControlsPopOutScreenContentButton.react"),{mediaStream:n?null:o.screenStreams.first()}):null,c("FBRTCConfig").isVCEndpointCall()?c("React").createElement(c("RTCCallControlsShowCameraControlsButton.react"),null):null,c("React").createElement(c("RTCCallControlsToggleFullScreenButton.react"),null),c("React").createElement(i,{peer:o,isAudioOnly:m})));default:return c("React").createElement(c("RTCAppViewHeader.react"),{isAudioCall:m},c("React").createElement(c("RTCCallControls.react"),babelHelpers["extends"]({compact:true},{autoHide:p}),c("React").createElement(c("RTCCallControlsToggleFullScreenButton.react"),null)))}},i=function i(k){var l=k.isAudioOnly,m=k.peer;return c("FBRTCUserSettings").isEnabled()?c("React").createElement(c("RTCCallControlsShowSettingsButton.react"),{isAudioOnly:l,remoteStream:m?m.streams.first():null}):null};function j(k){var l=k.conferenceState,m=k.isAudioCall,n=k.isScreenContentPoppedOut,o=k.remoteUser;if(m)return true;if(l!==c("RTCConferenceState").CONNECTED)return false;var p=c("RTCP2PCallNUXStore").getState(),q=p.showRemoteCameraControlsNUX,r=p.showRemoteScreenContentPopOutNUX,s=p.showRemoteStreamsSliderNUX,t=p.showSettingsNUX;return t||c("FBRTCConfig").isVCEndpointCall()&&q||!!o&&o.hasScreenStream()&&!n&&(s||r)}f.exports=h}),null);
__d("RTCPeerConnectionStats.react",["React"],(function a(b,c,d,e,f,g){"use strict";var h,i,j=c("React").PureComponent;h=babelHelpers.inherits(k,j);i=h&&h.prototype;function k(){var l,m;for(var n=arguments.length,o=Array(n),p=0;p<n;p++)o[p]=arguments[p];return m=(l=i.constructor).call.apply(l,[this].concat(o)),this.state={stats:[]},m}k.prototype.render=function(){return null;if(this.state.stats.length<1)return null;var l={background:"white",bottom:0,color:"black",fontSize:10,left:0,margin:0,opacity:.7,padding:"1em",position:"absolute",textAlign:"left",zIndex:9};return c("React").createElement("pre",{style:l},[this.$RTCPeerConnectionStats2("in"),this.$RTCPeerConnectionStats2("out")].filter(Boolean).join("\n"))};k.prototype.$RTCPeerConnectionStats2=function(l){var m=this.state.stats.filter(function(n){return n.direction===l}).map(function(n){var o=n.id,p=n.type,q=n.packetsLost,r=n.resolution,s=n.frameRate,t=babelHelpers.objectWithoutProperties(n,["id","type","packetsLost","resolution","frameRate"]),u=void 0;if(l==="in"){var v=t.bytesReceived,w=t.packetsReceived,x=q/(w+q)||0;u=["b:  "+v,"p:  "+q+" / "+w,"l:  "+x.toFixed(4).replace(/\.?0+$/,"")+"%"]}else{var y=t.bytesSent,z=t.packetsSent,A=q/(z+q)||0;u=["b:  "+y,"p:  "+q+" / "+z,"l:  "+A.toFixed(4).replace(/\.?0+$/,"")+"%"]}if(s)u.unshift("fr: "+s);if(r)u.unshift("r:  "+r);return p+" "+l+":\n  "+u.join("\n  ")}).join("\n");if(!m.length)return"";return m};k.prototype.componentDidMount=function(){return;this.$RTCPeerConnectionStats1=setInterval(function(){var l=this.props.connection;if(!l||l.getIceConnectionState()==="closed"||l.getIceConnectionState()==="disconnected")return;l.getStats().then(function(m){var n=[];for(var o=m.values(),p=Array.isArray(o),q=0,o=p?o:o[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var r;if(p){if(q>=o.length)break;r=o[q++]}else{q=o.next();if(q.done)break;r=q.value}var s=r;if(s.type==="ssrc"){var t={id:s.id,packetsLost:s.packetsLost||0,type:s.mediaType};if(s.mediaType==="video"){var u=s.googBandwidthLimitedResolution?" (BW limited)":"";if("googFrameWidthSent"in s){var v=s.googFrameWidthSent,w=s.googFrameHeightSent;t.resolution=v+"x"+w+u}else if("googFrameWidthReceived"in s){var x=s.googFrameWidthReceived,y=s.googFrameHeightReceived;t.resolution=x+"x"+y+u}if("googFrameRateInput"in s){var z=s.googFrameRateInput,A=s.googFrameRateSent;t.frameRate=z+" -> "+A}else if("googFrameRateOutput"in s){var B=s.googFrameRateOutput,C=s.googFrameRateReceived;t.frameRate=B+" -> "+C}}if("bytesSent"in s){t.bytesSent=s.bytesSent;t.packetsSent=s.packetsSent;t.direction="out"}else{t.bytesReceived=s.bytesReceived;t.packetsReceived=s.packetsReceived;t.direction="in"}n.push(t)}}return n}).then(function(m){return this.setState({stats:m})}.bind(this))["catch"](function(m){return false})}.bind(this),1e3)};k.prototype.componentWillUnmount=function(){clearInterval(this.$RTCPeerConnectionStats1)};f.exports=k}),null);
__d("RTCP2PAppView.react",["FluxContainer","React","RTCAppSpinner.react","RTCAppView.react","RTCAppViewFooter.react","RTCAppViewHeader.react","RTCAppViewMain.react","RTCCallType","RTCGrantUserMediaAccessView.react","RTCGroupCallDispatcher","RTCP2PAppViewContent.react","RTCP2PAppViewFooter.react","RTCP2PAppViewHeader.react","RTCP2PCallEscalationStore","RTCP2PCallStore","RTCPeerConnectionStats.react","RTCUserMediaRequest","RTCUserMediaRequestState"],(function a(b,c,d,e,f,g){"use strict";var h,i;h=babelHelpers.inherits(j,c("React").PureComponent);i=h&&h.prototype;j.getStores=function(){return[c("RTCP2PCallEscalationStore"),c("RTCP2PCallStore")]};j.calculateState=function(){var k=c("RTCP2PCallStore").getState(),l=k.callType,m=k.connectionStatus,n=k.endCallReason,o=k.isScreenContentPoppedOut,p=k.signalingExperiments;return{connectionStatus:m,endCallReason:n,canPeerReceiveScreenSharing:p.remoteSupport("screen_sharing"),isAudioCall:l===c("RTCCallType").AUDIO_ONLY,isScreenContentPoppedOut:o,startedEscalation:c("RTCP2PCallEscalationStore").isStarted()}};function j(k){i.constructor.call(this,k);this.state=j.calculateState();c("RTCGroupCallDispatcher").explicitlyRegisterStores([c("RTCP2PCallEscalationStore"),c("RTCP2PCallStore")])}j.prototype.render=function(){var k=this.props,l=k.conferenceState,m=k.remoteUser,n=k.userMediaRequest,o=this.state,p=o.isAudioCall,q=o.isScreenContentPoppedOut;switch(n.state){case c("RTCUserMediaRequestState").PENDING:case c("RTCUserMediaRequestState").REJECTED:return c("React").createElement(c("RTCAppView.react"),{isAudioCall:p},c("React").createElement(c("RTCAppViewHeader.react"),{isAudioCall:p}),c("React").createElement(c("RTCAppViewMain.react"),{fullBleed:true},c("React").createElement(c("RTCGrantUserMediaAccessView.react"),{isAudioCall:p,userMediaRequest:n})),c("React").createElement(c("RTCAppViewFooter.react"),null));case c("RTCUserMediaRequestState").FULFILLED:return c("React").createElement(c("RTCAppView.react"),{isAudioCall:p&&!this.state.startedEscalation},c("React").createElement(c("RTCP2PAppViewHeader.react"),{conferenceState:l,isAudioCall:p,isScreenContentPoppedOut:q,remoteUser:m}),c("React").createElement(c("RTCP2PAppViewContent.react"),{conferenceName:this.props.conferenceName,conferenceState:l,connectionStatus:this.state.connectionStatus,endCallReason:this.state.endCallReason,isAudioCall:p,isScreenContentPoppedOut:q,remoteUser:m}),c("React").createElement(c("RTCP2PAppViewFooter.react"),{canPeerReceiveScreenSharing:this.state.canPeerReceiveScreenSharing,conferenceState:l,hasRemoteScreenStream:m?m.hasScreenStream():false,isAudioCall:p,localUser:this.props.localUser,remotePeerName:m?m.userName:""}),c("React").createElement(c("RTCPeerConnectionStats.react"),{connection:this.props.connection}));default:return c("React").createElement(c("RTCAppView.react"),{isAudioCall:p},c("React").createElement(c("RTCAppViewHeader.react"),{isAudioCall:p}),c("React").createElement(c("RTCAppViewMain.react"),{fullBleed:true},c("React").createElement(c("RTCAppSpinner.react"),null)),c("React").createElement(c("RTCAppViewFooter.react"),null))}};f.exports=c("FluxContainer").create(j)}),null);
__d("RTCP2PLoggerStore",["Bootloader","CollabCallMessengerBrowserEventEnum","FBRTCConfig","FBRTCLogger","FluxReduceStore","RTCCallStore","RTCGroupCallActionTypes","RTCGroupCallDispatcher","RTCUserSettingsActionTypes"],(function a(b,c,d,e,f,g){"use strict";var h,i;h=babelHelpers.inherits(j,c("FluxReduceStore"));i=h&&h.prototype;j.prototype.getInitialState=function(){return 1};j.prototype.reduce=function(l,m){var n=c("RTCCallStore").getState(),o=n.remoteUsers,p=n.callInfo;if(!o.count())return 1;var q=c("FBRTCLogger").getInstance(),r=o.first().FBID;switch(m.type){case c("RTCGroupCallActionTypes").AUDIO_MUTED:q.logCallAction(r,p.conferenceName,c("FBRTCLogger").CallAction.SET_MUTE,true);break;case c("RTCGroupCallActionTypes").AUDIO_UNMUTED:q.logCallAction(r,p.conferenceName,c("FBRTCLogger").CallAction.SET_MUTE,false);break;case c("RTCGroupCallActionTypes").VIDEO_MUTED:q.logCallAction(r,p.conferenceName,c("FBRTCLogger").CallAction.SET_VIDEO_ON,false);break;case c("RTCGroupCallActionTypes").VIDEO_UNMUTED:q.logCallAction(r,p.conferenceName,c("FBRTCLogger").CallAction.SET_VIDEO_ON,true);break;case c("RTCGroupCallActionTypes").SELF_VIEW_COLLAPSED:q.logCallAction(r,p.conferenceName,c("FBRTCLogger").CallAction.SET_SELF_VIEW_ON,false);break;case c("RTCGroupCallActionTypes").SELF_VIEW_UNCOLLAPSED:q.logCallAction(r,p.conferenceName,c("FBRTCLogger").CallAction.SET_SELF_VIEW_ON,true);break;case c("RTCGroupCallActionTypes").ADD_LOCAL_STREAM:this.$RTCP2PLoggerStore1(c("CollabCallMessengerBrowserEventEnum").LOCAL_STREAM_SET,m.stream,r,Number(p.conferenceName));break;case c("RTCUserSettingsActionTypes").USER_SETTINGS_SAVE:case c("RTCUserSettingsActionTypes").USER_SETTINGS_SET_AUDIO_INPUT:case c("RTCUserSettingsActionTypes").USER_SETTINGS_SET_AUDIO_OUTPUT:case c("RTCUserSettingsActionTypes").USER_SETTINGS_SET_VIDEO_INPUT:q.logCallAction(r,p.conferenceName,c("FBRTCLogger").CallAction.USER_SETTINGS_CHANGED);this.$RTCP2PLoggerStore1(c("CollabCallMessengerBrowserEventEnum").USER_SETTINGS_CHANGED,m,r,Number(p.conferenceName))}return 1};j.prototype.$RTCP2PLoggerStore1=function(event,l,m,n){k(function(o){return o.log(event,{peerID:m,callID:n,eventDetails:l})})};function j(){h.apply(this,arguments)}function k(l){if(!c("FBRTCConfig").isVCEndpointCall())return;c("Bootloader").loadModules(["CollabMessengerLogger"],l,"RTCP2PLoggerStore")}f.exports=new j(c("RTCGroupCallDispatcher"))}),null);
__d("RTCP2PCallContainer.react",["cx","fbt","PageHooks","CSS","FBRTCConstants","FBRTCHangupReason","FBRTCLogger","FBRTCMessageListener","FBRTCUtils","FluxContainer","immutable","MessengerRTCFunnelLogger","React","RTCCallActions","RTCCallStore","RTCCallType","RTCConferenceState","RTCGroupCallDispatcher","RTCMediaDevicesStore","RTCP2PAppView.react","RTCP2PCallActions","RTCP2PCallNUXStore","RTCP2PCallStore","RTCP2PCallWindowHandler","RTCP2PLoggerStore","RTCP2PProtocolHandler","RTCUser","RTCUserMediaRequest","RTCUserMediaRequestState","RTCUserSettingsStore","Run"],(function a(b,c,d,e,f,g,h,i){"use strict";var j,k;c("PageHooks");var l=c("FBRTCConstants").SignalingProtocol;j=babelHelpers.inherits(m,c("React").PureComponent);k=j&&j.prototype;m.getStores=function(){return[c("RTCCallStore"),c("RTCP2PCallStore"),c("RTCUserSettingsStore")]};m.calculateState=function(){var o=c("RTCCallStore").getState(),p=o.callInfo,q=p.conferenceState,r=p.conferenceName,s=o.connections,t=o.localUser,u=o.remoteUsers;return{conferenceName:r,conferenceState:q,connection:s.first(),isAudioCall:c("RTCP2PCallStore").getState().callType===c("RTCCallType").AUDIO_ONLY,localUser:t,protocolHandler:c("RTCP2PCallStore").getState().protocolHandler,remoteUser:u.first(),userSettings:c("RTCUserSettingsStore").getState()}};function m(o){k.constructor.call(this,o);this.state=babelHelpers["extends"]({},m.calculateState(),{userMediaRequest:new(c("RTCUserMediaRequest"))()});this.$RTCP2PCallContainer1=0;this.$RTCP2PCallContainer2=c("FBRTCLogger").getInstance();this.$RTCP2PCallContainer3=function(){if(this.state.conferenceState===c("RTCConferenceState").CONNECTED)return i._("Leaving this page will end your call.");return null}.bind(this);this.$RTCP2PCallContainer4=function(){if(this.state.conferenceState===c("RTCConferenceState").TERMINATED)return;var p=this.state.userMediaRequest,q=c("FBRTCHangupReason").HANGUP_CALL,r="BrowserClosed";if(p.state!==c("RTCUserMediaRequestState").FULFILLED){q=c("FBRTCHangupReason").CLIENT_ERROR;r=p.state===c("RTCUserMediaRequestState").PENDING?"MediaPending":"MediaDenied"}this.state.protocolHandler.endCall(q,r,true)}.bind(this);c("RTCGroupCallDispatcher").explicitlyRegisterStores([c("RTCCallStore"),c("RTCP2PCallNUXStore"),c("RTCP2PCallStore"),c("RTCP2PLoggerStore"),c("RTCMediaDevicesStore"),c("RTCUserSettingsStore")]);if(this.props.nonce)c("MessengerRTCFunnelLogger").setWindowNonce(this.props.nonce);c("RTCCallActions").initialize(l.P2P,this.props.conferenceName||c("FBRTCUtils").generateRandomInt().toString());c("RTCCallActions").initLocalUser(new(c("RTCUser"))(o.localUser));c("RTCCallActions").initRemoteUsers(c("immutable").Set([new(c("RTCUser"))(o.remoteUser)]));c("RTCP2PCallActions").setCallType(this.props.isAudioCall?c("RTCCallType").AUDIO_ONLY:c("RTCCallType").AUDIO_VIDEO)}m.prototype.componentDidMount=function(){c("RTCP2PCallWindowHandler").init(window);if(document.documentElement)c("CSS").addClass(document.documentElement,"_2ujx");c("Run").onBeforeUnload(this.$RTCP2PCallContainer3,false);c("Run").onUnload(this.$RTCP2PCallContainer4);this.$RTCP2PCallContainer2.logCallAction(this.$RTCP2PCallContainer5(),this.$RTCP2PCallContainer6(),c("FBRTCLogger").CallAction.POPUP_OPENED);this.state.protocolHandler.init(this.$RTCP2PCallContainer5(),this.$RTCP2PCallContainer6(),this.props.isUsingMultiway);this.$RTCP2PCallContainer1=setTimeout(function(){this.setState(function(o){var p=o.userMediaRequest;return{userMediaRequest:p.set("state",p.state||c("RTCUserMediaRequestState").PENDING)}})}.bind(this),200);this.$RTCP2PCallContainer7().then(function(o){return c("RTCCallActions").addLocalStream(o)}).then(function(){return this.$RTCP2PCallContainer8()}.bind(this))["catch"](n)};m.prototype.$RTCP2PCallContainer5=function(){return this.props.remoteUser.FBID};m.prototype.$RTCP2PCallContainer6=function(){return Number(this.props.conferenceName||this.state.conferenceName)};m.prototype.$RTCP2PCallContainer7=function(){c("MessengerRTCFunnelLogger").appendAction("user_media_requested");return c("RTCP2PProtocolHandler").initStream(!this.props.isAudioCall).then(function(o){this.setState(function(p){var q=p.userMediaRequest;return{userMediaRequest:q.set("state",c("RTCUserMediaRequestState").FULFILLED)}});c("MessengerRTCFunnelLogger").appendAction("user_media_succeeded");return o}.bind(this))["catch"](function(o){this.setState(function(p){var q=p.userMediaRequest;return{userMediaRequest:q.set("error",o).set("state",c("RTCUserMediaRequestState").REJECTED)}});c("MessengerRTCFunnelLogger").appendAction("user_media_rejected");throw o}.bind(this))};m.prototype.$RTCP2PCallContainer8=function(){this.state.protocolHandler.fetchTURNCredentials().then(function(){var o=c("FBRTCMessageListener").setParentWindowStartCallHandler(function(){this.state.protocolHandler.startCall();if(o){o();o=null}}.bind(this));c("FBRTCMessageListener").init(true,this.$RTCP2PCallContainer5());setTimeout(function(){c("RTCCallActions").waitForUserInput();if(o){o();o=null}},1500)}.bind(this))["catch"](n)};m.prototype.render=function(){return c("React").createElement(c("RTCP2PAppView.react"),{conferenceName:this.state.conferenceName,conferenceState:this.state.conferenceState,connection:this.state.connection,localUser:this.state.localUser,remoteUser:this.state.remoteUser,userMediaRequest:this.state.userMediaRequest})};m.prototype.componentDidUpdate=function(o,p){if(!this.state||!p)return;if(p.userSettings.editing&&!this.state.userSettings.editing){var q=this.state.userSettings,r=q.audioInput,s=q.videoInput;if(p.userSettings.audioInput!==r||p.userSettings.videoInput!==s)c("RTCP2PProtocolHandler").initStream(!this.state.isAudioCall,r,s).then(function(t){return c("RTCP2PProtocolHandler").replaceLocalStream(t)})["catch"](n)}if(this.state.conferenceState===p.conferenceState)this.$RTCP2PCallContainer2.logToConsole('UI: no state change; current state - "'+this.state.conferenceState+'"');else this.$RTCP2PCallContainer2.logToConsole('UI: state change - from "'+p.conferenceState+'" to "'+this.state.conferenceState+'"')};m.prototype.componentWillUnmount=function(){clearTimeout(this.$RTCP2PCallContainer1);if(document.documentElement)c("CSS").removeClass(document.documentElement,"_2ujx")};function n(o){}f.exports=c("FluxContainer").create(m)}),null);